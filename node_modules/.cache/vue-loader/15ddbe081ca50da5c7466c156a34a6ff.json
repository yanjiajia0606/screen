{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/group/container.vue?vue&type=style&index=0&id=a9d4729a&prod&lang=scss&","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/group/container.vue","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIkAvc3R5bGVzL2VjaGFydC5zY3NzIjsKQGltcG9ydCAiQC9zdHlsZXMvc3R5bGUuc2NzcyI7Cg=="},{"version":3,"sources":["container.vue"],"names":[],"mappings":";AA8TA;AACA","file":"container.vue","sourceRoot":"src/page/group","sourcesContent":["<template>\n  <div class=\"middle\">\n    <div id=\"wrapper\"\n         class=\"wrapper\"\n         @mousedown=\"contain.handleMouseDown\">\n      <div class=\"content\"\n           id=\"content\"\n           ref=\"content\"\n           :style=\"contentStyle\">\n        <div class=\"container\"\n             :style=\"styleName\"\n             id=\"container\"\n             ref=\"container\">\n          <div class=\"grade\"\n               v-if=\"gradeFlag || contain.config.gradeShow\"\n               :style=\"gradeLenStyle\"></div>\n          <subgroup ref=\"subgroup\"\n                    :nav=\"contain.list\"></subgroup>\n\n        </div>\n      </div>\n    </div>\n    <wechat ref=\"wechat\"></wechat>\n  </div>\n</template>\n\n<script>\nimport wechat from '@/page/wechat/'\nimport subgroup from './subgroup'\nimport { config as defaultConfig } from '@/option/config'\nimport { getObj } from '@/api/visual'\nimport { website } from '@/config.js'\nimport Vue from 'vue'\nVue.prototype.$website = website;\nexport default {\n  name: 'contents',\n  inject: [\"contain\"],\n  props: {\n    target: String,\n    option: Object,\n    id: [String, Number],\n    wscale: Number\n  },\n  provide () {\n    return {\n      contain: this.contain,\n      container: this\n    };\n  },\n  components: {\n    subgroup,\n    wechat\n  },\n  data () {\n    return {\n      width: 0,\n      height: 0,\n      contentStyle: {},\n      selectCount: {\n        x1: null,\n        x2: null,\n        y1: null,\n        y2: null\n      },\n      scale: 1,\n      gradeFlag: false,\n    }\n  },\n  computed: {\n    stepScale () {\n      let scale = Number((100 / (this.scale * this.wscale))).toFixed(2) * 1\n      return scale\n    },\n    //计算中央可视化大屏比例\n    styleName () {\n      const widthVal = (this.contain.width / this.contain.config.width)\n      const heightVal = (this.contain.height / this.contain.config.height)\n\n      let scaleX = widthVal, scaleY = widthVal;\n      if (!this.isBuild) {\n        let screen = this.contain.config.screen;\n        if (screen == 'x') {\n          this.contain.viewStyle = {\n            'overflow-y': 'auto'\n          }\n        } else if (screen == 'y') {\n          scaleX = heightVal;\n          scaleY = heightVal;\n          this.contain.viewStyle = {\n            'overflow-x': 'auto'\n          }\n        } else if (screen == 'xy') {\n          scaleX = widthVal;\n          scaleY = heightVal;\n        }\n      }\n      return Object.assign({\n        transform: `scale(${scaleX}, ${scaleY})`,\n        width: this.setPx(this.contain.config.width),\n        height: this.setPx(this.contain.config.height),\n        backgroundColor: this.contain.config.backgroundColor\n      }, (() => {\n        if (this.contain.config.backgroundImage) {\n          return {\n            background: `url(${this.contain.config.backgroundImage}) 0% 0% / 100% 100% rgb(3, 12, 59)`,\n          }\n        }\n        return\n      })())\n    },\n    gradeLenStyle () {\n      return {\n        backgroundSize: `${this.setPx(this.contain.config.gradeLen)} ${this.setPx(this.contain.config.gradeLen)},${this.setPx(this.contain.config.gradeLen)} ${this.setPx(this.contain.config.gradeLen)}`\n      }\n    },\n    isBuild () {\n      return this.$route ? this.$route.name === 'build' : false;\n    }\n  },\n  mounted () {\n    // this.$refs.wechat.show()\n    this.initData();\n    this.initFun();\n  },\n  methods: {\n    getTargetDom () {\n      if (this.target) {\n        return document.querySelector(this.target)\n      }\n      return document.body\n    },\n    initFun () {\n      ['handleRefresh', 'getDragObj'].forEach(ele => {\n        this[ele] = this.$refs.subgroup[ele]\n      });\n      if (!this.isBuild) {\n        window.onresize = () => {\n          this.width = this.getTargetDom().offsetWidth;\n          this.setScale()\n        }\n      }\n    },\n    //初始化数据\n    initData () {\n      const id = this.id || (this.$route && this.$route.params.id)\n      this.width = this.isBuild ? this.$refs.content.offsetWidth : this.getTargetDom().offsetWidth;\n      this.contain.width = this.width\n      let config;\n      const callback = () => {\n        //赋值属性\n        let mark = this.contain.config.mark;\n        if (mark.show && !this.isBuild) {\n          this.watermark(Object.assign(mark, {\n            fontSize: mark.fontSize + 'px'\n          }));\n        }\n        this.calcData();\n        this.setScale();\n      }\n      if (id) {\n        const loading = this.$loading({\n          lock: true,\n          text: '正在加载中，请稍后',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        });\n        getObj(id).then(res => {\n          const data = res.data.data;\n          this.contain.obj = data;\n          config = data.config;\n          const contain = {\n            config: JSON.parse(config.detail) || {},\n            component: JSON.parse(config.component) || []\n          }\n          this.contain.config = Object.assign({}, defaultConfig, contain.config);\n          this.contain.nav = contain.component\n          this.contain.visual = data.visual;\n          document.title = this.$website.title + '-' + data.visual.title\n          //添加水印。只有查看页面生效\n          if (!this.isBuild) {\n            const password = this.contain.visual.password\n            const status = this.contain.visual.status\n            if (status == 0) {\n              this.$alert('大屏还没有发布，晚一点再来吧！', '提示', {\n                showClose: false,\n                center: true,\n                showConfirmButton: false,\n\n              });\n            } else if (!this.validatenull(password)) {\n              this.$prompt('请输入密码', '提示', {\n                confirmButtonText: '确定',\n                showCancelButton: false,\n                showClose: false,\n                closeOnClickModal: false,\n                inputPattern: new RegExp(password),\n                inputErrorMessage: '密码不正确，请重新输入'\n              }).then(() => {\n                callback();\n              })\n            } else {\n              callback();\n            }\n          } else {\n            callback();\n          }\n          loading.close();\n        }).catch((err) => {\n          console.log(err)\n          callback();\n          loading.close();\n        })\n      } else if (this.option) {\n        config = this.option;\n        this.contain.config = config.detail || {};\n        this.contain.nav = config.component || [];\n        callback();\n      } else {\n        this.setScale();\n      }\n    },\n    //计算比例\n    setScale (width) {\n      this.contain.width = width || this.width\n      this.scale = (this.contain.width / this.contain.config.width) * 100\n      this.contain.height = this.isBuild ? (this.scale * this.contain.config.height) / 100 : this.getTargetDom().offsetHeight\n      this.contentStyle = {\n        width: this.setPx(this.contain.width),\n        height: this.setPx(this.contain.height),\n      }\n    },\n    calcData () {\n      if (!this.contain.config.mark) this.contain.config.mark = {}\n      if (!this.contain.config.query) this.contain.config.query = {}\n    },\n    handlePostionSelect (postion) {\n      this.handleCalcPostionSelect();\n      const x1 = this.selectCount.x1;\n      const x2 = this.selectCount.x2;\n      const y1 = this.selectCount.y1;\n      const y2 = this.selectCount.y2;\n      if (postion === 'left') {\n        this.handleMoveSelectList(x1, undefined, true, postion);\n      } else if (postion === 'center') {\n        this.handleMoveSelectList(x1 + (x2 - x1) / 2, undefined, true, postion);\n      } else if (postion === 'right') {\n        this.handleMoveSelectList(x2, undefined, true, postion);\n      } else if (postion === 'top') {\n        this.handleMoveSelectList(undefined, y1, true, postion);\n      } else if (postion === 'middle') {\n        this.handleMoveSelectList(undefined, y1 + (y2 - y1) / 2, true, postion);\n      } else if (postion === 'bottom') {\n        this.handleMoveSelectList(undefined, y2, true, postion);\n      }\n    },\n    handleMoveSelectList (left, top, type, postion) {\n      this.contain.active.forEach(ele => {\n        ele = this.contain.findlist(ele)\n        const ele_component = ele.component;\n        //水平情况\n        if (left) {\n          let baseLeft = Number(type ? left : (ele.left + left).toFixed(2));\n          if (postion === 'right') {\n            baseLeft = baseLeft - ele_component.width\n          }\n          else if (postion === 'center') {\n            const obj_center = ele.left + ele_component.width / 2;\n            baseLeft = ele.left + (left - obj_center)\n          }\n          this.$set(ele, 'left', baseLeft);\n        }\n        //垂直情况\n        if (top) {\n          let baseTop = Number(type ? top : (ele.top + top).toFixed(2));\n          if (postion === 'bottom') {\n            baseTop = baseTop - ele_component.height\n          }\n          else if (postion === 'middle') {\n            const obj_middle = ele.top + ele_component.height / 2;\n            baseTop = ele.top + (top - obj_middle)\n          }\n          this.$set(ele, 'top', baseTop)\n        }\n      })\n    },\n    //计算多选状态下的最大边界值\n    handleCalcPostionSelect () {\n      this.selectCount = {\n        x1: null,\n        x2: null,\n        y1: null,\n        y2: null\n      }\n      this.contain.active.forEach(ele => {\n        ele = this.contain.findlist(ele)\n        const left = ele.left;\n        const top = ele.top;\n        const width = ele.component.width;\n        const height = ele.component.height;\n        if (!this.selectCount.x1) {\n          this.selectCount = {\n            x1: left,\n            x2: left + width,\n            y1: top,\n            y2: top + height\n          }\n        }\n        if (this.selectCount.x1 > left) this.selectCount.x1 = left;\n        if (this.selectCount.x2 < left + width) this.selectCount.x2 = left + width;\n        if (this.selectCount.y1 > top) this.selectCount.y1 = top;\n        if (this.selectCount.y2 < top + height) this.selectCount.y2 = top + height;\n      })\n    },\n  }\n}\n</script>\n\n<style lang=\"scss\">\n@import \"@/styles/echart.scss\";\n@import \"@/styles/style.scss\";\n</style>"]}]}