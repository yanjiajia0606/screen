{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/list/index.vue?vue&type=style&index=0&id=417b6ad6&prod&lang=scss&","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/list/index.vue","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIkAvc3R5bGVzL2xpc3Quc2NzcyI7Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA0UA","file":"index.vue","sourceRoot":"src/page/list","sourcesContent":["<template>\n  <el-container class=\"list\">\n    <el-aside width=\"180px\">\n      <ul class=\"menu\">\n        <li :index=\"item.categoryValue\"\n            :key=\"item.categoryValue\"\n            v-for=\"item in typeList\"\n            :class=\"{'is-active':item.categoryValue===activeName}\"\n            @click=\"handleSelect(item.categoryValue)\">\n          <i class=\"el-icon-s-order\"></i>\n          {{item.categoryKey}}\n        </li>\n      </ul>\n    </el-aside>\n    <el-container>\n      <el-header class=\"content__header\">\n        <p class=\"avue-tip-title\">选择下面的方式进行创建</p>\n        <div class=\"content__box content__nav\">\n          <div class=\"content__add\"\n               @click=\"handleAdd\">\n            <img :src=\"`${$router.options.base}img/new-project.png`\"\n                 height=\"40px\"\n                 alt=\"\">\n            <p>新建大屏</p>\n          </div>\n          <div class=\"content__page\">\n            <el-pagination v-if=\"page.total>0\"\n                           layout=\"total, sizes, prev, pager, next, jumper\"\n                           background\n                           size=\"small\"\n                           @size-change=\"handleSizeChange\"\n                           @current-change=\"handleCurrentChange\"\n                           :page-size=\"page.size\"\n                           :current-page.sync=\"page.page\"\n                           :total=\"page.total\">\n            </el-pagination>\n          </div>\n        </div>\n      </el-header>\n      <el-main class=\"content\">\n        <div class=\"content__box\">\n          <div class=\"content__item\"\n               v-for=\"(item,index) in list\"\n               :key=\"index\"\n               @mouseover=\"item._menu=true\"\n               @mouseout=\"item._menu=false\">\n            <div class=\"content__info\">\n              <img v-if=\"item.backgroundUrl\"\n                   :src=\"item.backgroundUrl\"\n                   alt=\"\" />\n              <div class=\"content__menu\"\n                   v-show=\"item._menu\">\n                <div class=\"content__right\">\n                  <el-tooltip content=\"导出\">\n                    <i class=\"el-icon-download\"\n                       @click=\"handleExport(item,index)\"></i>\n                  </el-tooltip>\n                  <el-tooltip content=\"预览\">\n                    <i class=\"el-icon-view\"\n                       @click=\"handleViews(item,index)\"></i>\n                  </el-tooltip>\n                </div>\n                <div class=\"content__btn\"\n                     @click=\"handleEdit(item)\">\n                  编辑\n                </div>\n                <div class=\"content__list\">\n                  <el-tooltip content=\"修改\">\n                    <i class=\"el-icon-edit\"\n                       @click=\"handleUpdate(item,index)\"></i>\n                  </el-tooltip>\n                  <el-tooltip content=\"删除\">\n                    <i class=\"el-icon-delete\"\n                       @click=\"handleDel(item,index)\"></i>\n                  </el-tooltip>\n                  <el-tooltip content=\"复制\">\n                    <i class=\"el-icon-copy-document\"\n                       @click=\"handleCopy(item,index)\"></i>\n                  </el-tooltip>\n                </div>\n              </div>\n            </div>\n            <div class=\"content__main\">\n              <span class=\"content__name\">{{item.title}}</span>\n              <div class=\"content__menulist\">\n                <div class=\"content__view\">\n                </div>\n                <span class=\"content__status\"\n                      :class=\"{'content__status--active':item.status}\">\n                  {{item.status==1?'已发布':'未发布'}}\n                </span>\n              </div>\n\n            </div>\n          </div>\n        </div>\n      </el-main>\n    </el-container>\n    <el-dialog title=\"编辑大屏\"\n               width=\"50%\"\n               :close-on-click-modal=\"false\"\n               :visible.sync=\"box\">\n      <avue-form :option=\"option\"\n                 v-model=\"form\"\n                 @submit=\"handleSave\"></avue-form>\n    </el-dialog>\n  </el-container>\n</template>\n<script>\nimport { getList, updateObj, delObj, getCategory, copyObj } from '@/api/visual';\nimport { getObj } from '@/api/visual'\nimport { url } from '@/config';\nexport default {\n  name: \"list\",\n  data () {\n    return {\n      typeList: [],\n      box: false,\n      option: {\n        submitText: '修改大屏',\n        column: [{\n          label: '分组',\n          prop: 'category',\n          span: 24,\n          labelWidth: 100,\n          type: 'select',\n          dicUrl: url + '/category/list',\n          props: {\n            label: 'categoryKey',\n            value: 'categoryValue',\n          },\n          rules: [{\n            required: true,\n            message: \"请选择分组\",\n            trigger: \"blur\"\n          }]\n        }, {\n          label: '大屏名称',\n          span: 24,\n          labelWidth: 100,\n          prop: 'title',\n          rules: [{\n            required: true,\n            message: \"请输入大屏名称\",\n            trigger: \"blur\"\n          }]\n        }, {\n          label: '密码',\n          span: 24,\n          type: 'password',\n          labelWidth: 100,\n          prop: 'password',\n        }, {\n          label: '发布状态',\n          prop: 'status',\n          span: 24,\n          labelWidth: 100,\n          type: 'select',\n          dicData: [{\n            label: '未发布',\n            value: 0\n          }, {\n            label: '已发布',\n            value: 1\n          }]\n        }]\n      },\n      page: {\n        page: 1,\n        size: 50,\n        total: 0,\n      },\n      form: {},\n      activeName: '',\n      list: [],\n    }\n  },\n  created () {\n    this.getCategory()\n  },\n  methods: {\n    handleSelect (key) {\n      this.activeName = key;\n      this.page.page = 1;\n      this.getList();\n    },\n    vaildData (id) {\n      const list = [];\n      for (var i = 0; i < 20; i++) {\n        list.push(i)\n      }\n      return list.includes(id)\n    },\n    getCategory () {\n      getCategory().then(res => {\n        const data = res.data.data;\n        this.typeList = data;\n        this.activeName = (data[0] || {}).categoryValue;\n        this.getList();\n      })\n    },\n    handleExport (item) {\n      getObj(item.id).then(res => {\n        this.$message.success('大屏导出成功')\n        const data = res.data.data;\n        let mode = {\n          detail: JSON.parse(data.config.detail),\n          component: JSON.parse(data.config.component)\n        }\n        var zip = new window.JSZip();\n        zip.file(\"view.js\", `const option =${JSON.stringify(mode, null, 4)}`);\n        zip.file(\"说明.txt\", `把view.js替换index.zip中文件即可,运行index.html即可看到效果`);\n        zip.generateAsync({ type: \"base64\" })\n          .then((content) => {\n            this.downFile(\"data:application/zip;base64,\" + content, 'view.zip')\n            setTimeout(() => {\n              location.href = '/index.zip'\n            }, 1000);\n          });\n      })\n    },\n    handleCopy (item) {\n      if (this.$website.isDemo) {\n        this.$message.error(this.$website.isDemoTip)\n        return\n      }\n      this.$confirm('确认复制当前大屏', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        copyObj(item.id).then((res) => {\n          this.$message.success('复制成功');\n          const id = res.data.data;\n          this.handleEdit({ id })\n        })\n      }).catch(() => {\n\n      });\n    },\n    handleDel (item, index) {\n      if (this.vaildData(index) && this.$website.isDemo) {\n        this.$message.error(this.$website.isDemoTip)\n        return false;\n      }\n      this.$confirm('是否确认永久删除?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        delObj(item.id).then(() => {\n          this.list.splice(index, 1)\n          this.$message.success('删除成功')\n        })\n      }).catch(() => {\n\n      });\n    },\n    handleAdd () {\n      this.$router.push({\n        path: '/create', query: {\n          category: this.activeName\n        }\n      })\n    },\n    handleUpdate (item, index) {\n      if (this.vaildData(Number(index)) && this.$website.isDemo) {\n        this.$message.error(this.$website.isDemoTip)\n        return false;\n      }\n      this.form = item\n      this.form.category = this.form.category + '';\n      this.box = true;\n    },\n    handleEdit (item) {\n      let routeUrl = this.$router.resolve({\n        path: '/build/' + item.id\n      })\n      window.open(routeUrl.href, '_blank');\n    },\n    handleViews (item) {\n      let routeUrl = this.$router.resolve({\n        path: '/view/' + item.id\n      })\n      window.open(routeUrl.href, '_blank');\n    },\n    handleSave (form, done) {\n      updateObj({\n        id: this.form.id,\n        category: this.form.category,\n        password: this.form.password,\n        status: this.form.status,\n        title: this.form.title\n      }).then(() => {\n        done();\n        this.$message.success('修改成功');\n        this.getList();\n\n      })\n    },\n    handleCurrentChange (val) {\n      this.page.page = val;\n      this.getList();\n    },\n    handleSizeChange (val) {\n      this.page.size = val;\n      this.getList();\n    },\n    getList (category) {\n      this.list = []\n      getList({\n        category: category || this.activeName,\n        current: this.page.page,\n        size: this.page.size,\n      }).then(res => {\n        const data = res.data.data;\n        this.page.total = data.total;\n        this.list = data.records\n        this.initData();\n      })\n    },\n    initData () {\n      this.list.forEach((ele, index) => {\n        this.$set(this.list[index], '_menu', false)\n      })\n    }\n  }\n}\n</script>\n<style lang=\"scss\">\n@import \"@/styles/list.scss\";\n</style>\n"]}]}