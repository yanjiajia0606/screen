{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/list/record.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/list/record.vue","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBjcnlwdG8gZnJvbSAnQC91dGlscy9jcnlwdG8nCmltcG9ydCB7IGFkZFBhcmFtIH0gZnJvbSAnQC9lY2hhcnQvdXRpbCc7CmltcG9ydCB7IGdldEZ1bmN0aW9uLCBmdW5FdmFsIH0gZnJvbSAnQC91dGlscy91dGlscycKaW1wb3J0IE1vbmFjb0VkaXRvciBmcm9tICdAL3BhZ2UvY29tcG9uZW50cy9lZGl0b3InCmltcG9ydCB7IGdldExpc3QsIGdldE9iaiwgYWRkT2JqLCBkZWxPYmosIHVwZGF0ZU9iaiB9IGZyb20gJ0AvYXBpL3JlY29yZCcKaW1wb3J0IHsgZ2V0TGlzdCBhcyBnZXREYkxpc3QsIGR5bmFtaWNTcWwgfSBmcm9tICJAL2FwaS9kYiI7CmltcG9ydCB7IGRpY09wdGlvbiB9IGZyb20gJ0Avb3B0aW9uL2NvbmZpZycKZGljT3B0aW9uLmRhdGFUeXBlLnNwbGljZSg0LCAxKQpjb25zdCBkYXRhVHlwZSA9IGRpY09wdGlvbi5kYXRhVHlwZQpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTW9uYWNvRWRpdG9yLAogIH0sCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICB0YWJzOiAwLAogICAgICBib3g6IGZhbHNlLAogICAgICBjbGllbnQ6IHt9LAogICAgICBESUM6IHsKICAgICAgICBtZXRob2Q6IGRpY09wdGlvbi5kYXRhTWV0aG9kLAogICAgICAgIHNxbDogW10KICAgICAgfSwKICAgICAgcmVzdWx0OiB7fSwKICAgICAgZm9ybToge30sCiAgICAgIGRhdGE6IFtdLAogICAgICBvcHRpb246IHsKICAgICAgICBsYWJlbFdpZHRoOiAxMzAsCiAgICAgICAgaW5kZXg6IHRydWUsCiAgICAgICAgYWxpZ246ICdjZW50ZXInLAogICAgICAgIGhlYWRlckFsaWduOiAnY2VudGVyJywKICAgICAgICBjb2x1bW46IFsKICAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICflkI3np7AnLAogICAgICAgICAgICBwcm9wOiAnbmFtZScsCiAgICAgICAgICAgIHJ1bGVzOiBbewogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fovpPlhaXlkI3np7AiLAogICAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgICAgICB9XQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICfnsbvlnosnLAogICAgICAgICAgICBwcm9wOiAnZGF0YVR5cGUnLAogICAgICAgICAgICB0eXBlOiAnc2VsZWN0JywKICAgICAgICAgICAgZGljRGF0YTogZGF0YVR5cGUsCiAgICAgICAgICAgIHJ1bGVzOiBbewogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fpgInmi6nnsbvlnosiLAogICAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgICAgICB9XQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgbGFiZWw6ICcnLAogICAgICAgICAgICBwcm9wOiAnY29udGVudCcsCiAgICAgICAgICAgIGhpZGU6IHRydWUsCiAgICAgICAgICAgIGxhYmVsV2lkdGg6IDAsCiAgICAgICAgICAgIHNwYW46IDI0LAogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGlzU3RhdGljICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZm9ybS5kYXRhVHlwZSA9PT0gMAogICAgfSwKICAgIGlzQXBpICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZm9ybS5kYXRhVHlwZSA9PSAxCiAgICB9LAogICAgaXNTcWwgKCkgewogICAgICByZXR1cm4gdGhpcy5mb3JtLmRhdGFUeXBlID09IDIKICAgIH0sCiAgICBpc1dzICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZm9ybS5kYXRhVHlwZSA9PT0gMwogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICAnZm9ybS5kYXRhVHlwZScgKCkgewogICAgICB0aGlzLnJlc3VsdCA9ICcnCiAgICAgIHRoaXMudGFicyA9ICcwJwogICAgfQogIH0sCiAgY3JlYXRlZCAoKSB7CiAgICB0aGlzLmluaXQoKQogICAgdGhpcy5nZXRMaXN0KCkKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXQgKCkgewogICAgICBnZXREYkxpc3QoewogICAgICAgIGN1cnJlbnQ6IDEsCiAgICAgICAgc2l6ZTogMTAwLAogICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgdGhpcy5ESUMuc3FsID0gZGF0YS5yZWNvcmRzLm1hcChlbGUgPT4gewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGFiZWw6IGVsZS5uYW1lLAogICAgICAgICAgICB2YWx1ZTogZWxlLmlkCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9LAogICAgZ2V0U3FsIChyb3cpIHsKICAgICAgcmV0dXJuIGNyeXB0by5lbmNyeXB0KEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBpZDogcm93LmRiSWQsCiAgICAgICAgc3FsOiByb3cuZGJTcWwKICAgICAgfSkpCiAgICB9LAogICAgaGFuZGxlQ2xvc2UgKCkgewogICAgICB0aGlzLmNsaWVudC5jbG9zZSAmJiB0aGlzLmNsaWVudC5jbG9zZSgpCiAgICB9LAogICAgaGFuZGxlUmVzICh0aXAgPSB0cnVlKSB7CiAgICAgIGNvbnN0IGZvcm1hdHRlciA9IChkYXRhKSA9PiB7CiAgICAgICAgY29uc3QgZGF0YUZvcm1hdHRlciA9IGdldEZ1bmN0aW9uKHRoaXMuZm9ybS5kYXRhRm9ybWF0dGVyKQogICAgICAgIGlmICh0aXApIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5pWw5o2u5Yi35paw5oiQ5YqfJykKICAgICAgICBpZiAodHlwZW9mIGRhdGFGb3JtYXR0ZXIgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgcmV0dXJuIGRhdGFGb3JtYXR0ZXIoZGF0YSkKICAgICAgICB9CgogICAgICAgIHJldHVybiBkYXRhCiAgICAgIH0KICAgICAgaWYgKHRoaXMuaXNTdGF0aWMpIHsKICAgICAgICBsZXQgcmVzdWx0ID0gZnVuRXZhbCh0aGlzLmZvcm0uZGF0YSkKICAgICAgICB0aGlzLnJlc3VsdCA9IGZvcm1hdHRlcihyZXN1bHQpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNBcGkpIHsKICAgICAgICBsZXQgZGF0YVF1ZXJ5ID0gdGhpcy5mb3JtLmRhdGFRdWVyeSA/IGdldEZ1bmN0aW9uKHRoaXMuZm9ybS5kYXRhUXVlcnkpKCkgOiB7fQogICAgICAgIGxldCBkYXRhSGVhZGVyID0gdGhpcy5mb3JtLmRhdGFIZWFkZXIgPyBnZXRGdW5jdGlvbih0aGlzLmZvcm0uZGF0YUhlYWRlcikoKSA6IHt9CiAgICAgICAgbGV0IHBhcmFtcyA9IHt9LCBtZXRob2QgPSB0aGlzLmZvcm0uZGF0YU1ldGhvZAogICAgICAgIGlmIChbJ3Bvc3QnLCAncHV0J10uaW5jbHVkZXMobWV0aG9kKSkgewogICAgICAgICAgcGFyYW1zLmRhdGEgPSBkYXRhUXVlcnkKICAgICAgICAgIGlmICh0aGlzLmZvcm0uZGF0YVF1ZXJ5VHlwZSA9PSAnZm9ybScpIHsKICAgICAgICAgICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCkKICAgICAgICAgICAgT2JqZWN0LmtleXMoZGF0YVF1ZXJ5KS5mb3JFYWNoKGVsZSA9PiB7CiAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGVsZSwgZGF0YVF1ZXJ5W2VsZV0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHBhcmFtcy5kYXRhID0gZm9ybURhdGEKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKFsnZ2V0JywgJ2RlbGV0ZSddLmluY2x1ZGVzKG1ldGhvZCkpIHsKICAgICAgICAgIHBhcmFtcy5wYXJhbXMgPSBkYXRhUXVlcnkKICAgICAgICB9CiAgICAgICAgdGhpcy4kYXhpb3MoewogICAgICAgICAgLi4uewogICAgICAgICAgICBtZXRob2Q6IHRoaXMuZm9ybS5kYXRhTWV0aG9kLAogICAgICAgICAgICB1cmw6IHRoaXMuZm9ybS51cmwsCiAgICAgICAgICAgIGhlYWRlcnM6IGRhdGFIZWFkZXIKICAgICAgICAgIH0sCiAgICAgICAgICAuLi5wYXJhbXMKICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICB0aGlzLnJlc3VsdCA9IGZvcm1hdHRlcihyZXMuZGF0YSkKICAgICAgICB9KQogICAgICB9IGVsc2UgaWYgKHRoaXMuaXNTcWwpIHsKICAgICAgICBkeW5hbWljU3FsKHRoaXMuZ2V0U3FsKHRoaXMuZm9ybSkpLnRoZW4ocmVzID0+IHsKICAgICAgICAgIHRoaXMucmVzdWx0ID0gZm9ybWF0dGVyKHJlcy5kYXRhLmRhdGEpCiAgICAgICAgfSkKICAgICAgfSBlbHNlIGlmICh0aGlzLmlzV3MpIHsKICAgICAgICB0aGlzLmhhbmRsZUNsb3NlKCkKICAgICAgICBsZXQgZGF0YVF1ZXJ5ID0gdGhpcy5mb3JtLmRhdGFRdWVyeSA/IGdldEZ1bmN0aW9uKHRoaXMuZm9ybS5kYXRhUXVlcnkpKCkgOiB7fQogICAgICAgIGxldCB1cmwgPSB0aGlzLmZvcm0ud3NVcmwgKyBhZGRQYXJhbShkYXRhUXVlcnkpCiAgICAgICAgdGhpcy5jbGllbnQgPSBuZXcgV2ViU29ja2V0KHVybCkKICAgICAgICB0aGlzLmNsaWVudC5vbm1lc3NhZ2UgPSAobXNnRXZlbnQgPSB7fSkgPT4gewogICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UobXNnRXZlbnQuZGF0YSkKICAgICAgICAgIHRoaXMucmVzdWx0ID0gZm9ybWF0dGVyKGRhdGEpCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaGFuZGxlSW1wb3J0IChmaWxlLCBmaWxlTGlzKSB7CiAgICAgIHRoaXMuJEV4cG9ydC54bHN4KGZpbGUucmF3KQogICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgdGhpcy5mb3JtLmRhdGEgPSBkYXRhLnJlc3VsdHM7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WvvOWFpeaIkOWKnycpCiAgICAgICAgfSkKICAgIH0sCiAgICB2YWlsZERhdGEgKGlkKSB7CiAgICAgIHJldHVybiBbMCwgMSwgMl0uaW5jbHVkZXMoaWQpCiAgICB9LAogICAgYmVmb3JlQ2xvc2UgKGRvbmUpIHsKICAgICAgdGhpcy5oYW5kbGVDbG9zZSgpCiAgICAgIGRvbmUoKQogICAgfSwKICAgIGJlZm9yZU9wZW4gKGRvbmUsIHR5cGUpIHsKICAgICAgdGhpcy5yZXN1bHQgPSAnJzsKICAgICAgaWYgKHR5cGUgPT0gJ2VkaXQnKSB7CiAgICAgICAgZ2V0T2JqKHRoaXMuZm9ybS5pZCkudGhlbihyZXMgPT4gewogICAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgICB0aGlzLmZvcm0gPSBkYXRhCiAgICAgICAgICBpZiAodGhpcy5pc1NxbCkgewogICAgICAgICAgICBsZXQgbW9kZSA9IEpTT04ucGFyc2UoY3J5cHRvLmRlY3J5cHQodGhpcy5mb3JtLmRhdGEpKTsKICAgICAgICAgICAgdGhpcy5mb3JtLmRiSWQgPSBtb2RlLmlkOwogICAgICAgICAgICB0aGlzLmZvcm0uZGJTcWwgPSBtb2RlLnNxbDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaGFuZGxlUmVzKGZhbHNlKQogICAgICAgICAgZG9uZSgpCiAgICAgICAgfSkKICAgICAgfSBlbHNlIHsKICAgICAgICBkb25lKCkKICAgICAgfQogICAgICB0aGlzLmZvcm0uZGF0YUZvcm1hdHRlciA9IHRoaXMuZm9ybS5kYXRhRm9ybWF0dGVyIHx8ICIoZGF0YSk9PntcbiAgICByZXR1cm4ge1xuICAgICAgICBkYXRhXG4gICAgfVxufSIKICAgIH0sCiAgICByb3dEZWwgKHJvdywgaW5kZXgpIHsKICAgICAgaWYgKHRoaXMudmFpbGREYXRhKGluZGV4KSAmJiB0aGlzLiR3ZWJzaXRlLmlzRGVtbykgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IodGhpcy4kd2Vic2l0ZS5pc0RlbW9UaXApCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heWIoOmZpCwg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICBkZWxPYmoocm93LmlkKS50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJyk7CiAgICAgICAgICB0aGlzLmdldExpc3QoKQogICAgICAgIH0pCiAgICAgIH0pLmNhdGNoKCgpID0+IHsKCiAgICAgIH0pOwoKICAgIH0sCiAgICByb3dVcGRhdGUgKHJvdywgaW5kZXgsIGRvbmUpIHsKICAgICAgaWYgKHRoaXMudmFpbGREYXRhKGluZGV4KSAmJiB0aGlzLiR3ZWJzaXRlLmlzRGVtbykgewogICAgICAgIGRvbmUoKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHRoaXMuJHdlYnNpdGUuaXNEZW1vVGlwKQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAodGhpcy5pc1NxbCkgcm93LmRhdGEgPSB0aGlzLmdldFNxbChyb3cpCiAgICAgIHVwZGF0ZU9iaihyb3cpLnRoZW4oKCkgPT4gewogICAgICAgIGRvbmUoKTsKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+S/ruaUueaIkOWKnycpOwogICAgICAgIHRoaXMuZ2V0TGlzdCgpCgogICAgICB9KQogICAgfSwKICAgIHJvd1NhdmUgKHJvdywgZG9uZSkgewogICAgICBpZiAodGhpcy5pc1NxbCkgcm93LmRhdGEgPSB0aGlzLmdldFNxbChyb3cpCiAgICAgIGFkZE9iaihyb3cpLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5paw5aKe5oiQ5YqfJyk7CiAgICAgICAgdGhpcy5nZXRMaXN0KCkKICAgICAgICBkb25lKCk7CiAgICAgIH0pCiAgICB9LAogICAgZ2V0TGlzdCAoKSB7CiAgICAgIGdldExpc3QoewogICAgICAgIGN1cnJlbnQ6IDEsCiAgICAgICAgc2l6ZTogMTAwLAogICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IHJlcy5kYXRhLmRhdGE7CiAgICAgICAgdGhpcy5kYXRhID0gZGF0YS5yZWNvcmRzOwogICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["record.vue"],"names":[],"mappings":";AA4GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"record.vue","sourceRoot":"src/page/list","sourcesContent":["<template>\n  <avue-crud :option=\"option\"\n             v-model=\"form\"\n             @row-save=\"rowSave\"\n             @row-update=\"rowUpdate\"\n             @row-del=\"rowDel\"\n             :before-close=\"beforeClose\"\n             :before-open=\"beforeOpen\"\n             :data=\"data\">\n    <template slot=\"contentForm\"\n              slot-scope=\"{}\">\n      <template v-if=\"isStatic\">\n        <el-form-item label=\"数据值\"\n                      label-position=\"top\">\n          <monaco-editor v-model=\"form.data\"\n                         language=\"javascript\"\n                         height=\"100\"></monaco-editor>\n          <br />\n          <el-upload :show-file-list=\"false\"\n                     :auto-upload=\"false\"\n                     style=\"display:inline-block\"\n                     accept=\".xls,.xlsx\"\n                     :on-change=\"handleImport\">\n            <el-button size=\"small\"\n                       icon=\"el-icon-upload\"\n                       type=\"success\">导入数据(Excel)</el-button>\n          </el-upload>\n\n        </el-form-item>\n      </template>\n      <template v-else-if=\"isSql\">\n        <el-form-item label=\"数据源选择\">\n          <avue-select :dic=\"DIC.sql\"\n                       v-model=\"form.dbId\"></avue-select>\n        </el-form-item>\n\n        <el-form-item label=\"SQL语句\"\n                      label-position=\"top\">\n          <monaco-editor v-model=\"form.dbSql\"\n                         language=\"sql\"\n                         height=\"100\"></monaco-editor>\n        </el-form-item>\n      </template>\n      <template v-else-if=\"isApi\">\n        <el-form-item label=\"接口地址\">\n          <avue-input v-model=\"form.url\"></avue-input>\n        </el-form-item>\n        <el-form-item label=\"请求方式\">\n          <avue-select v-model=\"form.dataMethod\"\n                       :dic=\"DIC.method\"></avue-select>\n        </el-form-item>\n      </template>\n      <template v-else-if=\"isWs\">\n        <el-form-item label=\"WS地址\">\n          <el-input v-model=\"form.wsUrl\">\n          </el-input>\n        </el-form-item>\n      </template>\n      <el-form-item label=\"请求配置\"\n                    v-if=\"isWs || isApi\">\n        <el-tabs class=\"menu__tabs\"\n                 v-model=\"tabs\">\n          <el-tab-pane label=\"请求参数（Body）\"\n                       name=\"0\">\n            <template v-if=\"tabs==0\">\n              <el-radio-group size=\"mini\"\n                              v-if=\"['post','put'].includes(form.dataMethod)\"\n                              v-model=\"form.dataQueryType\">\n                <el-radio label=\"json\">JSON数据</el-radio>\n                <el-radio label=\"form\">FORM表单</el-radio>\n              </el-radio-group>\n              <monaco-editor v-model=\"form.dataQuery\"\n                             language=\"javascript\"\n                             height=\"100\"></monaco-editor>\n            </template>\n          </el-tab-pane>\n          <el-tab-pane label=\"请求头（Headers）\"\n                       v-if=\"isApi\"\n                       name=\"1\">\n            <template v-if=\"tabs==1\">\n              <monaco-editor v-model=\"form.dataHeader\"\n                             language=\"javascript\"\n                             height=\"100\"></monaco-editor>\n            </template>\n          </el-tab-pane>\n\n        </el-tabs>\n      </el-form-item>\n      <el-form-item label=\"过滤器\">\n        <monaco-editor v-model=\"form.dataFormatter\"\n                       height=\"100\"></monaco-editor>\n      </el-form-item>\n      <el-form-item label=\"响应数据\">\n        <monaco-editor v-model=\"result\"\n                       disabled\n                       height=\"100\"></monaco-editor>\n      </el-form-item>\n    </template>\n    <template slot=\"menuForm\">\n      <el-button @click=\"handleRes\"\n                 size=\"small\"\n                 icon=\"el-icon-upload\"\n                 type=\"primary\">刷新数据</el-button>\n    </template>\n  </avue-crud>\n</template>\n\n<script>\nimport crypto from '@/utils/crypto'\nimport { addParam } from '@/echart/util';\nimport { getFunction, funEval } from '@/utils/utils'\nimport MonacoEditor from '@/page/components/editor'\nimport { getList, getObj, addObj, delObj, updateObj } from '@/api/record'\nimport { getList as getDbList, dynamicSql } from \"@/api/db\";\nimport { dicOption } from '@/option/config'\ndicOption.dataType.splice(4, 1)\nconst dataType = dicOption.dataType\nexport default {\n  components: {\n    MonacoEditor,\n  },\n  data () {\n    return {\n      tabs: 0,\n      box: false,\n      client: {},\n      DIC: {\n        method: dicOption.dataMethod,\n        sql: []\n      },\n      result: {},\n      form: {},\n      data: [],\n      option: {\n        labelWidth: 130,\n        index: true,\n        align: 'center',\n        headerAlign: 'center',\n        column: [\n          {\n            label: '名称',\n            prop: 'name',\n            rules: [{\n              required: true,\n              message: \"请输入名称\",\n              trigger: \"blur\"\n            }]\n          },\n          {\n            label: '类型',\n            prop: 'dataType',\n            type: 'select',\n            dicData: dataType,\n            rules: [{\n              required: true,\n              message: \"请选择类型\",\n              trigger: \"blur\"\n            }]\n          },\n          {\n            label: '',\n            prop: 'content',\n            hide: true,\n            labelWidth: 0,\n            span: 24,\n          }\n        ]\n      }\n    }\n  },\n  computed: {\n    isStatic () {\n      return this.form.dataType === 0\n    },\n    isApi () {\n      return this.form.dataType == 1\n    },\n    isSql () {\n      return this.form.dataType == 2\n    },\n    isWs () {\n      return this.form.dataType === 3\n    },\n  },\n  watch: {\n    'form.dataType' () {\n      this.result = ''\n      this.tabs = '0'\n    }\n  },\n  created () {\n    this.init()\n    this.getList()\n  },\n  methods: {\n    init () {\n      getDbList({\n        current: 1,\n        size: 100,\n      }).then(res => {\n        const data = res.data.data;\n        this.DIC.sql = data.records.map(ele => {\n          return {\n            label: ele.name,\n            value: ele.id\n          }\n        })\n      });\n    },\n    getSql (row) {\n      return crypto.encrypt(JSON.stringify({\n        id: row.dbId,\n        sql: row.dbSql\n      }))\n    },\n    handleClose () {\n      this.client.close && this.client.close()\n    },\n    handleRes (tip = true) {\n      const formatter = (data) => {\n        const dataFormatter = getFunction(this.form.dataFormatter)\n        if (tip) this.$message.success('数据刷新成功')\n        if (typeof dataFormatter == 'function') {\n          return dataFormatter(data)\n        }\n\n        return data\n      }\n      if (this.isStatic) {\n        let result = funEval(this.form.data)\n        this.result = formatter(result);\n      } else if (this.isApi) {\n        let dataQuery = this.form.dataQuery ? getFunction(this.form.dataQuery)() : {}\n        let dataHeader = this.form.dataHeader ? getFunction(this.form.dataHeader)() : {}\n        let params = {}, method = this.form.dataMethod\n        if (['post', 'put'].includes(method)) {\n          params.data = dataQuery\n          if (this.form.dataQueryType == 'form') {\n            let formData = new FormData()\n            Object.keys(dataQuery).forEach(ele => {\n              formData.append(ele, dataQuery[ele])\n            })\n            params.data = formData\n          }\n        } else if (['get', 'delete'].includes(method)) {\n          params.params = dataQuery\n        }\n        this.$axios({\n          ...{\n            method: this.form.dataMethod,\n            url: this.form.url,\n            headers: dataHeader\n          },\n          ...params\n        }).then(res => {\n          this.result = formatter(res.data)\n        })\n      } else if (this.isSql) {\n        dynamicSql(this.getSql(this.form)).then(res => {\n          this.result = formatter(res.data.data)\n        })\n      } else if (this.isWs) {\n        this.handleClose()\n        let dataQuery = this.form.dataQuery ? getFunction(this.form.dataQuery)() : {}\n        let url = this.form.wsUrl + addParam(dataQuery)\n        this.client = new WebSocket(url)\n        this.client.onmessage = (msgEvent = {}) => {\n          const data = JSON.parse(msgEvent.data)\n          this.result = formatter(data)\n        }\n      }\n    },\n    handleImport (file, fileLis) {\n      this.$Export.xlsx(file.raw)\n        .then(data => {\n          this.form.data = data.results;\n          this.$message.success('导入成功')\n        })\n    },\n    vaildData (id) {\n      return [0, 1, 2].includes(id)\n    },\n    beforeClose (done) {\n      this.handleClose()\n      done()\n    },\n    beforeOpen (done, type) {\n      this.result = '';\n      if (type == 'edit') {\n        getObj(this.form.id).then(res => {\n          const data = res.data.data;\n          this.form = data\n          if (this.isSql) {\n            let mode = JSON.parse(crypto.decrypt(this.form.data));\n            this.form.dbId = mode.id;\n            this.form.dbSql = mode.sql;\n          }\n          this.handleRes(false)\n          done()\n        })\n      } else {\n        done()\n      }\n      this.form.dataFormatter = this.form.dataFormatter || \"(data)=>{\\n    return {\\n        data\\n    }\\n}\"\n    },\n    rowDel (row, index) {\n      if (this.vaildData(index) && this.$website.isDemo) {\n        this.$message.error(this.$website.isDemoTip)\n        return false;\n      }\n      this.$confirm('此操作将永久删除, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        delObj(row.id).then(() => {\n          this.$message.success('删除成功');\n          this.getList()\n        })\n      }).catch(() => {\n\n      });\n\n    },\n    rowUpdate (row, index, done) {\n      if (this.vaildData(index) && this.$website.isDemo) {\n        done();\n        this.$message.error(this.$website.isDemoTip)\n        return false;\n      }\n      if (this.isSql) row.data = this.getSql(row)\n      updateObj(row).then(() => {\n        done();\n        this.$message.success('修改成功');\n        this.getList()\n\n      })\n    },\n    rowSave (row, done) {\n      if (this.isSql) row.data = this.getSql(row)\n      addObj(row).then(() => {\n        this.$message.success('新增成功');\n        this.getList()\n        done();\n      })\n    },\n    getList () {\n      getList({\n        current: 1,\n        size: 100,\n      }).then(res => {\n        const data = res.data.data;\n        this.data = data.records;\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n</style>"]}]}