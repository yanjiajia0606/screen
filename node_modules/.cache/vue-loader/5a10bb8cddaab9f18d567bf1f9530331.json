{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/group/header.vue?vue&type=style&index=1&id=d8a1e2d8&lang=css&","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/src/page/group/header.vue","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5oZWFkX2J0biB7CiAgYm94LXNoYWRvdzogaW5zZXQgMCAwIDAgMXB4IHJnYigyNTUgMjM1IDIzNSAvIDEwJSksIDAgMCAwIDFweCAjMTgxODE4Owp9Cg=="},{"version":3,"sources":["header.vue"],"names":[],"mappings":";AAwTA;AACA;AACA","file":"header.vue","sourceRoot":"src/page/group","sourcesContent":["<template>\n  <div class=\"head\">\n    <div class=\"head_actions head_left\">\n      <div class=\"head_btn\"\n           :class=\"{'head_btn--active':contain.menuShow}\"\n           @click=\"handleFlag('menuShow')\">\n        <el-tooltip effect=\"dark\"\n                    content=\"图层\"\n                    placement=\"top\">\n          <i class=\"el-icon-s-operation\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           :class=\"{'head_btn--active':contain.paramsShow}\"\n           @click=\"handleFlag('paramsShow')\">\n        <el-tooltip effect=\"dark\"\n                    content=\"操作\"\n                    placement=\"top\">\n          <i class=\"el-icon-setting\"></i>\n        </el-tooltip>\n      </div>\n    </div>\n    <div class=\"head_info\">\n      <i class=\"el-icon-data-analysis\"></i>\n      <span>AvueData-{{contain.visual.title}}</span>\n    </div>\n    <div class=\"head_actions\">\n      <div class=\"head_btn\"\n           @click=\"handleBuild\">\n        <el-tooltip effect=\"dark\"\n                    content=\"保存\"\n                    placement=\"top\">\n          <i class=\"iconfont icon-build\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           @click=\"handleImg\">\n        <el-tooltip effect=\"dark\"\n                    content=\"导出图片\"\n                    placement=\"top\">\n          <i class=\"el-icon-camera\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           @click=\"handleView\"\n           v-show=\"contain.menuFlag\">\n        <el-tooltip effect=\"dark\"\n                    content=\"预览\"\n                    placement=\"top\">\n          <i class=\"iconfont icon-view\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           @click=\"handleReset\"\n           v-show=\"!contain.menuFlag\">\n        <el-tooltip effect=\"dark\"\n                    content=\"还原\"\n                    placement=\"top\">\n          <i class=\"iconfont icon-reset\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           @click=\"$refs.result.show=true\">\n        <el-tooltip effect=\"dark\"\n                    content=\"导入导出\"\n                    placement=\"top\">\n          <i class=\"el-icon-download\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           @click=\"handleShare\">\n        <el-tooltip effect=\"dark\"\n                    content=\"分享\"\n                    placement=\"top\">\n          <i class=\"el-icon-share\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           :disabled='!contain.canUndo'\n           @click=\"contain.editorUndo\">\n        <el-tooltip effect=\"dark\"\n                    content=\"撤销\"\n                    placement=\"top\">\n          <i class=\"nav__icon el-icon-arrow-left\"></i>\n        </el-tooltip>\n      </div>\n      <div class=\"head_btn\"\n           :disabled='!contain.canRedo'\n           @click=\"contain.editorRedo\">\n        <el-tooltip effect=\"dark\"\n                    content=\"重做\"\n                    placement=\"top\">\n          <i class=\"nav__icon el-icon-arrow-right\"></i>\n        </el-tooltip>\n      </div>\n    </div>\n    <result ref=\"result\"></result>\n    <share ref=\"share\"></share>\n  </div>\n</template>\n\n<script>\nimport { url } from '@/config';\nimport result from './result';\nimport { updateComponent } from '@/api/visual'\nimport share from './share'\nexport default {\n  inject: [\"contain\"],\n  provide () {\n    return {\n      contain: this.contain\n    };\n  },\n  components: {\n    result,\n    share\n  },\n  created () {\n    if (this.$website.autoSave) {\n      setInterval(() => {\n        this.handleBuild(undefined, false, false);\n      }, this.$website.autoSaveTime)\n    }\n\n  },\n  methods: {\n    handleReset () {\n      this.contain.menuFlag = true;\n      this.contain.setScale();\n    },\n    handleFlag (name) {\n      this.contain[name] = !this.contain[name]\n      this.$nextTick(() => {\n        let screens = document.getElementById('screens')\n        this.contain.setScale(screens.clientWidth);\n      })\n    },\n    handleView () {\n      this.contain.menuFlag = false;\n      this.$nextTick(() => {\n        this.contain.handleInitActive();\n        this.contain.setScale(screens.clientWidth);\n      })\n    },\n    handleBuild (fn, tip, first = false) {\n      let isFun = typeof (fn) === 'function'\n      if (!isFun && this.$route.params.id <= 100 && this.$website.isDemo) {\n        this.$message.error(this.$website.isDemoTip)\n        return\n      }\n      if (first) this.contain.handleInitActive();\n      let loading\n      if (tip !== false) {\n        loading = this.$loading({\n          lock: true,\n          text: '正在保存配置，请稍后',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        });\n      }\n      this.$nextTick(() => {\n        html2canvas(document.getElementById('content'), {\n          useCORS: true,\n          backgroundColor: null,\n          logging: false,\n          allowTaint: true\n        }).then(canvas => {\n          function dataURLtoFile (dataurl, filename) {\n            var arr = dataurl.split(','),\n              mime = arr[0].match(/:(.*?);/)[1],\n              bstr = atob(arr[1]),\n              n = bstr.length,\n              u8arr = new Uint8Array(n);\n            while (n--) {\n              u8arr[n] = bstr.charCodeAt(n);\n            }\n            return new File([u8arr], filename, { type: mime });\n          }\n\n          var file = dataURLtoFile(canvas.toDataURL('image/jpeg', 0.1), new Date().getTime() + '.jpg');\n          var formdata = new FormData();\n          formdata.append('file', file)\n          axios.post(url + '/visual/put-file', formdata, {\n            headers: {\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          }).then(res => {\n            const data = res.data.data;\n            const url = data.link;\n            const formdata = {\n              visual: {\n                id: this.contain.visual.id,\n                backgroundUrl: url\n              },\n              config: {\n                id: this.contain.obj.config.id,\n                visualId: this.contain.visual.id,\n                detail: JSON.stringify(this.contain.config),\n                component: JSON.stringify(this.contain.nav),\n              },\n            }\n            return updateComponent(formdata)\n          }).then(() => {\n            loading && loading.close();\n            if (isFun) {\n              fn()\n            } else {\n              if (tip !== false) {\n                this.$message.success('大屏配置保存成功');\n              }\n            }\n          }).catch(err => {\n            console.log(err);\n            this.$message.error('大屏配置保存失败，请检查服务端配置')\n            loading.close();\n          })\n        })\n      })\n    },\n    handleImg () {\n      this.$confirm('是否导出大屏图片？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$Screenshot(document.getElementById('content'), {\n          useCORS: true,\n          backgroundColor: null,\n          logging: false,\n        }).then(canvas => {\n          this.downFile(canvas.toDataURL(\"image/jpeg\", 0.8), new Date().getTime());\n          this.$message.success('图片导出成功')\n        });\n      }).catch(() => {\n\n      });\n\n    },\n    handleShare () {\n      this.$refs.share.handleShow()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.head {\n  position: relative;\n  height: 41px;\n  padding-right: 8px;\n  display: flex;\n  z-index: 100;\n  align-items: center;\n  user-select: none;\n  color: var(--datav-gui-font-color-base);\n  border-bottom: var(--datav-border-dark);\n  background: #1d1e1f;\n  &_actions {\n    position: absolute;\n    top: 0;\n    right: 8px;\n    width: 300px;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    height: 40px;\n  }\n  &_left {\n    left: 8px;\n    justify-content: flex-start;\n  }\n  &_btn {\n    margin-left: 4px;\n    width: 40px;\n    height: 24px;\n    line-height: 26px;\n    text-align: center;\n    cursor: pointer;\n    background: #303640;\n    transition: 0.2s;\n    i {\n      color: #fff;\n    }\n    &--active {\n      background-color: #2681ff;\n    }\n  }\n  &_info {\n    position: absolute;\n    left: 50%;\n    top: 0;\n    transform: translateX(-50%);\n    text-align: center;\n    cursor: default;\n    font-size: 14px;\n    max-width: 500px;\n    font-weight: bold;\n    color: #fff;\n    line-height: 40px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    display: flex;\n    align-items: center;\n    i {\n      margin-right: 8px;\n      font-size: 20px;\n    }\n  }\n}\n</style>\n<style>\n.head_btn {\n  box-shadow: inset 0 0 0 1px rgb(255 235 235 / 10%), 0 0 0 1px #181818;\n}\n</style>\n"]}]}