{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/platform/undoRedo/common/undoRedoService.js","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/platform/undoRedo/common/undoRedoService.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/babel.config.js","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvclJ1bnRpbWUuanMiOwppbXBvcnQgX3NsaWNlZFRvQXJyYXkgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5LmpzIjsKaW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjay5qcyI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcy5qcyI7CmltcG9ydCBfdHlwZW9mIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWZsZWN0LnRvLXN0cmluZy10YWcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zZXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5lcnJvci5jYXVzZS5qcyI7Ci8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwp2YXIgX19kZWNvcmF0ZSA9IHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykgewogIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwKICAgIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLAogICAgZDsKICBpZiAoKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihSZWZsZWN0KSkgPT09ICJvYmplY3QiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSAiZnVuY3Rpb24iKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7ZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjsKICB9CiAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjsKfTsKdmFyIF9fcGFyYW0gPSB0aGlzICYmIHRoaXMuX19wYXJhbSB8fCBmdW5jdGlvbiAocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgewogICAgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsKICB9Owp9Owp2YXIgX19hd2FpdGVyID0gdGhpcyAmJiB0aGlzLl9fYXdhaXRlciB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7CiAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIHJlc29sdmUodmFsdWUpOwogICAgfSk7CiAgfQogIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgewogICAgICB0cnkgewogICAgICAgIHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZWplY3QoZSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7CiAgICAgIHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOwogICAgfQogICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOwogIH0pOwp9OwppbXBvcnQgeyBvblVuZXhwZWN0ZWRFcnJvciB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2Vycm9ycy5qcyc7CmltcG9ydCB7IERpc3Bvc2FibGUsIGlzRGlzcG9zYWJsZSB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2xpZmVjeWNsZS5qcyc7CmltcG9ydCB7IFNjaGVtYXMgfSBmcm9tICcuLi8uLi8uLi9iYXNlL2NvbW1vbi9uZXR3b3JrLmpzJzsKaW1wb3J0IFNldmVyaXR5IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL3NldmVyaXR5LmpzJzsKaW1wb3J0ICogYXMgbmxzIGZyb20gJy4uLy4uLy4uL25scy5qcyc7CmltcG9ydCB7IElEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vZGlhbG9ncy9jb21tb24vZGlhbG9ncy5qcyc7CmltcG9ydCB7IHJlZ2lzdGVyU2luZ2xldG9uIH0gZnJvbSAnLi4vLi4vaW5zdGFudGlhdGlvbi9jb21tb24vZXh0ZW5zaW9ucy5qcyc7CmltcG9ydCB7IElOb3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbm90aWZpY2F0aW9uL2NvbW1vbi9ub3RpZmljYXRpb24uanMnOwppbXBvcnQgeyBJVW5kb1JlZG9TZXJ2aWNlLCBSZXNvdXJjZUVkaXRTdGFja1NuYXBzaG90LCBVbmRvUmVkb0dyb3VwLCBVbmRvUmVkb1NvdXJjZSB9IGZyb20gJy4vdW5kb1JlZG8uanMnOwp2YXIgREVCVUcgPSBmYWxzZTsKZnVuY3Rpb24gZ2V0UmVzb3VyY2VMYWJlbChyZXNvdXJjZSkgewogIHJldHVybiByZXNvdXJjZS5zY2hlbWUgPT09IFNjaGVtYXMuZmlsZSA/IHJlc291cmNlLmZzUGF0aCA6IHJlc291cmNlLnBhdGg7Cn0KdmFyIHN0YWNrRWxlbWVudENvdW50ZXIgPSAwOwp2YXIgUmVzb3VyY2VTdGFja0VsZW1lbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFJlc291cmNlU3RhY2tFbGVtZW50KGFjdHVhbCwgcmVzb3VyY2VMYWJlbCwgc3RyUmVzb3VyY2UsIGdyb3VwSWQsIGdyb3VwT3JkZXIsIHNvdXJjZUlkLCBzb3VyY2VPcmRlcikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlc291cmNlU3RhY2tFbGVtZW50KTsKICAgIHRoaXMuaWQgPSArK3N0YWNrRWxlbWVudENvdW50ZXI7CiAgICB0aGlzLnR5cGUgPSAwIC8qIFVuZG9SZWRvRWxlbWVudFR5cGUuUmVzb3VyY2UgKi87CiAgICB0aGlzLmFjdHVhbCA9IGFjdHVhbDsKICAgIHRoaXMubGFiZWwgPSBhY3R1YWwubGFiZWw7CiAgICB0aGlzLmNvbmZpcm1CZWZvcmVVbmRvID0gYWN0dWFsLmNvbmZpcm1CZWZvcmVVbmRvIHx8IGZhbHNlOwogICAgdGhpcy5yZXNvdXJjZUxhYmVsID0gcmVzb3VyY2VMYWJlbDsKICAgIHRoaXMuc3RyUmVzb3VyY2UgPSBzdHJSZXNvdXJjZTsKICAgIHRoaXMucmVzb3VyY2VMYWJlbHMgPSBbdGhpcy5yZXNvdXJjZUxhYmVsXTsKICAgIHRoaXMuc3RyUmVzb3VyY2VzID0gW3RoaXMuc3RyUmVzb3VyY2VdOwogICAgdGhpcy5ncm91cElkID0gZ3JvdXBJZDsKICAgIHRoaXMuZ3JvdXBPcmRlciA9IGdyb3VwT3JkZXI7CiAgICB0aGlzLnNvdXJjZUlkID0gc291cmNlSWQ7CiAgICB0aGlzLnNvdXJjZU9yZGVyID0gc291cmNlT3JkZXI7CiAgICB0aGlzLmlzVmFsaWQgPSB0cnVlOwogIH0KICBfY3JlYXRlQ2xhc3MoUmVzb3VyY2VTdGFja0VsZW1lbnQsIFt7CiAgICBrZXk6ICJzZXRWYWxpZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VmFsaWQoaXNWYWxpZCkgewogICAgICB0aGlzLmlzVmFsaWQgPSBpc1ZhbGlkOwogICAgfQogIH0sIHsKICAgIGtleTogInRvU3RyaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuICJbaWQ6Ii5jb25jYXQodGhpcy5pZCwgIl0gW2dyb3VwOiIpLmNvbmNhdCh0aGlzLmdyb3VwSWQsICJdIFsiKS5jb25jYXQodGhpcy5pc1ZhbGlkID8gJyAgVkFMSUQnIDogJ0lOVkFMSUQnLCAiXSAiKS5jb25jYXQodGhpcy5hY3R1YWwuY29uc3RydWN0b3IubmFtZSwgIiAtICIpLmNvbmNhdCh0aGlzLmFjdHVhbCk7CiAgICB9CiAgfV0pOwogIHJldHVybiBSZXNvdXJjZVN0YWNrRWxlbWVudDsKfSgpOwp2YXIgUmVzb3VyY2VSZWFzb25QYWlyID0gLyojX19QVVJFX18qL19jcmVhdGVDbGFzcyhmdW5jdGlvbiBSZXNvdXJjZVJlYXNvblBhaXIocmVzb3VyY2VMYWJlbCwgcmVhc29uKSB7CiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlc291cmNlUmVhc29uUGFpcik7CiAgdGhpcy5yZXNvdXJjZUxhYmVsID0gcmVzb3VyY2VMYWJlbDsKICB0aGlzLnJlYXNvbiA9IHJlYXNvbjsKfSk7CnZhciBSZW1vdmVkUmVzb3VyY2VzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBSZW1vdmVkUmVzb3VyY2VzKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlbW92ZWRSZXNvdXJjZXMpOwogICAgdGhpcy5lbGVtZW50cyA9IG5ldyBNYXAoKTsKICB9CiAgX2NyZWF0ZUNsYXNzKFJlbW92ZWRSZXNvdXJjZXMsIFt7CiAgICBrZXk6ICJjcmVhdGVNZXNzYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVNZXNzYWdlKCkgewogICAgICB2YXIgZXh0ZXJuYWxSZW1vdmFsID0gW107CiAgICAgIHZhciBub1BhcmFsbGVsVW5pdmVyc2VzID0gW107CiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmVsZW1lbnRzKSwKICAgICAgICBfc3RlcDsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAudmFsdWUsIDIpLAogICAgICAgICAgICBlbGVtZW50ID0gX3N0ZXAkdmFsdWVbMV07CiAgICAgICAgICB2YXIgZGVzdCA9IGVsZW1lbnQucmVhc29uID09PSAwIC8qIFJlbW92ZWRSZXNvdXJjZVJlYXNvbi5FeHRlcm5hbFJlbW92YWwgKi8gPyBleHRlcm5hbFJlbW92YWwgOiBub1BhcmFsbGVsVW5pdmVyc2VzOwogICAgICAgICAgZGVzdC5wdXNoKGVsZW1lbnQucmVzb3VyY2VMYWJlbCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KICAgICAgdmFyIG1lc3NhZ2VzID0gW107CiAgICAgIGlmIChleHRlcm5hbFJlbW92YWwubGVuZ3RoID4gMCkgewogICAgICAgIG1lc3NhZ2VzLnB1c2gobmxzLmxvY2FsaXplKHsKICAgICAgICAgIGtleTogJ2V4dGVybmFsUmVtb3ZhbCcsCiAgICAgICAgICBjb21tZW50OiBbJ3swfSBpcyBhIGxpc3Qgb2YgZmlsZW5hbWVzJ10KICAgICAgICB9LCAiVGhlIGZvbGxvd2luZyBmaWxlcyBoYXZlIGJlZW4gY2xvc2VkIGFuZCBtb2RpZmllZCBvbiBkaXNrOiB7MH0uIiwgZXh0ZXJuYWxSZW1vdmFsLmpvaW4oJywgJykpKTsKICAgICAgfQogICAgICBpZiAobm9QYXJhbGxlbFVuaXZlcnNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgbWVzc2FnZXMucHVzaChubHMubG9jYWxpemUoewogICAgICAgICAga2V5OiAnbm9QYXJhbGxlbFVuaXZlcnNlcycsCiAgICAgICAgICBjb21tZW50OiBbJ3swfSBpcyBhIGxpc3Qgb2YgZmlsZW5hbWVzJ10KICAgICAgICB9LCAiVGhlIGZvbGxvd2luZyBmaWxlcyBoYXZlIGJlZW4gbW9kaWZpZWQgaW4gYW4gaW5jb21wYXRpYmxlIHdheTogezB9LiIsIG5vUGFyYWxsZWxVbml2ZXJzZXMuam9pbignLCAnKSkpOwogICAgICB9CiAgICAgIHJldHVybiBtZXNzYWdlcy5qb2luKCdcbicpOwogICAgfQogIH0sIHsKICAgIGtleTogInNpemUiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzLnNpemU7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXMoc3RyUmVzb3VyY2UpIHsKICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudHMuaGFzKHN0clJlc291cmNlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldChzdHJSZXNvdXJjZSwgdmFsdWUpIHsKICAgICAgdGhpcy5lbGVtZW50cy5zZXQoc3RyUmVzb3VyY2UsIHZhbHVlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZWxldGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kZWxldGUoc3RyUmVzb3VyY2UpIHsKICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudHMuZGVsZXRlKHN0clJlc291cmNlKTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIFJlbW92ZWRSZXNvdXJjZXM7Cn0oKTsKdmFyIFdvcmtzcGFjZVN0YWNrRWxlbWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gV29ya3NwYWNlU3RhY2tFbGVtZW50KGFjdHVhbCwgcmVzb3VyY2VMYWJlbHMsIHN0clJlc291cmNlcywgZ3JvdXBJZCwgZ3JvdXBPcmRlciwgc291cmNlSWQsIHNvdXJjZU9yZGVyKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV29ya3NwYWNlU3RhY2tFbGVtZW50KTsKICAgIHRoaXMuaWQgPSArK3N0YWNrRWxlbWVudENvdW50ZXI7CiAgICB0aGlzLnR5cGUgPSAxIC8qIFVuZG9SZWRvRWxlbWVudFR5cGUuV29ya3NwYWNlICovOwogICAgdGhpcy5hY3R1YWwgPSBhY3R1YWw7CiAgICB0aGlzLmxhYmVsID0gYWN0dWFsLmxhYmVsOwogICAgdGhpcy5jb25maXJtQmVmb3JlVW5kbyA9IGFjdHVhbC5jb25maXJtQmVmb3JlVW5kbyB8fCBmYWxzZTsKICAgIHRoaXMucmVzb3VyY2VMYWJlbHMgPSByZXNvdXJjZUxhYmVsczsKICAgIHRoaXMuc3RyUmVzb3VyY2VzID0gc3RyUmVzb3VyY2VzOwogICAgdGhpcy5ncm91cElkID0gZ3JvdXBJZDsKICAgIHRoaXMuZ3JvdXBPcmRlciA9IGdyb3VwT3JkZXI7CiAgICB0aGlzLnNvdXJjZUlkID0gc291cmNlSWQ7CiAgICB0aGlzLnNvdXJjZU9yZGVyID0gc291cmNlT3JkZXI7CiAgICB0aGlzLnJlbW92ZWRSZXNvdXJjZXMgPSBudWxsOwogICAgdGhpcy5pbnZhbGlkYXRlZFJlc291cmNlcyA9IG51bGw7CiAgfQogIF9jcmVhdGVDbGFzcyhXb3Jrc3BhY2VTdGFja0VsZW1lbnQsIFt7CiAgICBrZXk6ICJjYW5TcGxpdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuU3BsaXQoKSB7CiAgICAgIHJldHVybiB0eXBlb2YgdGhpcy5hY3R1YWwuc3BsaXQgPT09ICdmdW5jdGlvbic7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlUmVzb3VyY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVJlc291cmNlKHJlc291cmNlTGFiZWwsIHN0clJlc291cmNlLCByZWFzb24pIHsKICAgICAgaWYgKCF0aGlzLnJlbW92ZWRSZXNvdXJjZXMpIHsKICAgICAgICB0aGlzLnJlbW92ZWRSZXNvdXJjZXMgPSBuZXcgUmVtb3ZlZFJlc291cmNlcygpOwogICAgICB9CiAgICAgIGlmICghdGhpcy5yZW1vdmVkUmVzb3VyY2VzLmhhcyhzdHJSZXNvdXJjZSkpIHsKICAgICAgICB0aGlzLnJlbW92ZWRSZXNvdXJjZXMuc2V0KHN0clJlc291cmNlLCBuZXcgUmVzb3VyY2VSZWFzb25QYWlyKHJlc291cmNlTGFiZWwsIHJlYXNvbikpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VmFsaWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFZhbGlkKHJlc291cmNlTGFiZWwsIHN0clJlc291cmNlLCBpc1ZhbGlkKSB7CiAgICAgIGlmIChpc1ZhbGlkKSB7CiAgICAgICAgaWYgKHRoaXMuaW52YWxpZGF0ZWRSZXNvdXJjZXMpIHsKICAgICAgICAgIHRoaXMuaW52YWxpZGF0ZWRSZXNvdXJjZXMuZGVsZXRlKHN0clJlc291cmNlKTsKICAgICAgICAgIGlmICh0aGlzLmludmFsaWRhdGVkUmVzb3VyY2VzLnNpemUgPT09IDApIHsKICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlZFJlc291cmNlcyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghdGhpcy5pbnZhbGlkYXRlZFJlc291cmNlcykgewogICAgICAgICAgdGhpcy5pbnZhbGlkYXRlZFJlc291cmNlcyA9IG5ldyBSZW1vdmVkUmVzb3VyY2VzKCk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5pbnZhbGlkYXRlZFJlc291cmNlcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgICB0aGlzLmludmFsaWRhdGVkUmVzb3VyY2VzLnNldChzdHJSZXNvdXJjZSwgbmV3IFJlc291cmNlUmVhc29uUGFpcihyZXNvdXJjZUxhYmVsLCAwIC8qIFJlbW92ZWRSZXNvdXJjZVJlYXNvbi5FeHRlcm5hbFJlbW92YWwgKi8pKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiAiW2lkOiIuY29uY2F0KHRoaXMuaWQsICJdIFtncm91cDoiKS5jb25jYXQodGhpcy5ncm91cElkLCAiXSBbIikuY29uY2F0KHRoaXMuaW52YWxpZGF0ZWRSZXNvdXJjZXMgPyAnSU5WQUxJRCcgOiAnICBWQUxJRCcsICJdICIpLmNvbmNhdCh0aGlzLmFjdHVhbC5jb25zdHJ1Y3Rvci5uYW1lLCAiIC0gIikuY29uY2F0KHRoaXMuYWN0dWFsKTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIFdvcmtzcGFjZVN0YWNrRWxlbWVudDsKfSgpOwp2YXIgUmVzb3VyY2VFZGl0U3RhY2sgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFJlc291cmNlRWRpdFN0YWNrKHJlc291cmNlTGFiZWwsIHN0clJlc291cmNlKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVzb3VyY2VFZGl0U3RhY2spOwogICAgdGhpcy5yZXNvdXJjZUxhYmVsID0gcmVzb3VyY2VMYWJlbDsKICAgIHRoaXMuc3RyUmVzb3VyY2UgPSBzdHJSZXNvdXJjZTsKICAgIHRoaXMuX3Bhc3QgPSBbXTsKICAgIHRoaXMuX2Z1dHVyZSA9IFtdOwogICAgdGhpcy5sb2NrZWQgPSBmYWxzZTsKICAgIHRoaXMudmVyc2lvbklkID0gMTsKICB9CiAgX2NyZWF0ZUNsYXNzKFJlc291cmNlRWRpdFN0YWNrLCBbewogICAga2V5OiAiZGlzcG9zZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLl9wYXN0KSwKICAgICAgICBfc3RlcDI7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gMSAvKiBVbmRvUmVkb0VsZW1lbnRUeXBlLldvcmtzcGFjZSAqLykgewogICAgICAgICAgICBlbGVtZW50LnJlbW92ZVJlc291cmNlKHRoaXMucmVzb3VyY2VMYWJlbCwgdGhpcy5zdHJSZXNvdXJjZSwgMCAvKiBSZW1vdmVkUmVzb3VyY2VSZWFzb24uRXh0ZXJuYWxSZW1vdmFsICovKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICB9CiAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5fZnV0dXJlKSwKICAgICAgICBfc3RlcDM7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IzLnMoKTsgIShfc3RlcDMgPSBfaXRlcmF0b3IzLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfZWxlbWVudDIgPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICBpZiAoX2VsZW1lbnQyLnR5cGUgPT09IDEgLyogVW5kb1JlZG9FbGVtZW50VHlwZS5Xb3Jrc3BhY2UgKi8pIHsKICAgICAgICAgICAgX2VsZW1lbnQyLnJlbW92ZVJlc291cmNlKHRoaXMucmVzb3VyY2VMYWJlbCwgdGhpcy5zdHJSZXNvdXJjZSwgMCAvKiBSZW1vdmVkUmVzb3VyY2VSZWFzb24uRXh0ZXJuYWxSZW1vdmFsICovKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjMuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICB9CiAgICAgIHRoaXMudmVyc2lvbklkKys7CiAgICB9CiAgfSwgewogICAga2V5OiAidG9TdHJpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgIHJlc3VsdC5wdXNoKCIqICIuY29uY2F0KHRoaXMuc3RyUmVzb3VyY2UsICI6IikpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3Bhc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICByZXN1bHQucHVzaCgiICAgKiBbVU5ET10gIi5jb25jYXQodGhpcy5fcGFzdFtpXSkpOwogICAgICB9CiAgICAgIGZvciAodmFyIF9pID0gdGhpcy5fZnV0dXJlLmxlbmd0aCAtIDE7IF9pID49IDA7IF9pLS0pIHsKICAgICAgICByZXN1bHQucHVzaCgiICAgKiBbUkVET10gIi5jb25jYXQodGhpcy5fZnV0dXJlW19pXSkpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQuam9pbignXG4nKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmbHVzaEFsbEVsZW1lbnRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmbHVzaEFsbEVsZW1lbnRzKCkgewogICAgICB0aGlzLl9wYXN0ID0gW107CiAgICAgIHRoaXMuX2Z1dHVyZSA9IFtdOwogICAgICB0aGlzLnZlcnNpb25JZCsrOwogICAgfQogIH0sIHsKICAgIGtleTogIl9zZXRFbGVtZW50VmFsaWRGbGFnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0RWxlbWVudFZhbGlkRmxhZyhlbGVtZW50LCBpc1ZhbGlkKSB7CiAgICAgIGlmIChlbGVtZW50LnR5cGUgPT09IDEgLyogVW5kb1JlZG9FbGVtZW50VHlwZS5Xb3Jrc3BhY2UgKi8pIHsKICAgICAgICBlbGVtZW50LnNldFZhbGlkKHRoaXMucmVzb3VyY2VMYWJlbCwgdGhpcy5zdHJSZXNvdXJjZSwgaXNWYWxpZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudC5zZXRWYWxpZChpc1ZhbGlkKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNldEVsZW1lbnRzVmFsaWRGbGFnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRFbGVtZW50c1ZhbGlkRmxhZyhpc1ZhbGlkLCBmaWx0ZXIpIHsKICAgICAgdmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLl9wYXN0KSwKICAgICAgICBfc3RlcDQ7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I0LnMoKTsgIShfc3RlcDQgPSBfaXRlcmF0b3I0Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gX3N0ZXA0LnZhbHVlOwogICAgICAgICAgaWYgKGZpbHRlcihlbGVtZW50LmFjdHVhbCkpIHsKICAgICAgICAgICAgdGhpcy5fc2V0RWxlbWVudFZhbGlkRmxhZyhlbGVtZW50LCBpc1ZhbGlkKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICB9CiAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5fZnV0dXJlKSwKICAgICAgICBfc3RlcDU7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfZWxlbWVudDMgPSBfc3RlcDUudmFsdWU7CiAgICAgICAgICBpZiAoZmlsdGVyKF9lbGVtZW50My5hY3R1YWwpKSB7CiAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRWYWxpZEZsYWcoX2VsZW1lbnQzLCBpc1ZhbGlkKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjUuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjUuZigpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicHVzaEVsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHB1c2hFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgLy8gcmVtb3ZlIHRoZSBmdXR1cmUKICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLl9mdXR1cmUpLAogICAgICAgIF9zdGVwNjsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykgewogICAgICAgICAgdmFyIGZ1dHVyZUVsZW1lbnQgPSBfc3RlcDYudmFsdWU7CiAgICAgICAgICBpZiAoZnV0dXJlRWxlbWVudC50eXBlID09PSAxIC8qIFVuZG9SZWRvRWxlbWVudFR5cGUuV29ya3NwYWNlICovKSB7CiAgICAgICAgICAgIGZ1dHVyZUVsZW1lbnQucmVtb3ZlUmVzb3VyY2UodGhpcy5yZXNvdXJjZUxhYmVsLCB0aGlzLnN0clJlc291cmNlLCAxIC8qIFJlbW92ZWRSZXNvdXJjZVJlYXNvbi5Ob1BhcmFsbGVsVW5pdmVyc2VzICovKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjYuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICB9CiAgICAgIHRoaXMuX2Z1dHVyZSA9IFtdOwogICAgICB0aGlzLl9wYXN0LnB1c2goZWxlbWVudCk7CiAgICAgIHRoaXMudmVyc2lvbklkKys7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlU25hcHNob3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVNuYXBzaG90KHJlc291cmNlKSB7CiAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5fcGFzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGVsZW1lbnRzLnB1c2godGhpcy5fcGFzdFtpXS5pZCk7CiAgICAgIH0KICAgICAgZm9yICh2YXIgX2kyID0gdGhpcy5fZnV0dXJlLmxlbmd0aCAtIDE7IF9pMiA+PSAwOyBfaTItLSkgewogICAgICAgIGVsZW1lbnRzLnB1c2godGhpcy5fZnV0dXJlW19pMl0uaWQpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgUmVzb3VyY2VFZGl0U3RhY2tTbmFwc2hvdChyZXNvdXJjZSwgZWxlbWVudHMpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlc3RvcmVTbmFwc2hvdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzdG9yZVNuYXBzaG90KHNuYXBzaG90KSB7CiAgICAgIHZhciBzbmFwc2hvdExlbmd0aCA9IHNuYXBzaG90LmVsZW1lbnRzLmxlbmd0aDsKICAgICAgdmFyIGlzT0sgPSB0cnVlOwogICAgICB2YXIgc25hcHNob3RJbmRleCA9IDA7CiAgICAgIHZhciByZW1vdmVQYXN0QWZ0ZXIgPSAtMTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX3Bhc3QubGVuZ3RoOyBpIDwgbGVuOyBpKyssIHNuYXBzaG90SW5kZXgrKykgewogICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5fcGFzdFtpXTsKICAgICAgICBpZiAoaXNPSyAmJiAoc25hcHNob3RJbmRleCA+PSBzbmFwc2hvdExlbmd0aCB8fCBlbGVtZW50LmlkICE9PSBzbmFwc2hvdC5lbGVtZW50c1tzbmFwc2hvdEluZGV4XSkpIHsKICAgICAgICAgIGlzT0sgPSBmYWxzZTsKICAgICAgICAgIHJlbW92ZVBhc3RBZnRlciA9IDA7CiAgICAgICAgfQogICAgICAgIGlmICghaXNPSyAmJiBlbGVtZW50LnR5cGUgPT09IDEgLyogVW5kb1JlZG9FbGVtZW50VHlwZS5Xb3Jrc3BhY2UgKi8pIHsKICAgICAgICAgIGVsZW1lbnQucmVtb3ZlUmVzb3VyY2UodGhpcy5yZXNvdXJjZUxhYmVsLCB0aGlzLnN0clJlc291cmNlLCAwIC8qIFJlbW92ZWRSZXNvdXJjZVJlYXNvbi5FeHRlcm5hbFJlbW92YWwgKi8pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHJlbW92ZUZ1dHVyZUJlZm9yZSA9IC0xOwogICAgICBmb3IgKHZhciBfaTMgPSB0aGlzLl9mdXR1cmUubGVuZ3RoIC0gMTsgX2kzID49IDA7IF9pMy0tLCBzbmFwc2hvdEluZGV4KyspIHsKICAgICAgICB2YXIgX2VsZW1lbnQ0ID0gdGhpcy5fZnV0dXJlW19pM107CiAgICAgICAgaWYgKGlzT0sgJiYgKHNuYXBzaG90SW5kZXggPj0gc25hcHNob3RMZW5ndGggfHwgX2VsZW1lbnQ0LmlkICE9PSBzbmFwc2hvdC5lbGVtZW50c1tzbmFwc2hvdEluZGV4XSkpIHsKICAgICAgICAgIGlzT0sgPSBmYWxzZTsKICAgICAgICAgIHJlbW92ZUZ1dHVyZUJlZm9yZSA9IF9pMzsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc09LICYmIF9lbGVtZW50NC50eXBlID09PSAxIC8qIFVuZG9SZWRvRWxlbWVudFR5cGUuV29ya3NwYWNlICovKSB7CiAgICAgICAgICBfZWxlbWVudDQucmVtb3ZlUmVzb3VyY2UodGhpcy5yZXNvdXJjZUxhYmVsLCB0aGlzLnN0clJlc291cmNlLCAwIC8qIFJlbW92ZWRSZXNvdXJjZVJlYXNvbi5FeHRlcm5hbFJlbW92YWwgKi8pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHJlbW92ZVBhc3RBZnRlciAhPT0gLTEpIHsKICAgICAgICB0aGlzLl9wYXN0ID0gdGhpcy5fcGFzdC5zbGljZSgwLCByZW1vdmVQYXN0QWZ0ZXIpOwogICAgICB9CiAgICAgIGlmIChyZW1vdmVGdXR1cmVCZWZvcmUgIT09IC0xKSB7CiAgICAgICAgdGhpcy5fZnV0dXJlID0gdGhpcy5fZnV0dXJlLnNsaWNlKHJlbW92ZUZ1dHVyZUJlZm9yZSArIDEpOwogICAgICB9CiAgICAgIHRoaXMudmVyc2lvbklkKys7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RWxlbWVudHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVsZW1lbnRzKCkgewogICAgICB2YXIgcGFzdCA9IFtdOwogICAgICB2YXIgZnV0dXJlID0gW107CiAgICAgIHZhciBfaXRlcmF0b3I3ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5fcGFzdCksCiAgICAgICAgX3N0ZXA3OwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNy5zKCk7ICEoX3N0ZXA3ID0gX2l0ZXJhdG9yNy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IF9zdGVwNy52YWx1ZTsKICAgICAgICAgIHBhc3QucHVzaChlbGVtZW50LmFjdHVhbCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I3LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I3LmYoKTsKICAgICAgfQogICAgICB2YXIgX2l0ZXJhdG9yOCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuX2Z1dHVyZSksCiAgICAgICAgX3N0ZXA4OwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yOC5zKCk7ICEoX3N0ZXA4ID0gX2l0ZXJhdG9yOC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX2VsZW1lbnQ1ID0gX3N0ZXA4LnZhbHVlOwogICAgICAgICAgZnV0dXJlLnB1c2goX2VsZW1lbnQ1LmFjdHVhbCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I4LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I4LmYoKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHBhc3Q6IHBhc3QsCiAgICAgICAgZnV0dXJlOiBmdXR1cmUKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRDbG9zZXN0UGFzdEVsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENsb3Nlc3RQYXN0RWxlbWVudCgpIHsKICAgICAgaWYgKHRoaXMuX3Bhc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3Bhc3RbdGhpcy5fcGFzdC5sZW5ndGggLSAxXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTZWNvbmRDbG9zZXN0UGFzdEVsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlY29uZENsb3Nlc3RQYXN0RWxlbWVudCgpIHsKICAgICAgaWYgKHRoaXMuX3Bhc3QubGVuZ3RoIDwgMikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9wYXN0W3RoaXMuX3Bhc3QubGVuZ3RoIC0gMl07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q2xvc2VzdEZ1dHVyZUVsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENsb3Nlc3RGdXR1cmVFbGVtZW50KCkgewogICAgICBpZiAodGhpcy5fZnV0dXJlLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9mdXR1cmVbdGhpcy5fZnV0dXJlLmxlbmd0aCAtIDFdOwogICAgfQogIH0sIHsKICAgIGtleTogImhhc1Bhc3RFbGVtZW50cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFzUGFzdEVsZW1lbnRzKCkgewogICAgICByZXR1cm4gdGhpcy5fcGFzdC5sZW5ndGggPiAwOwogICAgfQogIH0sIHsKICAgIGtleTogImhhc0Z1dHVyZUVsZW1lbnRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNGdXR1cmVFbGVtZW50cygpIHsKICAgICAgcmV0dXJuIHRoaXMuX2Z1dHVyZS5sZW5ndGggPiAwOwogICAgfQogIH0sIHsKICAgIGtleTogInNwbGl0UGFzdFdvcmtzcGFjZUVsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNwbGl0UGFzdFdvcmtzcGFjZUVsZW1lbnQodG9SZW1vdmUsIGluZGl2aWR1YWxNYXApIHsKICAgICAgZm9yICh2YXIgaiA9IHRoaXMuX3Bhc3QubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICBpZiAodGhpcy5fcGFzdFtqXSA9PT0gdG9SZW1vdmUpIHsKICAgICAgICAgIGlmIChpbmRpdmlkdWFsTWFwLmhhcyh0aGlzLnN0clJlc291cmNlKSkgewogICAgICAgICAgICAvLyBnZXRzIHJlcGxhY2VkCiAgICAgICAgICAgIHRoaXMuX3Bhc3Rbal0gPSBpbmRpdmlkdWFsTWFwLmdldCh0aGlzLnN0clJlc291cmNlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGdldHMgZGVsZXRlZAogICAgICAgICAgICB0aGlzLl9wYXN0LnNwbGljZShqLCAxKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnZlcnNpb25JZCsrOwogICAgfQogIH0sIHsKICAgIGtleTogInNwbGl0RnV0dXJlV29ya3NwYWNlRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3BsaXRGdXR1cmVXb3Jrc3BhY2VFbGVtZW50KHRvUmVtb3ZlLCBpbmRpdmlkdWFsTWFwKSB7CiAgICAgIGZvciAodmFyIGogPSB0aGlzLl9mdXR1cmUubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICBpZiAodGhpcy5fZnV0dXJlW2pdID09PSB0b1JlbW92ZSkgewogICAgICAgICAgaWYgKGluZGl2aWR1YWxNYXAuaGFzKHRoaXMuc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgICAgIC8vIGdldHMgcmVwbGFjZWQKICAgICAgICAgICAgdGhpcy5fZnV0dXJlW2pdID0gaW5kaXZpZHVhbE1hcC5nZXQodGhpcy5zdHJSZXNvdXJjZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBnZXRzIGRlbGV0ZWQKICAgICAgICAgICAgdGhpcy5fZnV0dXJlLnNwbGljZShqLCAxKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnZlcnNpb25JZCsrOwogICAgfQogIH0sIHsKICAgIGtleTogIm1vdmVCYWNrd2FyZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZUJhY2t3YXJkKGVsZW1lbnQpIHsKICAgICAgdGhpcy5fcGFzdC5wb3AoKTsKICAgICAgdGhpcy5fZnV0dXJlLnB1c2goZWxlbWVudCk7CiAgICAgIHRoaXMudmVyc2lvbklkKys7CiAgICB9CiAgfSwgewogICAga2V5OiAibW92ZUZvcndhcmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1vdmVGb3J3YXJkKGVsZW1lbnQpIHsKICAgICAgdGhpcy5fZnV0dXJlLnBvcCgpOwogICAgICB0aGlzLl9wYXN0LnB1c2goZWxlbWVudCk7CiAgICAgIHRoaXMudmVyc2lvbklkKys7CiAgICB9CiAgfV0pOwogIHJldHVybiBSZXNvdXJjZUVkaXRTdGFjazsKfSgpOwp2YXIgRWRpdFN0YWNrU25hcHNob3QgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEVkaXRTdGFja1NuYXBzaG90KGVkaXRTdGFja3MpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFZGl0U3RhY2tTbmFwc2hvdCk7CiAgICB0aGlzLmVkaXRTdGFja3MgPSBlZGl0U3RhY2tzOwogICAgdGhpcy5fdmVyc2lvbklkcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWRpdFN0YWNrcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICB0aGlzLl92ZXJzaW9uSWRzW2ldID0gdGhpcy5lZGl0U3RhY2tzW2ldLnZlcnNpb25JZDsKICAgIH0KICB9CiAgX2NyZWF0ZUNsYXNzKEVkaXRTdGFja1NuYXBzaG90LCBbewogICAga2V5OiAiaXNWYWxpZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNWYWxpZCgpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWRpdFN0YWNrcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmICh0aGlzLl92ZXJzaW9uSWRzW2ldICE9PSB0aGlzLmVkaXRTdGFja3NbaV0udmVyc2lvbklkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH1dKTsKICByZXR1cm4gRWRpdFN0YWNrU25hcHNob3Q7Cn0oKTsKdmFyIG1pc3NpbmdFZGl0U3RhY2sgPSBuZXcgUmVzb3VyY2VFZGl0U3RhY2soJycsICcnKTsKbWlzc2luZ0VkaXRTdGFjay5sb2NrZWQgPSB0cnVlOwp2YXIgVW5kb1JlZG9TZXJ2aWNlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBVbmRvUmVkb1NlcnZpY2UoX2RpYWxvZ1NlcnZpY2UsIF9ub3RpZmljYXRpb25TZXJ2aWNlKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVW5kb1JlZG9TZXJ2aWNlKTsKICAgIHRoaXMuX2RpYWxvZ1NlcnZpY2UgPSBfZGlhbG9nU2VydmljZTsKICAgIHRoaXMuX25vdGlmaWNhdGlvblNlcnZpY2UgPSBfbm90aWZpY2F0aW9uU2VydmljZTsKICAgIHRoaXMuX2VkaXRTdGFja3MgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl91cmlDb21wYXJpc29uS2V5Q29tcHV0ZXJzID0gW107CiAgfQogIF9jcmVhdGVDbGFzcyhVbmRvUmVkb1NlcnZpY2UsIFt7CiAgICBrZXk6ICJnZXRVcmlDb21wYXJpc29uS2V5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVcmlDb21wYXJpc29uS2V5KHJlc291cmNlKSB7CiAgICAgIHZhciBfaXRlcmF0b3I5ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5fdXJpQ29tcGFyaXNvbktleUNvbXB1dGVycyksCiAgICAgICAgX3N0ZXA5OwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yOS5zKCk7ICEoX3N0ZXA5ID0gX2l0ZXJhdG9yOS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgdXJpQ29tcGFyaXNvbktleUNvbXB1dGVyID0gX3N0ZXA5LnZhbHVlOwogICAgICAgICAgaWYgKHVyaUNvbXBhcmlzb25LZXlDb21wdXRlclswXSA9PT0gcmVzb3VyY2Uuc2NoZW1lKSB7CiAgICAgICAgICAgIHJldHVybiB1cmlDb21wYXJpc29uS2V5Q29tcHV0ZXJbMV0uZ2V0Q29tcGFyaXNvbktleShyZXNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I5LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I5LmYoKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzb3VyY2UudG9TdHJpbmcoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcHJpbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wcmludChsYWJlbCkgewogICAgICBjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIik7CiAgICAgIGNvbnNvbGUubG9nKCJBRlRFUiAiLmNvbmNhdChsYWJlbCwgIjogIikpOwogICAgICB2YXIgc3RyID0gW107CiAgICAgIHZhciBfaXRlcmF0b3IxMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuX2VkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMTA7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxMC5zKCk7ICEoX3N0ZXAxMCA9IF9pdGVyYXRvcjEwLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gX3N0ZXAxMC52YWx1ZTsKICAgICAgICAgIHN0ci5wdXNoKGVsZW1lbnRbMV0udG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IxMC5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMTAuZigpOwogICAgICB9CiAgICAgIGNvbnNvbGUubG9nKHN0ci5qb2luKCdcbicpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwdXNoRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHVzaEVsZW1lbnQoZWxlbWVudCkgewogICAgICB2YXIgZ3JvdXAgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFVuZG9SZWRvR3JvdXAuTm9uZTsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogVW5kb1JlZG9Tb3VyY2UuTm9uZTsKICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gMCAvKiBVbmRvUmVkb0VsZW1lbnRUeXBlLlJlc291cmNlICovKSB7CiAgICAgICAgdmFyIHJlc291cmNlTGFiZWwgPSBnZXRSZXNvdXJjZUxhYmVsKGVsZW1lbnQucmVzb3VyY2UpOwogICAgICAgIHZhciBzdHJSZXNvdXJjZSA9IHRoaXMuZ2V0VXJpQ29tcGFyaXNvbktleShlbGVtZW50LnJlc291cmNlKTsKICAgICAgICB0aGlzLl9wdXNoRWxlbWVudChuZXcgUmVzb3VyY2VTdGFja0VsZW1lbnQoZWxlbWVudCwgcmVzb3VyY2VMYWJlbCwgc3RyUmVzb3VyY2UsIGdyb3VwLmlkLCBncm91cC5uZXh0T3JkZXIoKSwgc291cmNlLmlkLCBzb3VyY2UubmV4dE9yZGVyKCkpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgc2VlbiA9IG5ldyBTZXQoKTsKICAgICAgICB2YXIgcmVzb3VyY2VMYWJlbHMgPSBbXTsKICAgICAgICB2YXIgc3RyUmVzb3VyY2VzID0gW107CiAgICAgICAgdmFyIF9pdGVyYXRvcjExID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZWxlbWVudC5yZXNvdXJjZXMpLAogICAgICAgICAgX3N0ZXAxMTsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IxMS5zKCk7ICEoX3N0ZXAxMSA9IF9pdGVyYXRvcjExLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIHJlc291cmNlID0gX3N0ZXAxMS52YWx1ZTsKICAgICAgICAgICAgdmFyIF9yZXNvdXJjZUxhYmVsID0gZ2V0UmVzb3VyY2VMYWJlbChyZXNvdXJjZSk7CiAgICAgICAgICAgIHZhciBfc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2UpOwogICAgICAgICAgICBpZiAoc2Vlbi5oYXMoX3N0clJlc291cmNlKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlZW4uYWRkKF9zdHJSZXNvdXJjZSk7CiAgICAgICAgICAgIHJlc291cmNlTGFiZWxzLnB1c2goX3Jlc291cmNlTGFiZWwpOwogICAgICAgICAgICBzdHJSZXNvdXJjZXMucHVzaChfc3RyUmVzb3VyY2UpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yMTEuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3IxMS5mKCk7CiAgICAgICAgfQogICAgICAgIGlmIChyZXNvdXJjZUxhYmVscy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIHRoaXMuX3B1c2hFbGVtZW50KG5ldyBSZXNvdXJjZVN0YWNrRWxlbWVudChlbGVtZW50LCByZXNvdXJjZUxhYmVsc1swXSwgc3RyUmVzb3VyY2VzWzBdLCBncm91cC5pZCwgZ3JvdXAubmV4dE9yZGVyKCksIHNvdXJjZS5pZCwgc291cmNlLm5leHRPcmRlcigpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX3B1c2hFbGVtZW50KG5ldyBXb3Jrc3BhY2VTdGFja0VsZW1lbnQoZWxlbWVudCwgcmVzb3VyY2VMYWJlbHMsIHN0clJlc291cmNlcywgZ3JvdXAuaWQsIGdyb3VwLm5leHRPcmRlcigpLCBzb3VyY2UuaWQsIHNvdXJjZS5uZXh0T3JkZXIoKSkpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoREVCVUcpIHsKICAgICAgICB0aGlzLl9wcmludCgncHVzaEVsZW1lbnQnKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9wdXNoRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3B1c2hFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGVsZW1lbnQuc3RyUmVzb3VyY2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIHJlc291cmNlTGFiZWwgPSBlbGVtZW50LnJlc291cmNlTGFiZWxzW2ldOwogICAgICAgIHZhciBzdHJSZXNvdXJjZSA9IGVsZW1lbnQuc3RyUmVzb3VyY2VzW2ldOwogICAgICAgIHZhciBlZGl0U3RhY2sgPSB2b2lkIDA7CiAgICAgICAgaWYgKHRoaXMuX2VkaXRTdGFja3MuaGFzKHN0clJlc291cmNlKSkgewogICAgICAgICAgZWRpdFN0YWNrID0gdGhpcy5fZWRpdFN0YWNrcy5nZXQoc3RyUmVzb3VyY2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlZGl0U3RhY2sgPSBuZXcgUmVzb3VyY2VFZGl0U3RhY2socmVzb3VyY2VMYWJlbCwgc3RyUmVzb3VyY2UpOwogICAgICAgICAgdGhpcy5fZWRpdFN0YWNrcy5zZXQoc3RyUmVzb3VyY2UsIGVkaXRTdGFjayk7CiAgICAgICAgfQogICAgICAgIGVkaXRTdGFjay5wdXNoRWxlbWVudChlbGVtZW50KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldExhc3RFbGVtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMYXN0RWxlbWVudChyZXNvdXJjZSkgewogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2UpOwogICAgICBpZiAodGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgdmFyIGVkaXRTdGFjayA9IHRoaXMuX2VkaXRTdGFja3MuZ2V0KHN0clJlc291cmNlKTsKICAgICAgICBpZiAoZWRpdFN0YWNrLmhhc0Z1dHVyZUVsZW1lbnRzKCkpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB2YXIgY2xvc2VzdFBhc3RFbGVtZW50ID0gZWRpdFN0YWNrLmdldENsb3Nlc3RQYXN0RWxlbWVudCgpOwogICAgICAgIHJldHVybiBjbG9zZXN0UGFzdEVsZW1lbnQgPyBjbG9zZXN0UGFzdEVsZW1lbnQuYWN0dWFsIDogbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfc3BsaXRQYXN0V29ya3NwYWNlRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NwbGl0UGFzdFdvcmtzcGFjZUVsZW1lbnQodG9SZW1vdmUsIGlnbm9yZVJlc291cmNlcykgewogICAgICB2YXIgaW5kaXZpZHVhbEFyciA9IHRvUmVtb3ZlLmFjdHVhbC5zcGxpdCgpOwogICAgICB2YXIgaW5kaXZpZHVhbE1hcCA9IG5ldyBNYXAoKTsKICAgICAgdmFyIF9pdGVyYXRvcjEyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoaW5kaXZpZHVhbEFyciksCiAgICAgICAgX3N0ZXAxMjsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjEyLnMoKTsgIShfc3RlcDEyID0gX2l0ZXJhdG9yMTIubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9lbGVtZW50ID0gX3N0ZXAxMi52YWx1ZTsKICAgICAgICAgIHZhciByZXNvdXJjZUxhYmVsID0gZ2V0UmVzb3VyY2VMYWJlbChfZWxlbWVudC5yZXNvdXJjZSk7CiAgICAgICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkoX2VsZW1lbnQucmVzb3VyY2UpOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBuZXcgUmVzb3VyY2VTdGFja0VsZW1lbnQoX2VsZW1lbnQsIHJlc291cmNlTGFiZWwsIHN0clJlc291cmNlLCAwLCAwLCAwLCAwKTsKICAgICAgICAgIGluZGl2aWR1YWxNYXAuc2V0KGVsZW1lbnQuc3RyUmVzb3VyY2UsIGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMTIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjEyLmYoKTsKICAgICAgfQogICAgICB2YXIgX2l0ZXJhdG9yMTMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0b1JlbW92ZS5zdHJSZXNvdXJjZXMpLAogICAgICAgIF9zdGVwMTM7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxMy5zKCk7ICEoX3N0ZXAxMyA9IF9pdGVyYXRvcjEzLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RyUmVzb3VyY2UyID0gX3N0ZXAxMy52YWx1ZTsKICAgICAgICAgIGlmIChpZ25vcmVSZXNvdXJjZXMgJiYgaWdub3JlUmVzb3VyY2VzLmhhcyhfc3RyUmVzb3VyY2UyKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBlZGl0U3RhY2sgPSB0aGlzLl9lZGl0U3RhY2tzLmdldChfc3RyUmVzb3VyY2UyKTsKICAgICAgICAgIGVkaXRTdGFjay5zcGxpdFBhc3RXb3Jrc3BhY2VFbGVtZW50KHRvUmVtb3ZlLCBpbmRpdmlkdWFsTWFwKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjEzLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxMy5mKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfc3BsaXRGdXR1cmVXb3Jrc3BhY2VFbGVtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc3BsaXRGdXR1cmVXb3Jrc3BhY2VFbGVtZW50KHRvUmVtb3ZlLCBpZ25vcmVSZXNvdXJjZXMpIHsKICAgICAgdmFyIGluZGl2aWR1YWxBcnIgPSB0b1JlbW92ZS5hY3R1YWwuc3BsaXQoKTsKICAgICAgdmFyIGluZGl2aWR1YWxNYXAgPSBuZXcgTWFwKCk7CiAgICAgIHZhciBfaXRlcmF0b3IxNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGluZGl2aWR1YWxBcnIpLAogICAgICAgIF9zdGVwMTQ7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxNC5zKCk7ICEoX3N0ZXAxNCA9IF9pdGVyYXRvcjE0Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfZWxlbWVudCA9IF9zdGVwMTQudmFsdWU7CiAgICAgICAgICB2YXIgcmVzb3VyY2VMYWJlbCA9IGdldFJlc291cmNlTGFiZWwoX2VsZW1lbnQucmVzb3VyY2UpOwogICAgICAgICAgdmFyIHN0clJlc291cmNlID0gdGhpcy5nZXRVcmlDb21wYXJpc29uS2V5KF9lbGVtZW50LnJlc291cmNlKTsKICAgICAgICAgIHZhciBlbGVtZW50ID0gbmV3IFJlc291cmNlU3RhY2tFbGVtZW50KF9lbGVtZW50LCByZXNvdXJjZUxhYmVsLCBzdHJSZXNvdXJjZSwgMCwgMCwgMCwgMCk7CiAgICAgICAgICBpbmRpdmlkdWFsTWFwLnNldChlbGVtZW50LnN0clJlc291cmNlLCBlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjE0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxNC5mKCk7CiAgICAgIH0KICAgICAgdmFyIF9pdGVyYXRvcjE1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodG9SZW1vdmUuc3RyUmVzb3VyY2VzKSwKICAgICAgICBfc3RlcDE1OwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMTUucygpOyAhKF9zdGVwMTUgPSBfaXRlcmF0b3IxNS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX3N0clJlc291cmNlMyA9IF9zdGVwMTUudmFsdWU7CiAgICAgICAgICBpZiAoaWdub3JlUmVzb3VyY2VzICYmIGlnbm9yZVJlc291cmNlcy5oYXMoX3N0clJlc291cmNlMykpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZWRpdFN0YWNrID0gdGhpcy5fZWRpdFN0YWNrcy5nZXQoX3N0clJlc291cmNlMyk7CiAgICAgICAgICBlZGl0U3RhY2suc3BsaXRGdXR1cmVXb3Jrc3BhY2VFbGVtZW50KHRvUmVtb3ZlLCBpbmRpdmlkdWFsTWFwKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjE1LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxNS5mKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVFbGVtZW50cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRWxlbWVudHMocmVzb3VyY2UpIHsKICAgICAgdmFyIHN0clJlc291cmNlID0gdHlwZW9mIHJlc291cmNlID09PSAnc3RyaW5nJyA/IHJlc291cmNlIDogdGhpcy5nZXRVcmlDb21wYXJpc29uS2V5KHJlc291cmNlKTsKICAgICAgaWYgKHRoaXMuX2VkaXRTdGFja3MuaGFzKHN0clJlc291cmNlKSkgewogICAgICAgIHZhciBlZGl0U3RhY2sgPSB0aGlzLl9lZGl0U3RhY2tzLmdldChzdHJSZXNvdXJjZSk7CiAgICAgICAgZWRpdFN0YWNrLmRpc3Bvc2UoKTsKICAgICAgICB0aGlzLl9lZGl0U3RhY2tzLmRlbGV0ZShzdHJSZXNvdXJjZSk7CiAgICAgIH0KICAgICAgaWYgKERFQlVHKSB7CiAgICAgICAgdGhpcy5fcHJpbnQoJ3JlbW92ZUVsZW1lbnRzJyk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRFbGVtZW50c1ZhbGlkRmxhZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RWxlbWVudHNWYWxpZEZsYWcocmVzb3VyY2UsIGlzVmFsaWQsIGZpbHRlcikgewogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2UpOwogICAgICBpZiAodGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgdmFyIGVkaXRTdGFjayA9IHRoaXMuX2VkaXRTdGFja3MuZ2V0KHN0clJlc291cmNlKTsKICAgICAgICBlZGl0U3RhY2suc2V0RWxlbWVudHNWYWxpZEZsYWcoaXNWYWxpZCwgZmlsdGVyKTsKICAgICAgfQogICAgICBpZiAoREVCVUcpIHsKICAgICAgICB0aGlzLl9wcmludCgnc2V0RWxlbWVudHNWYWxpZEZsYWcnKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZVNuYXBzaG90IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVTbmFwc2hvdChyZXNvdXJjZSkgewogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2UpOwogICAgICBpZiAodGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgdmFyIGVkaXRTdGFjayA9IHRoaXMuX2VkaXRTdGFja3MuZ2V0KHN0clJlc291cmNlKTsKICAgICAgICByZXR1cm4gZWRpdFN0YWNrLmNyZWF0ZVNuYXBzaG90KHJlc291cmNlKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFJlc291cmNlRWRpdFN0YWNrU25hcHNob3QocmVzb3VyY2UsIFtdKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXN0b3JlU25hcHNob3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc3RvcmVTbmFwc2hvdChzbmFwc2hvdCkgewogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkoc25hcHNob3QucmVzb3VyY2UpOwogICAgICBpZiAodGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgdmFyIGVkaXRTdGFjayA9IHRoaXMuX2VkaXRTdGFja3MuZ2V0KHN0clJlc291cmNlKTsKICAgICAgICBlZGl0U3RhY2sucmVzdG9yZVNuYXBzaG90KHNuYXBzaG90KTsKICAgICAgICBpZiAoIWVkaXRTdGFjay5oYXNQYXN0RWxlbWVudHMoKSAmJiAhZWRpdFN0YWNrLmhhc0Z1dHVyZUVsZW1lbnRzKCkpIHsKICAgICAgICAgIC8vIHRoZSBlZGl0IHN0YWNrIGlzIG5vdyBlbXB0eSwganVzdCByZW1vdmUgaXQgZW50aXJlbHkKICAgICAgICAgIGVkaXRTdGFjay5kaXNwb3NlKCk7CiAgICAgICAgICB0aGlzLl9lZGl0U3RhY2tzLmRlbGV0ZShzdHJSZXNvdXJjZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChERUJVRykgewogICAgICAgIHRoaXMuX3ByaW50KCdyZXN0b3JlU25hcHNob3QnKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldEVsZW1lbnRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFbGVtZW50cyhyZXNvdXJjZSkgewogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2UpOwogICAgICBpZiAodGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgdmFyIGVkaXRTdGFjayA9IHRoaXMuX2VkaXRTdGFja3MuZ2V0KHN0clJlc291cmNlKTsKICAgICAgICByZXR1cm4gZWRpdFN0YWNrLmdldEVsZW1lbnRzKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBwYXN0OiBbXSwKICAgICAgICBmdXR1cmU6IFtdCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiX2ZpbmRDbG9zZXN0VW5kb0VsZW1lbnRXaXRoU291cmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZENsb3Nlc3RVbmRvRWxlbWVudFdpdGhTb3VyY2Uoc291cmNlSWQpIHsKICAgICAgaWYgKCFzb3VyY2VJZCkgewogICAgICAgIHJldHVybiBbbnVsbCwgbnVsbF07CiAgICAgIH0KICAgICAgLy8gZmluZCBhbiBlbGVtZW50IHdpdGggdGhlIHNvdXJjZUlkIGFuZCB3aXRoIHRoZSBoaWdoZXN0IHNvdXJjZU9yZGVyIHJlYWR5IHRvIGJlIHVuZG9uZQogICAgICB2YXIgbWF0Y2hlZEVsZW1lbnQgPSBudWxsOwogICAgICB2YXIgbWF0Y2hlZFN0clJlc291cmNlID0gbnVsbDsKICAgICAgdmFyIF9pdGVyYXRvcjE2ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5fZWRpdFN0YWNrcyksCiAgICAgICAgX3N0ZXAxNjsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjE2LnMoKTsgIShfc3RlcDE2ID0gX2l0ZXJhdG9yMTYubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwMTYkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDE2LnZhbHVlLCAyKSwKICAgICAgICAgICAgc3RyUmVzb3VyY2UgPSBfc3RlcDE2JHZhbHVlWzBdLAogICAgICAgICAgICBlZGl0U3RhY2sgPSBfc3RlcDE2JHZhbHVlWzFdOwogICAgICAgICAgdmFyIGNhbmRpZGF0ZSA9IGVkaXRTdGFjay5nZXRDbG9zZXN0UGFzdEVsZW1lbnQoKTsKICAgICAgICAgIGlmICghY2FuZGlkYXRlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNhbmRpZGF0ZS5zb3VyY2VJZCA9PT0gc291cmNlSWQpIHsKICAgICAgICAgICAgaWYgKCFtYXRjaGVkRWxlbWVudCB8fCBjYW5kaWRhdGUuc291cmNlT3JkZXIgPiBtYXRjaGVkRWxlbWVudC5zb3VyY2VPcmRlcikgewogICAgICAgICAgICAgIG1hdGNoZWRFbGVtZW50ID0gY2FuZGlkYXRlOwogICAgICAgICAgICAgIG1hdGNoZWRTdHJSZXNvdXJjZSA9IHN0clJlc291cmNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IxNi5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMTYuZigpOwogICAgICB9CiAgICAgIHJldHVybiBbbWF0Y2hlZEVsZW1lbnQsIG1hdGNoZWRTdHJSZXNvdXJjZV07CiAgICB9CiAgfSwgewogICAga2V5OiAiY2FuVW5kbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuVW5kbyhyZXNvdXJjZU9yU291cmNlKSB7CiAgICAgIGlmIChyZXNvdXJjZU9yU291cmNlIGluc3RhbmNlb2YgVW5kb1JlZG9Tb3VyY2UpIHsKICAgICAgICB2YXIgX3RoaXMkX2ZpbmRDbG9zZXN0VW5kID0gdGhpcy5fZmluZENsb3Nlc3RVbmRvRWxlbWVudFdpdGhTb3VyY2UocmVzb3VyY2VPclNvdXJjZS5pZCksCiAgICAgICAgICBfdGhpcyRfZmluZENsb3Nlc3RVbmQyID0gX3NsaWNlZFRvQXJyYXkoX3RoaXMkX2ZpbmRDbG9zZXN0VW5kLCAyKSwKICAgICAgICAgIG1hdGNoZWRTdHJSZXNvdXJjZSA9IF90aGlzJF9maW5kQ2xvc2VzdFVuZDJbMV07CiAgICAgICAgcmV0dXJuIG1hdGNoZWRTdHJSZXNvdXJjZSA/IHRydWUgOiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2VPclNvdXJjZSk7CiAgICAgIGlmICh0aGlzLl9lZGl0U3RhY2tzLmhhcyhzdHJSZXNvdXJjZSkpIHsKICAgICAgICB2YXIgZWRpdFN0YWNrID0gdGhpcy5fZWRpdFN0YWNrcy5nZXQoc3RyUmVzb3VyY2UpOwogICAgICAgIHJldHVybiBlZGl0U3RhY2suaGFzUGFzdEVsZW1lbnRzKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogIl9vbkVycm9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25FcnJvcihlcnIsIGVsZW1lbnQpIHsKICAgICAgb25VbmV4cGVjdGVkRXJyb3IoZXJyKTsKICAgICAgLy8gQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdW5kb2luZyBvciByZWRvaW5nID0+IGRyb3AgdGhlIHVuZG8vcmVkbyBzdGFjayBmb3IgYWxsIGFmZmVjdGVkIHJlc291cmNlcwogICAgICB2YXIgX2l0ZXJhdG9yMTcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihlbGVtZW50LnN0clJlc291cmNlcyksCiAgICAgICAgX3N0ZXAxNzsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjE3LnMoKTsgIShfc3RlcDE3ID0gX2l0ZXJhdG9yMTcubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHN0clJlc291cmNlID0gX3N0ZXAxNy52YWx1ZTsKICAgICAgICAgIHRoaXMucmVtb3ZlRWxlbWVudHMoc3RyUmVzb3VyY2UpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMTcuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjE3LmYoKTsKICAgICAgfQogICAgICB0aGlzLl9ub3RpZmljYXRpb25TZXJ2aWNlLmVycm9yKGVycik7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2FjcXVpcmVMb2NrcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FjcXVpcmVMb2NrcyhlZGl0U3RhY2tTbmFwc2hvdCkgewogICAgICAvLyBmaXJzdCwgY2hlY2sgaWYgYWxsIGxvY2tzIGNhbiBiZSBhY3F1aXJlZAogICAgICB2YXIgX2l0ZXJhdG9yMTggPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihlZGl0U3RhY2tTbmFwc2hvdC5lZGl0U3RhY2tzKSwKICAgICAgICBfc3RlcDE4OwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMTgucygpOyAhKF9zdGVwMTggPSBfaXRlcmF0b3IxOC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgZWRpdFN0YWNrID0gX3N0ZXAxOC52YWx1ZTsKICAgICAgICAgIGlmIChlZGl0U3RhY2subG9ja2VkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGFjcXVpcmUgZWRpdCBzdGFjayBsb2NrJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIGNhbiBhY3F1aXJlIGFsbCBsb2NrcwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IxOC5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMTguZigpOwogICAgICB9CiAgICAgIHZhciBfaXRlcmF0b3IxOSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMTk7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxOS5zKCk7ICEoX3N0ZXAxOSA9IF9pdGVyYXRvcjE5Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfZWRpdFN0YWNrID0gX3N0ZXAxOS52YWx1ZTsKICAgICAgICAgIF9lZGl0U3RhY2subG9ja2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjE5LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxOS5mKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyByZWxlYXNlIGFsbCBsb2NrcwogICAgICAgIHZhciBfaXRlcmF0b3IyMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MpLAogICAgICAgICAgX3N0ZXAyMDsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IyMC5zKCk7ICEoX3N0ZXAyMCA9IF9pdGVyYXRvcjIwLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIGVkaXRTdGFjayA9IF9zdGVwMjAudmFsdWU7CiAgICAgICAgICAgIGVkaXRTdGFjay5sb2NrZWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjIwLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yMjAuZigpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfc2FmZUludm9rZVdpdGhMb2NrcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NhZmVJbnZva2VXaXRoTG9ja3MoZWxlbWVudCwgaW52b2tlLCBlZGl0U3RhY2tTbmFwc2hvdCwgY2xlYW51cCwgY29udGludWF0aW9uKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciByZWxlYXNlTG9ja3MgPSB0aGlzLl9hY3F1aXJlTG9ja3MoZWRpdFN0YWNrU25hcHNob3QpOwogICAgICB2YXIgcmVzdWx0OwogICAgICB0cnkgewogICAgICAgIHJlc3VsdCA9IGludm9rZSgpOwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICByZWxlYXNlTG9ja3MoKTsKICAgICAgICBjbGVhbnVwLmRpc3Bvc2UoKTsKICAgICAgICByZXR1cm4gdGhpcy5fb25FcnJvcihlcnIsIGVsZW1lbnQpOwogICAgICB9CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAvLyByZXN1bHQgaXMgUHJvbWlzZTx2b2lkPgogICAgICAgIHJldHVybiByZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZWxlYXNlTG9ja3MoKTsKICAgICAgICAgIGNsZWFudXAuZGlzcG9zZSgpOwogICAgICAgICAgcmV0dXJuIGNvbnRpbnVhdGlvbigpOwogICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIHJlbGVhc2VMb2NrcygpOwogICAgICAgICAgY2xlYW51cC5kaXNwb3NlKCk7CiAgICAgICAgICByZXR1cm4gX3RoaXMuX29uRXJyb3IoZXJyLCBlbGVtZW50KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyByZXN1bHQgaXMgdm9pZAogICAgICAgIHJlbGVhc2VMb2NrcygpOwogICAgICAgIGNsZWFudXAuZGlzcG9zZSgpOwogICAgICAgIHJldHVybiBjb250aW51YXRpb24oKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9pbnZva2VXb3Jrc3BhY2VQcmVwYXJlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaW52b2tlV29ya3NwYWNlUHJlcGFyZShlbGVtZW50KSB7CiAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIGVsZW1lbnQuYWN0dWFsLnByZXBhcmVVbmRvUmVkbyA9PT0gJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIERpc3Bvc2FibGUuTm9uZSk7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gZWxlbWVudC5hY3R1YWwucHJlcGFyZVVuZG9SZWRvKCk7CiAgICAgICAgICAgICAgICBpZiAoISh0eXBlb2YgcmVzdWx0ID09PSAndW5kZWZpbmVkJykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgRGlzcG9zYWJsZS5Ob25lKTsKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXN1bHQpOwogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2ludm9rZVJlc291cmNlUHJlcGFyZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ludm9rZVJlc291cmNlUHJlcGFyZShlbGVtZW50LCBjYWxsYmFjaykgewogICAgICBpZiAoZWxlbWVudC5hY3R1YWwudHlwZSAhPT0gMSAvKiBVbmRvUmVkb0VsZW1lbnRUeXBlLldvcmtzcGFjZSAqLyB8fCB0eXBlb2YgZWxlbWVudC5hY3R1YWwucHJlcGFyZVVuZG9SZWRvID09PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIG5vIHByZXBhcmF0aW9uIG5lZWRlZAogICAgICAgIHJldHVybiBjYWxsYmFjayhEaXNwb3NhYmxlLk5vbmUpOwogICAgICB9CiAgICAgIHZhciByID0gZWxlbWVudC5hY3R1YWwucHJlcGFyZVVuZG9SZWRvKCk7CiAgICAgIGlmICghcikgewogICAgICAgIC8vIG5vdGhpbmcgdG8gY2xlYW4gdXAKICAgICAgICByZXR1cm4gY2FsbGJhY2soRGlzcG9zYWJsZS5Ob25lKTsKICAgICAgfQogICAgICBpZiAoaXNEaXNwb3NhYmxlKHIpKSB7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKHIpOwogICAgICB9CiAgICAgIHJldHVybiByLnRoZW4oZnVuY3Rpb24gKGRpc3Bvc2FibGUpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2soZGlzcG9zYWJsZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRBZmZlY3RlZEVkaXRTdGFja3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRBZmZlY3RlZEVkaXRTdGFja3MoZWxlbWVudCkgewogICAgICB2YXIgYWZmZWN0ZWRFZGl0U3RhY2tzID0gW107CiAgICAgIHZhciBfaXRlcmF0b3IyMSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVsZW1lbnQuc3RyUmVzb3VyY2VzKSwKICAgICAgICBfc3RlcDIxOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMjEucygpOyAhKF9zdGVwMjEgPSBfaXRlcmF0b3IyMS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgc3RyUmVzb3VyY2UgPSBfc3RlcDIxLnZhbHVlOwogICAgICAgICAgYWZmZWN0ZWRFZGl0U3RhY2tzLnB1c2godGhpcy5fZWRpdFN0YWNrcy5nZXQoc3RyUmVzb3VyY2UpIHx8IG1pc3NpbmdFZGl0U3RhY2spOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMjEuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIxLmYoKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IEVkaXRTdGFja1NuYXBzaG90KGFmZmVjdGVkRWRpdFN0YWNrcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3RyeVRvU3BsaXRBbmRVbmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdHJ5VG9TcGxpdEFuZFVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGlnbm9yZVJlc291cmNlcywgbWVzc2FnZSkgewogICAgICBpZiAoZWxlbWVudC5jYW5TcGxpdCgpKSB7CiAgICAgICAgdGhpcy5fc3BsaXRQYXN0V29ya3NwYWNlRWxlbWVudChlbGVtZW50LCBpZ25vcmVSZXNvdXJjZXMpOwogICAgICAgIHRoaXMuX25vdGlmaWNhdGlvblNlcnZpY2Uud2FybihtZXNzYWdlKTsKICAgICAgICByZXR1cm4gbmV3IFdvcmtzcGFjZVZlcmlmaWNhdGlvbkVycm9yKHRoaXMuX3VuZG8oc3RyUmVzb3VyY2UsIDAsIHRydWUpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDYW5ub3Qgc2FmZWx5IHNwbGl0IHRoaXMgd29ya3NwYWNlIGVsZW1lbnQgPT4gZmx1c2ggYWxsIHVuZG8vcmVkbyBzdGFja3MKICAgICAgICB2YXIgX2l0ZXJhdG9yMjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihlbGVtZW50LnN0clJlc291cmNlcyksCiAgICAgICAgICBfc3RlcDIyOwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjIyLnMoKTsgIShfc3RlcDIyID0gX2l0ZXJhdG9yMjIubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgX3N0clJlc291cmNlNCA9IF9zdGVwMjIudmFsdWU7CiAgICAgICAgICAgIHRoaXMucmVtb3ZlRWxlbWVudHMoX3N0clJlc291cmNlNCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfaXRlcmF0b3IyMi5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjIyLmYoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbm90aWZpY2F0aW9uU2VydmljZS53YXJuKG1lc3NhZ2UpOwogICAgICAgIHJldHVybiBuZXcgV29ya3NwYWNlVmVyaWZpY2F0aW9uRXJyb3IoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9jaGVja1dvcmtzcGFjZVVuZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jaGVja1dvcmtzcGFjZVVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGVkaXRTdGFja1NuYXBzaG90LCBjaGVja0ludmFsaWRhdGVkUmVzb3VyY2VzKSB7CiAgICAgIGlmIChlbGVtZW50LnJlbW92ZWRSZXNvdXJjZXMpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ5VG9TcGxpdEFuZFVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGVsZW1lbnQucmVtb3ZlZFJlc291cmNlcywgbmxzLmxvY2FsaXplKHsKICAgICAgICAgIGtleTogJ2Nhbm5vdFdvcmtzcGFjZVVuZG8nLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYW5vdGhlciBtZXNzYWdlLiddCiAgICAgICAgfSwgIkNvdWxkIG5vdCB1bmRvICd7MH0nIGFjcm9zcyBhbGwgZmlsZXMuIHsxfSIsIGVsZW1lbnQubGFiZWwsIGVsZW1lbnQucmVtb3ZlZFJlc291cmNlcy5jcmVhdGVNZXNzYWdlKCkpKTsKICAgICAgfQogICAgICBpZiAoY2hlY2tJbnZhbGlkYXRlZFJlc291cmNlcyAmJiBlbGVtZW50LmludmFsaWRhdGVkUmVzb3VyY2VzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyeVRvU3BsaXRBbmRVbmRvKHN0clJlc291cmNlLCBlbGVtZW50LCBlbGVtZW50LmludmFsaWRhdGVkUmVzb3VyY2VzLCBubHMubG9jYWxpemUoewogICAgICAgICAga2V5OiAnY2Fubm90V29ya3NwYWNlVW5kbycsCiAgICAgICAgICBjb21tZW50OiBbJ3swfSBpcyBhIGxhYmVsIGZvciBhbiBvcGVyYXRpb24uIHsxfSBpcyBhbm90aGVyIG1lc3NhZ2UuJ10KICAgICAgICB9LCAiQ291bGQgbm90IHVuZG8gJ3swfScgYWNyb3NzIGFsbCBmaWxlcy4gezF9IiwgZWxlbWVudC5sYWJlbCwgZWxlbWVudC5pbnZhbGlkYXRlZFJlc291cmNlcy5jcmVhdGVNZXNzYWdlKCkpKTsKICAgICAgfQogICAgICAvLyB0aGlzIG11c3QgYmUgdGhlIGxhc3QgcGFzdCBlbGVtZW50IGluIGFsbCB0aGUgaW1wYWN0ZWQgcmVzb3VyY2VzIQogICAgICB2YXIgY2Fubm90VW5kb0R1ZVRvUmVzb3VyY2VzID0gW107CiAgICAgIHZhciBfaXRlcmF0b3IyMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMjM7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyMy5zKCk7ICEoX3N0ZXAyMyA9IF9pdGVyYXRvcjIzLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBlZGl0U3RhY2sgPSBfc3RlcDIzLnZhbHVlOwogICAgICAgICAgaWYgKGVkaXRTdGFjay5nZXRDbG9zZXN0UGFzdEVsZW1lbnQoKSAhPT0gZWxlbWVudCkgewogICAgICAgICAgICBjYW5ub3RVbmRvRHVlVG9SZXNvdXJjZXMucHVzaChlZGl0U3RhY2sucmVzb3VyY2VMYWJlbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMjMuZigpOwogICAgICB9CiAgICAgIGlmIChjYW5ub3RVbmRvRHVlVG9SZXNvdXJjZXMubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiB0aGlzLl90cnlUb1NwbGl0QW5kVW5kbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgbnVsbCwgbmxzLmxvY2FsaXplKHsKICAgICAgICAgIGtleTogJ2Nhbm5vdFdvcmtzcGFjZVVuZG9EdWVUb0NoYW5nZXMnLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYSBsaXN0IG9mIGZpbGVuYW1lcy4nXQogICAgICAgIH0sICJDb3VsZCBub3QgdW5kbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzIGJlY2F1c2UgY2hhbmdlcyB3ZXJlIG1hZGUgdG8gezF9IiwgZWxlbWVudC5sYWJlbCwgY2Fubm90VW5kb0R1ZVRvUmVzb3VyY2VzLmpvaW4oJywgJykpKTsKICAgICAgfQogICAgICB2YXIgY2Fubm90TG9ja0R1ZVRvUmVzb3VyY2VzID0gW107CiAgICAgIHZhciBfaXRlcmF0b3IyNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMjQ7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyNC5zKCk7ICEoX3N0ZXAyNCA9IF9pdGVyYXRvcjI0Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfZWRpdFN0YWNrMiA9IF9zdGVwMjQudmFsdWU7CiAgICAgICAgICBpZiAoX2VkaXRTdGFjazIubG9ja2VkKSB7CiAgICAgICAgICAgIGNhbm5vdExvY2tEdWVUb1Jlc291cmNlcy5wdXNoKF9lZGl0U3RhY2syLnJlc291cmNlTGFiZWwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMjQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjI0LmYoKTsKICAgICAgfQogICAgICBpZiAoY2Fubm90TG9ja0R1ZVRvUmVzb3VyY2VzLmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ5VG9TcGxpdEFuZFVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIG51bGwsIG5scy5sb2NhbGl6ZSh7CiAgICAgICAgICBrZXk6ICdjYW5ub3RXb3Jrc3BhY2VVbmRvRHVlVG9JblByb2dyZXNzVW5kb1JlZG8nLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYSBsaXN0IG9mIGZpbGVuYW1lcy4nXQogICAgICAgIH0sICJDb3VsZCBub3QgdW5kbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzIGJlY2F1c2UgdGhlcmUgaXMgYWxyZWFkeSBhbiB1bmRvIG9yIHJlZG8gb3BlcmF0aW9uIHJ1bm5pbmcgb24gezF9IiwgZWxlbWVudC5sYWJlbCwgY2Fubm90TG9ja0R1ZVRvUmVzb3VyY2VzLmpvaW4oJywgJykpKTsKICAgICAgfQogICAgICAvLyBjaGVjayBpZiBuZXcgc3RhY2sgZWxlbWVudHMgd2VyZSBhZGRlZCBpbiB0aGUgbWVhbnRpbWUuLi4KICAgICAgaWYgKCFlZGl0U3RhY2tTbmFwc2hvdC5pc1ZhbGlkKCkpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ5VG9TcGxpdEFuZFVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIG51bGwsIG5scy5sb2NhbGl6ZSh7CiAgICAgICAgICBrZXk6ICdjYW5ub3RXb3Jrc3BhY2VVbmRvRHVlVG9Jbk1lYW50aW1lVW5kb1JlZG8nLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYSBsaXN0IG9mIGZpbGVuYW1lcy4nXQogICAgICAgIH0sICJDb3VsZCBub3QgdW5kbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzIGJlY2F1c2UgYW4gdW5kbyBvciByZWRvIG9wZXJhdGlvbiBvY2N1cnJlZCBpbiB0aGUgbWVhbnRpbWUiLCBlbGVtZW50LmxhYmVsKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3dvcmtzcGFjZVVuZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF93b3Jrc3BhY2VVbmRvKHN0clJlc291cmNlLCBlbGVtZW50LCB1bmRvQ29uZmlybWVkKSB7CiAgICAgIHZhciBhZmZlY3RlZEVkaXRTdGFja3MgPSB0aGlzLl9nZXRBZmZlY3RlZEVkaXRTdGFja3MoZWxlbWVudCk7CiAgICAgIHZhciB2ZXJpZmljYXRpb25FcnJvciA9IHRoaXMuX2NoZWNrV29ya3NwYWNlVW5kbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgYWZmZWN0ZWRFZGl0U3RhY2tzLCAvKmludmFsaWRhdGVkIHJlc291cmNlcyB3aWxsIGJlIGNoZWNrZWQgYWZ0ZXIgdGhlIHByZXBhcmUgY2FsbCovZmFsc2UpOwogICAgICBpZiAodmVyaWZpY2F0aW9uRXJyb3IpIHsKICAgICAgICByZXR1cm4gdmVyaWZpY2F0aW9uRXJyb3IucmV0dXJuVmFsdWU7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpcm1BbmRFeGVjdXRlV29ya3NwYWNlVW5kbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgYWZmZWN0ZWRFZGl0U3RhY2tzLCB1bmRvQ29uZmlybWVkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaXNQYXJ0T2ZVbmRvR3JvdXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pc1BhcnRPZlVuZG9Hcm91cChlbGVtZW50KSB7CiAgICAgIGlmICghZWxlbWVudC5ncm91cElkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIC8vIGNoZWNrIHRoYXQgdGhlcmUgaXMgYXQgbGVhc3QgYW5vdGhlciBlbGVtZW50IHdpdGggdGhlIHNhbWUgZ3JvdXBJZCByZWFkeSB0byBiZSB1bmRvbmUKICAgICAgdmFyIF9pdGVyYXRvcjI1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5fZWRpdFN0YWNrcyksCiAgICAgICAgX3N0ZXAyNTsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjI1LnMoKTsgIShfc3RlcDI1ID0gX2l0ZXJhdG9yMjUubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwMjUkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDI1LnZhbHVlLCAyKSwKICAgICAgICAgICAgZWRpdFN0YWNrID0gX3N0ZXAyNSR2YWx1ZVsxXTsKICAgICAgICAgIHZhciBwYXN0RWxlbWVudCA9IGVkaXRTdGFjay5nZXRDbG9zZXN0UGFzdEVsZW1lbnQoKTsKICAgICAgICAgIGlmICghcGFzdEVsZW1lbnQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGFzdEVsZW1lbnQgPT09IGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIHNlY29uZFBhc3RFbGVtZW50ID0gZWRpdFN0YWNrLmdldFNlY29uZENsb3Nlc3RQYXN0RWxlbWVudCgpOwogICAgICAgICAgICBpZiAoc2Vjb25kUGFzdEVsZW1lbnQgJiYgc2Vjb25kUGFzdEVsZW1lbnQuZ3JvdXBJZCA9PT0gZWxlbWVudC5ncm91cElkKSB7CiAgICAgICAgICAgICAgLy8gdGhlcmUgaXMgYW5vdGhlciBlbGVtZW50IHdpdGggdGhlIHNhbWUgZ3JvdXAgaWQgaW4gdGhlIHNhbWUgc3RhY2shCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChwYXN0RWxlbWVudC5ncm91cElkID09PSBlbGVtZW50Lmdyb3VwSWQpIHsKICAgICAgICAgICAgLy8gdGhlcmUgaXMgYW5vdGhlciBlbGVtZW50IHdpdGggdGhlIHNhbWUgZ3JvdXAgaWQgaW4gYW5vdGhlciBzdGFjayEKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyNS5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMjUuZigpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfY29uZmlybUFuZEV4ZWN1dGVXb3Jrc3BhY2VVbmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY29uZmlybUFuZEV4ZWN1dGVXb3Jrc3BhY2VVbmRvKHN0clJlc291cmNlLCBlbGVtZW50LCBlZGl0U3RhY2tTbmFwc2hvdCwgdW5kb0NvbmZpcm1lZCkgewogICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgICAgdmFyIHJlc3VsdCwgdmVyaWZpY2F0aW9uRXJyb3IxLCBjbGVhbnVwLCB2ZXJpZmljYXRpb25FcnJvcjIsIF9pdGVyYXRvcjI2LCBfc3RlcDI2LCBlZGl0U3RhY2s7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICghKGVsZW1lbnQuY2FuU3BsaXQoKSAmJiAhdGhpcy5faXNQYXJ0T2ZVbmRvR3JvdXAoZWxlbWVudCkpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RpYWxvZ1NlcnZpY2Uuc2hvdyhTZXZlcml0eS5JbmZvLCBubHMubG9jYWxpemUoJ2NvbmZpcm1Xb3Jrc3BhY2UnLCAiV291bGQgeW91IGxpa2UgdG8gdW5kbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzPyIsIGVsZW1lbnQubGFiZWwpLCBbbmxzLmxvY2FsaXplKHsKICAgICAgICAgICAgICAgICAga2V5OiAnb2snLAogICAgICAgICAgICAgICAgICBjb21tZW50OiBbJ3swfSBkZW5vdGVzIGEgbnVtYmVyIHRoYXQgaXMgPiAxJ10KICAgICAgICAgICAgICAgIH0sICJVbmRvIGluIHswfSBGaWxlcyIsIGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MubGVuZ3RoKSwgbmxzLmxvY2FsaXplKCdub2snLCAiVW5kbyB0aGlzIEZpbGUiKSwgbmxzLmxvY2FsaXplKCdjYW5jZWwnLCAiQ2FuY2VsIildLCB7CiAgICAgICAgICAgICAgICAgIGNhbmNlbElkOiAyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGlmICghKHJlc3VsdC5jaG9pY2UgPT09IDIpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgaWYgKCEocmVzdWx0LmNob2ljZSA9PT0gMSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNob2ljZTogdW5kbyB0aGlzIGZpbGUKICAgICAgICAgICAgICAgIHRoaXMuX3NwbGl0UGFzdFdvcmtzcGFjZUVsZW1lbnQoZWxlbWVudCwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5fdW5kbyhzdHJSZXNvdXJjZSwgMCwgdHJ1ZSkpOwogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIC8vIGNob2ljZTogdW5kbyBpbiBhbGwgZmlsZXMKICAgICAgICAgICAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlIGVsZW1lbnQgaGFzIGJlZW4gbWFkZSBpbnZhbGlkIGluIHRoZSBtZWFudGltZSAoZHVlIHRvIHRoZSBjb25maXJtYXRpb24gYXdhaXQpCiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25FcnJvcjEgPSB0aGlzLl9jaGVja1dvcmtzcGFjZVVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGVkaXRTdGFja1NuYXBzaG90LCAvKmludmFsaWRhdGVkIHJlc291cmNlcyB3aWxsIGJlIGNoZWNrZWQgYWZ0ZXIgdGhlIHByZXBhcmUgY2FsbCovZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKCF2ZXJpZmljYXRpb25FcnJvcjEpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdmVyaWZpY2F0aW9uRXJyb3IxLnJldHVyblZhbHVlKTsKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgdW5kb0NvbmZpcm1lZCA9IHRydWU7CiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTM7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ludm9rZVdvcmtzcGFjZVByZXBhcmUoZWxlbWVudCk7CiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIGNsZWFudXAgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxOTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgxMyk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdGhpcy5fb25FcnJvcihfY29udGV4dDIudDAsIGVsZW1lbnQpKTsKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgLy8gQXQgdGhpcyBwb2ludCwgaXQgaXMgcG9zc2libGUgdGhhdCB0aGUgZWxlbWVudCBoYXMgYmVlbiBtYWRlIGludmFsaWQgaW4gdGhlIG1lYW50aW1lIChkdWUgdG8gdGhlIHByZXBhcmUgYXdhaXQpCiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25FcnJvcjIgPSB0aGlzLl9jaGVja1dvcmtzcGFjZVVuZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGVkaXRTdGFja1NuYXBzaG90LCAvKm5vdyBhbHNvIGNoZWNrIHRoYXQgdGhlcmUgYXJlIG5vIG1vcmUgaW52YWxpZGF0ZWQgcmVzb3VyY2VzKi90cnVlKTsKICAgICAgICAgICAgICAgIGlmICghdmVyaWZpY2F0aW9uRXJyb3IyKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2xlYW51cC5kaXNwb3NlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdmVyaWZpY2F0aW9uRXJyb3IyLnJldHVyblZhbHVlKTsKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihlZGl0U3RhY2tTbmFwc2hvdC5lZGl0U3RhY2tzKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMjYucygpOyAhKF9zdGVwMjYgPSBfaXRlcmF0b3IyNi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICAgICAgZWRpdFN0YWNrID0gX3N0ZXAyNi52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBlZGl0U3RhY2subW92ZUJhY2t3YXJkKGVsZW1lbnQpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMjYuZShlcnIpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMjYuZigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3NhZmVJbnZva2VXaXRoTG9ja3MoZWxlbWVudCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5hY3R1YWwudW5kbygpOwogICAgICAgICAgICAgICAgfSwgZWRpdFN0YWNrU25hcHNob3QsIGNsZWFudXAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5fY29udGludWVVbmRvSW5Hcm91cChlbGVtZW50Lmdyb3VwSWQsIHVuZG9Db25maXJtZWQpOwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMsIFtbMTMsIDE5XV0pOwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3Jlc291cmNlVW5kbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Jlc291cmNlVW5kbyhlZGl0U3RhY2ssIGVsZW1lbnQsIHVuZG9Db25maXJtZWQpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CiAgICAgIGlmICghZWxlbWVudC5pc1ZhbGlkKSB7CiAgICAgICAgLy8gaW52YWxpZCBlbGVtZW50ID0+IGltbWVkaWF0ZWx5IGZsdXNoIGVkaXQgc3RhY2shCiAgICAgICAgZWRpdFN0YWNrLmZsdXNoQWxsRWxlbWVudHMoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGVkaXRTdGFjay5sb2NrZWQpIHsKICAgICAgICB2YXIgbWVzc2FnZSA9IG5scy5sb2NhbGl6ZSh7CiAgICAgICAgICBrZXk6ICdjYW5ub3RSZXNvdXJjZVVuZG9EdWVUb0luUHJvZ3Jlc3NVbmRvUmVkbycsCiAgICAgICAgICBjb21tZW50OiBbJ3swfSBpcyBhIGxhYmVsIGZvciBhbiBvcGVyYXRpb24uJ10KICAgICAgICB9LCAiQ291bGQgbm90IHVuZG8gJ3swfScgYmVjYXVzZSB0aGVyZSBpcyBhbHJlYWR5IGFuIHVuZG8gb3IgcmVkbyBvcGVyYXRpb24gcnVubmluZy4iLCBlbGVtZW50LmxhYmVsKTsKICAgICAgICB0aGlzLl9ub3RpZmljYXRpb25TZXJ2aWNlLndhcm4obWVzc2FnZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9pbnZva2VSZXNvdXJjZVByZXBhcmUoZWxlbWVudCwgZnVuY3Rpb24gKGNsZWFudXApIHsKICAgICAgICBlZGl0U3RhY2subW92ZUJhY2t3YXJkKGVsZW1lbnQpOwogICAgICAgIHJldHVybiBfdGhpczMuX3NhZmVJbnZva2VXaXRoTG9ja3MoZWxlbWVudCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYWN0dWFsLnVuZG8oKTsKICAgICAgICB9LCBuZXcgRWRpdFN0YWNrU25hcHNob3QoW2VkaXRTdGFja10pLCBjbGVhbnVwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMzLl9jb250aW51ZVVuZG9Jbkdyb3VwKGVsZW1lbnQuZ3JvdXBJZCwgdW5kb0NvbmZpcm1lZCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9maW5kQ2xvc2VzdFVuZG9FbGVtZW50SW5Hcm91cCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRDbG9zZXN0VW5kb0VsZW1lbnRJbkdyb3VwKGdyb3VwSWQpIHsKICAgICAgaWYgKCFncm91cElkKSB7CiAgICAgICAgcmV0dXJuIFtudWxsLCBudWxsXTsKICAgICAgfQogICAgICAvLyBmaW5kIGFub3RoZXIgZWxlbWVudCB3aXRoIHRoZSBzYW1lIGdyb3VwSWQgYW5kIHdpdGggdGhlIGhpZ2hlc3QgZ3JvdXBPcmRlciByZWFkeSB0byBiZSB1bmRvbmUKICAgICAgdmFyIG1hdGNoZWRFbGVtZW50ID0gbnVsbDsKICAgICAgdmFyIG1hdGNoZWRTdHJSZXNvdXJjZSA9IG51bGw7CiAgICAgIHZhciBfaXRlcmF0b3IyNyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuX2VkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMjc7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyNy5zKCk7ICEoX3N0ZXAyNyA9IF9pdGVyYXRvcjI3Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RlcDI3JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAyNy52YWx1ZSwgMiksCiAgICAgICAgICAgIHN0clJlc291cmNlID0gX3N0ZXAyNyR2YWx1ZVswXSwKICAgICAgICAgICAgZWRpdFN0YWNrID0gX3N0ZXAyNyR2YWx1ZVsxXTsKICAgICAgICAgIHZhciBjYW5kaWRhdGUgPSBlZGl0U3RhY2suZ2V0Q2xvc2VzdFBhc3RFbGVtZW50KCk7CiAgICAgICAgICBpZiAoIWNhbmRpZGF0ZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjYW5kaWRhdGUuZ3JvdXBJZCA9PT0gZ3JvdXBJZCkgewogICAgICAgICAgICBpZiAoIW1hdGNoZWRFbGVtZW50IHx8IGNhbmRpZGF0ZS5ncm91cE9yZGVyID4gbWF0Y2hlZEVsZW1lbnQuZ3JvdXBPcmRlcikgewogICAgICAgICAgICAgIG1hdGNoZWRFbGVtZW50ID0gY2FuZGlkYXRlOwogICAgICAgICAgICAgIG1hdGNoZWRTdHJSZXNvdXJjZSA9IHN0clJlc291cmNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyNy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMjcuZigpOwogICAgICB9CiAgICAgIHJldHVybiBbbWF0Y2hlZEVsZW1lbnQsIG1hdGNoZWRTdHJSZXNvdXJjZV07CiAgICB9CiAgfSwgewogICAga2V5OiAiX2NvbnRpbnVlVW5kb0luR3JvdXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jb250aW51ZVVuZG9Jbkdyb3VwKGdyb3VwSWQsIHVuZG9Db25maXJtZWQpIHsKICAgICAgaWYgKCFncm91cElkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBfdGhpcyRfZmluZENsb3Nlc3RVbmQzID0gdGhpcy5fZmluZENsb3Nlc3RVbmRvRWxlbWVudEluR3JvdXAoZ3JvdXBJZCksCiAgICAgICAgX3RoaXMkX2ZpbmRDbG9zZXN0VW5kNCA9IF9zbGljZWRUb0FycmF5KF90aGlzJF9maW5kQ2xvc2VzdFVuZDMsIDIpLAogICAgICAgIG1hdGNoZWRTdHJSZXNvdXJjZSA9IF90aGlzJF9maW5kQ2xvc2VzdFVuZDRbMV07CiAgICAgIGlmIChtYXRjaGVkU3RyUmVzb3VyY2UpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdW5kbyhtYXRjaGVkU3RyUmVzb3VyY2UsIDAsIHVuZG9Db25maXJtZWQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAidW5kbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdW5kbyhyZXNvdXJjZU9yU291cmNlKSB7CiAgICAgIGlmIChyZXNvdXJjZU9yU291cmNlIGluc3RhbmNlb2YgVW5kb1JlZG9Tb3VyY2UpIHsKICAgICAgICB2YXIgX3RoaXMkX2ZpbmRDbG9zZXN0VW5kNSA9IHRoaXMuX2ZpbmRDbG9zZXN0VW5kb0VsZW1lbnRXaXRoU291cmNlKHJlc291cmNlT3JTb3VyY2UuaWQpLAogICAgICAgICAgX3RoaXMkX2ZpbmRDbG9zZXN0VW5kNiA9IF9zbGljZWRUb0FycmF5KF90aGlzJF9maW5kQ2xvc2VzdFVuZDUsIDIpLAogICAgICAgICAgbWF0Y2hlZFN0clJlc291cmNlID0gX3RoaXMkX2ZpbmRDbG9zZXN0VW5kNlsxXTsKICAgICAgICByZXR1cm4gbWF0Y2hlZFN0clJlc291cmNlID8gdGhpcy5fdW5kbyhtYXRjaGVkU3RyUmVzb3VyY2UsIHJlc291cmNlT3JTb3VyY2UuaWQsIGZhbHNlKSA6IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBpZiAodHlwZW9mIHJlc291cmNlT3JTb3VyY2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VuZG8ocmVzb3VyY2VPclNvdXJjZSwgMCwgZmFsc2UpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl91bmRvKHRoaXMuZ2V0VXJpQ29tcGFyaXNvbktleShyZXNvdXJjZU9yU291cmNlKSwgMCwgZmFsc2UpOwogICAgfQogIH0sIHsKICAgIGtleTogIl91bmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdW5kbyhzdHJSZXNvdXJjZSkgewogICAgICB2YXIgc291cmNlSWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDA7CiAgICAgIHZhciB1bmRvQ29uZmlybWVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICAgIGlmICghdGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBlZGl0U3RhY2sgPSB0aGlzLl9lZGl0U3RhY2tzLmdldChzdHJSZXNvdXJjZSk7CiAgICAgIHZhciBlbGVtZW50ID0gZWRpdFN0YWNrLmdldENsb3Nlc3RQYXN0RWxlbWVudCgpOwogICAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGVsZW1lbnQuZ3JvdXBJZCkgewogICAgICAgIC8vIHRoaXMgZWxlbWVudCBpcyBhIHBhcnQgb2YgYSBncm91cCwgd2UgbmVlZCB0byBtYWtlIHN1cmUgdW5kb2luZyBpbiBhIGdyb3VwIGlzIGluIG9yZGVyCiAgICAgICAgdmFyIF90aGlzJF9maW5kQ2xvc2VzdFVuZDcgPSB0aGlzLl9maW5kQ2xvc2VzdFVuZG9FbGVtZW50SW5Hcm91cChlbGVtZW50Lmdyb3VwSWQpLAogICAgICAgICAgX3RoaXMkX2ZpbmRDbG9zZXN0VW5kOCA9IF9zbGljZWRUb0FycmF5KF90aGlzJF9maW5kQ2xvc2VzdFVuZDcsIDIpLAogICAgICAgICAgbWF0Y2hlZEVsZW1lbnQgPSBfdGhpcyRfZmluZENsb3Nlc3RVbmQ4WzBdLAogICAgICAgICAgbWF0Y2hlZFN0clJlc291cmNlID0gX3RoaXMkX2ZpbmRDbG9zZXN0VW5kOFsxXTsKICAgICAgICBpZiAoZWxlbWVudCAhPT0gbWF0Y2hlZEVsZW1lbnQgJiYgbWF0Y2hlZFN0clJlc291cmNlKSB7CiAgICAgICAgICAvLyB0aGVyZSBpcyBhbiBlbGVtZW50IGluIHRoZSBzYW1lIGdyb3VwIHRoYXQgc2hvdWxkIGJlIHVuZG9uZSBiZWZvcmUgdGhpcyBvbmUKICAgICAgICAgIHJldHVybiB0aGlzLl91bmRvKG1hdGNoZWRTdHJSZXNvdXJjZSwgc291cmNlSWQsIHVuZG9Db25maXJtZWQpOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgc2hvdWxkUHJvbXB0Rm9yQ29uZmlybWF0aW9uID0gZWxlbWVudC5zb3VyY2VJZCAhPT0gc291cmNlSWQgfHwgZWxlbWVudC5jb25maXJtQmVmb3JlVW5kbzsKICAgICAgaWYgKHNob3VsZFByb21wdEZvckNvbmZpcm1hdGlvbiAmJiAhdW5kb0NvbmZpcm1lZCkgewogICAgICAgIC8vIEhpdCBhIGRpZmZlcmVudCBzb3VyY2Ugb3IgdGhlIGVsZW1lbnQgYXNrcyBmb3IgcHJvbXB0IGJlZm9yZSB1bmRvLCBwcm9tcHQgZm9yIGNvbmZpcm1hdGlvbgogICAgICAgIHJldHVybiB0aGlzLl9jb25maXJtQW5kQ29udGludWVVbmRvKHN0clJlc291cmNlLCBzb3VyY2VJZCwgZWxlbWVudCk7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSAxIC8qIFVuZG9SZWRvRWxlbWVudFR5cGUuV29ya3NwYWNlICovKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fd29ya3NwYWNlVW5kbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgdW5kb0NvbmZpcm1lZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNvdXJjZVVuZG8oZWRpdFN0YWNrLCBlbGVtZW50LCB1bmRvQ29uZmlybWVkKTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgaWYgKERFQlVHKSB7CiAgICAgICAgICB0aGlzLl9wcmludCgndW5kbycpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9jb25maXJtQW5kQ29udGludWVVbmRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfY29uZmlybUFuZENvbnRpbnVlVW5kbyhzdHJSZXNvdXJjZSwgc291cmNlSWQsIGVsZW1lbnQpIHsKICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9kaWFsb2dTZXJ2aWNlLnNob3coU2V2ZXJpdHkuSW5mbywgbmxzLmxvY2FsaXplKCdjb25maXJtRGlmZmVyZW50U291cmNlJywgIldvdWxkIHlvdSBsaWtlIHRvIHVuZG8gJ3swfSc/IiwgZWxlbWVudC5sYWJlbCksIFtubHMubG9jYWxpemUoJ2NvbmZpcm1EaWZmZXJlbnRTb3VyY2UueWVzJywgIlllcyIpLCBubHMubG9jYWxpemUoJ2NvbmZpcm1EaWZmZXJlbnRTb3VyY2Uubm8nLCAiTm8iKV0sIHsKICAgICAgICAgICAgICAgICAgY2FuY2VsSWQ6IDEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgaWYgKCEocmVzdWx0LmNob2ljZSA9PT0gMSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iKTsKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdGhpcy5fdW5kbyhzdHJSZXNvdXJjZSwgc291cmNlSWQsIHRydWUpKTsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2ZpbmRDbG9zZXN0UmVkb0VsZW1lbnRXaXRoU291cmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZENsb3Nlc3RSZWRvRWxlbWVudFdpdGhTb3VyY2Uoc291cmNlSWQpIHsKICAgICAgaWYgKCFzb3VyY2VJZCkgewogICAgICAgIHJldHVybiBbbnVsbCwgbnVsbF07CiAgICAgIH0KICAgICAgLy8gZmluZCBhbiBlbGVtZW50IHdpdGggc291cmNlSWQgYW5kIHdpdGggdGhlIGxvd2VzdCBzb3VyY2VPcmRlciByZWFkeSB0byBiZSByZWRvbmUKICAgICAgdmFyIG1hdGNoZWRFbGVtZW50ID0gbnVsbDsKICAgICAgdmFyIG1hdGNoZWRTdHJSZXNvdXJjZSA9IG51bGw7CiAgICAgIHZhciBfaXRlcmF0b3IyOCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuX2VkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMjg7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyOC5zKCk7ICEoX3N0ZXAyOCA9IF9pdGVyYXRvcjI4Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RlcDI4JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAyOC52YWx1ZSwgMiksCiAgICAgICAgICAgIHN0clJlc291cmNlID0gX3N0ZXAyOCR2YWx1ZVswXSwKICAgICAgICAgICAgZWRpdFN0YWNrID0gX3N0ZXAyOCR2YWx1ZVsxXTsKICAgICAgICAgIHZhciBjYW5kaWRhdGUgPSBlZGl0U3RhY2suZ2V0Q2xvc2VzdEZ1dHVyZUVsZW1lbnQoKTsKICAgICAgICAgIGlmICghY2FuZGlkYXRlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNhbmRpZGF0ZS5zb3VyY2VJZCA9PT0gc291cmNlSWQpIHsKICAgICAgICAgICAgaWYgKCFtYXRjaGVkRWxlbWVudCB8fCBjYW5kaWRhdGUuc291cmNlT3JkZXIgPCBtYXRjaGVkRWxlbWVudC5zb3VyY2VPcmRlcikgewogICAgICAgICAgICAgIG1hdGNoZWRFbGVtZW50ID0gY2FuZGlkYXRlOwogICAgICAgICAgICAgIG1hdGNoZWRTdHJSZXNvdXJjZSA9IHN0clJlc291cmNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyOC5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMjguZigpOwogICAgICB9CiAgICAgIHJldHVybiBbbWF0Y2hlZEVsZW1lbnQsIG1hdGNoZWRTdHJSZXNvdXJjZV07CiAgICB9CiAgfSwgewogICAga2V5OiAiY2FuUmVkbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuUmVkbyhyZXNvdXJjZU9yU291cmNlKSB7CiAgICAgIGlmIChyZXNvdXJjZU9yU291cmNlIGluc3RhbmNlb2YgVW5kb1JlZG9Tb3VyY2UpIHsKICAgICAgICB2YXIgX3RoaXMkX2ZpbmRDbG9zZXN0UmVkID0gdGhpcy5fZmluZENsb3Nlc3RSZWRvRWxlbWVudFdpdGhTb3VyY2UocmVzb3VyY2VPclNvdXJjZS5pZCksCiAgICAgICAgICBfdGhpcyRfZmluZENsb3Nlc3RSZWQyID0gX3NsaWNlZFRvQXJyYXkoX3RoaXMkX2ZpbmRDbG9zZXN0UmVkLCAyKSwKICAgICAgICAgIG1hdGNoZWRTdHJSZXNvdXJjZSA9IF90aGlzJF9maW5kQ2xvc2VzdFJlZDJbMV07CiAgICAgICAgcmV0dXJuIG1hdGNoZWRTdHJSZXNvdXJjZSA/IHRydWUgOiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgc3RyUmVzb3VyY2UgPSB0aGlzLmdldFVyaUNvbXBhcmlzb25LZXkocmVzb3VyY2VPclNvdXJjZSk7CiAgICAgIGlmICh0aGlzLl9lZGl0U3RhY2tzLmhhcyhzdHJSZXNvdXJjZSkpIHsKICAgICAgICB2YXIgZWRpdFN0YWNrID0gdGhpcy5fZWRpdFN0YWNrcy5nZXQoc3RyUmVzb3VyY2UpOwogICAgICAgIHJldHVybiBlZGl0U3RhY2suaGFzRnV0dXJlRWxlbWVudHMoKTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3RyeVRvU3BsaXRBbmRSZWRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdHJ5VG9TcGxpdEFuZFJlZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGlnbm9yZVJlc291cmNlcywgbWVzc2FnZSkgewogICAgICBpZiAoZWxlbWVudC5jYW5TcGxpdCgpKSB7CiAgICAgICAgdGhpcy5fc3BsaXRGdXR1cmVXb3Jrc3BhY2VFbGVtZW50KGVsZW1lbnQsIGlnbm9yZVJlc291cmNlcyk7CiAgICAgICAgdGhpcy5fbm90aWZpY2F0aW9uU2VydmljZS53YXJuKG1lc3NhZ2UpOwogICAgICAgIHJldHVybiBuZXcgV29ya3NwYWNlVmVyaWZpY2F0aW9uRXJyb3IodGhpcy5fcmVkbyhzdHJSZXNvdXJjZSkpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENhbm5vdCBzYWZlbHkgc3BsaXQgdGhpcyB3b3Jrc3BhY2UgZWxlbWVudCA9PiBmbHVzaCBhbGwgdW5kby9yZWRvIHN0YWNrcwogICAgICAgIHZhciBfaXRlcmF0b3IyOSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVsZW1lbnQuc3RyUmVzb3VyY2VzKSwKICAgICAgICAgIF9zdGVwMjk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMjkucygpOyAhKF9zdGVwMjkgPSBfaXRlcmF0b3IyOS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBfc3RyUmVzb3VyY2U1ID0gX3N0ZXAyOS52YWx1ZTsKICAgICAgICAgICAgdGhpcy5yZW1vdmVFbGVtZW50cyhfc3RyUmVzb3VyY2U1KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjI5LmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yMjkuZigpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9ub3RpZmljYXRpb25TZXJ2aWNlLndhcm4obWVzc2FnZSk7CiAgICAgICAgcmV0dXJuIG5ldyBXb3Jrc3BhY2VWZXJpZmljYXRpb25FcnJvcigpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX2NoZWNrV29ya3NwYWNlUmVkbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NoZWNrV29ya3NwYWNlUmVkbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgZWRpdFN0YWNrU25hcHNob3QsIGNoZWNrSW52YWxpZGF0ZWRSZXNvdXJjZXMpIHsKICAgICAgaWYgKGVsZW1lbnQucmVtb3ZlZFJlc291cmNlcykgewogICAgICAgIHJldHVybiB0aGlzLl90cnlUb1NwbGl0QW5kUmVkbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgZWxlbWVudC5yZW1vdmVkUmVzb3VyY2VzLCBubHMubG9jYWxpemUoewogICAgICAgICAga2V5OiAnY2Fubm90V29ya3NwYWNlUmVkbycsCiAgICAgICAgICBjb21tZW50OiBbJ3swfSBpcyBhIGxhYmVsIGZvciBhbiBvcGVyYXRpb24uIHsxfSBpcyBhbm90aGVyIG1lc3NhZ2UuJ10KICAgICAgICB9LCAiQ291bGQgbm90IHJlZG8gJ3swfScgYWNyb3NzIGFsbCBmaWxlcy4gezF9IiwgZWxlbWVudC5sYWJlbCwgZWxlbWVudC5yZW1vdmVkUmVzb3VyY2VzLmNyZWF0ZU1lc3NhZ2UoKSkpOwogICAgICB9CiAgICAgIGlmIChjaGVja0ludmFsaWRhdGVkUmVzb3VyY2VzICYmIGVsZW1lbnQuaW52YWxpZGF0ZWRSZXNvdXJjZXMpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ5VG9TcGxpdEFuZFJlZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIGVsZW1lbnQuaW52YWxpZGF0ZWRSZXNvdXJjZXMsIG5scy5sb2NhbGl6ZSh7CiAgICAgICAgICBrZXk6ICdjYW5ub3RXb3Jrc3BhY2VSZWRvJywKICAgICAgICAgIGNvbW1lbnQ6IFsnezB9IGlzIGEgbGFiZWwgZm9yIGFuIG9wZXJhdGlvbi4gezF9IGlzIGFub3RoZXIgbWVzc2FnZS4nXQogICAgICAgIH0sICJDb3VsZCBub3QgcmVkbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzLiB7MX0iLCBlbGVtZW50LmxhYmVsLCBlbGVtZW50LmludmFsaWRhdGVkUmVzb3VyY2VzLmNyZWF0ZU1lc3NhZ2UoKSkpOwogICAgICB9CiAgICAgIC8vIHRoaXMgbXVzdCBiZSB0aGUgbGFzdCBmdXR1cmUgZWxlbWVudCBpbiBhbGwgdGhlIGltcGFjdGVkIHJlc291cmNlcyEKICAgICAgdmFyIGNhbm5vdFJlZG9EdWVUb1Jlc291cmNlcyA9IFtdOwogICAgICB2YXIgX2l0ZXJhdG9yMzAgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihlZGl0U3RhY2tTbmFwc2hvdC5lZGl0U3RhY2tzKSwKICAgICAgICBfc3RlcDMwOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMzAucygpOyAhKF9zdGVwMzAgPSBfaXRlcmF0b3IzMC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgZWRpdFN0YWNrID0gX3N0ZXAzMC52YWx1ZTsKICAgICAgICAgIGlmIChlZGl0U3RhY2suZ2V0Q2xvc2VzdEZ1dHVyZUVsZW1lbnQoKSAhPT0gZWxlbWVudCkgewogICAgICAgICAgICBjYW5ub3RSZWRvRHVlVG9SZXNvdXJjZXMucHVzaChlZGl0U3RhY2sucmVzb3VyY2VMYWJlbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IzMC5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMzAuZigpOwogICAgICB9CiAgICAgIGlmIChjYW5ub3RSZWRvRHVlVG9SZXNvdXJjZXMubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiB0aGlzLl90cnlUb1NwbGl0QW5kUmVkbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgbnVsbCwgbmxzLmxvY2FsaXplKHsKICAgICAgICAgIGtleTogJ2Nhbm5vdFdvcmtzcGFjZVJlZG9EdWVUb0NoYW5nZXMnLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYSBsaXN0IG9mIGZpbGVuYW1lcy4nXQogICAgICAgIH0sICJDb3VsZCBub3QgcmVkbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzIGJlY2F1c2UgY2hhbmdlcyB3ZXJlIG1hZGUgdG8gezF9IiwgZWxlbWVudC5sYWJlbCwgY2Fubm90UmVkb0R1ZVRvUmVzb3VyY2VzLmpvaW4oJywgJykpKTsKICAgICAgfQogICAgICB2YXIgY2Fubm90TG9ja0R1ZVRvUmVzb3VyY2VzID0gW107CiAgICAgIHZhciBfaXRlcmF0b3IzMSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMzE7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IzMS5zKCk7ICEoX3N0ZXAzMSA9IF9pdGVyYXRvcjMxLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfZWRpdFN0YWNrMyA9IF9zdGVwMzEudmFsdWU7CiAgICAgICAgICBpZiAoX2VkaXRTdGFjazMubG9ja2VkKSB7CiAgICAgICAgICAgIGNhbm5vdExvY2tEdWVUb1Jlc291cmNlcy5wdXNoKF9lZGl0U3RhY2szLnJlc291cmNlTGFiZWwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMzEuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjMxLmYoKTsKICAgICAgfQogICAgICBpZiAoY2Fubm90TG9ja0R1ZVRvUmVzb3VyY2VzLmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ5VG9TcGxpdEFuZFJlZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIG51bGwsIG5scy5sb2NhbGl6ZSh7CiAgICAgICAgICBrZXk6ICdjYW5ub3RXb3Jrc3BhY2VSZWRvRHVlVG9JblByb2dyZXNzVW5kb1JlZG8nLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYSBsaXN0IG9mIGZpbGVuYW1lcy4nXQogICAgICAgIH0sICJDb3VsZCBub3QgcmVkbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzIGJlY2F1c2UgdGhlcmUgaXMgYWxyZWFkeSBhbiB1bmRvIG9yIHJlZG8gb3BlcmF0aW9uIHJ1bm5pbmcgb24gezF9IiwgZWxlbWVudC5sYWJlbCwgY2Fubm90TG9ja0R1ZVRvUmVzb3VyY2VzLmpvaW4oJywgJykpKTsKICAgICAgfQogICAgICAvLyBjaGVjayBpZiBuZXcgc3RhY2sgZWxlbWVudHMgd2VyZSBhZGRlZCBpbiB0aGUgbWVhbnRpbWUuLi4KICAgICAgaWYgKCFlZGl0U3RhY2tTbmFwc2hvdC5pc1ZhbGlkKCkpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ5VG9TcGxpdEFuZFJlZG8oc3RyUmVzb3VyY2UsIGVsZW1lbnQsIG51bGwsIG5scy5sb2NhbGl6ZSh7CiAgICAgICAgICBrZXk6ICdjYW5ub3RXb3Jrc3BhY2VSZWRvRHVlVG9Jbk1lYW50aW1lVW5kb1JlZG8nLAogICAgICAgICAgY29tbWVudDogWyd7MH0gaXMgYSBsYWJlbCBmb3IgYW4gb3BlcmF0aW9uLiB7MX0gaXMgYSBsaXN0IG9mIGZpbGVuYW1lcy4nXQogICAgICAgIH0sICJDb3VsZCBub3QgcmVkbyAnezB9JyBhY3Jvc3MgYWxsIGZpbGVzIGJlY2F1c2UgYW4gdW5kbyBvciByZWRvIG9wZXJhdGlvbiBvY2N1cnJlZCBpbiB0aGUgbWVhbnRpbWUiLCBlbGVtZW50LmxhYmVsKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3dvcmtzcGFjZVJlZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF93b3Jrc3BhY2VSZWRvKHN0clJlc291cmNlLCBlbGVtZW50KSB7CiAgICAgIHZhciBhZmZlY3RlZEVkaXRTdGFja3MgPSB0aGlzLl9nZXRBZmZlY3RlZEVkaXRTdGFja3MoZWxlbWVudCk7CiAgICAgIHZhciB2ZXJpZmljYXRpb25FcnJvciA9IHRoaXMuX2NoZWNrV29ya3NwYWNlUmVkbyhzdHJSZXNvdXJjZSwgZWxlbWVudCwgYWZmZWN0ZWRFZGl0U3RhY2tzLCAvKmludmFsaWRhdGVkIHJlc291cmNlcyB3aWxsIGJlIGNoZWNrZWQgYWZ0ZXIgdGhlIHByZXBhcmUgY2FsbCovZmFsc2UpOwogICAgICBpZiAodmVyaWZpY2F0aW9uRXJyb3IpIHsKICAgICAgICByZXR1cm4gdmVyaWZpY2F0aW9uRXJyb3IucmV0dXJuVmFsdWU7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2V4ZWN1dGVXb3Jrc3BhY2VSZWRvKHN0clJlc291cmNlLCBlbGVtZW50LCBhZmZlY3RlZEVkaXRTdGFja3MpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9leGVjdXRlV29ya3NwYWNlUmVkbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2V4ZWN1dGVXb3Jrc3BhY2VSZWRvKHN0clJlc291cmNlLCBlbGVtZW50LCBlZGl0U3RhY2tTbmFwc2hvdCkgewogICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgICAgdmFyIGNsZWFudXAsIHZlcmlmaWNhdGlvbkVycm9yLCBfaXRlcmF0b3IzMiwgX3N0ZXAzMiwgZWRpdFN0YWNrOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlV29ya3NwYWNlUHJlcGFyZShlbGVtZW50KTsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBjbGVhbnVwID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDY7CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5fb25FcnJvcihfY29udGV4dDQudDAsIGVsZW1lbnQpKTsKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAvLyBBdCB0aGlzIHBvaW50LCBpdCBpcyBwb3NzaWJsZSB0aGF0IHRoZSBlbGVtZW50IGhhcyBiZWVuIG1hZGUgaW52YWxpZCBpbiB0aGUgbWVhbnRpbWUgKGR1ZSB0byB0aGUgcHJlcGFyZSBhd2FpdCkKICAgICAgICAgICAgICAgIHZlcmlmaWNhdGlvbkVycm9yID0gdGhpcy5fY2hlY2tXb3Jrc3BhY2VSZWRvKHN0clJlc291cmNlLCBlbGVtZW50LCBlZGl0U3RhY2tTbmFwc2hvdCwgLypub3cgYWxzbyBjaGVjayB0aGF0IHRoZXJlIGFyZSBubyBtb3JlIGludmFsaWRhdGVkIHJlc291cmNlcyovdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoIXZlcmlmaWNhdGlvbkVycm9yKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2xlYW51cC5kaXNwb3NlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdmVyaWZpY2F0aW9uRXJyb3IucmV0dXJuVmFsdWUpOwogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IzMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGVkaXRTdGFja1NuYXBzaG90LmVkaXRTdGFja3MpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IzMi5zKCk7ICEoX3N0ZXAzMiA9IF9pdGVyYXRvcjMyLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgICAgICBlZGl0U3RhY2sgPSBfc3RlcDMyLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGVkaXRTdGFjay5tb3ZlRm9yd2FyZChlbGVtZW50KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjMyLmUoZXJyKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjMyLmYoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB0aGlzLl9zYWZlSW52b2tlV2l0aExvY2tzKGVsZW1lbnQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYWN0dWFsLnJlZG8oKTsKICAgICAgICAgICAgICAgIH0sIGVkaXRTdGFja1NuYXBzaG90LCBjbGVhbnVwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczQuX2NvbnRpbnVlUmVkb0luR3JvdXAoZWxlbWVudC5ncm91cElkKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzLCBbWzAsIDZdXSk7CiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVzb3VyY2VSZWRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVzb3VyY2VSZWRvKGVkaXRTdGFjaywgZWxlbWVudCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKICAgICAgaWYgKCFlbGVtZW50LmlzVmFsaWQpIHsKICAgICAgICAvLyBpbnZhbGlkIGVsZW1lbnQgPT4gaW1tZWRpYXRlbHkgZmx1c2ggZWRpdCBzdGFjayEKICAgICAgICBlZGl0U3RhY2suZmx1c2hBbGxFbGVtZW50cygpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoZWRpdFN0YWNrLmxvY2tlZCkgewogICAgICAgIHZhciBtZXNzYWdlID0gbmxzLmxvY2FsaXplKHsKICAgICAgICAgIGtleTogJ2Nhbm5vdFJlc291cmNlUmVkb0R1ZVRvSW5Qcm9ncmVzc1VuZG9SZWRvJywKICAgICAgICAgIGNvbW1lbnQ6IFsnezB9IGlzIGEgbGFiZWwgZm9yIGFuIG9wZXJhdGlvbi4nXQogICAgICAgIH0sICJDb3VsZCBub3QgcmVkbyAnezB9JyBiZWNhdXNlIHRoZXJlIGlzIGFscmVhZHkgYW4gdW5kbyBvciByZWRvIG9wZXJhdGlvbiBydW5uaW5nLiIsIGVsZW1lbnQubGFiZWwpOwogICAgICAgIHRoaXMuX25vdGlmaWNhdGlvblNlcnZpY2Uud2FybihtZXNzYWdlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2ludm9rZVJlc291cmNlUHJlcGFyZShlbGVtZW50LCBmdW5jdGlvbiAoY2xlYW51cCkgewogICAgICAgIGVkaXRTdGFjay5tb3ZlRm9yd2FyZChlbGVtZW50KTsKICAgICAgICByZXR1cm4gX3RoaXM1Ll9zYWZlSW52b2tlV2l0aExvY2tzKGVsZW1lbnQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlbGVtZW50LmFjdHVhbC5yZWRvKCk7CiAgICAgICAgfSwgbmV3IEVkaXRTdGFja1NuYXBzaG90KFtlZGl0U3RhY2tdKSwgY2xlYW51cCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNS5fY29udGludWVSZWRvSW5Hcm91cChlbGVtZW50Lmdyb3VwSWQpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZmluZENsb3Nlc3RSZWRvRWxlbWVudEluR3JvdXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kQ2xvc2VzdFJlZG9FbGVtZW50SW5Hcm91cChncm91cElkKSB7CiAgICAgIGlmICghZ3JvdXBJZCkgewogICAgICAgIHJldHVybiBbbnVsbCwgbnVsbF07CiAgICAgIH0KICAgICAgLy8gZmluZCBhbm90aGVyIGVsZW1lbnQgd2l0aCB0aGUgc2FtZSBncm91cElkIGFuZCB3aXRoIHRoZSBsb3dlc3QgZ3JvdXBPcmRlciByZWFkeSB0byBiZSByZWRvbmUKICAgICAgdmFyIG1hdGNoZWRFbGVtZW50ID0gbnVsbDsKICAgICAgdmFyIG1hdGNoZWRTdHJSZXNvdXJjZSA9IG51bGw7CiAgICAgIHZhciBfaXRlcmF0b3IzMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuX2VkaXRTdGFja3MpLAogICAgICAgIF9zdGVwMzM7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IzMy5zKCk7ICEoX3N0ZXAzMyA9IF9pdGVyYXRvcjMzLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RlcDMzJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAzMy52YWx1ZSwgMiksCiAgICAgICAgICAgIHN0clJlc291cmNlID0gX3N0ZXAzMyR2YWx1ZVswXSwKICAgICAgICAgICAgZWRpdFN0YWNrID0gX3N0ZXAzMyR2YWx1ZVsxXTsKICAgICAgICAgIHZhciBjYW5kaWRhdGUgPSBlZGl0U3RhY2suZ2V0Q2xvc2VzdEZ1dHVyZUVsZW1lbnQoKTsKICAgICAgICAgIGlmICghY2FuZGlkYXRlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNhbmRpZGF0ZS5ncm91cElkID09PSBncm91cElkKSB7CiAgICAgICAgICAgIGlmICghbWF0Y2hlZEVsZW1lbnQgfHwgY2FuZGlkYXRlLmdyb3VwT3JkZXIgPCBtYXRjaGVkRWxlbWVudC5ncm91cE9yZGVyKSB7CiAgICAgICAgICAgICAgbWF0Y2hlZEVsZW1lbnQgPSBjYW5kaWRhdGU7CiAgICAgICAgICAgICAgbWF0Y2hlZFN0clJlc291cmNlID0gc3RyUmVzb3VyY2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjMzLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IzMy5mKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIFttYXRjaGVkRWxlbWVudCwgbWF0Y2hlZFN0clJlc291cmNlXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfY29udGludWVSZWRvSW5Hcm91cCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbnRpbnVlUmVkb0luR3JvdXAoZ3JvdXBJZCkgewogICAgICBpZiAoIWdyb3VwSWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIF90aGlzJF9maW5kQ2xvc2VzdFJlZDMgPSB0aGlzLl9maW5kQ2xvc2VzdFJlZG9FbGVtZW50SW5Hcm91cChncm91cElkKSwKICAgICAgICBfdGhpcyRfZmluZENsb3Nlc3RSZWQ0ID0gX3NsaWNlZFRvQXJyYXkoX3RoaXMkX2ZpbmRDbG9zZXN0UmVkMywgMiksCiAgICAgICAgbWF0Y2hlZFN0clJlc291cmNlID0gX3RoaXMkX2ZpbmRDbG9zZXN0UmVkNFsxXTsKICAgICAgaWYgKG1hdGNoZWRTdHJSZXNvdXJjZSkgewogICAgICAgIHJldHVybiB0aGlzLl9yZWRvKG1hdGNoZWRTdHJSZXNvdXJjZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZWRvIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWRvKHJlc291cmNlT3JTb3VyY2UpIHsKICAgICAgaWYgKHJlc291cmNlT3JTb3VyY2UgaW5zdGFuY2VvZiBVbmRvUmVkb1NvdXJjZSkgewogICAgICAgIHZhciBfdGhpcyRfZmluZENsb3Nlc3RSZWQ1ID0gdGhpcy5fZmluZENsb3Nlc3RSZWRvRWxlbWVudFdpdGhTb3VyY2UocmVzb3VyY2VPclNvdXJjZS5pZCksCiAgICAgICAgICBfdGhpcyRfZmluZENsb3Nlc3RSZWQ2ID0gX3NsaWNlZFRvQXJyYXkoX3RoaXMkX2ZpbmRDbG9zZXN0UmVkNSwgMiksCiAgICAgICAgICBtYXRjaGVkU3RyUmVzb3VyY2UgPSBfdGhpcyRfZmluZENsb3Nlc3RSZWQ2WzFdOwogICAgICAgIHJldHVybiBtYXRjaGVkU3RyUmVzb3VyY2UgPyB0aGlzLl9yZWRvKG1hdGNoZWRTdHJSZXNvdXJjZSkgOiB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiByZXNvdXJjZU9yU291cmNlID09PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiB0aGlzLl9yZWRvKHJlc291cmNlT3JTb3VyY2UpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9yZWRvKHRoaXMuZ2V0VXJpQ29tcGFyaXNvbktleShyZXNvdXJjZU9yU291cmNlKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3JlZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZWRvKHN0clJlc291cmNlKSB7CiAgICAgIGlmICghdGhpcy5fZWRpdFN0YWNrcy5oYXMoc3RyUmVzb3VyY2UpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBlZGl0U3RhY2sgPSB0aGlzLl9lZGl0U3RhY2tzLmdldChzdHJSZXNvdXJjZSk7CiAgICAgIHZhciBlbGVtZW50ID0gZWRpdFN0YWNrLmdldENsb3Nlc3RGdXR1cmVFbGVtZW50KCk7CiAgICAgIGlmICghZWxlbWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoZWxlbWVudC5ncm91cElkKSB7CiAgICAgICAgLy8gdGhpcyBlbGVtZW50IGlzIGEgcGFydCBvZiBhIGdyb3VwLCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSByZWRvaW5nIGluIGEgZ3JvdXAgaXMgaW4gb3JkZXIKICAgICAgICB2YXIgX3RoaXMkX2ZpbmRDbG9zZXN0UmVkNyA9IHRoaXMuX2ZpbmRDbG9zZXN0UmVkb0VsZW1lbnRJbkdyb3VwKGVsZW1lbnQuZ3JvdXBJZCksCiAgICAgICAgICBfdGhpcyRfZmluZENsb3Nlc3RSZWQ4ID0gX3NsaWNlZFRvQXJyYXkoX3RoaXMkX2ZpbmRDbG9zZXN0UmVkNywgMiksCiAgICAgICAgICBtYXRjaGVkRWxlbWVudCA9IF90aGlzJF9maW5kQ2xvc2VzdFJlZDhbMF0sCiAgICAgICAgICBtYXRjaGVkU3RyUmVzb3VyY2UgPSBfdGhpcyRfZmluZENsb3Nlc3RSZWQ4WzFdOwogICAgICAgIGlmIChlbGVtZW50ICE9PSBtYXRjaGVkRWxlbWVudCAmJiBtYXRjaGVkU3RyUmVzb3VyY2UpIHsKICAgICAgICAgIC8vIHRoZXJlIGlzIGFuIGVsZW1lbnQgaW4gdGhlIHNhbWUgZ3JvdXAgdGhhdCBzaG91bGQgYmUgcmVkb25lIGJlZm9yZSB0aGlzIG9uZQogICAgICAgICAgcmV0dXJuIHRoaXMuX3JlZG8obWF0Y2hlZFN0clJlc291cmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSAxIC8qIFVuZG9SZWRvRWxlbWVudFR5cGUuV29ya3NwYWNlICovKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fd29ya3NwYWNlUmVkbyhzdHJSZXNvdXJjZSwgZWxlbWVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNvdXJjZVJlZG8oZWRpdFN0YWNrLCBlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgaWYgKERFQlVHKSB7CiAgICAgICAgICB0aGlzLl9wcmludCgncmVkbycpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH1dKTsKICByZXR1cm4gVW5kb1JlZG9TZXJ2aWNlOwp9KCk7ClVuZG9SZWRvU2VydmljZSA9IF9fZGVjb3JhdGUoW19fcGFyYW0oMCwgSURpYWxvZ1NlcnZpY2UpLCBfX3BhcmFtKDEsIElOb3RpZmljYXRpb25TZXJ2aWNlKV0sIFVuZG9SZWRvU2VydmljZSk7CmV4cG9ydCB7IFVuZG9SZWRvU2VydmljZSB9Owp2YXIgV29ya3NwYWNlVmVyaWZpY2F0aW9uRXJyb3IgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZUNsYXNzKGZ1bmN0aW9uIFdvcmtzcGFjZVZlcmlmaWNhdGlvbkVycm9yKHJldHVyblZhbHVlKSB7CiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdvcmtzcGFjZVZlcmlmaWNhdGlvbkVycm9yKTsKICB0aGlzLnJldHVyblZhbHVlID0gcmV0dXJuVmFsdWU7Cn0pOwpyZWdpc3RlclNpbmdsZXRvbihJVW5kb1JlZG9TZXJ2aWNlLCBVbmRvUmVkb1NlcnZpY2UpOw=="},{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","onUnexpectedError","Disposable","isDisposable","Schemas","Severity","nls","IDialogService","registerSingleton","INotificationService","IUndoRedoService","ResourceEditStackSnapshot","UndoRedoGroup","UndoRedoSource","DEBUG","getResourceLabel","resource","scheme","file","fsPath","path","stackElementCounter","ResourceStackElement","actual","resourceLabel","strResource","groupId","groupOrder","sourceId","sourceOrder","id","type","label","confirmBeforeUndo","resourceLabels","strResources","isValid","constructor","name","ResourceReasonPair","reason","RemovedResources","elements","Map","externalRemoval","noParallelUniverses","element","dest","push","messages","localize","comment","join","size","has","set","delete","WorkspaceStackElement","removedResources","invalidatedResources","split","ResourceEditStack","_past","_future","locked","versionId","removeResource","setValid","filter","_setElementValidFlag","futureElement","len","snapshot","snapshotLength","isOK","snapshotIndex","removePastAfter","removeFutureBefore","slice","past","future","toRemove","individualMap","j","get","splice","pop","EditStackSnapshot","editStacks","_versionIds","missingEditStack","UndoRedoService","_dialogService","_notificationService","_editStacks","_uriComparisonKeyComputers","uriComparisonKeyComputer","getComparisonKey","toString","console","log","str","group","None","source","getUriComparisonKey","_pushElement","nextOrder","seen","Set","resources","add","_print","editStack","pushElement","hasFutureElements","closestPastElement","getClosestPastElement","ignoreResources","individualArr","_element","splitPastWorkspaceElement","splitFutureWorkspaceElement","dispose","setElementsValidFlag","createSnapshot","restoreSnapshot","hasPastElements","getElements","matchedElement","matchedStrResource","candidate","resourceOrSource","_findClosestUndoElementWithSource","err","removeElements","error","editStackSnapshot","Error","invoke","cleanup","continuation","releaseLocks","_acquireLocks","_onError","prepareUndoRedo","callback","disposable","affectedEditStacks","message","canSplit","_splitPastWorkspaceElement","warn","WorkspaceVerificationError","_undo","checkInvalidatedResources","_tryToSplitAndUndo","createMessage","cannotUndoDueToResources","cannotLockDueToResources","undoConfirmed","_getAffectedEditStacks","verificationError","_checkWorkspaceUndo","returnValue","_confirmAndExecuteWorkspaceUndo","pastElement","secondPastElement","getSecondClosestPastElement","_isPartOfUndoGroup","show","Info","cancelId","choice","verificationError1","_invokeWorkspacePrepare","verificationError2","moveBackward","_safeInvokeWithLocks","undo","_continueUndoInGroup","flushAllElements","_invokeResourcePrepare","_findClosestUndoElementInGroup","undefined","shouldPromptForConfirmation","_confirmAndContinueUndo","_workspaceUndo","_resourceUndo","getClosestFutureElement","_findClosestRedoElementWithSource","_splitFutureWorkspaceElement","_redo","_tryToSplitAndRedo","cannotRedoDueToResources","_checkWorkspaceRedo","_executeWorkspaceRedo","moveForward","redo","_continueRedoInGroup","_findClosestRedoElementInGroup","_workspaceRedo","_resourceRedo"],"sources":["/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/platform/undoRedo/common/undoRedoService.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Disposable, isDisposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport Severity from '../../../base/common/severity.js';\nimport * as nls from '../../../nls.js';\nimport { IDialogService } from '../../dialogs/common/dialogs.js';\nimport { registerSingleton } from '../../instantiation/common/extensions.js';\nimport { INotificationService } from '../../notification/common/notification.js';\nimport { IUndoRedoService, ResourceEditStackSnapshot, UndoRedoGroup, UndoRedoSource } from './undoRedo.js';\nconst DEBUG = false;\nfunction getResourceLabel(resource) {\n    return resource.scheme === Schemas.file ? resource.fsPath : resource.path;\n}\nlet stackElementCounter = 0;\nclass ResourceStackElement {\n    constructor(actual, resourceLabel, strResource, groupId, groupOrder, sourceId, sourceOrder) {\n        this.id = (++stackElementCounter);\n        this.type = 0 /* UndoRedoElementType.Resource */;\n        this.actual = actual;\n        this.label = actual.label;\n        this.confirmBeforeUndo = actual.confirmBeforeUndo || false;\n        this.resourceLabel = resourceLabel;\n        this.strResource = strResource;\n        this.resourceLabels = [this.resourceLabel];\n        this.strResources = [this.strResource];\n        this.groupId = groupId;\n        this.groupOrder = groupOrder;\n        this.sourceId = sourceId;\n        this.sourceOrder = sourceOrder;\n        this.isValid = true;\n    }\n    setValid(isValid) {\n        this.isValid = isValid;\n    }\n    toString() {\n        return `[id:${this.id}] [group:${this.groupId}] [${this.isValid ? '  VALID' : 'INVALID'}] ${this.actual.constructor.name} - ${this.actual}`;\n    }\n}\nclass ResourceReasonPair {\n    constructor(resourceLabel, reason) {\n        this.resourceLabel = resourceLabel;\n        this.reason = reason;\n    }\n}\nclass RemovedResources {\n    constructor() {\n        this.elements = new Map();\n    }\n    createMessage() {\n        const externalRemoval = [];\n        const noParallelUniverses = [];\n        for (const [, element] of this.elements) {\n            const dest = (element.reason === 0 /* RemovedResourceReason.ExternalRemoval */\n                ? externalRemoval\n                : noParallelUniverses);\n            dest.push(element.resourceLabel);\n        }\n        const messages = [];\n        if (externalRemoval.length > 0) {\n            messages.push(nls.localize({ key: 'externalRemoval', comment: ['{0} is a list of filenames'] }, \"The following files have been closed and modified on disk: {0}.\", externalRemoval.join(', ')));\n        }\n        if (noParallelUniverses.length > 0) {\n            messages.push(nls.localize({ key: 'noParallelUniverses', comment: ['{0} is a list of filenames'] }, \"The following files have been modified in an incompatible way: {0}.\", noParallelUniverses.join(', ')));\n        }\n        return messages.join('\\n');\n    }\n    get size() {\n        return this.elements.size;\n    }\n    has(strResource) {\n        return this.elements.has(strResource);\n    }\n    set(strResource, value) {\n        this.elements.set(strResource, value);\n    }\n    delete(strResource) {\n        return this.elements.delete(strResource);\n    }\n}\nclass WorkspaceStackElement {\n    constructor(actual, resourceLabels, strResources, groupId, groupOrder, sourceId, sourceOrder) {\n        this.id = (++stackElementCounter);\n        this.type = 1 /* UndoRedoElementType.Workspace */;\n        this.actual = actual;\n        this.label = actual.label;\n        this.confirmBeforeUndo = actual.confirmBeforeUndo || false;\n        this.resourceLabels = resourceLabels;\n        this.strResources = strResources;\n        this.groupId = groupId;\n        this.groupOrder = groupOrder;\n        this.sourceId = sourceId;\n        this.sourceOrder = sourceOrder;\n        this.removedResources = null;\n        this.invalidatedResources = null;\n    }\n    canSplit() {\n        return (typeof this.actual.split === 'function');\n    }\n    removeResource(resourceLabel, strResource, reason) {\n        if (!this.removedResources) {\n            this.removedResources = new RemovedResources();\n        }\n        if (!this.removedResources.has(strResource)) {\n            this.removedResources.set(strResource, new ResourceReasonPair(resourceLabel, reason));\n        }\n    }\n    setValid(resourceLabel, strResource, isValid) {\n        if (isValid) {\n            if (this.invalidatedResources) {\n                this.invalidatedResources.delete(strResource);\n                if (this.invalidatedResources.size === 0) {\n                    this.invalidatedResources = null;\n                }\n            }\n        }\n        else {\n            if (!this.invalidatedResources) {\n                this.invalidatedResources = new RemovedResources();\n            }\n            if (!this.invalidatedResources.has(strResource)) {\n                this.invalidatedResources.set(strResource, new ResourceReasonPair(resourceLabel, 0 /* RemovedResourceReason.ExternalRemoval */));\n            }\n        }\n    }\n    toString() {\n        return `[id:${this.id}] [group:${this.groupId}] [${this.invalidatedResources ? 'INVALID' : '  VALID'}] ${this.actual.constructor.name} - ${this.actual}`;\n    }\n}\nclass ResourceEditStack {\n    constructor(resourceLabel, strResource) {\n        this.resourceLabel = resourceLabel;\n        this.strResource = strResource;\n        this._past = [];\n        this._future = [];\n        this.locked = false;\n        this.versionId = 1;\n    }\n    dispose() {\n        for (const element of this._past) {\n            if (element.type === 1 /* UndoRedoElementType.Workspace */) {\n                element.removeResource(this.resourceLabel, this.strResource, 0 /* RemovedResourceReason.ExternalRemoval */);\n            }\n        }\n        for (const element of this._future) {\n            if (element.type === 1 /* UndoRedoElementType.Workspace */) {\n                element.removeResource(this.resourceLabel, this.strResource, 0 /* RemovedResourceReason.ExternalRemoval */);\n            }\n        }\n        this.versionId++;\n    }\n    toString() {\n        const result = [];\n        result.push(`* ${this.strResource}:`);\n        for (let i = 0; i < this._past.length; i++) {\n            result.push(`   * [UNDO] ${this._past[i]}`);\n        }\n        for (let i = this._future.length - 1; i >= 0; i--) {\n            result.push(`   * [REDO] ${this._future[i]}`);\n        }\n        return result.join('\\n');\n    }\n    flushAllElements() {\n        this._past = [];\n        this._future = [];\n        this.versionId++;\n    }\n    _setElementValidFlag(element, isValid) {\n        if (element.type === 1 /* UndoRedoElementType.Workspace */) {\n            element.setValid(this.resourceLabel, this.strResource, isValid);\n        }\n        else {\n            element.setValid(isValid);\n        }\n    }\n    setElementsValidFlag(isValid, filter) {\n        for (const element of this._past) {\n            if (filter(element.actual)) {\n                this._setElementValidFlag(element, isValid);\n            }\n        }\n        for (const element of this._future) {\n            if (filter(element.actual)) {\n                this._setElementValidFlag(element, isValid);\n            }\n        }\n    }\n    pushElement(element) {\n        // remove the future\n        for (const futureElement of this._future) {\n            if (futureElement.type === 1 /* UndoRedoElementType.Workspace */) {\n                futureElement.removeResource(this.resourceLabel, this.strResource, 1 /* RemovedResourceReason.NoParallelUniverses */);\n            }\n        }\n        this._future = [];\n        this._past.push(element);\n        this.versionId++;\n    }\n    createSnapshot(resource) {\n        const elements = [];\n        for (let i = 0, len = this._past.length; i < len; i++) {\n            elements.push(this._past[i].id);\n        }\n        for (let i = this._future.length - 1; i >= 0; i--) {\n            elements.push(this._future[i].id);\n        }\n        return new ResourceEditStackSnapshot(resource, elements);\n    }\n    restoreSnapshot(snapshot) {\n        const snapshotLength = snapshot.elements.length;\n        let isOK = true;\n        let snapshotIndex = 0;\n        let removePastAfter = -1;\n        for (let i = 0, len = this._past.length; i < len; i++, snapshotIndex++) {\n            const element = this._past[i];\n            if (isOK && (snapshotIndex >= snapshotLength || element.id !== snapshot.elements[snapshotIndex])) {\n                isOK = false;\n                removePastAfter = 0;\n            }\n            if (!isOK && element.type === 1 /* UndoRedoElementType.Workspace */) {\n                element.removeResource(this.resourceLabel, this.strResource, 0 /* RemovedResourceReason.ExternalRemoval */);\n            }\n        }\n        let removeFutureBefore = -1;\n        for (let i = this._future.length - 1; i >= 0; i--, snapshotIndex++) {\n            const element = this._future[i];\n            if (isOK && (snapshotIndex >= snapshotLength || element.id !== snapshot.elements[snapshotIndex])) {\n                isOK = false;\n                removeFutureBefore = i;\n            }\n            if (!isOK && element.type === 1 /* UndoRedoElementType.Workspace */) {\n                element.removeResource(this.resourceLabel, this.strResource, 0 /* RemovedResourceReason.ExternalRemoval */);\n            }\n        }\n        if (removePastAfter !== -1) {\n            this._past = this._past.slice(0, removePastAfter);\n        }\n        if (removeFutureBefore !== -1) {\n            this._future = this._future.slice(removeFutureBefore + 1);\n        }\n        this.versionId++;\n    }\n    getElements() {\n        const past = [];\n        const future = [];\n        for (const element of this._past) {\n            past.push(element.actual);\n        }\n        for (const element of this._future) {\n            future.push(element.actual);\n        }\n        return { past, future };\n    }\n    getClosestPastElement() {\n        if (this._past.length === 0) {\n            return null;\n        }\n        return this._past[this._past.length - 1];\n    }\n    getSecondClosestPastElement() {\n        if (this._past.length < 2) {\n            return null;\n        }\n        return this._past[this._past.length - 2];\n    }\n    getClosestFutureElement() {\n        if (this._future.length === 0) {\n            return null;\n        }\n        return this._future[this._future.length - 1];\n    }\n    hasPastElements() {\n        return (this._past.length > 0);\n    }\n    hasFutureElements() {\n        return (this._future.length > 0);\n    }\n    splitPastWorkspaceElement(toRemove, individualMap) {\n        for (let j = this._past.length - 1; j >= 0; j--) {\n            if (this._past[j] === toRemove) {\n                if (individualMap.has(this.strResource)) {\n                    // gets replaced\n                    this._past[j] = individualMap.get(this.strResource);\n                }\n                else {\n                    // gets deleted\n                    this._past.splice(j, 1);\n                }\n                break;\n            }\n        }\n        this.versionId++;\n    }\n    splitFutureWorkspaceElement(toRemove, individualMap) {\n        for (let j = this._future.length - 1; j >= 0; j--) {\n            if (this._future[j] === toRemove) {\n                if (individualMap.has(this.strResource)) {\n                    // gets replaced\n                    this._future[j] = individualMap.get(this.strResource);\n                }\n                else {\n                    // gets deleted\n                    this._future.splice(j, 1);\n                }\n                break;\n            }\n        }\n        this.versionId++;\n    }\n    moveBackward(element) {\n        this._past.pop();\n        this._future.push(element);\n        this.versionId++;\n    }\n    moveForward(element) {\n        this._future.pop();\n        this._past.push(element);\n        this.versionId++;\n    }\n}\nclass EditStackSnapshot {\n    constructor(editStacks) {\n        this.editStacks = editStacks;\n        this._versionIds = [];\n        for (let i = 0, len = this.editStacks.length; i < len; i++) {\n            this._versionIds[i] = this.editStacks[i].versionId;\n        }\n    }\n    isValid() {\n        for (let i = 0, len = this.editStacks.length; i < len; i++) {\n            if (this._versionIds[i] !== this.editStacks[i].versionId) {\n                return false;\n            }\n        }\n        return true;\n    }\n}\nconst missingEditStack = new ResourceEditStack('', '');\nmissingEditStack.locked = true;\nlet UndoRedoService = class UndoRedoService {\n    constructor(_dialogService, _notificationService) {\n        this._dialogService = _dialogService;\n        this._notificationService = _notificationService;\n        this._editStacks = new Map();\n        this._uriComparisonKeyComputers = [];\n    }\n    getUriComparisonKey(resource) {\n        for (const uriComparisonKeyComputer of this._uriComparisonKeyComputers) {\n            if (uriComparisonKeyComputer[0] === resource.scheme) {\n                return uriComparisonKeyComputer[1].getComparisonKey(resource);\n            }\n        }\n        return resource.toString();\n    }\n    _print(label) {\n        console.log(`------------------------------------`);\n        console.log(`AFTER ${label}: `);\n        const str = [];\n        for (const element of this._editStacks) {\n            str.push(element[1].toString());\n        }\n        console.log(str.join('\\n'));\n    }\n    pushElement(element, group = UndoRedoGroup.None, source = UndoRedoSource.None) {\n        if (element.type === 0 /* UndoRedoElementType.Resource */) {\n            const resourceLabel = getResourceLabel(element.resource);\n            const strResource = this.getUriComparisonKey(element.resource);\n            this._pushElement(new ResourceStackElement(element, resourceLabel, strResource, group.id, group.nextOrder(), source.id, source.nextOrder()));\n        }\n        else {\n            const seen = new Set();\n            const resourceLabels = [];\n            const strResources = [];\n            for (const resource of element.resources) {\n                const resourceLabel = getResourceLabel(resource);\n                const strResource = this.getUriComparisonKey(resource);\n                if (seen.has(strResource)) {\n                    continue;\n                }\n                seen.add(strResource);\n                resourceLabels.push(resourceLabel);\n                strResources.push(strResource);\n            }\n            if (resourceLabels.length === 1) {\n                this._pushElement(new ResourceStackElement(element, resourceLabels[0], strResources[0], group.id, group.nextOrder(), source.id, source.nextOrder()));\n            }\n            else {\n                this._pushElement(new WorkspaceStackElement(element, resourceLabels, strResources, group.id, group.nextOrder(), source.id, source.nextOrder()));\n            }\n        }\n        if (DEBUG) {\n            this._print('pushElement');\n        }\n    }\n    _pushElement(element) {\n        for (let i = 0, len = element.strResources.length; i < len; i++) {\n            const resourceLabel = element.resourceLabels[i];\n            const strResource = element.strResources[i];\n            let editStack;\n            if (this._editStacks.has(strResource)) {\n                editStack = this._editStacks.get(strResource);\n            }\n            else {\n                editStack = new ResourceEditStack(resourceLabel, strResource);\n                this._editStacks.set(strResource, editStack);\n            }\n            editStack.pushElement(element);\n        }\n    }\n    getLastElement(resource) {\n        const strResource = this.getUriComparisonKey(resource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            if (editStack.hasFutureElements()) {\n                return null;\n            }\n            const closestPastElement = editStack.getClosestPastElement();\n            return closestPastElement ? closestPastElement.actual : null;\n        }\n        return null;\n    }\n    _splitPastWorkspaceElement(toRemove, ignoreResources) {\n        const individualArr = toRemove.actual.split();\n        const individualMap = new Map();\n        for (const _element of individualArr) {\n            const resourceLabel = getResourceLabel(_element.resource);\n            const strResource = this.getUriComparisonKey(_element.resource);\n            const element = new ResourceStackElement(_element, resourceLabel, strResource, 0, 0, 0, 0);\n            individualMap.set(element.strResource, element);\n        }\n        for (const strResource of toRemove.strResources) {\n            if (ignoreResources && ignoreResources.has(strResource)) {\n                continue;\n            }\n            const editStack = this._editStacks.get(strResource);\n            editStack.splitPastWorkspaceElement(toRemove, individualMap);\n        }\n    }\n    _splitFutureWorkspaceElement(toRemove, ignoreResources) {\n        const individualArr = toRemove.actual.split();\n        const individualMap = new Map();\n        for (const _element of individualArr) {\n            const resourceLabel = getResourceLabel(_element.resource);\n            const strResource = this.getUriComparisonKey(_element.resource);\n            const element = new ResourceStackElement(_element, resourceLabel, strResource, 0, 0, 0, 0);\n            individualMap.set(element.strResource, element);\n        }\n        for (const strResource of toRemove.strResources) {\n            if (ignoreResources && ignoreResources.has(strResource)) {\n                continue;\n            }\n            const editStack = this._editStacks.get(strResource);\n            editStack.splitFutureWorkspaceElement(toRemove, individualMap);\n        }\n    }\n    removeElements(resource) {\n        const strResource = typeof resource === 'string' ? resource : this.getUriComparisonKey(resource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            editStack.dispose();\n            this._editStacks.delete(strResource);\n        }\n        if (DEBUG) {\n            this._print('removeElements');\n        }\n    }\n    setElementsValidFlag(resource, isValid, filter) {\n        const strResource = this.getUriComparisonKey(resource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            editStack.setElementsValidFlag(isValid, filter);\n        }\n        if (DEBUG) {\n            this._print('setElementsValidFlag');\n        }\n    }\n    createSnapshot(resource) {\n        const strResource = this.getUriComparisonKey(resource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            return editStack.createSnapshot(resource);\n        }\n        return new ResourceEditStackSnapshot(resource, []);\n    }\n    restoreSnapshot(snapshot) {\n        const strResource = this.getUriComparisonKey(snapshot.resource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            editStack.restoreSnapshot(snapshot);\n            if (!editStack.hasPastElements() && !editStack.hasFutureElements()) {\n                // the edit stack is now empty, just remove it entirely\n                editStack.dispose();\n                this._editStacks.delete(strResource);\n            }\n        }\n        if (DEBUG) {\n            this._print('restoreSnapshot');\n        }\n    }\n    getElements(resource) {\n        const strResource = this.getUriComparisonKey(resource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            return editStack.getElements();\n        }\n        return { past: [], future: [] };\n    }\n    _findClosestUndoElementWithSource(sourceId) {\n        if (!sourceId) {\n            return [null, null];\n        }\n        // find an element with the sourceId and with the highest sourceOrder ready to be undone\n        let matchedElement = null;\n        let matchedStrResource = null;\n        for (const [strResource, editStack] of this._editStacks) {\n            const candidate = editStack.getClosestPastElement();\n            if (!candidate) {\n                continue;\n            }\n            if (candidate.sourceId === sourceId) {\n                if (!matchedElement || candidate.sourceOrder > matchedElement.sourceOrder) {\n                    matchedElement = candidate;\n                    matchedStrResource = strResource;\n                }\n            }\n        }\n        return [matchedElement, matchedStrResource];\n    }\n    canUndo(resourceOrSource) {\n        if (resourceOrSource instanceof UndoRedoSource) {\n            const [, matchedStrResource] = this._findClosestUndoElementWithSource(resourceOrSource.id);\n            return matchedStrResource ? true : false;\n        }\n        const strResource = this.getUriComparisonKey(resourceOrSource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            return editStack.hasPastElements();\n        }\n        return false;\n    }\n    _onError(err, element) {\n        onUnexpectedError(err);\n        // An error occurred while undoing or redoing => drop the undo/redo stack for all affected resources\n        for (const strResource of element.strResources) {\n            this.removeElements(strResource);\n        }\n        this._notificationService.error(err);\n    }\n    _acquireLocks(editStackSnapshot) {\n        // first, check if all locks can be acquired\n        for (const editStack of editStackSnapshot.editStacks) {\n            if (editStack.locked) {\n                throw new Error('Cannot acquire edit stack lock');\n            }\n        }\n        // can acquire all locks\n        for (const editStack of editStackSnapshot.editStacks) {\n            editStack.locked = true;\n        }\n        return () => {\n            // release all locks\n            for (const editStack of editStackSnapshot.editStacks) {\n                editStack.locked = false;\n            }\n        };\n    }\n    _safeInvokeWithLocks(element, invoke, editStackSnapshot, cleanup, continuation) {\n        const releaseLocks = this._acquireLocks(editStackSnapshot);\n        let result;\n        try {\n            result = invoke();\n        }\n        catch (err) {\n            releaseLocks();\n            cleanup.dispose();\n            return this._onError(err, element);\n        }\n        if (result) {\n            // result is Promise<void>\n            return result.then(() => {\n                releaseLocks();\n                cleanup.dispose();\n                return continuation();\n            }, (err) => {\n                releaseLocks();\n                cleanup.dispose();\n                return this._onError(err, element);\n            });\n        }\n        else {\n            // result is void\n            releaseLocks();\n            cleanup.dispose();\n            return continuation();\n        }\n    }\n    _invokeWorkspacePrepare(element) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (typeof element.actual.prepareUndoRedo === 'undefined') {\n                return Disposable.None;\n            }\n            const result = element.actual.prepareUndoRedo();\n            if (typeof result === 'undefined') {\n                return Disposable.None;\n            }\n            return result;\n        });\n    }\n    _invokeResourcePrepare(element, callback) {\n        if (element.actual.type !== 1 /* UndoRedoElementType.Workspace */ || typeof element.actual.prepareUndoRedo === 'undefined') {\n            // no preparation needed\n            return callback(Disposable.None);\n        }\n        const r = element.actual.prepareUndoRedo();\n        if (!r) {\n            // nothing to clean up\n            return callback(Disposable.None);\n        }\n        if (isDisposable(r)) {\n            return callback(r);\n        }\n        return r.then((disposable) => {\n            return callback(disposable);\n        });\n    }\n    _getAffectedEditStacks(element) {\n        const affectedEditStacks = [];\n        for (const strResource of element.strResources) {\n            affectedEditStacks.push(this._editStacks.get(strResource) || missingEditStack);\n        }\n        return new EditStackSnapshot(affectedEditStacks);\n    }\n    _tryToSplitAndUndo(strResource, element, ignoreResources, message) {\n        if (element.canSplit()) {\n            this._splitPastWorkspaceElement(element, ignoreResources);\n            this._notificationService.warn(message);\n            return new WorkspaceVerificationError(this._undo(strResource, 0, true));\n        }\n        else {\n            // Cannot safely split this workspace element => flush all undo/redo stacks\n            for (const strResource of element.strResources) {\n                this.removeElements(strResource);\n            }\n            this._notificationService.warn(message);\n            return new WorkspaceVerificationError();\n        }\n    }\n    _checkWorkspaceUndo(strResource, element, editStackSnapshot, checkInvalidatedResources) {\n        if (element.removedResources) {\n            return this._tryToSplitAndUndo(strResource, element, element.removedResources, nls.localize({ key: 'cannotWorkspaceUndo', comment: ['{0} is a label for an operation. {1} is another message.'] }, \"Could not undo '{0}' across all files. {1}\", element.label, element.removedResources.createMessage()));\n        }\n        if (checkInvalidatedResources && element.invalidatedResources) {\n            return this._tryToSplitAndUndo(strResource, element, element.invalidatedResources, nls.localize({ key: 'cannotWorkspaceUndo', comment: ['{0} is a label for an operation. {1} is another message.'] }, \"Could not undo '{0}' across all files. {1}\", element.label, element.invalidatedResources.createMessage()));\n        }\n        // this must be the last past element in all the impacted resources!\n        const cannotUndoDueToResources = [];\n        for (const editStack of editStackSnapshot.editStacks) {\n            if (editStack.getClosestPastElement() !== element) {\n                cannotUndoDueToResources.push(editStack.resourceLabel);\n            }\n        }\n        if (cannotUndoDueToResources.length > 0) {\n            return this._tryToSplitAndUndo(strResource, element, null, nls.localize({ key: 'cannotWorkspaceUndoDueToChanges', comment: ['{0} is a label for an operation. {1} is a list of filenames.'] }, \"Could not undo '{0}' across all files because changes were made to {1}\", element.label, cannotUndoDueToResources.join(', ')));\n        }\n        const cannotLockDueToResources = [];\n        for (const editStack of editStackSnapshot.editStacks) {\n            if (editStack.locked) {\n                cannotLockDueToResources.push(editStack.resourceLabel);\n            }\n        }\n        if (cannotLockDueToResources.length > 0) {\n            return this._tryToSplitAndUndo(strResource, element, null, nls.localize({ key: 'cannotWorkspaceUndoDueToInProgressUndoRedo', comment: ['{0} is a label for an operation. {1} is a list of filenames.'] }, \"Could not undo '{0}' across all files because there is already an undo or redo operation running on {1}\", element.label, cannotLockDueToResources.join(', ')));\n        }\n        // check if new stack elements were added in the meantime...\n        if (!editStackSnapshot.isValid()) {\n            return this._tryToSplitAndUndo(strResource, element, null, nls.localize({ key: 'cannotWorkspaceUndoDueToInMeantimeUndoRedo', comment: ['{0} is a label for an operation. {1} is a list of filenames.'] }, \"Could not undo '{0}' across all files because an undo or redo operation occurred in the meantime\", element.label));\n        }\n        return null;\n    }\n    _workspaceUndo(strResource, element, undoConfirmed) {\n        const affectedEditStacks = this._getAffectedEditStacks(element);\n        const verificationError = this._checkWorkspaceUndo(strResource, element, affectedEditStacks, /*invalidated resources will be checked after the prepare call*/ false);\n        if (verificationError) {\n            return verificationError.returnValue;\n        }\n        return this._confirmAndExecuteWorkspaceUndo(strResource, element, affectedEditStacks, undoConfirmed);\n    }\n    _isPartOfUndoGroup(element) {\n        if (!element.groupId) {\n            return false;\n        }\n        // check that there is at least another element with the same groupId ready to be undone\n        for (const [, editStack] of this._editStacks) {\n            const pastElement = editStack.getClosestPastElement();\n            if (!pastElement) {\n                continue;\n            }\n            if (pastElement === element) {\n                const secondPastElement = editStack.getSecondClosestPastElement();\n                if (secondPastElement && secondPastElement.groupId === element.groupId) {\n                    // there is another element with the same group id in the same stack!\n                    return true;\n                }\n            }\n            if (pastElement.groupId === element.groupId) {\n                // there is another element with the same group id in another stack!\n                return true;\n            }\n        }\n        return false;\n    }\n    _confirmAndExecuteWorkspaceUndo(strResource, element, editStackSnapshot, undoConfirmed) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (element.canSplit() && !this._isPartOfUndoGroup(element)) {\n                // this element can be split\n                const result = yield this._dialogService.show(Severity.Info, nls.localize('confirmWorkspace', \"Would you like to undo '{0}' across all files?\", element.label), [\n                    nls.localize({ key: 'ok', comment: ['{0} denotes a number that is > 1'] }, \"Undo in {0} Files\", editStackSnapshot.editStacks.length),\n                    nls.localize('nok', \"Undo this File\"),\n                    nls.localize('cancel', \"Cancel\"),\n                ], {\n                    cancelId: 2\n                });\n                if (result.choice === 2) {\n                    // choice: cancel\n                    return;\n                }\n                if (result.choice === 1) {\n                    // choice: undo this file\n                    this._splitPastWorkspaceElement(element, null);\n                    return this._undo(strResource, 0, true);\n                }\n                // choice: undo in all files\n                // At this point, it is possible that the element has been made invalid in the meantime (due to the confirmation await)\n                const verificationError1 = this._checkWorkspaceUndo(strResource, element, editStackSnapshot, /*invalidated resources will be checked after the prepare call*/ false);\n                if (verificationError1) {\n                    return verificationError1.returnValue;\n                }\n                undoConfirmed = true;\n            }\n            // prepare\n            let cleanup;\n            try {\n                cleanup = yield this._invokeWorkspacePrepare(element);\n            }\n            catch (err) {\n                return this._onError(err, element);\n            }\n            // At this point, it is possible that the element has been made invalid in the meantime (due to the prepare await)\n            const verificationError2 = this._checkWorkspaceUndo(strResource, element, editStackSnapshot, /*now also check that there are no more invalidated resources*/ true);\n            if (verificationError2) {\n                cleanup.dispose();\n                return verificationError2.returnValue;\n            }\n            for (const editStack of editStackSnapshot.editStacks) {\n                editStack.moveBackward(element);\n            }\n            return this._safeInvokeWithLocks(element, () => element.actual.undo(), editStackSnapshot, cleanup, () => this._continueUndoInGroup(element.groupId, undoConfirmed));\n        });\n    }\n    _resourceUndo(editStack, element, undoConfirmed) {\n        if (!element.isValid) {\n            // invalid element => immediately flush edit stack!\n            editStack.flushAllElements();\n            return;\n        }\n        if (editStack.locked) {\n            const message = nls.localize({ key: 'cannotResourceUndoDueToInProgressUndoRedo', comment: ['{0} is a label for an operation.'] }, \"Could not undo '{0}' because there is already an undo or redo operation running.\", element.label);\n            this._notificationService.warn(message);\n            return;\n        }\n        return this._invokeResourcePrepare(element, (cleanup) => {\n            editStack.moveBackward(element);\n            return this._safeInvokeWithLocks(element, () => element.actual.undo(), new EditStackSnapshot([editStack]), cleanup, () => this._continueUndoInGroup(element.groupId, undoConfirmed));\n        });\n    }\n    _findClosestUndoElementInGroup(groupId) {\n        if (!groupId) {\n            return [null, null];\n        }\n        // find another element with the same groupId and with the highest groupOrder ready to be undone\n        let matchedElement = null;\n        let matchedStrResource = null;\n        for (const [strResource, editStack] of this._editStacks) {\n            const candidate = editStack.getClosestPastElement();\n            if (!candidate) {\n                continue;\n            }\n            if (candidate.groupId === groupId) {\n                if (!matchedElement || candidate.groupOrder > matchedElement.groupOrder) {\n                    matchedElement = candidate;\n                    matchedStrResource = strResource;\n                }\n            }\n        }\n        return [matchedElement, matchedStrResource];\n    }\n    _continueUndoInGroup(groupId, undoConfirmed) {\n        if (!groupId) {\n            return;\n        }\n        const [, matchedStrResource] = this._findClosestUndoElementInGroup(groupId);\n        if (matchedStrResource) {\n            return this._undo(matchedStrResource, 0, undoConfirmed);\n        }\n    }\n    undo(resourceOrSource) {\n        if (resourceOrSource instanceof UndoRedoSource) {\n            const [, matchedStrResource] = this._findClosestUndoElementWithSource(resourceOrSource.id);\n            return matchedStrResource ? this._undo(matchedStrResource, resourceOrSource.id, false) : undefined;\n        }\n        if (typeof resourceOrSource === 'string') {\n            return this._undo(resourceOrSource, 0, false);\n        }\n        return this._undo(this.getUriComparisonKey(resourceOrSource), 0, false);\n    }\n    _undo(strResource, sourceId = 0, undoConfirmed) {\n        if (!this._editStacks.has(strResource)) {\n            return;\n        }\n        const editStack = this._editStacks.get(strResource);\n        const element = editStack.getClosestPastElement();\n        if (!element) {\n            return;\n        }\n        if (element.groupId) {\n            // this element is a part of a group, we need to make sure undoing in a group is in order\n            const [matchedElement, matchedStrResource] = this._findClosestUndoElementInGroup(element.groupId);\n            if (element !== matchedElement && matchedStrResource) {\n                // there is an element in the same group that should be undone before this one\n                return this._undo(matchedStrResource, sourceId, undoConfirmed);\n            }\n        }\n        const shouldPromptForConfirmation = (element.sourceId !== sourceId || element.confirmBeforeUndo);\n        if (shouldPromptForConfirmation && !undoConfirmed) {\n            // Hit a different source or the element asks for prompt before undo, prompt for confirmation\n            return this._confirmAndContinueUndo(strResource, sourceId, element);\n        }\n        try {\n            if (element.type === 1 /* UndoRedoElementType.Workspace */) {\n                return this._workspaceUndo(strResource, element, undoConfirmed);\n            }\n            else {\n                return this._resourceUndo(editStack, element, undoConfirmed);\n            }\n        }\n        finally {\n            if (DEBUG) {\n                this._print('undo');\n            }\n        }\n    }\n    _confirmAndContinueUndo(strResource, sourceId, element) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const result = yield this._dialogService.show(Severity.Info, nls.localize('confirmDifferentSource', \"Would you like to undo '{0}'?\", element.label), [\n                nls.localize('confirmDifferentSource.yes', \"Yes\"),\n                nls.localize('confirmDifferentSource.no', \"No\"),\n            ], {\n                cancelId: 1\n            });\n            if (result.choice === 1) {\n                // choice: cancel\n                return;\n            }\n            // choice: undo\n            return this._undo(strResource, sourceId, true);\n        });\n    }\n    _findClosestRedoElementWithSource(sourceId) {\n        if (!sourceId) {\n            return [null, null];\n        }\n        // find an element with sourceId and with the lowest sourceOrder ready to be redone\n        let matchedElement = null;\n        let matchedStrResource = null;\n        for (const [strResource, editStack] of this._editStacks) {\n            const candidate = editStack.getClosestFutureElement();\n            if (!candidate) {\n                continue;\n            }\n            if (candidate.sourceId === sourceId) {\n                if (!matchedElement || candidate.sourceOrder < matchedElement.sourceOrder) {\n                    matchedElement = candidate;\n                    matchedStrResource = strResource;\n                }\n            }\n        }\n        return [matchedElement, matchedStrResource];\n    }\n    canRedo(resourceOrSource) {\n        if (resourceOrSource instanceof UndoRedoSource) {\n            const [, matchedStrResource] = this._findClosestRedoElementWithSource(resourceOrSource.id);\n            return matchedStrResource ? true : false;\n        }\n        const strResource = this.getUriComparisonKey(resourceOrSource);\n        if (this._editStacks.has(strResource)) {\n            const editStack = this._editStacks.get(strResource);\n            return editStack.hasFutureElements();\n        }\n        return false;\n    }\n    _tryToSplitAndRedo(strResource, element, ignoreResources, message) {\n        if (element.canSplit()) {\n            this._splitFutureWorkspaceElement(element, ignoreResources);\n            this._notificationService.warn(message);\n            return new WorkspaceVerificationError(this._redo(strResource));\n        }\n        else {\n            // Cannot safely split this workspace element => flush all undo/redo stacks\n            for (const strResource of element.strResources) {\n                this.removeElements(strResource);\n            }\n            this._notificationService.warn(message);\n            return new WorkspaceVerificationError();\n        }\n    }\n    _checkWorkspaceRedo(strResource, element, editStackSnapshot, checkInvalidatedResources) {\n        if (element.removedResources) {\n            return this._tryToSplitAndRedo(strResource, element, element.removedResources, nls.localize({ key: 'cannotWorkspaceRedo', comment: ['{0} is a label for an operation. {1} is another message.'] }, \"Could not redo '{0}' across all files. {1}\", element.label, element.removedResources.createMessage()));\n        }\n        if (checkInvalidatedResources && element.invalidatedResources) {\n            return this._tryToSplitAndRedo(strResource, element, element.invalidatedResources, nls.localize({ key: 'cannotWorkspaceRedo', comment: ['{0} is a label for an operation. {1} is another message.'] }, \"Could not redo '{0}' across all files. {1}\", element.label, element.invalidatedResources.createMessage()));\n        }\n        // this must be the last future element in all the impacted resources!\n        const cannotRedoDueToResources = [];\n        for (const editStack of editStackSnapshot.editStacks) {\n            if (editStack.getClosestFutureElement() !== element) {\n                cannotRedoDueToResources.push(editStack.resourceLabel);\n            }\n        }\n        if (cannotRedoDueToResources.length > 0) {\n            return this._tryToSplitAndRedo(strResource, element, null, nls.localize({ key: 'cannotWorkspaceRedoDueToChanges', comment: ['{0} is a label for an operation. {1} is a list of filenames.'] }, \"Could not redo '{0}' across all files because changes were made to {1}\", element.label, cannotRedoDueToResources.join(', ')));\n        }\n        const cannotLockDueToResources = [];\n        for (const editStack of editStackSnapshot.editStacks) {\n            if (editStack.locked) {\n                cannotLockDueToResources.push(editStack.resourceLabel);\n            }\n        }\n        if (cannotLockDueToResources.length > 0) {\n            return this._tryToSplitAndRedo(strResource, element, null, nls.localize({ key: 'cannotWorkspaceRedoDueToInProgressUndoRedo', comment: ['{0} is a label for an operation. {1} is a list of filenames.'] }, \"Could not redo '{0}' across all files because there is already an undo or redo operation running on {1}\", element.label, cannotLockDueToResources.join(', ')));\n        }\n        // check if new stack elements were added in the meantime...\n        if (!editStackSnapshot.isValid()) {\n            return this._tryToSplitAndRedo(strResource, element, null, nls.localize({ key: 'cannotWorkspaceRedoDueToInMeantimeUndoRedo', comment: ['{0} is a label for an operation. {1} is a list of filenames.'] }, \"Could not redo '{0}' across all files because an undo or redo operation occurred in the meantime\", element.label));\n        }\n        return null;\n    }\n    _workspaceRedo(strResource, element) {\n        const affectedEditStacks = this._getAffectedEditStacks(element);\n        const verificationError = this._checkWorkspaceRedo(strResource, element, affectedEditStacks, /*invalidated resources will be checked after the prepare call*/ false);\n        if (verificationError) {\n            return verificationError.returnValue;\n        }\n        return this._executeWorkspaceRedo(strResource, element, affectedEditStacks);\n    }\n    _executeWorkspaceRedo(strResource, element, editStackSnapshot) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // prepare\n            let cleanup;\n            try {\n                cleanup = yield this._invokeWorkspacePrepare(element);\n            }\n            catch (err) {\n                return this._onError(err, element);\n            }\n            // At this point, it is possible that the element has been made invalid in the meantime (due to the prepare await)\n            const verificationError = this._checkWorkspaceRedo(strResource, element, editStackSnapshot, /*now also check that there are no more invalidated resources*/ true);\n            if (verificationError) {\n                cleanup.dispose();\n                return verificationError.returnValue;\n            }\n            for (const editStack of editStackSnapshot.editStacks) {\n                editStack.moveForward(element);\n            }\n            return this._safeInvokeWithLocks(element, () => element.actual.redo(), editStackSnapshot, cleanup, () => this._continueRedoInGroup(element.groupId));\n        });\n    }\n    _resourceRedo(editStack, element) {\n        if (!element.isValid) {\n            // invalid element => immediately flush edit stack!\n            editStack.flushAllElements();\n            return;\n        }\n        if (editStack.locked) {\n            const message = nls.localize({ key: 'cannotResourceRedoDueToInProgressUndoRedo', comment: ['{0} is a label for an operation.'] }, \"Could not redo '{0}' because there is already an undo or redo operation running.\", element.label);\n            this._notificationService.warn(message);\n            return;\n        }\n        return this._invokeResourcePrepare(element, (cleanup) => {\n            editStack.moveForward(element);\n            return this._safeInvokeWithLocks(element, () => element.actual.redo(), new EditStackSnapshot([editStack]), cleanup, () => this._continueRedoInGroup(element.groupId));\n        });\n    }\n    _findClosestRedoElementInGroup(groupId) {\n        if (!groupId) {\n            return [null, null];\n        }\n        // find another element with the same groupId and with the lowest groupOrder ready to be redone\n        let matchedElement = null;\n        let matchedStrResource = null;\n        for (const [strResource, editStack] of this._editStacks) {\n            const candidate = editStack.getClosestFutureElement();\n            if (!candidate) {\n                continue;\n            }\n            if (candidate.groupId === groupId) {\n                if (!matchedElement || candidate.groupOrder < matchedElement.groupOrder) {\n                    matchedElement = candidate;\n                    matchedStrResource = strResource;\n                }\n            }\n        }\n        return [matchedElement, matchedStrResource];\n    }\n    _continueRedoInGroup(groupId) {\n        if (!groupId) {\n            return;\n        }\n        const [, matchedStrResource] = this._findClosestRedoElementInGroup(groupId);\n        if (matchedStrResource) {\n            return this._redo(matchedStrResource);\n        }\n    }\n    redo(resourceOrSource) {\n        if (resourceOrSource instanceof UndoRedoSource) {\n            const [, matchedStrResource] = this._findClosestRedoElementWithSource(resourceOrSource.id);\n            return matchedStrResource ? this._redo(matchedStrResource) : undefined;\n        }\n        if (typeof resourceOrSource === 'string') {\n            return this._redo(resourceOrSource);\n        }\n        return this._redo(this.getUriComparisonKey(resourceOrSource));\n    }\n    _redo(strResource) {\n        if (!this._editStacks.has(strResource)) {\n            return;\n        }\n        const editStack = this._editStacks.get(strResource);\n        const element = editStack.getClosestFutureElement();\n        if (!element) {\n            return;\n        }\n        if (element.groupId) {\n            // this element is a part of a group, we need to make sure redoing in a group is in order\n            const [matchedElement, matchedStrResource] = this._findClosestRedoElementInGroup(element.groupId);\n            if (element !== matchedElement && matchedStrResource) {\n                // there is an element in the same group that should be redone before this one\n                return this._redo(matchedStrResource);\n            }\n        }\n        try {\n            if (element.type === 1 /* UndoRedoElementType.Workspace */) {\n                return this._workspaceRedo(strResource, element);\n            }\n            else {\n                return this._resourceRedo(editStack, element);\n            }\n        }\n        finally {\n            if (DEBUG) {\n                this._print('redo');\n            }\n        }\n    }\n};\nUndoRedoService = __decorate([\n    __param(0, IDialogService),\n    __param(1, INotificationService)\n], UndoRedoService);\nexport { UndoRedoService };\nclass WorkspaceVerificationError {\n    constructor(returnValue) {\n        this.returnValue = returnValue;\n    }\n}\nregisterSingleton(IUndoRedoService, UndoRedoService);\n"],"mappings":"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"}]}