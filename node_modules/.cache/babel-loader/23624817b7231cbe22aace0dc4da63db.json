{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/thread-loader/dist/cjs.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/model/bracketPairsTextModelPart/bracketPairsImpl.js","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/model/bracketPairsTextModelPart/bracketPairsImpl.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/babel.config.js","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMveWFuamlhamlhL0Rlc2t0b3Avd29ya3NwYWNlL2F2dWUtZGF0YS1uZXcvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrLmpzIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMveWFuamlhamlhL0Rlc2t0b3Avd29ya3NwYWNlL2F2dWUtZGF0YS1uZXcvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzLmpzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICIvVXNlcnMveWFuamlhamlhL0Rlc2t0b3Avd29ya3NwYWNlL2F2dWUtZGF0YS1uZXcvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzLmpzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvVXNlcnMveWFuamlhamlhL0Rlc2t0b3Avd29ya3NwYWNlL2F2dWUtZGF0YS1uZXcvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZVN1cGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLgogKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KaW1wb3J0IHsgRW1pdHRlciB9IGZyb20gJy4uLy4uLy4uLy4uL2Jhc2UvY29tbW9uL2V2ZW50LmpzJzsKaW1wb3J0IHsgRGlzcG9zYWJsZSwgRGlzcG9zYWJsZVN0b3JlLCBNdXRhYmxlRGlzcG9zYWJsZSB9IGZyb20gJy4uLy4uLy4uLy4uL2Jhc2UvY29tbW9uL2xpZmVjeWNsZS5qcyc7CmltcG9ydCB7IFJhbmdlIH0gZnJvbSAnLi4vLi4vY29yZS9yYW5nZS5qcyc7CmltcG9ydCB7IEJyYWNrZXRQYWlyc1RyZWUgfSBmcm9tICcuL2JyYWNrZXRQYWlyc1RyZWUvYnJhY2tldFBhaXJzVHJlZS5qcyc7CmltcG9ydCB7IGlnbm9yZUJyYWNrZXRzSW5Ub2tlbiB9IGZyb20gJy4uLy4uL2xhbmd1YWdlcy9zdXBwb3J0cy5qcyc7CmltcG9ydCB7IEJyYWNrZXRzVXRpbHMgfSBmcm9tICcuLi8uLi9sYW5ndWFnZXMvc3VwcG9ydHMvcmljaEVkaXRCcmFja2V0cy5qcyc7CmltcG9ydCB7IGNvbXBhcmVCeSwgZmluZExhc3QsIGZpbmRMYXN0TWF4QnkgfSBmcm9tICcuLi8uLi8uLi8uLi9iYXNlL2NvbW1vbi9hcnJheXMuanMnOwpleHBvcnQgdmFyIEJyYWNrZXRQYWlyc1RleHRNb2RlbFBhcnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9EaXNwb3NhYmxlKSB7CiAgX2luaGVyaXRzKEJyYWNrZXRQYWlyc1RleHRNb2RlbFBhcnQsIF9EaXNwb3NhYmxlKTsKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEJyYWNrZXRQYWlyc1RleHRNb2RlbFBhcnQpOwogIGZ1bmN0aW9uIEJyYWNrZXRQYWlyc1RleHRNb2RlbFBhcnQodGV4dE1vZGVsLCBsYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlKSB7CiAgICB2YXIgX3RoaXM7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQnJhY2tldFBhaXJzVGV4dE1vZGVsUGFydCk7CiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpOwogICAgX3RoaXMudGV4dE1vZGVsID0gdGV4dE1vZGVsOwogICAgX3RoaXMubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZSA9IGxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2U7CiAgICBfdGhpcy5icmFja2V0UGFpcnNUcmVlID0gX3RoaXMuX3JlZ2lzdGVyKG5ldyBNdXRhYmxlRGlzcG9zYWJsZSgpKTsKICAgIF90aGlzLm9uRGlkQ2hhbmdlRW1pdHRlciA9IG5ldyBFbWl0dGVyKCk7CiAgICBfdGhpcy5vbkRpZENoYW5nZSA9IF90aGlzLm9uRGlkQ2hhbmdlRW1pdHRlci5ldmVudDsKICAgIF90aGlzLmJyYWNrZXRzUmVxdWVzdGVkID0gZmFsc2U7CiAgICBfdGhpcy5fcmVnaXN0ZXIoX3RoaXMubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZS5vbkRpZENoYW5nZShmdW5jdGlvbiAoZSkgewogICAgICB2YXIgX2E7CiAgICAgIGlmICghZS5sYW5ndWFnZUlkIHx8ICgoX2EgPSBfdGhpcy5icmFja2V0UGFpcnNUcmVlLnZhbHVlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub2JqZWN0LmRpZExhbmd1YWdlQ2hhbmdlKGUubGFuZ3VhZ2VJZCkpKSB7CiAgICAgICAgX3RoaXMuYnJhY2tldFBhaXJzVHJlZS5jbGVhcigpOwogICAgICAgIF90aGlzLnVwZGF0ZUJyYWNrZXRQYWlyc1RyZWUoKTsKICAgICAgfQogICAgfSkpOwogICAgcmV0dXJuIF90aGlzOwogIH0KICBfY3JlYXRlQ2xhc3MoQnJhY2tldFBhaXJzVGV4dE1vZGVsUGFydCwgW3sKICAgIGtleTogImNhbkJ1aWxkQVNUIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgbWF4U3VwcG9ydGVkRG9jdW1lbnRMZW5ndGggPSAvKiBtYXggbGluZXMgKi81MDAwMCAqIC8qIGF2ZXJhZ2UgY29sdW1uIGNvdW50ICovMTAwOwogICAgICByZXR1cm4gdGhpcy50ZXh0TW9kZWwuZ2V0VmFsdWVMZW5ndGgoKSA8PSBtYXhTdXBwb3J0ZWREb2N1bWVudExlbmd0aDsKICAgIH0KICAgIC8vI3JlZ2lvbiBUZXh0TW9kZWwgZXZlbnRzCiAgfSwgewogICAga2V5OiAiaGFuZGxlRGlkQ2hhbmdlT3B0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlRGlkQ2hhbmdlT3B0aW9ucyhlKSB7CiAgICAgIHRoaXMuYnJhY2tldFBhaXJzVHJlZS5jbGVhcigpOwogICAgICB0aGlzLnVwZGF0ZUJyYWNrZXRQYWlyc1RyZWUoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYW5kbGVEaWRDaGFuZ2VMYW5ndWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlRGlkQ2hhbmdlTGFuZ3VhZ2UoZSkgewogICAgICB0aGlzLmJyYWNrZXRQYWlyc1RyZWUuY2xlYXIoKTsKICAgICAgdGhpcy51cGRhdGVCcmFja2V0UGFpcnNUcmVlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFuZGxlRGlkQ2hhbmdlQ29udGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlRGlkQ2hhbmdlQ29udGVudChjaGFuZ2UpIHsKICAgICAgdmFyIF9hOwogICAgICAoX2EgPSB0aGlzLmJyYWNrZXRQYWlyc1RyZWUudmFsdWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vYmplY3QuaGFuZGxlQ29udGVudENoYW5nZWQoY2hhbmdlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYW5kbGVEaWRDaGFuZ2VCYWNrZ3JvdW5kVG9rZW5pemF0aW9uU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZURpZENoYW5nZUJhY2tncm91bmRUb2tlbml6YXRpb25TdGF0ZSgpIHsKICAgICAgdmFyIF9hOwogICAgICAoX2EgPSB0aGlzLmJyYWNrZXRQYWlyc1RyZWUudmFsdWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vYmplY3QuaGFuZGxlRGlkQ2hhbmdlQmFja2dyb3VuZFRva2VuaXphdGlvblN0YXRlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFuZGxlRGlkQ2hhbmdlVG9rZW5zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVEaWRDaGFuZ2VUb2tlbnMoZSkgewogICAgICB2YXIgX2E7CiAgICAgIChfYSA9IHRoaXMuYnJhY2tldFBhaXJzVHJlZS52YWx1ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm9iamVjdC5oYW5kbGVEaWRDaGFuZ2VUb2tlbnMoZSk7CiAgICB9CiAgICAvLyNlbmRyZWdpb24KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVCcmFja2V0UGFpcnNUcmVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCcmFja2V0UGFpcnNUcmVlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgaWYgKHRoaXMuYnJhY2tldHNSZXF1ZXN0ZWQgJiYgdGhpcy5jYW5CdWlsZEFTVCkgewogICAgICAgIGlmICghdGhpcy5icmFja2V0UGFpcnNUcmVlLnZhbHVlKSB7CiAgICAgICAgICB2YXIgc3RvcmUgPSBuZXcgRGlzcG9zYWJsZVN0b3JlKCk7CiAgICAgICAgICB0aGlzLmJyYWNrZXRQYWlyc1RyZWUudmFsdWUgPSBjcmVhdGVEaXNwb3NhYmxlUmVmKHN0b3JlLmFkZChuZXcgQnJhY2tldFBhaXJzVHJlZSh0aGlzLnRleHRNb2RlbCwgZnVuY3Rpb24gKGxhbmd1YWdlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldExhbmd1YWdlQ29uZmlndXJhdGlvbihsYW5ndWFnZUlkKTsKICAgICAgICAgIH0pKSwgc3RvcmUpOwogICAgICAgICAgc3RvcmUuYWRkKHRoaXMuYnJhY2tldFBhaXJzVHJlZS52YWx1ZS5vYmplY3Qub25EaWRDaGFuZ2UoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5vbkRpZENoYW5nZUVtaXR0ZXIuZmlyZShlKTsKICAgICAgICAgIH0pKTsKICAgICAgICAgIHRoaXMub25EaWRDaGFuZ2VFbWl0dGVyLmZpcmUoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuYnJhY2tldFBhaXJzVHJlZS52YWx1ZSkgewogICAgICAgICAgdGhpcy5icmFja2V0UGFpcnNUcmVlLmNsZWFyKCk7CiAgICAgICAgICAvLyBJbXBvcnRhbnQ6IERvbid0IGNhbGwgZmlyZSBpZiB0aGVyZSB3YXMgbm8gY2hhbmdlIQogICAgICAgICAgdGhpcy5vbkRpZENoYW5nZUVtaXR0ZXIuZmlyZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBicmFja2V0IHBhaXJzIHRoYXQgaW50ZXJzZWN0IHRoZSBnaXZlbiByYW5nZS4KICAgICAqIFRoZSByZXN1bHQgaXMgc29ydGVkIGJ5IHRoZSBzdGFydCBwb3NpdGlvbi4KICAgICovCiAgfSwgewogICAga2V5OiAiZ2V0QnJhY2tldFBhaXJzSW5SYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QnJhY2tldFBhaXJzSW5SYW5nZShyYW5nZSkgewogICAgICB2YXIgX2E7CiAgICAgIHRoaXMuYnJhY2tldHNSZXF1ZXN0ZWQgPSB0cnVlOwogICAgICB0aGlzLnVwZGF0ZUJyYWNrZXRQYWlyc1RyZWUoKTsKICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmJyYWNrZXRQYWlyc1RyZWUudmFsdWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vYmplY3QuZ2V0QnJhY2tldFBhaXJzSW5SYW5nZShyYW5nZSwgZmFsc2UpKSB8fCBbXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRCcmFja2V0UGFpcnNJblJhbmdlV2l0aE1pbkluZGVudGF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCcmFja2V0UGFpcnNJblJhbmdlV2l0aE1pbkluZGVudGF0aW9uKHJhbmdlKSB7CiAgICAgIHZhciBfYTsKICAgICAgdGhpcy5icmFja2V0c1JlcXVlc3RlZCA9IHRydWU7CiAgICAgIHRoaXMudXBkYXRlQnJhY2tldFBhaXJzVHJlZSgpOwogICAgICByZXR1cm4gKChfYSA9IHRoaXMuYnJhY2tldFBhaXJzVHJlZS52YWx1ZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm9iamVjdC5nZXRCcmFja2V0UGFpcnNJblJhbmdlKHJhbmdlLCB0cnVlKSkgfHwgW107CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QnJhY2tldHNJblJhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCcmFja2V0c0luUmFuZ2UocmFuZ2UpIHsKICAgICAgdmFyIF9hOwogICAgICB0aGlzLmJyYWNrZXRzUmVxdWVzdGVkID0gdHJ1ZTsKICAgICAgdGhpcy51cGRhdGVCcmFja2V0UGFpcnNUcmVlKCk7CiAgICAgIHJldHVybiAoKF9hID0gdGhpcy5icmFja2V0UGFpcnNUcmVlLnZhbHVlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub2JqZWN0LmdldEJyYWNrZXRzSW5SYW5nZShyYW5nZSkpIHx8IFtdOwogICAgfQogIH0sIHsKICAgIGtleTogImZpbmRNYXRjaGluZ0JyYWNrZXRVcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZE1hdGNoaW5nQnJhY2tldFVwKF9icmFja2V0LCBfcG9zaXRpb24sIG1heER1cmF0aW9uKSB7CiAgICAgIHZhciBwb3NpdGlvbiA9IHRoaXMudGV4dE1vZGVsLnZhbGlkYXRlUG9zaXRpb24oX3Bvc2l0aW9uKTsKICAgICAgdmFyIGxhbmd1YWdlSWQgPSB0aGlzLnRleHRNb2RlbC5nZXRMYW5ndWFnZUlkQXRQb3NpdGlvbihwb3NpdGlvbi5saW5lTnVtYmVyLCBwb3NpdGlvbi5jb2x1bW4pOwogICAgICBpZiAodGhpcy5jYW5CdWlsZEFTVCkgewogICAgICAgIHZhciBjbG9zaW5nQnJhY2tldEluZm8gPSB0aGlzLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UuZ2V0TGFuZ3VhZ2VDb25maWd1cmF0aW9uKGxhbmd1YWdlSWQpLmJyYWNrZXRzTmV3LmdldENsb3NpbmdCcmFja2V0SW5mbyhfYnJhY2tldCk7CiAgICAgICAgaWYgKCFjbG9zaW5nQnJhY2tldEluZm8pIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB2YXIgYnJhY2tldFBhaXIgPSBmaW5kTGFzdCh0aGlzLmdldEJyYWNrZXRQYWlyc0luUmFuZ2UoUmFuZ2UuZnJvbVBvc2l0aW9ucyhfcG9zaXRpb24sIF9wb3NpdGlvbikpIHx8IFtdLCBmdW5jdGlvbiAoYikgewogICAgICAgICAgcmV0dXJuIGNsb3NpbmdCcmFja2V0SW5mby5jbG9zZXMoYi5vcGVuaW5nQnJhY2tldEluZm8pOwogICAgICAgIH0pOwogICAgICAgIGlmIChicmFja2V0UGFpcikgewogICAgICAgICAgcmV0dXJuIGJyYWNrZXRQYWlyLm9wZW5pbmdCcmFja2V0UmFuZ2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEZhbGxiYWNrIHRvIG9sZCBicmFja2V0IG1hdGNoaW5nIGNvZGU6CiAgICAgICAgdmFyIGJyYWNrZXQgPSBfYnJhY2tldC50b0xvd2VyQ2FzZSgpOwogICAgICAgIHZhciBicmFja2V0c1N1cHBvcnQgPSB0aGlzLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UuZ2V0TGFuZ3VhZ2VDb25maWd1cmF0aW9uKGxhbmd1YWdlSWQpLmJyYWNrZXRzOwogICAgICAgIGlmICghYnJhY2tldHNTdXBwb3J0KSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIGRhdGEgPSBicmFja2V0c1N1cHBvcnQudGV4dElzQnJhY2tldFticmFja2V0XTsKICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaXBCcmFja2V0U2VhcmNoQ2FuY2VsZWQodGhpcy5fZmluZE1hdGNoaW5nQnJhY2tldFVwKGRhdGEsIHBvc2l0aW9uLCBjcmVhdGVUaW1lQmFzZWRDb250aW51ZUJyYWNrZXRTZWFyY2hQcmVkaWNhdGUobWF4RHVyYXRpb24pKSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJtYXRjaEJyYWNrZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1hdGNoQnJhY2tldChwb3NpdGlvbiwgbWF4RHVyYXRpb24pIHsKICAgICAgaWYgKHRoaXMuY2FuQnVpbGRBU1QpIHsKICAgICAgICB2YXIgYnJhY2tldFBhaXIgPSBmaW5kTGFzdE1heEJ5KHRoaXMuZ2V0QnJhY2tldFBhaXJzSW5SYW5nZShSYW5nZS5mcm9tUG9zaXRpb25zKHBvc2l0aW9uLCBwb3NpdGlvbikpLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW0uY2xvc2luZ0JyYWNrZXRSYW5nZSAhPT0gdW5kZWZpbmVkICYmIChpdGVtLm9wZW5pbmdCcmFja2V0UmFuZ2UuY29udGFpbnNQb3NpdGlvbihwb3NpdGlvbikgfHwgaXRlbS5jbG9zaW5nQnJhY2tldFJhbmdlLmNvbnRhaW5zUG9zaXRpb24ocG9zaXRpb24pKTsKICAgICAgICB9KSwgY29tcGFyZUJ5KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5vcGVuaW5nQnJhY2tldFJhbmdlLmNvbnRhaW5zUG9zaXRpb24ocG9zaXRpb24pID8gaXRlbS5vcGVuaW5nQnJhY2tldFJhbmdlIDogaXRlbS5jbG9zaW5nQnJhY2tldFJhbmdlOwogICAgICAgIH0sIFJhbmdlLmNvbXBhcmVSYW5nZXNVc2luZ1N0YXJ0cykpOwogICAgICAgIGlmIChicmFja2V0UGFpcikgewogICAgICAgICAgcmV0dXJuIFticmFja2V0UGFpci5vcGVuaW5nQnJhY2tldFJhbmdlLCBicmFja2V0UGFpci5jbG9zaW5nQnJhY2tldFJhbmdlXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gRmFsbGJhY2sgdG8gb2xkIGJyYWNrZXQgbWF0Y2hpbmcgY29kZToKICAgICAgICB2YXIgY29udGludWVTZWFyY2hQcmVkaWNhdGUgPSBjcmVhdGVUaW1lQmFzZWRDb250aW51ZUJyYWNrZXRTZWFyY2hQcmVkaWNhdGUobWF4RHVyYXRpb24pOwogICAgICAgIHJldHVybiB0aGlzLl9tYXRjaEJyYWNrZXQodGhpcy50ZXh0TW9kZWwudmFsaWRhdGVQb3NpdGlvbihwb3NpdGlvbiksIGNvbnRpbnVlU2VhcmNoUHJlZGljYXRlKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9lc3RhYmxpc2hCcmFja2V0U2VhcmNoT2Zmc2V0cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2VzdGFibGlzaEJyYWNrZXRTZWFyY2hPZmZzZXRzKHBvc2l0aW9uLCBsaW5lVG9rZW5zLCBtb2RlQnJhY2tldHMsIHRva2VuSW5kZXgpIHsKICAgICAgdmFyIHRva2VuQ291bnQgPSBsaW5lVG9rZW5zLmdldENvdW50KCk7CiAgICAgIHZhciBjdXJyZW50TGFuZ3VhZ2VJZCA9IGxpbmVUb2tlbnMuZ2V0TGFuZ3VhZ2VJZCh0b2tlbkluZGV4KTsKICAgICAgLy8gbGltaXQgc2VhcmNoIHRvIG5vdCBnbyBiZWZvcmUgYG1heEJyYWNrZXRMZW5ndGhgCiAgICAgIHZhciBzZWFyY2hTdGFydE9mZnNldCA9IE1hdGgubWF4KDAsIHBvc2l0aW9uLmNvbHVtbiAtIDEgLSBtb2RlQnJhY2tldHMubWF4QnJhY2tldExlbmd0aCk7CiAgICAgIGZvciAodmFyIGkgPSB0b2tlbkluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB2YXIgdG9rZW5FbmRPZmZzZXQgPSBsaW5lVG9rZW5zLmdldEVuZE9mZnNldChpKTsKICAgICAgICBpZiAodG9rZW5FbmRPZmZzZXQgPD0gc2VhcmNoU3RhcnRPZmZzZXQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoaWdub3JlQnJhY2tldHNJblRva2VuKGxpbmVUb2tlbnMuZ2V0U3RhbmRhcmRUb2tlblR5cGUoaSkpIHx8IGxpbmVUb2tlbnMuZ2V0TGFuZ3VhZ2VJZChpKSAhPT0gY3VycmVudExhbmd1YWdlSWQpIHsKICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gdG9rZW5FbmRPZmZzZXQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gbGltaXQgc2VhcmNoIHRvIG5vdCBnbyBhZnRlciBgbWF4QnJhY2tldExlbmd0aGAKICAgICAgdmFyIHNlYXJjaEVuZE9mZnNldCA9IE1hdGgubWluKGxpbmVUb2tlbnMuZ2V0TGluZUNvbnRlbnQoKS5sZW5ndGgsIHBvc2l0aW9uLmNvbHVtbiAtIDEgKyBtb2RlQnJhY2tldHMubWF4QnJhY2tldExlbmd0aCk7CiAgICAgIGZvciAodmFyIF9pID0gdG9rZW5JbmRleCArIDE7IF9pIDwgdG9rZW5Db3VudDsgX2krKykgewogICAgICAgIHZhciB0b2tlblN0YXJ0T2Zmc2V0ID0gbGluZVRva2Vucy5nZXRTdGFydE9mZnNldChfaSk7CiAgICAgICAgaWYgKHRva2VuU3RhcnRPZmZzZXQgPj0gc2VhcmNoRW5kT2Zmc2V0KSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGlnbm9yZUJyYWNrZXRzSW5Ub2tlbihsaW5lVG9rZW5zLmdldFN0YW5kYXJkVG9rZW5UeXBlKF9pKSkgfHwgbGluZVRva2Vucy5nZXRMYW5ndWFnZUlkKF9pKSAhPT0gY3VycmVudExhbmd1YWdlSWQpIHsKICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IHRva2VuU3RhcnRPZmZzZXQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBzZWFyY2hTdGFydE9mZnNldDogc2VhcmNoU3RhcnRPZmZzZXQsCiAgICAgICAgc2VhcmNoRW5kT2Zmc2V0OiBzZWFyY2hFbmRPZmZzZXQKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfbWF0Y2hCcmFja2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfbWF0Y2hCcmFja2V0KHBvc2l0aW9uLCBjb250aW51ZVNlYXJjaFByZWRpY2F0ZSkgewogICAgICB2YXIgbGluZU51bWJlciA9IHBvc2l0aW9uLmxpbmVOdW1iZXI7CiAgICAgIHZhciBsaW5lVG9rZW5zID0gdGhpcy50ZXh0TW9kZWwudG9rZW5pemF0aW9uLmdldExpbmVUb2tlbnMobGluZU51bWJlcik7CiAgICAgIHZhciBsaW5lVGV4dCA9IHRoaXMudGV4dE1vZGVsLmdldExpbmVDb250ZW50KGxpbmVOdW1iZXIpOwogICAgICB2YXIgdG9rZW5JbmRleCA9IGxpbmVUb2tlbnMuZmluZFRva2VuSW5kZXhBdE9mZnNldChwb3NpdGlvbi5jb2x1bW4gLSAxKTsKICAgICAgaWYgKHRva2VuSW5kZXggPCAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdmFyIGN1cnJlbnRNb2RlQnJhY2tldHMgPSB0aGlzLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UuZ2V0TGFuZ3VhZ2VDb25maWd1cmF0aW9uKGxpbmVUb2tlbnMuZ2V0TGFuZ3VhZ2VJZCh0b2tlbkluZGV4KSkuYnJhY2tldHM7CiAgICAgIC8vIGNoZWNrIHRoYXQgdGhlIHRva2VuIGlzIG5vdCB0byBiZSBpZ25vcmVkCiAgICAgIGlmIChjdXJyZW50TW9kZUJyYWNrZXRzICYmICFpZ25vcmVCcmFja2V0c0luVG9rZW4obGluZVRva2Vucy5nZXRTdGFuZGFyZFRva2VuVHlwZSh0b2tlbkluZGV4KSkpIHsKICAgICAgICB2YXIgX3RoaXMkX2VzdGFibGlzaEJyYWNrID0gdGhpcy5fZXN0YWJsaXNoQnJhY2tldFNlYXJjaE9mZnNldHMocG9zaXRpb24sIGxpbmVUb2tlbnMsIGN1cnJlbnRNb2RlQnJhY2tldHMsIHRva2VuSW5kZXgpLAogICAgICAgICAgc2VhcmNoU3RhcnRPZmZzZXQgPSBfdGhpcyRfZXN0YWJsaXNoQnJhY2suc2VhcmNoU3RhcnRPZmZzZXQsCiAgICAgICAgICBzZWFyY2hFbmRPZmZzZXQgPSBfdGhpcyRfZXN0YWJsaXNoQnJhY2suc2VhcmNoRW5kT2Zmc2V0OwogICAgICAgIC8vIGl0IG1pZ2h0IGJlIHRoZSBjYXNlIHRoYXQgW2N1cnJlbnRUb2tlblN0YXJ0IC0+IGN1cnJlbnRUb2tlbkVuZF0gY29udGFpbnMgbXVsdGlwbGUgYnJhY2tldHMKICAgICAgICAvLyBgYmVzdFJlc3VsdGAgd2lsbCBjb250YWluIHRoZSBtb3N0IHJpZ2h0LXNpZGUgcmVzdWx0CiAgICAgICAgdmFyIGJlc3RSZXN1bHQgPSBudWxsOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICB2YXIgZm91bmRCcmFja2V0ID0gQnJhY2tldHNVdGlscy5maW5kTmV4dEJyYWNrZXRJblJhbmdlKGN1cnJlbnRNb2RlQnJhY2tldHMuZm9yd2FyZFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICBpZiAoIWZvdW5kQnJhY2tldCkgewogICAgICAgICAgICAvLyB0aGVyZSBhcmUgbm8gbW9yZSBicmFja2V0cyBpbiB0aGlzIHRleHQKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBjaGVjayB0aGF0IHdlIGRpZG4ndCBoaXQgYSBicmFja2V0IHRvbyBmYXIgYXdheSBmcm9tIHBvc2l0aW9uCiAgICAgICAgICBpZiAoZm91bmRCcmFja2V0LnN0YXJ0Q29sdW1uIDw9IHBvc2l0aW9uLmNvbHVtbiAmJiBwb3NpdGlvbi5jb2x1bW4gPD0gZm91bmRCcmFja2V0LmVuZENvbHVtbikgewogICAgICAgICAgICB2YXIgZm91bmRCcmFja2V0VGV4dCA9IGxpbmVUZXh0LnN1YnN0cmluZyhmb3VuZEJyYWNrZXQuc3RhcnRDb2x1bW4gLSAxLCBmb3VuZEJyYWNrZXQuZW5kQ29sdW1uIC0gMSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLl9tYXRjaEZvdW5kQnJhY2tldChmb3VuZEJyYWNrZXQsIGN1cnJlbnRNb2RlQnJhY2tldHMudGV4dElzQnJhY2tldFtmb3VuZEJyYWNrZXRUZXh0XSwgY3VycmVudE1vZGVCcmFja2V0cy50ZXh0SXNPcGVuQnJhY2tldFtmb3VuZEJyYWNrZXRUZXh0XSwgY29udGludWVTZWFyY2hQcmVkaWNhdGUpOwogICAgICAgICAgICBpZiAocikgewogICAgICAgICAgICAgIGlmIChyIGluc3RhbmNlb2YgQnJhY2tldFNlYXJjaENhbmNlbGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYmVzdFJlc3VsdCA9IHI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gZm91bmRCcmFja2V0LmVuZENvbHVtbiAtIDE7CiAgICAgICAgfQogICAgICAgIGlmIChiZXN0UmVzdWx0KSB7CiAgICAgICAgICByZXR1cm4gYmVzdFJlc3VsdDsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gSWYgcG9zaXRpb24gaXMgaW4gYmV0d2VlbiB0d28gdG9rZW5zLCB0cnkgYWxzbyBsb29raW5nIGluIHRoZSBwcmV2aW91cyB0b2tlbgogICAgICBpZiAodG9rZW5JbmRleCA+IDAgJiYgbGluZVRva2Vucy5nZXRTdGFydE9mZnNldCh0b2tlbkluZGV4KSA9PT0gcG9zaXRpb24uY29sdW1uIC0gMSkgewogICAgICAgIHZhciBwcmV2VG9rZW5JbmRleCA9IHRva2VuSW5kZXggLSAxOwogICAgICAgIHZhciBwcmV2TW9kZUJyYWNrZXRzID0gdGhpcy5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldExhbmd1YWdlQ29uZmlndXJhdGlvbihsaW5lVG9rZW5zLmdldExhbmd1YWdlSWQocHJldlRva2VuSW5kZXgpKS5icmFja2V0czsKICAgICAgICAvLyBjaGVjayB0aGF0IHByZXZpb3VzIHRva2VuIGlzIG5vdCB0byBiZSBpZ25vcmVkCiAgICAgICAgaWYgKHByZXZNb2RlQnJhY2tldHMgJiYgIWlnbm9yZUJyYWNrZXRzSW5Ub2tlbihsaW5lVG9rZW5zLmdldFN0YW5kYXJkVG9rZW5UeXBlKHByZXZUb2tlbkluZGV4KSkpIHsKICAgICAgICAgIHZhciBfdGhpcyRfZXN0YWJsaXNoQnJhY2syID0gdGhpcy5fZXN0YWJsaXNoQnJhY2tldFNlYXJjaE9mZnNldHMocG9zaXRpb24sIGxpbmVUb2tlbnMsIHByZXZNb2RlQnJhY2tldHMsIHByZXZUb2tlbkluZGV4KSwKICAgICAgICAgICAgX3NlYXJjaFN0YXJ0T2Zmc2V0ID0gX3RoaXMkX2VzdGFibGlzaEJyYWNrMi5zZWFyY2hTdGFydE9mZnNldCwKICAgICAgICAgICAgX3NlYXJjaEVuZE9mZnNldCA9IF90aGlzJF9lc3RhYmxpc2hCcmFjazIuc2VhcmNoRW5kT2Zmc2V0OwogICAgICAgICAgdmFyIF9mb3VuZEJyYWNrZXQgPSBCcmFja2V0c1V0aWxzLmZpbmRQcmV2QnJhY2tldEluUmFuZ2UocHJldk1vZGVCcmFja2V0cy5yZXZlcnNlZFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgX3NlYXJjaFN0YXJ0T2Zmc2V0LCBfc2VhcmNoRW5kT2Zmc2V0KTsKICAgICAgICAgIC8vIGNoZWNrIHRoYXQgd2UgZGlkbid0IGhpdCBhIGJyYWNrZXQgdG9vIGZhciBhd2F5IGZyb20gcG9zaXRpb24KICAgICAgICAgIGlmIChfZm91bmRCcmFja2V0ICYmIF9mb3VuZEJyYWNrZXQuc3RhcnRDb2x1bW4gPD0gcG9zaXRpb24uY29sdW1uICYmIHBvc2l0aW9uLmNvbHVtbiA8PSBfZm91bmRCcmFja2V0LmVuZENvbHVtbikgewogICAgICAgICAgICB2YXIgX2ZvdW5kQnJhY2tldFRleHQgPSBsaW5lVGV4dC5zdWJzdHJpbmcoX2ZvdW5kQnJhY2tldC5zdGFydENvbHVtbiAtIDEsIF9mb3VuZEJyYWNrZXQuZW5kQ29sdW1uIC0gMSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgdmFyIF9yID0gdGhpcy5fbWF0Y2hGb3VuZEJyYWNrZXQoX2ZvdW5kQnJhY2tldCwgcHJldk1vZGVCcmFja2V0cy50ZXh0SXNCcmFja2V0W19mb3VuZEJyYWNrZXRUZXh0XSwgcHJldk1vZGVCcmFja2V0cy50ZXh0SXNPcGVuQnJhY2tldFtfZm91bmRCcmFja2V0VGV4dF0sIGNvbnRpbnVlU2VhcmNoUHJlZGljYXRlKTsKICAgICAgICAgICAgaWYgKF9yKSB7CiAgICAgICAgICAgICAgaWYgKF9yIGluc3RhbmNlb2YgQnJhY2tldFNlYXJjaENhbmNlbGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIF9yOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIl9tYXRjaEZvdW5kQnJhY2tldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX21hdGNoRm91bmRCcmFja2V0KGZvdW5kQnJhY2tldCwgZGF0YSwgaXNPcGVuLCBjb250aW51ZVNlYXJjaFByZWRpY2F0ZSkgewogICAgICBpZiAoIWRhdGEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICB2YXIgbWF0Y2hlZCA9IGlzT3BlbiA/IHRoaXMuX2ZpbmRNYXRjaGluZ0JyYWNrZXREb3duKGRhdGEsIGZvdW5kQnJhY2tldC5nZXRFbmRQb3NpdGlvbigpLCBjb250aW51ZVNlYXJjaFByZWRpY2F0ZSkgOiB0aGlzLl9maW5kTWF0Y2hpbmdCcmFja2V0VXAoZGF0YSwgZm91bmRCcmFja2V0LmdldFN0YXJ0UG9zaXRpb24oKSwgY29udGludWVTZWFyY2hQcmVkaWNhdGUpOwogICAgICBpZiAoIW1hdGNoZWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAobWF0Y2hlZCBpbnN0YW5jZW9mIEJyYWNrZXRTZWFyY2hDYW5jZWxlZCkgewogICAgICAgIHJldHVybiBtYXRjaGVkOwogICAgICB9CiAgICAgIHJldHVybiBbZm91bmRCcmFja2V0LCBtYXRjaGVkXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZmluZE1hdGNoaW5nQnJhY2tldFVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZE1hdGNoaW5nQnJhY2tldFVwKGJyYWNrZXQsIHBvc2l0aW9uLCBjb250aW51ZVNlYXJjaFByZWRpY2F0ZSkgewogICAgICAvLyBjb25zb2xlLmxvZygnX2ZpbmRNYXRjaGluZ0JyYWNrZXRVcDogJywgJ2JyYWNrZXQ6ICcsIEpTT04uc3RyaW5naWZ5KGJyYWNrZXQpLCAnc3RhcnRQb3NpdGlvbjogJywgU3RyaW5nKHBvc2l0aW9uKSk7CiAgICAgIHZhciBsYW5ndWFnZUlkID0gYnJhY2tldC5sYW5ndWFnZUlkOwogICAgICB2YXIgcmV2ZXJzZWRCcmFja2V0UmVnZXggPSBicmFja2V0LnJldmVyc2VkUmVnZXg7CiAgICAgIHZhciBjb3VudCA9IC0xOwogICAgICB2YXIgdG90YWxDYWxsQ291bnQgPSAwOwogICAgICB2YXIgc2VhcmNoUHJldk1hdGNoaW5nQnJhY2tldEluUmFuZ2UgPSBmdW5jdGlvbiBzZWFyY2hQcmV2TWF0Y2hpbmdCcmFja2V0SW5SYW5nZShsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpZiAoY29udGludWVTZWFyY2hQcmVkaWNhdGUgJiYgKyt0b3RhbENhbGxDb3VudCAlIDEwMCA9PT0gMCAmJiAhY29udGludWVTZWFyY2hQcmVkaWNhdGUoKSkgewogICAgICAgICAgICByZXR1cm4gQnJhY2tldFNlYXJjaENhbmNlbGVkLklOU1RBTkNFOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHIgPSBCcmFja2V0c1V0aWxzLmZpbmRQcmV2QnJhY2tldEluUmFuZ2UocmV2ZXJzZWRCcmFja2V0UmVnZXgsIGxpbmVOdW1iZXIsIGxpbmVUZXh0LCBzZWFyY2hTdGFydE9mZnNldCwgc2VhcmNoRW5kT2Zmc2V0KTsKICAgICAgICAgIGlmICghcikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBoaXRUZXh0ID0gbGluZVRleHQuc3Vic3RyaW5nKHIuc3RhcnRDb2x1bW4gLSAxLCByLmVuZENvbHVtbiAtIDEpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBpZiAoYnJhY2tldC5pc09wZW4oaGl0VGV4dCkpIHsKICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgIH0gZWxzZSBpZiAoYnJhY2tldC5pc0Nsb3NlKGhpdFRleHQpKSB7CiAgICAgICAgICAgIGNvdW50LS07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICB9CiAgICAgICAgICBzZWFyY2hFbmRPZmZzZXQgPSByLnN0YXJ0Q29sdW1uIC0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH07CiAgICAgIGZvciAodmFyIGxpbmVOdW1iZXIgPSBwb3NpdGlvbi5saW5lTnVtYmVyOyBsaW5lTnVtYmVyID49IDE7IGxpbmVOdW1iZXItLSkgewogICAgICAgIHZhciBsaW5lVG9rZW5zID0gdGhpcy50ZXh0TW9kZWwudG9rZW5pemF0aW9uLmdldExpbmVUb2tlbnMobGluZU51bWJlcik7CiAgICAgICAgdmFyIHRva2VuQ291bnQgPSBsaW5lVG9rZW5zLmdldENvdW50KCk7CiAgICAgICAgdmFyIGxpbmVUZXh0ID0gdGhpcy50ZXh0TW9kZWwuZ2V0TGluZUNvbnRlbnQobGluZU51bWJlcik7CiAgICAgICAgdmFyIHRva2VuSW5kZXggPSB0b2tlbkNvdW50IC0gMTsKICAgICAgICB2YXIgc2VhcmNoU3RhcnRPZmZzZXQgPSBsaW5lVGV4dC5sZW5ndGg7CiAgICAgICAgdmFyIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUZXh0Lmxlbmd0aDsKICAgICAgICBpZiAobGluZU51bWJlciA9PT0gcG9zaXRpb24ubGluZU51bWJlcikgewogICAgICAgICAgdG9rZW5JbmRleCA9IGxpbmVUb2tlbnMuZmluZFRva2VuSW5kZXhBdE9mZnNldChwb3NpdGlvbi5jb2x1bW4gLSAxKTsKICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gcG9zaXRpb24uY29sdW1uIC0gMTsKICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IHBvc2l0aW9uLmNvbHVtbiAtIDE7CiAgICAgICAgfQogICAgICAgIHZhciBwcmV2U2VhcmNoSW5Ub2tlbiA9IHRydWU7CiAgICAgICAgZm9yICg7IHRva2VuSW5kZXggPj0gMDsgdG9rZW5JbmRleC0tKSB7CiAgICAgICAgICB2YXIgc2VhcmNoSW5Ub2tlbiA9IGxpbmVUb2tlbnMuZ2V0TGFuZ3VhZ2VJZCh0b2tlbkluZGV4KSA9PT0gbGFuZ3VhZ2VJZCAmJiAhaWdub3JlQnJhY2tldHNJblRva2VuKGxpbmVUb2tlbnMuZ2V0U3RhbmRhcmRUb2tlblR5cGUodG9rZW5JbmRleCkpOwogICAgICAgICAgaWYgKHNlYXJjaEluVG9rZW4pIHsKICAgICAgICAgICAgLy8gdGhpcyB0b2tlbiBzaG91bGQgYmUgc2VhcmNoZWQKICAgICAgICAgICAgaWYgKHByZXZTZWFyY2hJblRva2VuKSB7CiAgICAgICAgICAgICAgLy8gdGhlIHByZXZpb3VzIHRva2VuIHNob3VsZCBiZSBzZWFyY2hlZCwgc2ltcGx5IGV4dGVuZCBzZWFyY2hTdGFydE9mZnNldAogICAgICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gbGluZVRva2Vucy5nZXRTdGFydE9mZnNldCh0b2tlbkluZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyB0aGUgcHJldmlvdXMgdG9rZW4gc2hvdWxkIG5vdCBiZSBzZWFyY2hlZAogICAgICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gbGluZVRva2Vucy5nZXRTdGFydE9mZnNldCh0b2tlbkluZGV4KTsKICAgICAgICAgICAgICBzZWFyY2hFbmRPZmZzZXQgPSBsaW5lVG9rZW5zLmdldEVuZE9mZnNldCh0b2tlbkluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gdGhpcyB0b2tlbiBzaG91bGQgbm90IGJlIHNlYXJjaGVkCiAgICAgICAgICAgIGlmIChwcmV2U2VhcmNoSW5Ub2tlbiAmJiBzZWFyY2hTdGFydE9mZnNldCAhPT0gc2VhcmNoRW5kT2Zmc2V0KSB7CiAgICAgICAgICAgICAgdmFyIHIgPSBzZWFyY2hQcmV2TWF0Y2hpbmdCcmFja2V0SW5SYW5nZShsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgIHJldHVybiByOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcHJldlNlYXJjaEluVG9rZW4gPSBzZWFyY2hJblRva2VuOwogICAgICAgIH0KICAgICAgICBpZiAocHJldlNlYXJjaEluVG9rZW4gJiYgc2VhcmNoU3RhcnRPZmZzZXQgIT09IHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgICAgdmFyIF9yMiA9IHNlYXJjaFByZXZNYXRjaGluZ0JyYWNrZXRJblJhbmdlKGxpbmVOdW1iZXIsIGxpbmVUZXh0LCBzZWFyY2hTdGFydE9mZnNldCwgc2VhcmNoRW5kT2Zmc2V0KTsKICAgICAgICAgIGlmIChfcjIpIHsKICAgICAgICAgICAgcmV0dXJuIF9yMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2ZpbmRNYXRjaGluZ0JyYWNrZXREb3duIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZE1hdGNoaW5nQnJhY2tldERvd24oYnJhY2tldCwgcG9zaXRpb24sIGNvbnRpbnVlU2VhcmNoUHJlZGljYXRlKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdfZmluZE1hdGNoaW5nQnJhY2tldERvd246ICcsICdicmFja2V0OiAnLCBKU09OLnN0cmluZ2lmeShicmFja2V0KSwgJ3N0YXJ0UG9zaXRpb246ICcsIFN0cmluZyhwb3NpdGlvbikpOwogICAgICB2YXIgbGFuZ3VhZ2VJZCA9IGJyYWNrZXQubGFuZ3VhZ2VJZDsKICAgICAgdmFyIGJyYWNrZXRSZWdleCA9IGJyYWNrZXQuZm9yd2FyZFJlZ2V4OwogICAgICB2YXIgY291bnQgPSAxOwogICAgICB2YXIgdG90YWxDYWxsQ291bnQgPSAwOwogICAgICB2YXIgc2VhcmNoTmV4dE1hdGNoaW5nQnJhY2tldEluUmFuZ2UgPSBmdW5jdGlvbiBzZWFyY2hOZXh0TWF0Y2hpbmdCcmFja2V0SW5SYW5nZShsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpZiAoY29udGludWVTZWFyY2hQcmVkaWNhdGUgJiYgKyt0b3RhbENhbGxDb3VudCAlIDEwMCA9PT0gMCAmJiAhY29udGludWVTZWFyY2hQcmVkaWNhdGUoKSkgewogICAgICAgICAgICByZXR1cm4gQnJhY2tldFNlYXJjaENhbmNlbGVkLklOU1RBTkNFOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHIgPSBCcmFja2V0c1V0aWxzLmZpbmROZXh0QnJhY2tldEluUmFuZ2UoYnJhY2tldFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICBpZiAoIXIpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaGl0VGV4dCA9IGxpbmVUZXh0LnN1YnN0cmluZyhyLnN0YXJ0Q29sdW1uIC0gMSwgci5lbmRDb2x1bW4gLSAxKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgaWYgKGJyYWNrZXQuaXNPcGVuKGhpdFRleHQpKSB7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICB9IGVsc2UgaWYgKGJyYWNrZXQuaXNDbG9zZShoaXRUZXh0KSkgewogICAgICAgICAgICBjb3VudC0tOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiByOwogICAgICAgICAgfQogICAgICAgICAgc2VhcmNoU3RhcnRPZmZzZXQgPSByLmVuZENvbHVtbiAtIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9OwogICAgICB2YXIgbGluZUNvdW50ID0gdGhpcy50ZXh0TW9kZWwuZ2V0TGluZUNvdW50KCk7CiAgICAgIGZvciAodmFyIGxpbmVOdW1iZXIgPSBwb3NpdGlvbi5saW5lTnVtYmVyOyBsaW5lTnVtYmVyIDw9IGxpbmVDb3VudDsgbGluZU51bWJlcisrKSB7CiAgICAgICAgdmFyIGxpbmVUb2tlbnMgPSB0aGlzLnRleHRNb2RlbC50b2tlbml6YXRpb24uZ2V0TGluZVRva2VucyhsaW5lTnVtYmVyKTsKICAgICAgICB2YXIgdG9rZW5Db3VudCA9IGxpbmVUb2tlbnMuZ2V0Q291bnQoKTsKICAgICAgICB2YXIgbGluZVRleHQgPSB0aGlzLnRleHRNb2RlbC5nZXRMaW5lQ29udGVudChsaW5lTnVtYmVyKTsKICAgICAgICB2YXIgdG9rZW5JbmRleCA9IDA7CiAgICAgICAgdmFyIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gMDsKICAgICAgICB2YXIgc2VhcmNoRW5kT2Zmc2V0ID0gMDsKICAgICAgICBpZiAobGluZU51bWJlciA9PT0gcG9zaXRpb24ubGluZU51bWJlcikgewogICAgICAgICAgdG9rZW5JbmRleCA9IGxpbmVUb2tlbnMuZmluZFRva2VuSW5kZXhBdE9mZnNldChwb3NpdGlvbi5jb2x1bW4gLSAxKTsKICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gcG9zaXRpb24uY29sdW1uIC0gMTsKICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IHBvc2l0aW9uLmNvbHVtbiAtIDE7CiAgICAgICAgfQogICAgICAgIHZhciBwcmV2U2VhcmNoSW5Ub2tlbiA9IHRydWU7CiAgICAgICAgZm9yICg7IHRva2VuSW5kZXggPCB0b2tlbkNvdW50OyB0b2tlbkluZGV4KyspIHsKICAgICAgICAgIHZhciBzZWFyY2hJblRva2VuID0gbGluZVRva2Vucy5nZXRMYW5ndWFnZUlkKHRva2VuSW5kZXgpID09PSBsYW5ndWFnZUlkICYmICFpZ25vcmVCcmFja2V0c0luVG9rZW4obGluZVRva2Vucy5nZXRTdGFuZGFyZFRva2VuVHlwZSh0b2tlbkluZGV4KSk7CiAgICAgICAgICBpZiAoc2VhcmNoSW5Ub2tlbikgewogICAgICAgICAgICAvLyB0aGlzIHRva2VuIHNob3VsZCBiZSBzZWFyY2hlZAogICAgICAgICAgICBpZiAocHJldlNlYXJjaEluVG9rZW4pIHsKICAgICAgICAgICAgICAvLyB0aGUgcHJldmlvdXMgdG9rZW4gc2hvdWxkIGJlIHNlYXJjaGVkLCBzaW1wbHkgZXh0ZW5kIHNlYXJjaEVuZE9mZnNldAogICAgICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUb2tlbnMuZ2V0RW5kT2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIHRoZSBwcmV2aW91cyB0b2tlbiBzaG91bGQgbm90IGJlIHNlYXJjaGVkCiAgICAgICAgICAgICAgc2VhcmNoU3RhcnRPZmZzZXQgPSBsaW5lVG9rZW5zLmdldFN0YXJ0T2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUb2tlbnMuZ2V0RW5kT2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0aGlzIHRva2VuIHNob3VsZCBub3QgYmUgc2VhcmNoZWQKICAgICAgICAgICAgaWYgKHByZXZTZWFyY2hJblRva2VuICYmIHNlYXJjaFN0YXJ0T2Zmc2V0ICE9PSBzZWFyY2hFbmRPZmZzZXQpIHsKICAgICAgICAgICAgICB2YXIgciA9IHNlYXJjaE5leHRNYXRjaGluZ0JyYWNrZXRJblJhbmdlKGxpbmVOdW1iZXIsIGxpbmVUZXh0LCBzZWFyY2hTdGFydE9mZnNldCwgc2VhcmNoRW5kT2Zmc2V0KTsKICAgICAgICAgICAgICBpZiAocikgewogICAgICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2U2VhcmNoSW5Ub2tlbiA9IHNlYXJjaEluVG9rZW47CiAgICAgICAgfQogICAgICAgIGlmIChwcmV2U2VhcmNoSW5Ub2tlbiAmJiBzZWFyY2hTdGFydE9mZnNldCAhPT0gc2VhcmNoRW5kT2Zmc2V0KSB7CiAgICAgICAgICB2YXIgX3IzID0gc2VhcmNoTmV4dE1hdGNoaW5nQnJhY2tldEluUmFuZ2UobGluZU51bWJlciwgbGluZVRleHQsIHNlYXJjaFN0YXJ0T2Zmc2V0LCBzZWFyY2hFbmRPZmZzZXQpOwogICAgICAgICAgaWYgKF9yMykgewogICAgICAgICAgICByZXR1cm4gX3IzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmaW5kUHJldkJyYWNrZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRQcmV2QnJhY2tldChfcG9zaXRpb24pIHsKICAgICAgdmFyIF9hOwogICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnRleHRNb2RlbC52YWxpZGF0ZVBvc2l0aW9uKF9wb3NpdGlvbik7CiAgICAgIGlmICh0aGlzLmNhbkJ1aWxkQVNUKSB7CiAgICAgICAgdGhpcy5icmFja2V0c1JlcXVlc3RlZCA9IHRydWU7CiAgICAgICAgdGhpcy51cGRhdGVCcmFja2V0UGFpcnNUcmVlKCk7CiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmJyYWNrZXRQYWlyc1RyZWUudmFsdWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vYmplY3QuZ2V0Rmlyc3RCcmFja2V0QmVmb3JlKHBvc2l0aW9uKSkgfHwgbnVsbDsKICAgICAgfQogICAgICB2YXIgbGFuZ3VhZ2VJZCA9IG51bGw7CiAgICAgIHZhciBtb2RlQnJhY2tldHMgPSBudWxsOwogICAgICB2YXIgYnJhY2tldENvbmZpZyA9IG51bGw7CiAgICAgIGZvciAodmFyIGxpbmVOdW1iZXIgPSBwb3NpdGlvbi5saW5lTnVtYmVyOyBsaW5lTnVtYmVyID49IDE7IGxpbmVOdW1iZXItLSkgewogICAgICAgIHZhciBsaW5lVG9rZW5zID0gdGhpcy50ZXh0TW9kZWwudG9rZW5pemF0aW9uLmdldExpbmVUb2tlbnMobGluZU51bWJlcik7CiAgICAgICAgdmFyIHRva2VuQ291bnQgPSBsaW5lVG9rZW5zLmdldENvdW50KCk7CiAgICAgICAgdmFyIGxpbmVUZXh0ID0gdGhpcy50ZXh0TW9kZWwuZ2V0TGluZUNvbnRlbnQobGluZU51bWJlcik7CiAgICAgICAgdmFyIHRva2VuSW5kZXggPSB0b2tlbkNvdW50IC0gMTsKICAgICAgICB2YXIgc2VhcmNoU3RhcnRPZmZzZXQgPSBsaW5lVGV4dC5sZW5ndGg7CiAgICAgICAgdmFyIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUZXh0Lmxlbmd0aDsKICAgICAgICBpZiAobGluZU51bWJlciA9PT0gcG9zaXRpb24ubGluZU51bWJlcikgewogICAgICAgICAgdG9rZW5JbmRleCA9IGxpbmVUb2tlbnMuZmluZFRva2VuSW5kZXhBdE9mZnNldChwb3NpdGlvbi5jb2x1bW4gLSAxKTsKICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gcG9zaXRpb24uY29sdW1uIC0gMTsKICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IHBvc2l0aW9uLmNvbHVtbiAtIDE7CiAgICAgICAgICB2YXIgdG9rZW5MYW5ndWFnZUlkID0gbGluZVRva2Vucy5nZXRMYW5ndWFnZUlkKHRva2VuSW5kZXgpOwogICAgICAgICAgaWYgKGxhbmd1YWdlSWQgIT09IHRva2VuTGFuZ3VhZ2VJZCkgewogICAgICAgICAgICBsYW5ndWFnZUlkID0gdG9rZW5MYW5ndWFnZUlkOwogICAgICAgICAgICBtb2RlQnJhY2tldHMgPSB0aGlzLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UuZ2V0TGFuZ3VhZ2VDb25maWd1cmF0aW9uKGxhbmd1YWdlSWQpLmJyYWNrZXRzOwogICAgICAgICAgICBicmFja2V0Q29uZmlnID0gdGhpcy5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldExhbmd1YWdlQ29uZmlndXJhdGlvbihsYW5ndWFnZUlkKS5icmFja2V0c05ldzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHByZXZTZWFyY2hJblRva2VuID0gdHJ1ZTsKICAgICAgICBmb3IgKDsgdG9rZW5JbmRleCA+PSAwOyB0b2tlbkluZGV4LS0pIHsKICAgICAgICAgIHZhciBfdG9rZW5MYW5ndWFnZUlkID0gbGluZVRva2Vucy5nZXRMYW5ndWFnZUlkKHRva2VuSW5kZXgpOwogICAgICAgICAgaWYgKGxhbmd1YWdlSWQgIT09IF90b2tlbkxhbmd1YWdlSWQpIHsKICAgICAgICAgICAgLy8gbGFuZ3VhZ2UgaWQgY2hhbmdlIQogICAgICAgICAgICBpZiAobW9kZUJyYWNrZXRzICYmIGJyYWNrZXRDb25maWcgJiYgcHJldlNlYXJjaEluVG9rZW4gJiYgc2VhcmNoU3RhcnRPZmZzZXQgIT09IHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgICAgICAgIHZhciByID0gQnJhY2tldHNVdGlscy5maW5kUHJldkJyYWNrZXRJblJhbmdlKG1vZGVCcmFja2V0cy5yZXZlcnNlZFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90b0ZvdW5kQnJhY2tldChicmFja2V0Q29uZmlnLCByKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcHJldlNlYXJjaEluVG9rZW4gPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYW5ndWFnZUlkID0gX3Rva2VuTGFuZ3VhZ2VJZDsKICAgICAgICAgICAgbW9kZUJyYWNrZXRzID0gdGhpcy5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldExhbmd1YWdlQ29uZmlndXJhdGlvbihsYW5ndWFnZUlkKS5icmFja2V0czsKICAgICAgICAgICAgYnJhY2tldENvbmZpZyA9IHRoaXMubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZS5nZXRMYW5ndWFnZUNvbmZpZ3VyYXRpb24obGFuZ3VhZ2VJZCkuYnJhY2tldHNOZXc7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc2VhcmNoSW5Ub2tlbiA9ICEhbW9kZUJyYWNrZXRzICYmICFpZ25vcmVCcmFja2V0c0luVG9rZW4obGluZVRva2Vucy5nZXRTdGFuZGFyZFRva2VuVHlwZSh0b2tlbkluZGV4KSk7CiAgICAgICAgICBpZiAoc2VhcmNoSW5Ub2tlbikgewogICAgICAgICAgICAvLyB0aGlzIHRva2VuIHNob3VsZCBiZSBzZWFyY2hlZAogICAgICAgICAgICBpZiAocHJldlNlYXJjaEluVG9rZW4pIHsKICAgICAgICAgICAgICAvLyB0aGUgcHJldmlvdXMgdG9rZW4gc2hvdWxkIGJlIHNlYXJjaGVkLCBzaW1wbHkgZXh0ZW5kIHNlYXJjaFN0YXJ0T2Zmc2V0CiAgICAgICAgICAgICAgc2VhcmNoU3RhcnRPZmZzZXQgPSBsaW5lVG9rZW5zLmdldFN0YXJ0T2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIHRoZSBwcmV2aW91cyB0b2tlbiBzaG91bGQgbm90IGJlIHNlYXJjaGVkCiAgICAgICAgICAgICAgc2VhcmNoU3RhcnRPZmZzZXQgPSBsaW5lVG9rZW5zLmdldFN0YXJ0T2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUb2tlbnMuZ2V0RW5kT2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0aGlzIHRva2VuIHNob3VsZCBub3QgYmUgc2VhcmNoZWQKICAgICAgICAgICAgaWYgKGJyYWNrZXRDb25maWcgJiYgbW9kZUJyYWNrZXRzICYmIHByZXZTZWFyY2hJblRva2VuICYmIHNlYXJjaFN0YXJ0T2Zmc2V0ICE9PSBzZWFyY2hFbmRPZmZzZXQpIHsKICAgICAgICAgICAgICB2YXIgX3I0ID0gQnJhY2tldHNVdGlscy5maW5kUHJldkJyYWNrZXRJblJhbmdlKG1vZGVCcmFja2V0cy5yZXZlcnNlZFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICAgICAgaWYgKF9yNCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RvRm91bmRCcmFja2V0KGJyYWNrZXRDb25maWcsIF9yNCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2U2VhcmNoSW5Ub2tlbiA9IHNlYXJjaEluVG9rZW47CiAgICAgICAgfQogICAgICAgIGlmIChicmFja2V0Q29uZmlnICYmIG1vZGVCcmFja2V0cyAmJiBwcmV2U2VhcmNoSW5Ub2tlbiAmJiBzZWFyY2hTdGFydE9mZnNldCAhPT0gc2VhcmNoRW5kT2Zmc2V0KSB7CiAgICAgICAgICB2YXIgX3I1ID0gQnJhY2tldHNVdGlscy5maW5kUHJldkJyYWNrZXRJblJhbmdlKG1vZGVCcmFja2V0cy5yZXZlcnNlZFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICBpZiAoX3I1KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90b0ZvdW5kQnJhY2tldChicmFja2V0Q29uZmlnLCBfcjUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmaW5kTmV4dEJyYWNrZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmROZXh0QnJhY2tldChfcG9zaXRpb24pIHsKICAgICAgdmFyIF9hOwogICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnRleHRNb2RlbC52YWxpZGF0ZVBvc2l0aW9uKF9wb3NpdGlvbik7CiAgICAgIGlmICh0aGlzLmNhbkJ1aWxkQVNUKSB7CiAgICAgICAgdGhpcy5icmFja2V0c1JlcXVlc3RlZCA9IHRydWU7CiAgICAgICAgdGhpcy51cGRhdGVCcmFja2V0UGFpcnNUcmVlKCk7CiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmJyYWNrZXRQYWlyc1RyZWUudmFsdWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5vYmplY3QuZ2V0Rmlyc3RCcmFja2V0QWZ0ZXIocG9zaXRpb24pKSB8fCBudWxsOwogICAgICB9CiAgICAgIHZhciBsaW5lQ291bnQgPSB0aGlzLnRleHRNb2RlbC5nZXRMaW5lQ291bnQoKTsKICAgICAgdmFyIGxhbmd1YWdlSWQgPSBudWxsOwogICAgICB2YXIgbW9kZUJyYWNrZXRzID0gbnVsbDsKICAgICAgdmFyIGJyYWNrZXRDb25maWcgPSBudWxsOwogICAgICBmb3IgKHZhciBsaW5lTnVtYmVyID0gcG9zaXRpb24ubGluZU51bWJlcjsgbGluZU51bWJlciA8PSBsaW5lQ291bnQ7IGxpbmVOdW1iZXIrKykgewogICAgICAgIHZhciBsaW5lVG9rZW5zID0gdGhpcy50ZXh0TW9kZWwudG9rZW5pemF0aW9uLmdldExpbmVUb2tlbnMobGluZU51bWJlcik7CiAgICAgICAgdmFyIHRva2VuQ291bnQgPSBsaW5lVG9rZW5zLmdldENvdW50KCk7CiAgICAgICAgdmFyIGxpbmVUZXh0ID0gdGhpcy50ZXh0TW9kZWwuZ2V0TGluZUNvbnRlbnQobGluZU51bWJlcik7CiAgICAgICAgdmFyIHRva2VuSW5kZXggPSAwOwogICAgICAgIHZhciBzZWFyY2hTdGFydE9mZnNldCA9IDA7CiAgICAgICAgdmFyIHNlYXJjaEVuZE9mZnNldCA9IDA7CiAgICAgICAgaWYgKGxpbmVOdW1iZXIgPT09IHBvc2l0aW9uLmxpbmVOdW1iZXIpIHsKICAgICAgICAgIHRva2VuSW5kZXggPSBsaW5lVG9rZW5zLmZpbmRUb2tlbkluZGV4QXRPZmZzZXQocG9zaXRpb24uY29sdW1uIC0gMSk7CiAgICAgICAgICBzZWFyY2hTdGFydE9mZnNldCA9IHBvc2l0aW9uLmNvbHVtbiAtIDE7CiAgICAgICAgICBzZWFyY2hFbmRPZmZzZXQgPSBwb3NpdGlvbi5jb2x1bW4gLSAxOwogICAgICAgICAgdmFyIHRva2VuTGFuZ3VhZ2VJZCA9IGxpbmVUb2tlbnMuZ2V0TGFuZ3VhZ2VJZCh0b2tlbkluZGV4KTsKICAgICAgICAgIGlmIChsYW5ndWFnZUlkICE9PSB0b2tlbkxhbmd1YWdlSWQpIHsKICAgICAgICAgICAgbGFuZ3VhZ2VJZCA9IHRva2VuTGFuZ3VhZ2VJZDsKICAgICAgICAgICAgbW9kZUJyYWNrZXRzID0gdGhpcy5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldExhbmd1YWdlQ29uZmlndXJhdGlvbihsYW5ndWFnZUlkKS5icmFja2V0czsKICAgICAgICAgICAgYnJhY2tldENvbmZpZyA9IHRoaXMubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZS5nZXRMYW5ndWFnZUNvbmZpZ3VyYXRpb24obGFuZ3VhZ2VJZCkuYnJhY2tldHNOZXc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBwcmV2U2VhcmNoSW5Ub2tlbiA9IHRydWU7CiAgICAgICAgZm9yICg7IHRva2VuSW5kZXggPCB0b2tlbkNvdW50OyB0b2tlbkluZGV4KyspIHsKICAgICAgICAgIHZhciBfdG9rZW5MYW5ndWFnZUlkMiA9IGxpbmVUb2tlbnMuZ2V0TGFuZ3VhZ2VJZCh0b2tlbkluZGV4KTsKICAgICAgICAgIGlmIChsYW5ndWFnZUlkICE9PSBfdG9rZW5MYW5ndWFnZUlkMikgewogICAgICAgICAgICAvLyBsYW5ndWFnZSBpZCBjaGFuZ2UhCiAgICAgICAgICAgIGlmIChicmFja2V0Q29uZmlnICYmIG1vZGVCcmFja2V0cyAmJiBwcmV2U2VhcmNoSW5Ub2tlbiAmJiBzZWFyY2hTdGFydE9mZnNldCAhPT0gc2VhcmNoRW5kT2Zmc2V0KSB7CiAgICAgICAgICAgICAgdmFyIHIgPSBCcmFja2V0c1V0aWxzLmZpbmROZXh0QnJhY2tldEluUmFuZ2UobW9kZUJyYWNrZXRzLmZvcndhcmRSZWdleCwgbGluZU51bWJlciwgbGluZVRleHQsIHNlYXJjaFN0YXJ0T2Zmc2V0LCBzZWFyY2hFbmRPZmZzZXQpOwogICAgICAgICAgICAgIGlmIChyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG9Gb3VuZEJyYWNrZXQoYnJhY2tldENvbmZpZywgcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHByZXZTZWFyY2hJblRva2VuID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFuZ3VhZ2VJZCA9IF90b2tlbkxhbmd1YWdlSWQyOwogICAgICAgICAgICBtb2RlQnJhY2tldHMgPSB0aGlzLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UuZ2V0TGFuZ3VhZ2VDb25maWd1cmF0aW9uKGxhbmd1YWdlSWQpLmJyYWNrZXRzOwogICAgICAgICAgICBicmFja2V0Q29uZmlnID0gdGhpcy5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldExhbmd1YWdlQ29uZmlndXJhdGlvbihsYW5ndWFnZUlkKS5icmFja2V0c05ldzsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzZWFyY2hJblRva2VuID0gISFtb2RlQnJhY2tldHMgJiYgIWlnbm9yZUJyYWNrZXRzSW5Ub2tlbihsaW5lVG9rZW5zLmdldFN0YW5kYXJkVG9rZW5UeXBlKHRva2VuSW5kZXgpKTsKICAgICAgICAgIGlmIChzZWFyY2hJblRva2VuKSB7CiAgICAgICAgICAgIC8vIHRoaXMgdG9rZW4gc2hvdWxkIGJlIHNlYXJjaGVkCiAgICAgICAgICAgIGlmIChwcmV2U2VhcmNoSW5Ub2tlbikgewogICAgICAgICAgICAgIC8vIHRoZSBwcmV2aW91cyB0b2tlbiBzaG91bGQgYmUgc2VhcmNoZWQsIHNpbXBseSBleHRlbmQgc2VhcmNoRW5kT2Zmc2V0CiAgICAgICAgICAgICAgc2VhcmNoRW5kT2Zmc2V0ID0gbGluZVRva2Vucy5nZXRFbmRPZmZzZXQodG9rZW5JbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gdGhlIHByZXZpb3VzIHRva2VuIHNob3VsZCBub3QgYmUgc2VhcmNoZWQKICAgICAgICAgICAgICBzZWFyY2hTdGFydE9mZnNldCA9IGxpbmVUb2tlbnMuZ2V0U3RhcnRPZmZzZXQodG9rZW5JbmRleCk7CiAgICAgICAgICAgICAgc2VhcmNoRW5kT2Zmc2V0ID0gbGluZVRva2Vucy5nZXRFbmRPZmZzZXQodG9rZW5JbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHRoaXMgdG9rZW4gc2hvdWxkIG5vdCBiZSBzZWFyY2hlZAogICAgICAgICAgICBpZiAoYnJhY2tldENvbmZpZyAmJiBtb2RlQnJhY2tldHMgJiYgcHJldlNlYXJjaEluVG9rZW4gJiYgc2VhcmNoU3RhcnRPZmZzZXQgIT09IHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgICAgICAgIHZhciBfcjYgPSBCcmFja2V0c1V0aWxzLmZpbmROZXh0QnJhY2tldEluUmFuZ2UobW9kZUJyYWNrZXRzLmZvcndhcmRSZWdleCwgbGluZU51bWJlciwgbGluZVRleHQsIHNlYXJjaFN0YXJ0T2Zmc2V0LCBzZWFyY2hFbmRPZmZzZXQpOwogICAgICAgICAgICAgIGlmIChfcjYpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90b0ZvdW5kQnJhY2tldChicmFja2V0Q29uZmlnLCBfcjYpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcHJldlNlYXJjaEluVG9rZW4gPSBzZWFyY2hJblRva2VuOwogICAgICAgIH0KICAgICAgICBpZiAoYnJhY2tldENvbmZpZyAmJiBtb2RlQnJhY2tldHMgJiYgcHJldlNlYXJjaEluVG9rZW4gJiYgc2VhcmNoU3RhcnRPZmZzZXQgIT09IHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgICAgdmFyIF9yNyA9IEJyYWNrZXRzVXRpbHMuZmluZE5leHRCcmFja2V0SW5SYW5nZShtb2RlQnJhY2tldHMuZm9yd2FyZFJlZ2V4LCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICBpZiAoX3I3KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90b0ZvdW5kQnJhY2tldChicmFja2V0Q29uZmlnLCBfcjcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmaW5kRW5jbG9zaW5nQnJhY2tldHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRFbmNsb3NpbmdCcmFja2V0cyhfcG9zaXRpb24sIG1heER1cmF0aW9uKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLnRleHRNb2RlbC52YWxpZGF0ZVBvc2l0aW9uKF9wb3NpdGlvbik7CiAgICAgIGlmICh0aGlzLmNhbkJ1aWxkQVNUKSB7CiAgICAgICAgdmFyIHJhbmdlID0gUmFuZ2UuZnJvbVBvc2l0aW9ucyhwb3NpdGlvbik7CiAgICAgICAgdmFyIGJyYWNrZXRQYWlyID0gZmluZExhc3QodGhpcy5nZXRCcmFja2V0UGFpcnNJblJhbmdlKFJhbmdlLmZyb21Qb3NpdGlvbnMocG9zaXRpb24sIHBvc2l0aW9uKSksIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5jbG9zaW5nQnJhY2tldFJhbmdlICE9PSB1bmRlZmluZWQgJiYgaXRlbS5yYW5nZS5zdHJpY3RDb250YWluc1JhbmdlKHJhbmdlKTsKICAgICAgICB9KTsKICAgICAgICBpZiAoYnJhY2tldFBhaXIpIHsKICAgICAgICAgIHJldHVybiBbYnJhY2tldFBhaXIub3BlbmluZ0JyYWNrZXRSYW5nZSwgYnJhY2tldFBhaXIuY2xvc2luZ0JyYWNrZXRSYW5nZV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciBjb250aW51ZVNlYXJjaFByZWRpY2F0ZSA9IGNyZWF0ZVRpbWVCYXNlZENvbnRpbnVlQnJhY2tldFNlYXJjaFByZWRpY2F0ZShtYXhEdXJhdGlvbik7CiAgICAgIHZhciBsaW5lQ291bnQgPSB0aGlzLnRleHRNb2RlbC5nZXRMaW5lQ291bnQoKTsKICAgICAgdmFyIHNhdmVkQ291bnRzID0gbmV3IE1hcCgpOwogICAgICB2YXIgY291bnRzID0gW107CiAgICAgIHZhciByZXNldENvdW50cyA9IGZ1bmN0aW9uIHJlc2V0Q291bnRzKGxhbmd1YWdlSWQsIG1vZGVCcmFja2V0cykgewogICAgICAgIGlmICghc2F2ZWRDb3VudHMuaGFzKGxhbmd1YWdlSWQpKSB7CiAgICAgICAgICB2YXIgdG1wID0gW107CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbW9kZUJyYWNrZXRzID8gbW9kZUJyYWNrZXRzLmJyYWNrZXRzLmxlbmd0aCA6IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICB0bXBbaV0gPSAwOwogICAgICAgICAgfQogICAgICAgICAgc2F2ZWRDb3VudHMuc2V0KGxhbmd1YWdlSWQsIHRtcCk7CiAgICAgICAgfQogICAgICAgIGNvdW50cyA9IHNhdmVkQ291bnRzLmdldChsYW5ndWFnZUlkKTsKICAgICAgfTsKICAgICAgdmFyIHRvdGFsQ2FsbENvdW50ID0gMDsKICAgICAgdmFyIHNlYXJjaEluUmFuZ2UgPSBmdW5jdGlvbiBzZWFyY2hJblJhbmdlKG1vZGVCcmFja2V0cywgbGluZU51bWJlciwgbGluZVRleHQsIHNlYXJjaFN0YXJ0T2Zmc2V0LCBzZWFyY2hFbmRPZmZzZXQpIHsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaWYgKGNvbnRpbnVlU2VhcmNoUHJlZGljYXRlICYmICsrdG90YWxDYWxsQ291bnQgJSAxMDAgPT09IDAgJiYgIWNvbnRpbnVlU2VhcmNoUHJlZGljYXRlKCkpIHsKICAgICAgICAgICAgcmV0dXJuIEJyYWNrZXRTZWFyY2hDYW5jZWxlZC5JTlNUQU5DRTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciByID0gQnJhY2tldHNVdGlscy5maW5kTmV4dEJyYWNrZXRJblJhbmdlKG1vZGVCcmFja2V0cy5mb3J3YXJkUmVnZXgsIGxpbmVOdW1iZXIsIGxpbmVUZXh0LCBzZWFyY2hTdGFydE9mZnNldCwgc2VhcmNoRW5kT2Zmc2V0KTsKICAgICAgICAgIGlmICghcikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBoaXRUZXh0ID0gbGluZVRleHQuc3Vic3RyaW5nKHIuc3RhcnRDb2x1bW4gLSAxLCByLmVuZENvbHVtbiAtIDEpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB2YXIgYnJhY2tldCA9IG1vZGVCcmFja2V0cy50ZXh0SXNCcmFja2V0W2hpdFRleHRdOwogICAgICAgICAgaWYgKGJyYWNrZXQpIHsKICAgICAgICAgICAgaWYgKGJyYWNrZXQuaXNPcGVuKGhpdFRleHQpKSB7CiAgICAgICAgICAgICAgY291bnRzW2JyYWNrZXQuaW5kZXhdKys7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJhY2tldC5pc0Nsb3NlKGhpdFRleHQpKSB7CiAgICAgICAgICAgICAgY291bnRzW2JyYWNrZXQuaW5kZXhdLS07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvdW50c1ticmFja2V0LmluZGV4XSA9PT0gLTEpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMzLl9tYXRjaEZvdW5kQnJhY2tldChyLCBicmFja2V0LCBmYWxzZSwgY29udGludWVTZWFyY2hQcmVkaWNhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBzZWFyY2hTdGFydE9mZnNldCA9IHIuZW5kQ29sdW1uIC0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH07CiAgICAgIHZhciBsYW5ndWFnZUlkID0gbnVsbDsKICAgICAgdmFyIG1vZGVCcmFja2V0cyA9IG51bGw7CiAgICAgIGZvciAodmFyIGxpbmVOdW1iZXIgPSBwb3NpdGlvbi5saW5lTnVtYmVyOyBsaW5lTnVtYmVyIDw9IGxpbmVDb3VudDsgbGluZU51bWJlcisrKSB7CiAgICAgICAgdmFyIGxpbmVUb2tlbnMgPSB0aGlzLnRleHRNb2RlbC50b2tlbml6YXRpb24uZ2V0TGluZVRva2VucyhsaW5lTnVtYmVyKTsKICAgICAgICB2YXIgdG9rZW5Db3VudCA9IGxpbmVUb2tlbnMuZ2V0Q291bnQoKTsKICAgICAgICB2YXIgbGluZVRleHQgPSB0aGlzLnRleHRNb2RlbC5nZXRMaW5lQ29udGVudChsaW5lTnVtYmVyKTsKICAgICAgICB2YXIgdG9rZW5JbmRleCA9IDA7CiAgICAgICAgdmFyIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gMDsKICAgICAgICB2YXIgc2VhcmNoRW5kT2Zmc2V0ID0gMDsKICAgICAgICBpZiAobGluZU51bWJlciA9PT0gcG9zaXRpb24ubGluZU51bWJlcikgewogICAgICAgICAgdG9rZW5JbmRleCA9IGxpbmVUb2tlbnMuZmluZFRva2VuSW5kZXhBdE9mZnNldChwb3NpdGlvbi5jb2x1bW4gLSAxKTsKICAgICAgICAgIHNlYXJjaFN0YXJ0T2Zmc2V0ID0gcG9zaXRpb24uY29sdW1uIC0gMTsKICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IHBvc2l0aW9uLmNvbHVtbiAtIDE7CiAgICAgICAgICB2YXIgdG9rZW5MYW5ndWFnZUlkID0gbGluZVRva2Vucy5nZXRMYW5ndWFnZUlkKHRva2VuSW5kZXgpOwogICAgICAgICAgaWYgKGxhbmd1YWdlSWQgIT09IHRva2VuTGFuZ3VhZ2VJZCkgewogICAgICAgICAgICBsYW5ndWFnZUlkID0gdG9rZW5MYW5ndWFnZUlkOwogICAgICAgICAgICBtb2RlQnJhY2tldHMgPSB0aGlzLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UuZ2V0TGFuZ3VhZ2VDb25maWd1cmF0aW9uKGxhbmd1YWdlSWQpLmJyYWNrZXRzOwogICAgICAgICAgICByZXNldENvdW50cyhsYW5ndWFnZUlkLCBtb2RlQnJhY2tldHMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgcHJldlNlYXJjaEluVG9rZW4gPSB0cnVlOwogICAgICAgIGZvciAoOyB0b2tlbkluZGV4IDwgdG9rZW5Db3VudDsgdG9rZW5JbmRleCsrKSB7CiAgICAgICAgICB2YXIgX3Rva2VuTGFuZ3VhZ2VJZDMgPSBsaW5lVG9rZW5zLmdldExhbmd1YWdlSWQodG9rZW5JbmRleCk7CiAgICAgICAgICBpZiAobGFuZ3VhZ2VJZCAhPT0gX3Rva2VuTGFuZ3VhZ2VJZDMpIHsKICAgICAgICAgICAgLy8gbGFuZ3VhZ2UgaWQgY2hhbmdlIQogICAgICAgICAgICBpZiAobW9kZUJyYWNrZXRzICYmIHByZXZTZWFyY2hJblRva2VuICYmIHNlYXJjaFN0YXJ0T2Zmc2V0ICE9PSBzZWFyY2hFbmRPZmZzZXQpIHsKICAgICAgICAgICAgICB2YXIgciA9IHNlYXJjaEluUmFuZ2UobW9kZUJyYWNrZXRzLCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdHJpcEJyYWNrZXRTZWFyY2hDYW5jZWxlZChyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcHJldlNlYXJjaEluVG9rZW4gPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYW5ndWFnZUlkID0gX3Rva2VuTGFuZ3VhZ2VJZDM7CiAgICAgICAgICAgIG1vZGVCcmFja2V0cyA9IHRoaXMubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZS5nZXRMYW5ndWFnZUNvbmZpZ3VyYXRpb24obGFuZ3VhZ2VJZCkuYnJhY2tldHM7CiAgICAgICAgICAgIHJlc2V0Q291bnRzKGxhbmd1YWdlSWQsIG1vZGVCcmFja2V0cyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc2VhcmNoSW5Ub2tlbiA9ICEhbW9kZUJyYWNrZXRzICYmICFpZ25vcmVCcmFja2V0c0luVG9rZW4obGluZVRva2Vucy5nZXRTdGFuZGFyZFRva2VuVHlwZSh0b2tlbkluZGV4KSk7CiAgICAgICAgICBpZiAoc2VhcmNoSW5Ub2tlbikgewogICAgICAgICAgICAvLyB0aGlzIHRva2VuIHNob3VsZCBiZSBzZWFyY2hlZAogICAgICAgICAgICBpZiAocHJldlNlYXJjaEluVG9rZW4pIHsKICAgICAgICAgICAgICAvLyB0aGUgcHJldmlvdXMgdG9rZW4gc2hvdWxkIGJlIHNlYXJjaGVkLCBzaW1wbHkgZXh0ZW5kIHNlYXJjaEVuZE9mZnNldAogICAgICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUb2tlbnMuZ2V0RW5kT2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIHRoZSBwcmV2aW91cyB0b2tlbiBzaG91bGQgbm90IGJlIHNlYXJjaGVkCiAgICAgICAgICAgICAgc2VhcmNoU3RhcnRPZmZzZXQgPSBsaW5lVG9rZW5zLmdldFN0YXJ0T2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICAgIHNlYXJjaEVuZE9mZnNldCA9IGxpbmVUb2tlbnMuZ2V0RW5kT2Zmc2V0KHRva2VuSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0aGlzIHRva2VuIHNob3VsZCBub3QgYmUgc2VhcmNoZWQKICAgICAgICAgICAgaWYgKG1vZGVCcmFja2V0cyAmJiBwcmV2U2VhcmNoSW5Ub2tlbiAmJiBzZWFyY2hTdGFydE9mZnNldCAhPT0gc2VhcmNoRW5kT2Zmc2V0KSB7CiAgICAgICAgICAgICAgdmFyIF9yOCA9IHNlYXJjaEluUmFuZ2UobW9kZUJyYWNrZXRzLCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICAgICAgaWYgKF9yOCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmlwQnJhY2tldFNlYXJjaENhbmNlbGVkKF9yOCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2U2VhcmNoSW5Ub2tlbiA9IHNlYXJjaEluVG9rZW47CiAgICAgICAgfQogICAgICAgIGlmIChtb2RlQnJhY2tldHMgJiYgcHJldlNlYXJjaEluVG9rZW4gJiYgc2VhcmNoU3RhcnRPZmZzZXQgIT09IHNlYXJjaEVuZE9mZnNldCkgewogICAgICAgICAgdmFyIF9yOSA9IHNlYXJjaEluUmFuZ2UobW9kZUJyYWNrZXRzLCBsaW5lTnVtYmVyLCBsaW5lVGV4dCwgc2VhcmNoU3RhcnRPZmZzZXQsIHNlYXJjaEVuZE9mZnNldCk7CiAgICAgICAgICBpZiAoX3I5KSB7CiAgICAgICAgICAgIHJldHVybiBzdHJpcEJyYWNrZXRTZWFyY2hDYW5jZWxlZChfcjkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdG9Gb3VuZEJyYWNrZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF90b0ZvdW5kQnJhY2tldChicmFja2V0Q29uZmlnLCByKSB7CiAgICAgIGlmICghcikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciB0ZXh0ID0gdGhpcy50ZXh0TW9kZWwuZ2V0VmFsdWVJblJhbmdlKHIpOwogICAgICB0ZXh0ID0gdGV4dC50b0xvd2VyQ2FzZSgpOwogICAgICB2YXIgYnJhY2tldEluZm8gPSBicmFja2V0Q29uZmlnLmdldEJyYWNrZXRJbmZvKHRleHQpOwogICAgICBpZiAoIWJyYWNrZXRJbmZvKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICByYW5nZTogciwKICAgICAgICBicmFja2V0SW5mbzogYnJhY2tldEluZm8KICAgICAgfTsKICAgIH0KICB9XSk7CiAgcmV0dXJuIEJyYWNrZXRQYWlyc1RleHRNb2RlbFBhcnQ7Cn0oRGlzcG9zYWJsZSk7CmZ1bmN0aW9uIGNyZWF0ZURpc3Bvc2FibGVSZWYob2JqZWN0LCBkaXNwb3NhYmxlKSB7CiAgcmV0dXJuIHsKICAgIG9iamVjdDogb2JqZWN0LAogICAgZGlzcG9zZTogZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgcmV0dXJuIGRpc3Bvc2FibGUgPT09IG51bGwgfHwgZGlzcG9zYWJsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGlzcG9zYWJsZS5kaXNwb3NlKCk7CiAgICB9CiAgfTsKfQpmdW5jdGlvbiBjcmVhdGVUaW1lQmFzZWRDb250aW51ZUJyYWNrZXRTZWFyY2hQcmVkaWNhdGUobWF4RHVyYXRpb24pIHsKICBpZiAodHlwZW9mIG1heER1cmF0aW9uID09PSAndW5kZWZpbmVkJykgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogIH0gZWxzZSB7CiAgICB2YXIgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lIDw9IG1heER1cmF0aW9uOwogICAgfTsKICB9Cn0KdmFyIEJyYWNrZXRTZWFyY2hDYW5jZWxlZCA9IC8qI19fUFVSRV9fKi9fY3JlYXRlQ2xhc3MoZnVuY3Rpb24gQnJhY2tldFNlYXJjaENhbmNlbGVkKCkgewogIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCcmFja2V0U2VhcmNoQ2FuY2VsZWQpOwogIHRoaXMuX3NlYXJjaENhbmNlbGVkQnJhbmQgPSB1bmRlZmluZWQ7Cn0pOwpCcmFja2V0U2VhcmNoQ2FuY2VsZWQuSU5TVEFOQ0UgPSBuZXcgQnJhY2tldFNlYXJjaENhbmNlbGVkKCk7CmZ1bmN0aW9uIHN0cmlwQnJhY2tldFNlYXJjaENhbmNlbGVkKHJlc3VsdCkgewogIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBCcmFja2V0U2VhcmNoQ2FuY2VsZWQpIHsKICAgIHJldHVybiBudWxsOwogIH0KICByZXR1cm4gcmVzdWx0Owp9"},{"version":3,"names":["Emitter","Disposable","DisposableStore","MutableDisposable","Range","BracketPairsTree","ignoreBracketsInToken","BracketsUtils","compareBy","findLast","findLastMaxBy","BracketPairsTextModelPart","textModel","languageConfigurationService","bracketPairsTree","_register","onDidChangeEmitter","onDidChange","event","bracketsRequested","e","_a","languageId","value","object","didLanguageChange","clear","updateBracketPairsTree","maxSupportedDocumentLength","getValueLength","change","handleContentChanged","handleDidChangeBackgroundTokenizationState","handleDidChangeTokens","canBuildAST","store","createDisposableRef","add","getLanguageConfiguration","fire","range","getBracketPairsInRange","getBracketsInRange","_bracket","_position","maxDuration","position","validatePosition","getLanguageIdAtPosition","lineNumber","column","closingBracketInfo","bracketsNew","getClosingBracketInfo","bracketPair","fromPositions","b","closes","openingBracketInfo","openingBracketRange","bracket","toLowerCase","bracketsSupport","brackets","data","textIsBracket","stripBracketSearchCanceled","_findMatchingBracketUp","createTimeBasedContinueBracketSearchPredicate","filter","item","closingBracketRange","undefined","containsPosition","compareRangesUsingStarts","continueSearchPredicate","_matchBracket","lineTokens","modeBrackets","tokenIndex","tokenCount","getCount","currentLanguageId","getLanguageId","searchStartOffset","Math","max","maxBracketLength","i","tokenEndOffset","getEndOffset","getStandardTokenType","searchEndOffset","min","getLineContent","length","tokenStartOffset","getStartOffset","tokenization","getLineTokens","lineText","findTokenIndexAtOffset","currentModeBrackets","_establishBracketSearchOffsets","bestResult","foundBracket","findNextBracketInRange","forwardRegex","startColumn","endColumn","foundBracketText","substring","r","_matchFoundBracket","textIsOpenBracket","BracketSearchCanceled","prevTokenIndex","prevModeBrackets","findPrevBracketInRange","reversedRegex","isOpen","matched","_findMatchingBracketDown","getEndPosition","getStartPosition","reversedBracketRegex","count","totalCallCount","searchPrevMatchingBracketInRange","INSTANCE","hitText","isClose","prevSearchInToken","searchInToken","bracketRegex","searchNextMatchingBracketInRange","lineCount","getLineCount","getFirstBracketBefore","bracketConfig","tokenLanguageId","_toFoundBracket","getFirstBracketAfter","strictContainsRange","savedCounts","Map","counts","resetCounts","has","tmp","len","set","get","searchInRange","index","text","getValueInRange","bracketInfo","getBracketInfo","disposable","dispose","startTime","Date","now","_searchCanceledBrand","result"],"sources":["/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/model/bracketPairsTextModelPart/bracketPairsImpl.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable, DisposableStore, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { Range } from '../../core/range.js';\nimport { BracketPairsTree } from './bracketPairsTree/bracketPairsTree.js';\nimport { ignoreBracketsInToken } from '../../languages/supports.js';\nimport { BracketsUtils } from '../../languages/supports/richEditBrackets.js';\nimport { compareBy, findLast, findLastMaxBy } from '../../../../base/common/arrays.js';\nexport class BracketPairsTextModelPart extends Disposable {\n    constructor(textModel, languageConfigurationService) {\n        super();\n        this.textModel = textModel;\n        this.languageConfigurationService = languageConfigurationService;\n        this.bracketPairsTree = this._register(new MutableDisposable());\n        this.onDidChangeEmitter = new Emitter();\n        this.onDidChange = this.onDidChangeEmitter.event;\n        this.bracketsRequested = false;\n        this._register(this.languageConfigurationService.onDidChange(e => {\n            var _a;\n            if (!e.languageId || ((_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.didLanguageChange(e.languageId))) {\n                this.bracketPairsTree.clear();\n                this.updateBracketPairsTree();\n            }\n        }));\n    }\n    get canBuildAST() {\n        const maxSupportedDocumentLength = /* max lines */ 50000 * /* average column count */ 100;\n        return this.textModel.getValueLength() <= maxSupportedDocumentLength;\n    }\n    //#region TextModel events\n    handleDidChangeOptions(e) {\n        this.bracketPairsTree.clear();\n        this.updateBracketPairsTree();\n    }\n    handleDidChangeLanguage(e) {\n        this.bracketPairsTree.clear();\n        this.updateBracketPairsTree();\n    }\n    handleDidChangeContent(change) {\n        var _a;\n        (_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.handleContentChanged(change);\n    }\n    handleDidChangeBackgroundTokenizationState() {\n        var _a;\n        (_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.handleDidChangeBackgroundTokenizationState();\n    }\n    handleDidChangeTokens(e) {\n        var _a;\n        (_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.handleDidChangeTokens(e);\n    }\n    //#endregion\n    updateBracketPairsTree() {\n        if (this.bracketsRequested && this.canBuildAST) {\n            if (!this.bracketPairsTree.value) {\n                const store = new DisposableStore();\n                this.bracketPairsTree.value = createDisposableRef(store.add(new BracketPairsTree(this.textModel, (languageId) => {\n                    return this.languageConfigurationService.getLanguageConfiguration(languageId);\n                })), store);\n                store.add(this.bracketPairsTree.value.object.onDidChange(e => this.onDidChangeEmitter.fire(e)));\n                this.onDidChangeEmitter.fire();\n            }\n        }\n        else {\n            if (this.bracketPairsTree.value) {\n                this.bracketPairsTree.clear();\n                // Important: Don't call fire if there was no change!\n                this.onDidChangeEmitter.fire();\n            }\n        }\n    }\n    /**\n     * Returns all bracket pairs that intersect the given range.\n     * The result is sorted by the start position.\n    */\n    getBracketPairsInRange(range) {\n        var _a;\n        this.bracketsRequested = true;\n        this.updateBracketPairsTree();\n        return ((_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.getBracketPairsInRange(range, false)) || [];\n    }\n    getBracketPairsInRangeWithMinIndentation(range) {\n        var _a;\n        this.bracketsRequested = true;\n        this.updateBracketPairsTree();\n        return ((_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.getBracketPairsInRange(range, true)) || [];\n    }\n    getBracketsInRange(range) {\n        var _a;\n        this.bracketsRequested = true;\n        this.updateBracketPairsTree();\n        return ((_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.getBracketsInRange(range)) || [];\n    }\n    findMatchingBracketUp(_bracket, _position, maxDuration) {\n        const position = this.textModel.validatePosition(_position);\n        const languageId = this.textModel.getLanguageIdAtPosition(position.lineNumber, position.column);\n        if (this.canBuildAST) {\n            const closingBracketInfo = this.languageConfigurationService\n                .getLanguageConfiguration(languageId)\n                .bracketsNew.getClosingBracketInfo(_bracket);\n            if (!closingBracketInfo) {\n                return null;\n            }\n            const bracketPair = findLast(this.getBracketPairsInRange(Range.fromPositions(_position, _position)) || [], (b) => closingBracketInfo.closes(b.openingBracketInfo));\n            if (bracketPair) {\n                return bracketPair.openingBracketRange;\n            }\n            return null;\n        }\n        else {\n            // Fallback to old bracket matching code:\n            const bracket = _bracket.toLowerCase();\n            const bracketsSupport = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n            if (!bracketsSupport) {\n                return null;\n            }\n            const data = bracketsSupport.textIsBracket[bracket];\n            if (!data) {\n                return null;\n            }\n            return stripBracketSearchCanceled(this._findMatchingBracketUp(data, position, createTimeBasedContinueBracketSearchPredicate(maxDuration)));\n        }\n    }\n    matchBracket(position, maxDuration) {\n        if (this.canBuildAST) {\n            const bracketPair = findLastMaxBy(this.getBracketPairsInRange(Range.fromPositions(position, position)).filter((item) => item.closingBracketRange !== undefined &&\n                (item.openingBracketRange.containsPosition(position) ||\n                    item.closingBracketRange.containsPosition(position))), compareBy((item) => item.openingBracketRange.containsPosition(position)\n                ? item.openingBracketRange\n                : item.closingBracketRange, Range.compareRangesUsingStarts));\n            if (bracketPair) {\n                return [bracketPair.openingBracketRange, bracketPair.closingBracketRange];\n            }\n            return null;\n        }\n        else {\n            // Fallback to old bracket matching code:\n            const continueSearchPredicate = createTimeBasedContinueBracketSearchPredicate(maxDuration);\n            return this._matchBracket(this.textModel.validatePosition(position), continueSearchPredicate);\n        }\n    }\n    _establishBracketSearchOffsets(position, lineTokens, modeBrackets, tokenIndex) {\n        const tokenCount = lineTokens.getCount();\n        const currentLanguageId = lineTokens.getLanguageId(tokenIndex);\n        // limit search to not go before `maxBracketLength`\n        let searchStartOffset = Math.max(0, position.column - 1 - modeBrackets.maxBracketLength);\n        for (let i = tokenIndex - 1; i >= 0; i--) {\n            const tokenEndOffset = lineTokens.getEndOffset(i);\n            if (tokenEndOffset <= searchStartOffset) {\n                break;\n            }\n            if (ignoreBracketsInToken(lineTokens.getStandardTokenType(i)) || lineTokens.getLanguageId(i) !== currentLanguageId) {\n                searchStartOffset = tokenEndOffset;\n                break;\n            }\n        }\n        // limit search to not go after `maxBracketLength`\n        let searchEndOffset = Math.min(lineTokens.getLineContent().length, position.column - 1 + modeBrackets.maxBracketLength);\n        for (let i = tokenIndex + 1; i < tokenCount; i++) {\n            const tokenStartOffset = lineTokens.getStartOffset(i);\n            if (tokenStartOffset >= searchEndOffset) {\n                break;\n            }\n            if (ignoreBracketsInToken(lineTokens.getStandardTokenType(i)) || lineTokens.getLanguageId(i) !== currentLanguageId) {\n                searchEndOffset = tokenStartOffset;\n                break;\n            }\n        }\n        return { searchStartOffset, searchEndOffset };\n    }\n    _matchBracket(position, continueSearchPredicate) {\n        const lineNumber = position.lineNumber;\n        const lineTokens = this.textModel.tokenization.getLineTokens(lineNumber);\n        const lineText = this.textModel.getLineContent(lineNumber);\n        const tokenIndex = lineTokens.findTokenIndexAtOffset(position.column - 1);\n        if (tokenIndex < 0) {\n            return null;\n        }\n        const currentModeBrackets = this.languageConfigurationService.getLanguageConfiguration(lineTokens.getLanguageId(tokenIndex)).brackets;\n        // check that the token is not to be ignored\n        if (currentModeBrackets && !ignoreBracketsInToken(lineTokens.getStandardTokenType(tokenIndex))) {\n            let { searchStartOffset, searchEndOffset } = this._establishBracketSearchOffsets(position, lineTokens, currentModeBrackets, tokenIndex);\n            // it might be the case that [currentTokenStart -> currentTokenEnd] contains multiple brackets\n            // `bestResult` will contain the most right-side result\n            let bestResult = null;\n            while (true) {\n                const foundBracket = BracketsUtils.findNextBracketInRange(currentModeBrackets.forwardRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (!foundBracket) {\n                    // there are no more brackets in this text\n                    break;\n                }\n                // check that we didn't hit a bracket too far away from position\n                if (foundBracket.startColumn <= position.column && position.column <= foundBracket.endColumn) {\n                    const foundBracketText = lineText.substring(foundBracket.startColumn - 1, foundBracket.endColumn - 1).toLowerCase();\n                    const r = this._matchFoundBracket(foundBracket, currentModeBrackets.textIsBracket[foundBracketText], currentModeBrackets.textIsOpenBracket[foundBracketText], continueSearchPredicate);\n                    if (r) {\n                        if (r instanceof BracketSearchCanceled) {\n                            return null;\n                        }\n                        bestResult = r;\n                    }\n                }\n                searchStartOffset = foundBracket.endColumn - 1;\n            }\n            if (bestResult) {\n                return bestResult;\n            }\n        }\n        // If position is in between two tokens, try also looking in the previous token\n        if (tokenIndex > 0 && lineTokens.getStartOffset(tokenIndex) === position.column - 1) {\n            const prevTokenIndex = tokenIndex - 1;\n            const prevModeBrackets = this.languageConfigurationService.getLanguageConfiguration(lineTokens.getLanguageId(prevTokenIndex)).brackets;\n            // check that previous token is not to be ignored\n            if (prevModeBrackets && !ignoreBracketsInToken(lineTokens.getStandardTokenType(prevTokenIndex))) {\n                const { searchStartOffset, searchEndOffset } = this._establishBracketSearchOffsets(position, lineTokens, prevModeBrackets, prevTokenIndex);\n                const foundBracket = BracketsUtils.findPrevBracketInRange(prevModeBrackets.reversedRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                // check that we didn't hit a bracket too far away from position\n                if (foundBracket && foundBracket.startColumn <= position.column && position.column <= foundBracket.endColumn) {\n                    const foundBracketText = lineText.substring(foundBracket.startColumn - 1, foundBracket.endColumn - 1).toLowerCase();\n                    const r = this._matchFoundBracket(foundBracket, prevModeBrackets.textIsBracket[foundBracketText], prevModeBrackets.textIsOpenBracket[foundBracketText], continueSearchPredicate);\n                    if (r) {\n                        if (r instanceof BracketSearchCanceled) {\n                            return null;\n                        }\n                        return r;\n                    }\n                }\n            }\n        }\n        return null;\n    }\n    _matchFoundBracket(foundBracket, data, isOpen, continueSearchPredicate) {\n        if (!data) {\n            return null;\n        }\n        const matched = (isOpen\n            ? this._findMatchingBracketDown(data, foundBracket.getEndPosition(), continueSearchPredicate)\n            : this._findMatchingBracketUp(data, foundBracket.getStartPosition(), continueSearchPredicate));\n        if (!matched) {\n            return null;\n        }\n        if (matched instanceof BracketSearchCanceled) {\n            return matched;\n        }\n        return [foundBracket, matched];\n    }\n    _findMatchingBracketUp(bracket, position, continueSearchPredicate) {\n        // console.log('_findMatchingBracketUp: ', 'bracket: ', JSON.stringify(bracket), 'startPosition: ', String(position));\n        const languageId = bracket.languageId;\n        const reversedBracketRegex = bracket.reversedRegex;\n        let count = -1;\n        let totalCallCount = 0;\n        const searchPrevMatchingBracketInRange = (lineNumber, lineText, searchStartOffset, searchEndOffset) => {\n            while (true) {\n                if (continueSearchPredicate && (++totalCallCount) % 100 === 0 && !continueSearchPredicate()) {\n                    return BracketSearchCanceled.INSTANCE;\n                }\n                const r = BracketsUtils.findPrevBracketInRange(reversedBracketRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (!r) {\n                    break;\n                }\n                const hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1).toLowerCase();\n                if (bracket.isOpen(hitText)) {\n                    count++;\n                }\n                else if (bracket.isClose(hitText)) {\n                    count--;\n                }\n                if (count === 0) {\n                    return r;\n                }\n                searchEndOffset = r.startColumn - 1;\n            }\n            return null;\n        };\n        for (let lineNumber = position.lineNumber; lineNumber >= 1; lineNumber--) {\n            const lineTokens = this.textModel.tokenization.getLineTokens(lineNumber);\n            const tokenCount = lineTokens.getCount();\n            const lineText = this.textModel.getLineContent(lineNumber);\n            let tokenIndex = tokenCount - 1;\n            let searchStartOffset = lineText.length;\n            let searchEndOffset = lineText.length;\n            if (lineNumber === position.lineNumber) {\n                tokenIndex = lineTokens.findTokenIndexAtOffset(position.column - 1);\n                searchStartOffset = position.column - 1;\n                searchEndOffset = position.column - 1;\n            }\n            let prevSearchInToken = true;\n            for (; tokenIndex >= 0; tokenIndex--) {\n                const searchInToken = (lineTokens.getLanguageId(tokenIndex) === languageId && !ignoreBracketsInToken(lineTokens.getStandardTokenType(tokenIndex)));\n                if (searchInToken) {\n                    // this token should be searched\n                    if (prevSearchInToken) {\n                        // the previous token should be searched, simply extend searchStartOffset\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                    }\n                    else {\n                        // the previous token should not be searched\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                }\n                else {\n                    // this token should not be searched\n                    if (prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = searchPrevMatchingBracketInRange(lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return r;\n                        }\n                    }\n                }\n                prevSearchInToken = searchInToken;\n            }\n            if (prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                const r = searchPrevMatchingBracketInRange(lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (r) {\n                    return r;\n                }\n            }\n        }\n        return null;\n    }\n    _findMatchingBracketDown(bracket, position, continueSearchPredicate) {\n        // console.log('_findMatchingBracketDown: ', 'bracket: ', JSON.stringify(bracket), 'startPosition: ', String(position));\n        const languageId = bracket.languageId;\n        const bracketRegex = bracket.forwardRegex;\n        let count = 1;\n        let totalCallCount = 0;\n        const searchNextMatchingBracketInRange = (lineNumber, lineText, searchStartOffset, searchEndOffset) => {\n            while (true) {\n                if (continueSearchPredicate && (++totalCallCount) % 100 === 0 && !continueSearchPredicate()) {\n                    return BracketSearchCanceled.INSTANCE;\n                }\n                const r = BracketsUtils.findNextBracketInRange(bracketRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (!r) {\n                    break;\n                }\n                const hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1).toLowerCase();\n                if (bracket.isOpen(hitText)) {\n                    count++;\n                }\n                else if (bracket.isClose(hitText)) {\n                    count--;\n                }\n                if (count === 0) {\n                    return r;\n                }\n                searchStartOffset = r.endColumn - 1;\n            }\n            return null;\n        };\n        const lineCount = this.textModel.getLineCount();\n        for (let lineNumber = position.lineNumber; lineNumber <= lineCount; lineNumber++) {\n            const lineTokens = this.textModel.tokenization.getLineTokens(lineNumber);\n            const tokenCount = lineTokens.getCount();\n            const lineText = this.textModel.getLineContent(lineNumber);\n            let tokenIndex = 0;\n            let searchStartOffset = 0;\n            let searchEndOffset = 0;\n            if (lineNumber === position.lineNumber) {\n                tokenIndex = lineTokens.findTokenIndexAtOffset(position.column - 1);\n                searchStartOffset = position.column - 1;\n                searchEndOffset = position.column - 1;\n            }\n            let prevSearchInToken = true;\n            for (; tokenIndex < tokenCount; tokenIndex++) {\n                const searchInToken = (lineTokens.getLanguageId(tokenIndex) === languageId && !ignoreBracketsInToken(lineTokens.getStandardTokenType(tokenIndex)));\n                if (searchInToken) {\n                    // this token should be searched\n                    if (prevSearchInToken) {\n                        // the previous token should be searched, simply extend searchEndOffset\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                    else {\n                        // the previous token should not be searched\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                }\n                else {\n                    // this token should not be searched\n                    if (prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = searchNextMatchingBracketInRange(lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return r;\n                        }\n                    }\n                }\n                prevSearchInToken = searchInToken;\n            }\n            if (prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                const r = searchNextMatchingBracketInRange(lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (r) {\n                    return r;\n                }\n            }\n        }\n        return null;\n    }\n    findPrevBracket(_position) {\n        var _a;\n        const position = this.textModel.validatePosition(_position);\n        if (this.canBuildAST) {\n            this.bracketsRequested = true;\n            this.updateBracketPairsTree();\n            return ((_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.getFirstBracketBefore(position)) || null;\n        }\n        let languageId = null;\n        let modeBrackets = null;\n        let bracketConfig = null;\n        for (let lineNumber = position.lineNumber; lineNumber >= 1; lineNumber--) {\n            const lineTokens = this.textModel.tokenization.getLineTokens(lineNumber);\n            const tokenCount = lineTokens.getCount();\n            const lineText = this.textModel.getLineContent(lineNumber);\n            let tokenIndex = tokenCount - 1;\n            let searchStartOffset = lineText.length;\n            let searchEndOffset = lineText.length;\n            if (lineNumber === position.lineNumber) {\n                tokenIndex = lineTokens.findTokenIndexAtOffset(position.column - 1);\n                searchStartOffset = position.column - 1;\n                searchEndOffset = position.column - 1;\n                const tokenLanguageId = lineTokens.getLanguageId(tokenIndex);\n                if (languageId !== tokenLanguageId) {\n                    languageId = tokenLanguageId;\n                    modeBrackets = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n                    bracketConfig = this.languageConfigurationService.getLanguageConfiguration(languageId).bracketsNew;\n                }\n            }\n            let prevSearchInToken = true;\n            for (; tokenIndex >= 0; tokenIndex--) {\n                const tokenLanguageId = lineTokens.getLanguageId(tokenIndex);\n                if (languageId !== tokenLanguageId) {\n                    // language id change!\n                    if (modeBrackets && bracketConfig && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = BracketsUtils.findPrevBracketInRange(modeBrackets.reversedRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return this._toFoundBracket(bracketConfig, r);\n                        }\n                        prevSearchInToken = false;\n                    }\n                    languageId = tokenLanguageId;\n                    modeBrackets = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n                    bracketConfig = this.languageConfigurationService.getLanguageConfiguration(languageId).bracketsNew;\n                }\n                const searchInToken = (!!modeBrackets && !ignoreBracketsInToken(lineTokens.getStandardTokenType(tokenIndex)));\n                if (searchInToken) {\n                    // this token should be searched\n                    if (prevSearchInToken) {\n                        // the previous token should be searched, simply extend searchStartOffset\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                    }\n                    else {\n                        // the previous token should not be searched\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                }\n                else {\n                    // this token should not be searched\n                    if (bracketConfig && modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = BracketsUtils.findPrevBracketInRange(modeBrackets.reversedRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return this._toFoundBracket(bracketConfig, r);\n                        }\n                    }\n                }\n                prevSearchInToken = searchInToken;\n            }\n            if (bracketConfig && modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                const r = BracketsUtils.findPrevBracketInRange(modeBrackets.reversedRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (r) {\n                    return this._toFoundBracket(bracketConfig, r);\n                }\n            }\n        }\n        return null;\n    }\n    findNextBracket(_position) {\n        var _a;\n        const position = this.textModel.validatePosition(_position);\n        if (this.canBuildAST) {\n            this.bracketsRequested = true;\n            this.updateBracketPairsTree();\n            return ((_a = this.bracketPairsTree.value) === null || _a === void 0 ? void 0 : _a.object.getFirstBracketAfter(position)) || null;\n        }\n        const lineCount = this.textModel.getLineCount();\n        let languageId = null;\n        let modeBrackets = null;\n        let bracketConfig = null;\n        for (let lineNumber = position.lineNumber; lineNumber <= lineCount; lineNumber++) {\n            const lineTokens = this.textModel.tokenization.getLineTokens(lineNumber);\n            const tokenCount = lineTokens.getCount();\n            const lineText = this.textModel.getLineContent(lineNumber);\n            let tokenIndex = 0;\n            let searchStartOffset = 0;\n            let searchEndOffset = 0;\n            if (lineNumber === position.lineNumber) {\n                tokenIndex = lineTokens.findTokenIndexAtOffset(position.column - 1);\n                searchStartOffset = position.column - 1;\n                searchEndOffset = position.column - 1;\n                const tokenLanguageId = lineTokens.getLanguageId(tokenIndex);\n                if (languageId !== tokenLanguageId) {\n                    languageId = tokenLanguageId;\n                    modeBrackets = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n                    bracketConfig = this.languageConfigurationService.getLanguageConfiguration(languageId).bracketsNew;\n                }\n            }\n            let prevSearchInToken = true;\n            for (; tokenIndex < tokenCount; tokenIndex++) {\n                const tokenLanguageId = lineTokens.getLanguageId(tokenIndex);\n                if (languageId !== tokenLanguageId) {\n                    // language id change!\n                    if (bracketConfig && modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = BracketsUtils.findNextBracketInRange(modeBrackets.forwardRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return this._toFoundBracket(bracketConfig, r);\n                        }\n                        prevSearchInToken = false;\n                    }\n                    languageId = tokenLanguageId;\n                    modeBrackets = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n                    bracketConfig = this.languageConfigurationService.getLanguageConfiguration(languageId).bracketsNew;\n                }\n                const searchInToken = (!!modeBrackets && !ignoreBracketsInToken(lineTokens.getStandardTokenType(tokenIndex)));\n                if (searchInToken) {\n                    // this token should be searched\n                    if (prevSearchInToken) {\n                        // the previous token should be searched, simply extend searchEndOffset\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                    else {\n                        // the previous token should not be searched\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                }\n                else {\n                    // this token should not be searched\n                    if (bracketConfig && modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = BracketsUtils.findNextBracketInRange(modeBrackets.forwardRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return this._toFoundBracket(bracketConfig, r);\n                        }\n                    }\n                }\n                prevSearchInToken = searchInToken;\n            }\n            if (bracketConfig && modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                const r = BracketsUtils.findNextBracketInRange(modeBrackets.forwardRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (r) {\n                    return this._toFoundBracket(bracketConfig, r);\n                }\n            }\n        }\n        return null;\n    }\n    findEnclosingBrackets(_position, maxDuration) {\n        const position = this.textModel.validatePosition(_position);\n        if (this.canBuildAST) {\n            const range = Range.fromPositions(position);\n            const bracketPair = findLast(this.getBracketPairsInRange(Range.fromPositions(position, position)), (item) => item.closingBracketRange !== undefined && item.range.strictContainsRange(range));\n            if (bracketPair) {\n                return [bracketPair.openingBracketRange, bracketPair.closingBracketRange];\n            }\n            return null;\n        }\n        const continueSearchPredicate = createTimeBasedContinueBracketSearchPredicate(maxDuration);\n        const lineCount = this.textModel.getLineCount();\n        const savedCounts = new Map();\n        let counts = [];\n        const resetCounts = (languageId, modeBrackets) => {\n            if (!savedCounts.has(languageId)) {\n                const tmp = [];\n                for (let i = 0, len = modeBrackets ? modeBrackets.brackets.length : 0; i < len; i++) {\n                    tmp[i] = 0;\n                }\n                savedCounts.set(languageId, tmp);\n            }\n            counts = savedCounts.get(languageId);\n        };\n        let totalCallCount = 0;\n        const searchInRange = (modeBrackets, lineNumber, lineText, searchStartOffset, searchEndOffset) => {\n            while (true) {\n                if (continueSearchPredicate && (++totalCallCount) % 100 === 0 && !continueSearchPredicate()) {\n                    return BracketSearchCanceled.INSTANCE;\n                }\n                const r = BracketsUtils.findNextBracketInRange(modeBrackets.forwardRegex, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (!r) {\n                    break;\n                }\n                const hitText = lineText.substring(r.startColumn - 1, r.endColumn - 1).toLowerCase();\n                const bracket = modeBrackets.textIsBracket[hitText];\n                if (bracket) {\n                    if (bracket.isOpen(hitText)) {\n                        counts[bracket.index]++;\n                    }\n                    else if (bracket.isClose(hitText)) {\n                        counts[bracket.index]--;\n                    }\n                    if (counts[bracket.index] === -1) {\n                        return this._matchFoundBracket(r, bracket, false, continueSearchPredicate);\n                    }\n                }\n                searchStartOffset = r.endColumn - 1;\n            }\n            return null;\n        };\n        let languageId = null;\n        let modeBrackets = null;\n        for (let lineNumber = position.lineNumber; lineNumber <= lineCount; lineNumber++) {\n            const lineTokens = this.textModel.tokenization.getLineTokens(lineNumber);\n            const tokenCount = lineTokens.getCount();\n            const lineText = this.textModel.getLineContent(lineNumber);\n            let tokenIndex = 0;\n            let searchStartOffset = 0;\n            let searchEndOffset = 0;\n            if (lineNumber === position.lineNumber) {\n                tokenIndex = lineTokens.findTokenIndexAtOffset(position.column - 1);\n                searchStartOffset = position.column - 1;\n                searchEndOffset = position.column - 1;\n                const tokenLanguageId = lineTokens.getLanguageId(tokenIndex);\n                if (languageId !== tokenLanguageId) {\n                    languageId = tokenLanguageId;\n                    modeBrackets = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n                    resetCounts(languageId, modeBrackets);\n                }\n            }\n            let prevSearchInToken = true;\n            for (; tokenIndex < tokenCount; tokenIndex++) {\n                const tokenLanguageId = lineTokens.getLanguageId(tokenIndex);\n                if (languageId !== tokenLanguageId) {\n                    // language id change!\n                    if (modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = searchInRange(modeBrackets, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return stripBracketSearchCanceled(r);\n                        }\n                        prevSearchInToken = false;\n                    }\n                    languageId = tokenLanguageId;\n                    modeBrackets = this.languageConfigurationService.getLanguageConfiguration(languageId).brackets;\n                    resetCounts(languageId, modeBrackets);\n                }\n                const searchInToken = (!!modeBrackets && !ignoreBracketsInToken(lineTokens.getStandardTokenType(tokenIndex)));\n                if (searchInToken) {\n                    // this token should be searched\n                    if (prevSearchInToken) {\n                        // the previous token should be searched, simply extend searchEndOffset\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                    else {\n                        // the previous token should not be searched\n                        searchStartOffset = lineTokens.getStartOffset(tokenIndex);\n                        searchEndOffset = lineTokens.getEndOffset(tokenIndex);\n                    }\n                }\n                else {\n                    // this token should not be searched\n                    if (modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                        const r = searchInRange(modeBrackets, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                        if (r) {\n                            return stripBracketSearchCanceled(r);\n                        }\n                    }\n                }\n                prevSearchInToken = searchInToken;\n            }\n            if (modeBrackets && prevSearchInToken && searchStartOffset !== searchEndOffset) {\n                const r = searchInRange(modeBrackets, lineNumber, lineText, searchStartOffset, searchEndOffset);\n                if (r) {\n                    return stripBracketSearchCanceled(r);\n                }\n            }\n        }\n        return null;\n    }\n    _toFoundBracket(bracketConfig, r) {\n        if (!r) {\n            return null;\n        }\n        let text = this.textModel.getValueInRange(r);\n        text = text.toLowerCase();\n        const bracketInfo = bracketConfig.getBracketInfo(text);\n        if (!bracketInfo) {\n            return null;\n        }\n        return {\n            range: r,\n            bracketInfo\n        };\n    }\n}\nfunction createDisposableRef(object, disposable) {\n    return {\n        object,\n        dispose: () => disposable === null || disposable === void 0 ? void 0 : disposable.dispose(),\n    };\n}\nfunction createTimeBasedContinueBracketSearchPredicate(maxDuration) {\n    if (typeof maxDuration === 'undefined') {\n        return () => true;\n    }\n    else {\n        const startTime = Date.now();\n        return () => {\n            return (Date.now() - startTime <= maxDuration);\n        };\n    }\n}\nclass BracketSearchCanceled {\n    constructor() {\n        this._searchCanceledBrand = undefined;\n    }\n}\nBracketSearchCanceled.INSTANCE = new BracketSearchCanceled();\nfunction stripBracketSearchCanceled(result) {\n    if (result instanceof BracketSearchCanceled) {\n        return null;\n    }\n    return result;\n}\n"],"mappings":"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"}]}