{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/thread-loader/dist/cjs.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/model/pieceTreeTextBuffer/pieceTreeBase.js","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/model/pieceTreeTextBuffer/pieceTreeBase.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/babel.config.js","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcy5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjay5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LWJ1ZmZlci5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS51aW50MTYtYXJyYXkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5hdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmNvcHktd2l0aGluLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZXZlcnkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWxsLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWxhc3QuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWxhc3QtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5kZXgtb2YuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5sYXN0LWluZGV4LW9mLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkucmVkdWNlLXJpZ2h0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkucmV2ZXJzZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNldC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29tZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNvcnQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zdWJhcnJheS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLWxvY2FsZS1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS51aW50MzItYXJyYXkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIjsKLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29yZS9wb3NpdGlvbi5qcyc7CmltcG9ydCB7IFJhbmdlIH0gZnJvbSAnLi4vLi4vY29yZS9yYW5nZS5qcyc7CmltcG9ydCB7IEZpbmRNYXRjaCB9IGZyb20gJy4uLy4uL21vZGVsLmpzJzsKaW1wb3J0IHsgU0VOVElORUwsIFRyZWVOb2RlLCBmaXhJbnNlcnQsIGxlZnRlc3QsIHJiRGVsZXRlLCByaWdodHRlc3QsIHVwZGF0ZVRyZWVNZXRhZGF0YSB9IGZyb20gJy4vcmJUcmVlQmFzZS5qcyc7CmltcG9ydCB7IFNlYXJjaGVyLCBjcmVhdGVGaW5kTWF0Y2gsIGlzVmFsaWRNYXRjaCB9IGZyb20gJy4uL3RleHRNb2RlbFNlYXJjaC5qcyc7Ci8vIGNvbnN0IGxmUmVnZXggPSBuZXcgUmVnRXhwKC9cclxufFxyfFxuL2cpOwpleHBvcnQgdmFyIEF2ZXJhZ2VCdWZmZXJTaXplID0gNjU1MzU7CmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVVaW50QXJyYXkoYXJyKSB7CiAgdmFyIHI7CiAgaWYgKGFyclthcnIubGVuZ3RoIC0gMV0gPCA2NTUzNikgewogICAgciA9IG5ldyBVaW50MTZBcnJheShhcnIubGVuZ3RoKTsKICB9IGVsc2UgewogICAgciA9IG5ldyBVaW50MzJBcnJheShhcnIubGVuZ3RoKTsKICB9CiAgci5zZXQoYXJyLCAwKTsKICByZXR1cm4gcjsKfQpleHBvcnQgdmFyIExpbmVTdGFydHMgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZUNsYXNzKGZ1bmN0aW9uIExpbmVTdGFydHMobGluZVN0YXJ0cywgY3IsIGxmLCBjcmxmLCBpc0Jhc2ljQVNDSUkpIHsKICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTGluZVN0YXJ0cyk7CiAgdGhpcy5saW5lU3RhcnRzID0gbGluZVN0YXJ0czsKICB0aGlzLmNyID0gY3I7CiAgdGhpcy5sZiA9IGxmOwogIHRoaXMuY3JsZiA9IGNybGY7CiAgdGhpcy5pc0Jhc2ljQVNDSUkgPSBpc0Jhc2ljQVNDSUk7Cn0pOwpleHBvcnQgZnVuY3Rpb24gY3JlYXRlTGluZVN0YXJ0c0Zhc3Qoc3RyKSB7CiAgdmFyIHJlYWRvbmx5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOwogIHZhciByID0gWzBdOwogIHZhciByTGVuZ3RoID0gMTsKICBmb3IgKHZhciBpID0gMCwgbGVuID0gc3RyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICB2YXIgY2hyID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICBpZiAoY2hyID09PSAxMyAvKiBDaGFyQ29kZS5DYXJyaWFnZVJldHVybiAqLykgewogICAgICBpZiAoaSArIDEgPCBsZW4gJiYgc3RyLmNoYXJDb2RlQXQoaSArIDEpID09PSAxMCAvKiBDaGFyQ29kZS5MaW5lRmVlZCAqLykgewogICAgICAgIC8vIFxyXG4uLi4gY2FzZQogICAgICAgIHJbckxlbmd0aCsrXSA9IGkgKyAyOwogICAgICAgIGkrKzsgLy8gc2tpcCBcbgogICAgICB9IGVsc2UgewogICAgICAgIC8vIFxyLi4uIGNhc2UKICAgICAgICByW3JMZW5ndGgrK10gPSBpICsgMTsKICAgICAgfQogICAgfSBlbHNlIGlmIChjaHIgPT09IDEwIC8qIENoYXJDb2RlLkxpbmVGZWVkICovKSB7CiAgICAgIHJbckxlbmd0aCsrXSA9IGkgKyAxOwogICAgfQogIH0KICBpZiAocmVhZG9ubHkpIHsKICAgIHJldHVybiBjcmVhdGVVaW50QXJyYXkocik7CiAgfSBlbHNlIHsKICAgIHJldHVybiByOwogIH0KfQpleHBvcnQgZnVuY3Rpb24gY3JlYXRlTGluZVN0YXJ0cyhyLCBzdHIpIHsKICByLmxlbmd0aCA9IDA7CiAgclswXSA9IDA7CiAgdmFyIHJMZW5ndGggPSAxOwogIHZhciBjciA9IDAsCiAgICBsZiA9IDAsCiAgICBjcmxmID0gMDsKICB2YXIgaXNCYXNpY0FTQ0lJID0gdHJ1ZTsKICBmb3IgKHZhciBpID0gMCwgbGVuID0gc3RyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICB2YXIgY2hyID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICBpZiAoY2hyID09PSAxMyAvKiBDaGFyQ29kZS5DYXJyaWFnZVJldHVybiAqLykgewogICAgICBpZiAoaSArIDEgPCBsZW4gJiYgc3RyLmNoYXJDb2RlQXQoaSArIDEpID09PSAxMCAvKiBDaGFyQ29kZS5MaW5lRmVlZCAqLykgewogICAgICAgIC8vIFxyXG4uLi4gY2FzZQogICAgICAgIGNybGYrKzsKICAgICAgICByW3JMZW5ndGgrK10gPSBpICsgMjsKICAgICAgICBpKys7IC8vIHNraXAgXG4KICAgICAgfSBlbHNlIHsKICAgICAgICBjcisrOwogICAgICAgIC8vIFxyLi4uIGNhc2UKICAgICAgICByW3JMZW5ndGgrK10gPSBpICsgMTsKICAgICAgfQogICAgfSBlbHNlIGlmIChjaHIgPT09IDEwIC8qIENoYXJDb2RlLkxpbmVGZWVkICovKSB7CiAgICAgIGxmKys7CiAgICAgIHJbckxlbmd0aCsrXSA9IGkgKyAxOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGlzQmFzaWNBU0NJSSkgewogICAgICAgIGlmIChjaHIgIT09IDkgLyogQ2hhckNvZGUuVGFiICovICYmIChjaHIgPCAzMiB8fCBjaHIgPiAxMjYpKSB7CiAgICAgICAgICBpc0Jhc2ljQVNDSUkgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgdmFyIHJlc3VsdCA9IG5ldyBMaW5lU3RhcnRzKGNyZWF0ZVVpbnRBcnJheShyKSwgY3IsIGxmLCBjcmxmLCBpc0Jhc2ljQVNDSUkpOwogIHIubGVuZ3RoID0gMDsKICByZXR1cm4gcmVzdWx0Owp9CmV4cG9ydCB2YXIgUGllY2UgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZUNsYXNzKGZ1bmN0aW9uIFBpZWNlKGJ1ZmZlckluZGV4LCBzdGFydCwgZW5kLCBsaW5lRmVlZENudCwgbGVuZ3RoKSB7CiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBpZWNlKTsKICB0aGlzLmJ1ZmZlckluZGV4ID0gYnVmZmVySW5kZXg7CiAgdGhpcy5zdGFydCA9IHN0YXJ0OwogIHRoaXMuZW5kID0gZW5kOwogIHRoaXMubGluZUZlZWRDbnQgPSBsaW5lRmVlZENudDsKICB0aGlzLmxlbmd0aCA9IGxlbmd0aDsKfSk7CmV4cG9ydCB2YXIgU3RyaW5nQnVmZmVyID0gLyojX19QVVJFX18qL19jcmVhdGVDbGFzcyhmdW5jdGlvbiBTdHJpbmdCdWZmZXIoYnVmZmVyLCBsaW5lU3RhcnRzKSB7CiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0cmluZ0J1ZmZlcik7CiAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgdGhpcy5saW5lU3RhcnRzID0gbGluZVN0YXJ0czsKfSk7Ci8qKgogKiBSZWFkb25seSBzbmFwc2hvdCBmb3IgcGllY2UgdHJlZS4KICogSW4gYSByZWFsIG11bHRpcGxlIHRocmVhZCBlbnZpcm9ubWVudCwgdG8gbWFrZSBzbmFwc2hvdCByZWFkaW5nIGFsd2F5cyB3b3JrIGNvcnJlY3RseSwgd2UgbmVlZCB0bwogKiAxLiBNYWtlIFRyZWVOb2RlLnBpZWNlIGltbXV0YWJsZSwgdGhlbiByZWFkaW5nIGFuZCB3cml0aW5nIGNhbiBydW4gaW4gcGFyYWxsZWwuCiAqIDIuIFRyZWVOb2RlL0J1ZmZlcnMgbm9ybWFsaXphdGlvbiBzaG91bGQgbm90IGhhcHBlbiBkdXJpbmcgc25hcHNob3QgcmVhZGluZy4KICovCnZhciBQaWVjZVRyZWVTbmFwc2hvdCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUGllY2VUcmVlU25hcHNob3QodHJlZSwgQk9NKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBpZWNlVHJlZVNuYXBzaG90KTsKICAgIHRoaXMuX3BpZWNlcyA9IFtdOwogICAgdGhpcy5fdHJlZSA9IHRyZWU7CiAgICB0aGlzLl9CT00gPSBCT007CiAgICB0aGlzLl9pbmRleCA9IDA7CiAgICBpZiAodHJlZS5yb290ICE9PSBTRU5USU5FTCkgewogICAgICB0cmVlLml0ZXJhdGUodHJlZS5yb290LCBmdW5jdGlvbiAobm9kZSkgewogICAgICAgIGlmIChub2RlICE9PSBTRU5USU5FTCkgewogICAgICAgICAgX3RoaXMuX3BpZWNlcy5wdXNoKG5vZGUucGllY2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CiAgICB9CiAgfQogIF9jcmVhdGVDbGFzcyhQaWVjZVRyZWVTbmFwc2hvdCwgW3sKICAgIGtleTogInJlYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlYWQoKSB7CiAgICAgIGlmICh0aGlzLl9waWVjZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgaWYgKHRoaXMuX2luZGV4ID09PSAwKSB7CiAgICAgICAgICB0aGlzLl9pbmRleCsrOwogICAgICAgICAgcmV0dXJuIHRoaXMuX0JPTTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLl9pbmRleCA+IHRoaXMuX3BpZWNlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX2luZGV4ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0JPTSArIHRoaXMuX3RyZWUuZ2V0UGllY2VDb250ZW50KHRoaXMuX3BpZWNlc1t0aGlzLl9pbmRleCsrXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3RyZWUuZ2V0UGllY2VDb250ZW50KHRoaXMuX3BpZWNlc1t0aGlzLl9pbmRleCsrXSk7CiAgICB9CiAgfV0pOwogIHJldHVybiBQaWVjZVRyZWVTbmFwc2hvdDsKfSgpOwp2YXIgUGllY2VUcmVlU2VhcmNoQ2FjaGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFBpZWNlVHJlZVNlYXJjaENhY2hlKGxpbWl0KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGllY2VUcmVlU2VhcmNoQ2FjaGUpOwogICAgdGhpcy5fbGltaXQgPSBsaW1pdDsKICAgIHRoaXMuX2NhY2hlID0gW107CiAgfQogIF9jcmVhdGVDbGFzcyhQaWVjZVRyZWVTZWFyY2hDYWNoZSwgW3sKICAgIGtleTogImdldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0KG9mZnNldCkgewogICAgICBmb3IgKHZhciBpID0gdGhpcy5fY2FjaGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB2YXIgbm9kZVBvcyA9IHRoaXMuX2NhY2hlW2ldOwogICAgICAgIGlmIChub2RlUG9zLm5vZGVTdGFydE9mZnNldCA8PSBvZmZzZXQgJiYgbm9kZVBvcy5ub2RlU3RhcnRPZmZzZXQgKyBub2RlUG9zLm5vZGUucGllY2UubGVuZ3RoID49IG9mZnNldCkgewogICAgICAgICAgcmV0dXJuIG5vZGVQb3M7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogImdldDIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldDIobGluZU51bWJlcikgewogICAgICBmb3IgKHZhciBpID0gdGhpcy5fY2FjaGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB2YXIgbm9kZVBvcyA9IHRoaXMuX2NhY2hlW2ldOwogICAgICAgIGlmIChub2RlUG9zLm5vZGVTdGFydExpbmVOdW1iZXIgJiYgbm9kZVBvcy5ub2RlU3RhcnRMaW5lTnVtYmVyIDwgbGluZU51bWJlciAmJiBub2RlUG9zLm5vZGVTdGFydExpbmVOdW1iZXIgKyBub2RlUG9zLm5vZGUucGllY2UubGluZUZlZWRDbnQgPj0gbGluZU51bWJlcikgewogICAgICAgICAgcmV0dXJuIG5vZGVQb3M7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInNldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0KG5vZGVQb3NpdGlvbikgewogICAgICBpZiAodGhpcy5fY2FjaGUubGVuZ3RoID49IHRoaXMuX2xpbWl0KSB7CiAgICAgICAgdGhpcy5fY2FjaGUuc2hpZnQoKTsKICAgICAgfQogICAgICB0aGlzLl9jYWNoZS5wdXNoKG5vZGVQb3NpdGlvbik7CiAgICB9CiAgfSwgewogICAga2V5OiAidmFsaWRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlKG9mZnNldCkgewogICAgICB2YXIgaGFzSW52YWxpZFZhbCA9IGZhbHNlOwogICAgICB2YXIgdG1wID0gdGhpcy5fY2FjaGU7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG1wLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIG5vZGVQb3MgPSB0bXBbaV07CiAgICAgICAgaWYgKG5vZGVQb3Mubm9kZS5wYXJlbnQgPT09IG51bGwgfHwgbm9kZVBvcy5ub2RlU3RhcnRPZmZzZXQgPj0gb2Zmc2V0KSB7CiAgICAgICAgICB0bXBbaV0gPSBudWxsOwogICAgICAgICAgaGFzSW52YWxpZFZhbCA9IHRydWU7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGhhc0ludmFsaWRWYWwpIHsKICAgICAgICB2YXIgbmV3QXJyID0gW107CiAgICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRtcCksCiAgICAgICAgICBfc3RlcDsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgIGlmIChlbnRyeSAhPT0gbnVsbCkgewogICAgICAgICAgICAgIG5ld0Fyci5wdXNoKGVudHJ5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY2FjaGUgPSBuZXdBcnI7CiAgICAgIH0KICAgIH0KICB9XSk7CiAgcmV0dXJuIFBpZWNlVHJlZVNlYXJjaENhY2hlOwp9KCk7CmV4cG9ydCB2YXIgUGllY2VUcmVlQmFzZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUGllY2VUcmVlQmFzZShjaHVua3MsIGVvbCwgZW9sTm9ybWFsaXplZCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBpZWNlVHJlZUJhc2UpOwogICAgdGhpcy5jcmVhdGUoY2h1bmtzLCBlb2wsIGVvbE5vcm1hbGl6ZWQpOwogIH0KICBfY3JlYXRlQ2xhc3MoUGllY2VUcmVlQmFzZSwgW3sKICAgIGtleTogImNyZWF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKGNodW5rcywgZW9sLCBlb2xOb3JtYWxpemVkKSB7CiAgICAgIHRoaXMuX2J1ZmZlcnMgPSBbbmV3IFN0cmluZ0J1ZmZlcignJywgWzBdKV07CiAgICAgIHRoaXMuX2xhc3RDaGFuZ2VCdWZmZXJQb3MgPSB7CiAgICAgICAgbGluZTogMCwKICAgICAgICBjb2x1bW46IDAKICAgICAgfTsKICAgICAgdGhpcy5yb290ID0gU0VOVElORUw7CiAgICAgIHRoaXMuX2xpbmVDbnQgPSAxOwogICAgICB0aGlzLl9sZW5ndGggPSAwOwogICAgICB0aGlzLl9FT0wgPSBlb2w7CiAgICAgIHRoaXMuX0VPTExlbmd0aCA9IGVvbC5sZW5ndGg7CiAgICAgIHRoaXMuX0VPTE5vcm1hbGl6ZWQgPSBlb2xOb3JtYWxpemVkOwogICAgICB2YXIgbGFzdE5vZGUgPSBudWxsOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2h1bmtzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGNodW5rc1tpXS5idWZmZXIubGVuZ3RoID4gMCkgewogICAgICAgICAgaWYgKCFjaHVua3NbaV0ubGluZVN0YXJ0cykgewogICAgICAgICAgICBjaHVua3NbaV0ubGluZVN0YXJ0cyA9IGNyZWF0ZUxpbmVTdGFydHNGYXN0KGNodW5rc1tpXS5idWZmZXIpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHBpZWNlID0gbmV3IFBpZWNlKGkgKyAxLCB7CiAgICAgICAgICAgIGxpbmU6IDAsCiAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgfSwgewogICAgICAgICAgICBsaW5lOiBjaHVua3NbaV0ubGluZVN0YXJ0cy5sZW5ndGggLSAxLAogICAgICAgICAgICBjb2x1bW46IGNodW5rc1tpXS5idWZmZXIubGVuZ3RoIC0gY2h1bmtzW2ldLmxpbmVTdGFydHNbY2h1bmtzW2ldLmxpbmVTdGFydHMubGVuZ3RoIC0gMV0KICAgICAgICAgIH0sIGNodW5rc1tpXS5saW5lU3RhcnRzLmxlbmd0aCAtIDEsIGNodW5rc1tpXS5idWZmZXIubGVuZ3RoKTsKICAgICAgICAgIHRoaXMuX2J1ZmZlcnMucHVzaChjaHVua3NbaV0pOwogICAgICAgICAgbGFzdE5vZGUgPSB0aGlzLnJiSW5zZXJ0UmlnaHQobGFzdE5vZGUsIHBpZWNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5fc2VhcmNoQ2FjaGUgPSBuZXcgUGllY2VUcmVlU2VhcmNoQ2FjaGUoMSk7CiAgICAgIHRoaXMuX2xhc3RWaXNpdGVkTGluZSA9IHsKICAgICAgICBsaW5lTnVtYmVyOiAwLAogICAgICAgIHZhbHVlOiAnJwogICAgICB9OwogICAgICB0aGlzLmNvbXB1dGVCdWZmZXJNZXRhZGF0YSgpOwogICAgfQogIH0sIHsKICAgIGtleTogIm5vcm1hbGl6ZUVPTCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbm9ybWFsaXplRU9MKGVvbCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgdmFyIGF2ZXJhZ2VCdWZmZXJTaXplID0gQXZlcmFnZUJ1ZmZlclNpemU7CiAgICAgIHZhciBtaW4gPSBhdmVyYWdlQnVmZmVyU2l6ZSAtIE1hdGguZmxvb3IoYXZlcmFnZUJ1ZmZlclNpemUgLyAzKTsKICAgICAgdmFyIG1heCA9IG1pbiAqIDI7CiAgICAgIHZhciB0ZW1wQ2h1bmsgPSAnJzsKICAgICAgdmFyIHRlbXBDaHVua0xlbiA9IDA7CiAgICAgIHZhciBjaHVua3MgPSBbXTsKICAgICAgdGhpcy5pdGVyYXRlKHRoaXMucm9vdCwgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICB2YXIgc3RyID0gX3RoaXMyLmdldE5vZGVDb250ZW50KG5vZGUpOwogICAgICAgIHZhciBsZW4gPSBzdHIubGVuZ3RoOwogICAgICAgIGlmICh0ZW1wQ2h1bmtMZW4gPD0gbWluIHx8IHRlbXBDaHVua0xlbiArIGxlbiA8IG1heCkgewogICAgICAgICAgdGVtcENodW5rICs9IHN0cjsKICAgICAgICAgIHRlbXBDaHVua0xlbiArPSBsZW47CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgLy8gZmx1c2ggYW55d2F5cwogICAgICAgIHZhciB0ZXh0ID0gdGVtcENodW5rLnJlcGxhY2UoL1xyXG58XHJ8XG4vZywgZW9sKTsKICAgICAgICBjaHVua3MucHVzaChuZXcgU3RyaW5nQnVmZmVyKHRleHQsIGNyZWF0ZUxpbmVTdGFydHNGYXN0KHRleHQpKSk7CiAgICAgICAgdGVtcENodW5rID0gc3RyOwogICAgICAgIHRlbXBDaHVua0xlbiA9IGxlbjsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CiAgICAgIGlmICh0ZW1wQ2h1bmtMZW4gPiAwKSB7CiAgICAgICAgdmFyIHRleHQgPSB0ZW1wQ2h1bmsucmVwbGFjZSgvXHJcbnxccnxcbi9nLCBlb2wpOwogICAgICAgIGNodW5rcy5wdXNoKG5ldyBTdHJpbmdCdWZmZXIodGV4dCwgY3JlYXRlTGluZVN0YXJ0c0Zhc3QodGV4dCkpKTsKICAgICAgfQogICAgICB0aGlzLmNyZWF0ZShjaHVua3MsIGVvbCwgdHJ1ZSk7CiAgICB9CiAgICAvLyAjcmVnaW9uIEJ1ZmZlciBBUEkKICB9LCB7CiAgICBrZXk6ICJnZXRFT0wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVPTCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX0VPTDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRFT0wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEVPTChuZXdFT0wpIHsKICAgICAgdGhpcy5fRU9MID0gbmV3RU9MOwogICAgICB0aGlzLl9FT0xMZW5ndGggPSB0aGlzLl9FT0wubGVuZ3RoOwogICAgICB0aGlzLm5vcm1hbGl6ZUVPTChuZXdFT0wpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZVNuYXBzaG90IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVTbmFwc2hvdChCT00pIHsKICAgICAgcmV0dXJuIG5ldyBQaWVjZVRyZWVTbmFwc2hvdCh0aGlzLCBCT00pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldE9mZnNldEF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPZmZzZXRBdChsaW5lTnVtYmVyLCBjb2x1bW4pIHsKICAgICAgdmFyIGxlZnRMZW4gPSAwOyAvLyBpbm9yZGVyCiAgICAgIHZhciB4ID0gdGhpcy5yb290OwogICAgICB3aGlsZSAoeCAhPT0gU0VOVElORUwpIHsKICAgICAgICBpZiAoeC5sZWZ0ICE9PSBTRU5USU5FTCAmJiB4LmxmX2xlZnQgKyAxID49IGxpbmVOdW1iZXIpIHsKICAgICAgICAgIHggPSB4LmxlZnQ7CiAgICAgICAgfSBlbHNlIGlmICh4LmxmX2xlZnQgKyB4LnBpZWNlLmxpbmVGZWVkQ250ICsgMSA+PSBsaW5lTnVtYmVyKSB7CiAgICAgICAgICBsZWZ0TGVuICs9IHguc2l6ZV9sZWZ0OwogICAgICAgICAgLy8gbGluZU51bWJlciA+PSAyCiAgICAgICAgICB2YXIgYWNjdW11YWx0ZWRWYWxJbkN1cnJlbnRJbmRleCA9IHRoaXMuZ2V0QWNjdW11bGF0ZWRWYWx1ZSh4LCBsaW5lTnVtYmVyIC0geC5sZl9sZWZ0IC0gMik7CiAgICAgICAgICByZXR1cm4gbGVmdExlbiArPSBhY2N1bXVhbHRlZFZhbEluQ3VycmVudEluZGV4ICsgY29sdW1uIC0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGluZU51bWJlciAtPSB4LmxmX2xlZnQgKyB4LnBpZWNlLmxpbmVGZWVkQ250OwogICAgICAgICAgbGVmdExlbiArPSB4LnNpemVfbGVmdCArIHgucGllY2UubGVuZ3RoOwogICAgICAgICAgeCA9IHgucmlnaHQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBsZWZ0TGVuOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFBvc2l0aW9uQXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBvc2l0aW9uQXQob2Zmc2V0KSB7CiAgICAgIG9mZnNldCA9IE1hdGguZmxvb3Iob2Zmc2V0KTsKICAgICAgb2Zmc2V0ID0gTWF0aC5tYXgoMCwgb2Zmc2V0KTsKICAgICAgdmFyIHggPSB0aGlzLnJvb3Q7CiAgICAgIHZhciBsZkNudCA9IDA7CiAgICAgIHZhciBvcmlnaW5hbE9mZnNldCA9IG9mZnNldDsKICAgICAgd2hpbGUgKHggIT09IFNFTlRJTkVMKSB7CiAgICAgICAgaWYgKHguc2l6ZV9sZWZ0ICE9PSAwICYmIHguc2l6ZV9sZWZ0ID49IG9mZnNldCkgewogICAgICAgICAgeCA9IHgubGVmdDsKICAgICAgICB9IGVsc2UgaWYgKHguc2l6ZV9sZWZ0ICsgeC5waWVjZS5sZW5ndGggPj0gb2Zmc2V0KSB7CiAgICAgICAgICB2YXIgb3V0ID0gdGhpcy5nZXRJbmRleE9mKHgsIG9mZnNldCAtIHguc2l6ZV9sZWZ0KTsKICAgICAgICAgIGxmQ250ICs9IHgubGZfbGVmdCArIG91dC5pbmRleDsKICAgICAgICAgIGlmIChvdXQuaW5kZXggPT09IDApIHsKICAgICAgICAgICAgdmFyIGxpbmVTdGFydE9mZnNldCA9IHRoaXMuZ2V0T2Zmc2V0QXQobGZDbnQgKyAxLCAxKTsKICAgICAgICAgICAgdmFyIGNvbHVtbiA9IG9yaWdpbmFsT2Zmc2V0IC0gbGluZVN0YXJ0T2Zmc2V0OwogICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKGxmQ250ICsgMSwgY29sdW1uICsgMSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKGxmQ250ICsgMSwgb3V0LnJlbWFpbmRlciArIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvZmZzZXQgLT0geC5zaXplX2xlZnQgKyB4LnBpZWNlLmxlbmd0aDsKICAgICAgICAgIGxmQ250ICs9IHgubGZfbGVmdCArIHgucGllY2UubGluZUZlZWRDbnQ7CiAgICAgICAgICBpZiAoeC5yaWdodCA9PT0gU0VOVElORUwpIHsKICAgICAgICAgICAgLy8gbGFzdCBub2RlCiAgICAgICAgICAgIHZhciBfbGluZVN0YXJ0T2Zmc2V0ID0gdGhpcy5nZXRPZmZzZXRBdChsZkNudCArIDEsIDEpOwogICAgICAgICAgICB2YXIgX2NvbHVtbiA9IG9yaWdpbmFsT2Zmc2V0IC0gb2Zmc2V0IC0gX2xpbmVTdGFydE9mZnNldDsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbihsZkNudCArIDEsIF9jb2x1bW4gKyAxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHggPSB4LnJpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKDEsIDEpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZhbHVlSW5SYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWVJblJhbmdlKHJhbmdlLCBlb2wpIHsKICAgICAgaWYgKHJhbmdlLnN0YXJ0TGluZU51bWJlciA9PT0gcmFuZ2UuZW5kTGluZU51bWJlciAmJiByYW5nZS5zdGFydENvbHVtbiA9PT0gcmFuZ2UuZW5kQ29sdW1uKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CiAgICAgIHZhciBzdGFydFBvc2l0aW9uID0gdGhpcy5ub2RlQXQyKHJhbmdlLnN0YXJ0TGluZU51bWJlciwgcmFuZ2Uuc3RhcnRDb2x1bW4pOwogICAgICB2YXIgZW5kUG9zaXRpb24gPSB0aGlzLm5vZGVBdDIocmFuZ2UuZW5kTGluZU51bWJlciwgcmFuZ2UuZW5kQ29sdW1uKTsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXRWYWx1ZUluUmFuZ2UyKHN0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uKTsKICAgICAgaWYgKGVvbCkgewogICAgICAgIGlmIChlb2wgIT09IHRoaXMuX0VPTCB8fCAhdGhpcy5fRU9MTm9ybWFsaXplZCkgewogICAgICAgICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoL1xyXG58XHJ8XG4vZywgZW9sKTsKICAgICAgICB9CiAgICAgICAgaWYgKGVvbCA9PT0gdGhpcy5nZXRFT0woKSAmJiB0aGlzLl9FT0xOb3JtYWxpemVkKSB7CiAgICAgICAgICBpZiAoZW9sID09PSAnXHJcbicpIHt9CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKC9cclxufFxyfFxuL2csIGVvbCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZhbHVlSW5SYW5nZTIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlSW5SYW5nZTIoc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pIHsKICAgICAgaWYgKHN0YXJ0UG9zaXRpb24ubm9kZSA9PT0gZW5kUG9zaXRpb24ubm9kZSkgewogICAgICAgIHZhciBub2RlID0gc3RhcnRQb3NpdGlvbi5ub2RlOwogICAgICAgIHZhciBfYnVmZmVyID0gdGhpcy5fYnVmZmVyc1tub2RlLnBpZWNlLmJ1ZmZlckluZGV4XS5idWZmZXI7CiAgICAgICAgdmFyIF9zdGFydE9mZnNldCA9IHRoaXMub2Zmc2V0SW5CdWZmZXIobm9kZS5waWVjZS5idWZmZXJJbmRleCwgbm9kZS5waWVjZS5zdGFydCk7CiAgICAgICAgcmV0dXJuIF9idWZmZXIuc3Vic3RyaW5nKF9zdGFydE9mZnNldCArIHN0YXJ0UG9zaXRpb24ucmVtYWluZGVyLCBfc3RhcnRPZmZzZXQgKyBlbmRQb3NpdGlvbi5yZW1haW5kZXIpOwogICAgICB9CiAgICAgIHZhciB4ID0gc3RhcnRQb3NpdGlvbi5ub2RlOwogICAgICB2YXIgYnVmZmVyID0gdGhpcy5fYnVmZmVyc1t4LnBpZWNlLmJ1ZmZlckluZGV4XS5idWZmZXI7CiAgICAgIHZhciBzdGFydE9mZnNldCA9IHRoaXMub2Zmc2V0SW5CdWZmZXIoeC5waWVjZS5idWZmZXJJbmRleCwgeC5waWVjZS5zdGFydCk7CiAgICAgIHZhciByZXQgPSBidWZmZXIuc3Vic3RyaW5nKHN0YXJ0T2Zmc2V0ICsgc3RhcnRQb3NpdGlvbi5yZW1haW5kZXIsIHN0YXJ0T2Zmc2V0ICsgeC5waWVjZS5sZW5ndGgpOwogICAgICB4ID0geC5uZXh0KCk7CiAgICAgIHdoaWxlICh4ICE9PSBTRU5USU5FTCkgewogICAgICAgIHZhciBfYnVmZmVyMiA9IHRoaXMuX2J1ZmZlcnNbeC5waWVjZS5idWZmZXJJbmRleF0uYnVmZmVyOwogICAgICAgIHZhciBfc3RhcnRPZmZzZXQyID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcih4LnBpZWNlLmJ1ZmZlckluZGV4LCB4LnBpZWNlLnN0YXJ0KTsKICAgICAgICBpZiAoeCA9PT0gZW5kUG9zaXRpb24ubm9kZSkgewogICAgICAgICAgcmV0ICs9IF9idWZmZXIyLnN1YnN0cmluZyhfc3RhcnRPZmZzZXQyLCBfc3RhcnRPZmZzZXQyICsgZW5kUG9zaXRpb24ucmVtYWluZGVyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXQgKz0gX2J1ZmZlcjIuc3Vic3RyKF9zdGFydE9mZnNldDIsIHgucGllY2UubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgeCA9IHgubmV4dCgpOwogICAgICB9CiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGluZXNDb250ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lc0NvbnRlbnQoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB2YXIgbGluZXMgPSBbXTsKICAgICAgdmFyIGxpbmVzTGVuZ3RoID0gMDsKICAgICAgdmFyIGN1cnJlbnRMaW5lID0gJyc7CiAgICAgIHZhciBkYW5nbGluZ0NSID0gZmFsc2U7CiAgICAgIHRoaXMuaXRlcmF0ZSh0aGlzLnJvb3QsIGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgaWYgKG5vZGUgPT09IFNFTlRJTkVMKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdmFyIHBpZWNlID0gbm9kZS5waWVjZTsKICAgICAgICB2YXIgcGllY2VMZW5ndGggPSBwaWVjZS5sZW5ndGg7CiAgICAgICAgaWYgKHBpZWNlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgdmFyIGJ1ZmZlciA9IF90aGlzMy5fYnVmZmVyc1twaWVjZS5idWZmZXJJbmRleF0uYnVmZmVyOwogICAgICAgIHZhciBsaW5lU3RhcnRzID0gX3RoaXMzLl9idWZmZXJzW3BpZWNlLmJ1ZmZlckluZGV4XS5saW5lU3RhcnRzOwogICAgICAgIHZhciBwaWVjZVN0YXJ0TGluZSA9IHBpZWNlLnN0YXJ0LmxpbmU7CiAgICAgICAgdmFyIHBpZWNlRW5kTGluZSA9IHBpZWNlLmVuZC5saW5lOwogICAgICAgIHZhciBwaWVjZVN0YXJ0T2Zmc2V0ID0gbGluZVN0YXJ0c1twaWVjZVN0YXJ0TGluZV0gKyBwaWVjZS5zdGFydC5jb2x1bW47CiAgICAgICAgaWYgKGRhbmdsaW5nQ1IpIHsKICAgICAgICAgIGlmIChidWZmZXIuY2hhckNvZGVBdChwaWVjZVN0YXJ0T2Zmc2V0KSA9PT0gMTAgLyogQ2hhckNvZGUuTGluZUZlZWQgKi8pIHsKICAgICAgICAgICAgLy8gcHJldGVuZCB0aGUgXG4gd2FzIGluIHRoZSBwcmV2aW91cyBwaWVjZS4uCiAgICAgICAgICAgIHBpZWNlU3RhcnRPZmZzZXQrKzsKICAgICAgICAgICAgcGllY2VMZW5ndGgtLTsKICAgICAgICAgIH0KICAgICAgICAgIGxpbmVzW2xpbmVzTGVuZ3RoKytdID0gY3VycmVudExpbmU7CiAgICAgICAgICBjdXJyZW50TGluZSA9ICcnOwogICAgICAgICAgZGFuZ2xpbmdDUiA9IGZhbHNlOwogICAgICAgICAgaWYgKHBpZWNlTGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocGllY2VTdGFydExpbmUgPT09IHBpZWNlRW5kTGluZSkgewogICAgICAgICAgLy8gdGhpcyBwaWVjZSBoYXMgbm8gbmV3IGxpbmVzCiAgICAgICAgICBpZiAoIV90aGlzMy5fRU9MTm9ybWFsaXplZCAmJiBidWZmZXIuY2hhckNvZGVBdChwaWVjZVN0YXJ0T2Zmc2V0ICsgcGllY2VMZW5ndGggLSAxKSA9PT0gMTMgLyogQ2hhckNvZGUuQ2FycmlhZ2VSZXR1cm4gKi8pIHsKICAgICAgICAgICAgZGFuZ2xpbmdDUiA9IHRydWU7CiAgICAgICAgICAgIGN1cnJlbnRMaW5lICs9IGJ1ZmZlci5zdWJzdHIocGllY2VTdGFydE9mZnNldCwgcGllY2VMZW5ndGggLSAxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1cnJlbnRMaW5lICs9IGJ1ZmZlci5zdWJzdHIocGllY2VTdGFydE9mZnNldCwgcGllY2VMZW5ndGgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIC8vIGFkZCB0aGUgdGV4dCBiZWZvcmUgdGhlIGZpcnN0IGxpbmUgc3RhcnQgaW4gdGhpcyBwaWVjZQogICAgICAgIGN1cnJlbnRMaW5lICs9IF90aGlzMy5fRU9MTm9ybWFsaXplZCA/IGJ1ZmZlci5zdWJzdHJpbmcocGllY2VTdGFydE9mZnNldCwgTWF0aC5tYXgocGllY2VTdGFydE9mZnNldCwgbGluZVN0YXJ0c1twaWVjZVN0YXJ0TGluZSArIDFdIC0gX3RoaXMzLl9FT0xMZW5ndGgpKSA6IGJ1ZmZlci5zdWJzdHJpbmcocGllY2VTdGFydE9mZnNldCwgbGluZVN0YXJ0c1twaWVjZVN0YXJ0TGluZSArIDFdKS5yZXBsYWNlKC8oXHJcbnxccnxcbikkLywgJycpOwogICAgICAgIGxpbmVzW2xpbmVzTGVuZ3RoKytdID0gY3VycmVudExpbmU7CiAgICAgICAgZm9yICh2YXIgbGluZSA9IHBpZWNlU3RhcnRMaW5lICsgMTsgbGluZSA8IHBpZWNlRW5kTGluZTsgbGluZSsrKSB7CiAgICAgICAgICBjdXJyZW50TGluZSA9IF90aGlzMy5fRU9MTm9ybWFsaXplZCA/IGJ1ZmZlci5zdWJzdHJpbmcobGluZVN0YXJ0c1tsaW5lXSwgbGluZVN0YXJ0c1tsaW5lICsgMV0gLSBfdGhpczMuX0VPTExlbmd0aCkgOiBidWZmZXIuc3Vic3RyaW5nKGxpbmVTdGFydHNbbGluZV0sIGxpbmVTdGFydHNbbGluZSArIDFdKS5yZXBsYWNlKC8oXHJcbnxccnxcbikkLywgJycpOwogICAgICAgICAgbGluZXNbbGluZXNMZW5ndGgrK10gPSBjdXJyZW50TGluZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFfdGhpczMuX0VPTE5vcm1hbGl6ZWQgJiYgYnVmZmVyLmNoYXJDb2RlQXQobGluZVN0YXJ0c1twaWVjZUVuZExpbmVdICsgcGllY2UuZW5kLmNvbHVtbiAtIDEpID09PSAxMyAvKiBDaGFyQ29kZS5DYXJyaWFnZVJldHVybiAqLykgewogICAgICAgICAgZGFuZ2xpbmdDUiA9IHRydWU7CiAgICAgICAgICBpZiAocGllY2UuZW5kLmNvbHVtbiA9PT0gMCkgewogICAgICAgICAgICAvLyBUaGUgbGFzdCBsaW5lIGVuZGVkIHdpdGggYSBcciwgbGV0J3MgdW5kbyB0aGUgcHVzaCwgaXQgd2lsbCBiZSBwdXNoZWQgYnkgbmV4dCBpdGVyYXRpb24KICAgICAgICAgICAgbGluZXNMZW5ndGgtLTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gYnVmZmVyLnN1YnN0cihsaW5lU3RhcnRzW3BpZWNlRW5kTGluZV0sIHBpZWNlLmVuZC5jb2x1bW4gLSAxKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudExpbmUgPSBidWZmZXIuc3Vic3RyKGxpbmVTdGFydHNbcGllY2VFbmRMaW5lXSwgcGllY2UuZW5kLmNvbHVtbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgICAgaWYgKGRhbmdsaW5nQ1IpIHsKICAgICAgICBsaW5lc1tsaW5lc0xlbmd0aCsrXSA9IGN1cnJlbnRMaW5lOwogICAgICAgIGN1cnJlbnRMaW5lID0gJyc7CiAgICAgIH0KICAgICAgbGluZXNbbGluZXNMZW5ndGgrK10gPSBjdXJyZW50TGluZTsKICAgICAgcmV0dXJuIGxpbmVzOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExlbmd0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGVuZ3RoKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVuZ3RoOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExpbmVDb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGluZUNvdW50KCkgewogICAgICByZXR1cm4gdGhpcy5fbGluZUNudDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMaW5lQ29udGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGluZUNvbnRlbnQobGluZU51bWJlcikgewogICAgICBpZiAodGhpcy5fbGFzdFZpc2l0ZWRMaW5lLmxpbmVOdW1iZXIgPT09IGxpbmVOdW1iZXIpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdFZpc2l0ZWRMaW5lLnZhbHVlOwogICAgICB9CiAgICAgIHRoaXMuX2xhc3RWaXNpdGVkTGluZS5saW5lTnVtYmVyID0gbGluZU51bWJlcjsKICAgICAgaWYgKGxpbmVOdW1iZXIgPT09IHRoaXMuX2xpbmVDbnQpIHsKICAgICAgICB0aGlzLl9sYXN0VmlzaXRlZExpbmUudmFsdWUgPSB0aGlzLmdldExpbmVSYXdDb250ZW50KGxpbmVOdW1iZXIpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX0VPTE5vcm1hbGl6ZWQpIHsKICAgICAgICB0aGlzLl9sYXN0VmlzaXRlZExpbmUudmFsdWUgPSB0aGlzLmdldExpbmVSYXdDb250ZW50KGxpbmVOdW1iZXIsIHRoaXMuX0VPTExlbmd0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fbGFzdFZpc2l0ZWRMaW5lLnZhbHVlID0gdGhpcy5nZXRMaW5lUmF3Q29udGVudChsaW5lTnVtYmVyKS5yZXBsYWNlKC8oXHJcbnxccnxcbikkLywgJycpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9sYXN0VmlzaXRlZExpbmUudmFsdWU7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldENoYXJDb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0Q2hhckNvZGUobm9kZVBvcykgewogICAgICBpZiAobm9kZVBvcy5yZW1haW5kZXIgPT09IG5vZGVQb3Mubm9kZS5waWVjZS5sZW5ndGgpIHsKICAgICAgICAvLyB0aGUgY2hhciB3ZSB3YW50IHRvIGZldGNoIGlzIGF0IHRoZSBoZWFkIG9mIG5leHQgbm9kZS4KICAgICAgICB2YXIgbWF0Y2hpbmdOb2RlID0gbm9kZVBvcy5ub2RlLm5leHQoKTsKICAgICAgICBpZiAoIW1hdGNoaW5nTm9kZSkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl9idWZmZXJzW21hdGNoaW5nTm9kZS5waWVjZS5idWZmZXJJbmRleF07CiAgICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihtYXRjaGluZ05vZGUucGllY2UuYnVmZmVySW5kZXgsIG1hdGNoaW5nTm9kZS5waWVjZS5zdGFydCk7CiAgICAgICAgcmV0dXJuIGJ1ZmZlci5idWZmZXIuY2hhckNvZGVBdChzdGFydE9mZnNldCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF9idWZmZXIzID0gdGhpcy5fYnVmZmVyc1tub2RlUG9zLm5vZGUucGllY2UuYnVmZmVySW5kZXhdOwogICAgICAgIHZhciBfc3RhcnRPZmZzZXQzID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihub2RlUG9zLm5vZGUucGllY2UuYnVmZmVySW5kZXgsIG5vZGVQb3Mubm9kZS5waWVjZS5zdGFydCk7CiAgICAgICAgdmFyIHRhcmdldE9mZnNldCA9IF9zdGFydE9mZnNldDMgKyBub2RlUG9zLnJlbWFpbmRlcjsKICAgICAgICByZXR1cm4gX2J1ZmZlcjMuYnVmZmVyLmNoYXJDb2RlQXQodGFyZ2V0T2Zmc2V0KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImdldExpbmVDaGFyQ29kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGluZUNoYXJDb2RlKGxpbmVOdW1iZXIsIGluZGV4KSB7CiAgICAgIHZhciBub2RlUG9zID0gdGhpcy5ub2RlQXQyKGxpbmVOdW1iZXIsIGluZGV4ICsgMSk7CiAgICAgIHJldHVybiB0aGlzLl9nZXRDaGFyQ29kZShub2RlUG9zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMaW5lTGVuZ3RoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lTGVuZ3RoKGxpbmVOdW1iZXIpIHsKICAgICAgaWYgKGxpbmVOdW1iZXIgPT09IHRoaXMuZ2V0TGluZUNvdW50KCkpIHsKICAgICAgICB2YXIgc3RhcnRPZmZzZXQgPSB0aGlzLmdldE9mZnNldEF0KGxpbmVOdW1iZXIsIDEpOwogICAgICAgIHJldHVybiB0aGlzLmdldExlbmd0aCgpIC0gc3RhcnRPZmZzZXQ7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZ2V0T2Zmc2V0QXQobGluZU51bWJlciArIDEsIDEpIC0gdGhpcy5nZXRPZmZzZXRBdChsaW5lTnVtYmVyLCAxKSAtIHRoaXMuX0VPTExlbmd0aDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJmaW5kTWF0Y2hlc0luTm9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZE1hdGNoZXNJbk5vZGUobm9kZSwgc2VhcmNoZXIsIHN0YXJ0TGluZU51bWJlciwgc3RhcnRDb2x1bW4sIHN0YXJ0Q3Vyc29yLCBlbmRDdXJzb3IsIHNlYXJjaERhdGEsIGNhcHR1cmVNYXRjaGVzLCBsaW1pdFJlc3VsdENvdW50LCByZXN1bHRMZW4sIHJlc3VsdCkgewogICAgICB2YXIgYnVmZmVyID0gdGhpcy5fYnVmZmVyc1tub2RlLnBpZWNlLmJ1ZmZlckluZGV4XTsKICAgICAgdmFyIHN0YXJ0T2Zmc2V0SW5CdWZmZXIgPSB0aGlzLm9mZnNldEluQnVmZmVyKG5vZGUucGllY2UuYnVmZmVySW5kZXgsIG5vZGUucGllY2Uuc3RhcnQpOwogICAgICB2YXIgc3RhcnQgPSB0aGlzLm9mZnNldEluQnVmZmVyKG5vZGUucGllY2UuYnVmZmVySW5kZXgsIHN0YXJ0Q3Vyc29yKTsKICAgICAgdmFyIGVuZCA9IHRoaXMub2Zmc2V0SW5CdWZmZXIobm9kZS5waWVjZS5idWZmZXJJbmRleCwgZW5kQ3Vyc29yKTsKICAgICAgdmFyIG07CiAgICAgIC8vIFJlc2V0IHJlZ2V4IHRvIHNlYXJjaCBmcm9tIHRoZSBiZWdpbm5pbmcKICAgICAgdmFyIHJldCA9IHsKICAgICAgICBsaW5lOiAwLAogICAgICAgIGNvbHVtbjogMAogICAgICB9OwogICAgICB2YXIgc2VhcmNoVGV4dDsKICAgICAgdmFyIG9mZnNldEluQnVmZmVyOwogICAgICBpZiAoc2VhcmNoZXIuX3dvcmRTZXBhcmF0b3JzKSB7CiAgICAgICAgc2VhcmNoVGV4dCA9IGJ1ZmZlci5idWZmZXIuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpOwogICAgICAgIG9mZnNldEluQnVmZmVyID0gZnVuY3Rpb24gb2Zmc2V0SW5CdWZmZXIob2Zmc2V0KSB7CiAgICAgICAgICByZXR1cm4gb2Zmc2V0ICsgc3RhcnQ7CiAgICAgICAgfTsKICAgICAgICBzZWFyY2hlci5yZXNldCgwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWFyY2hUZXh0ID0gYnVmZmVyLmJ1ZmZlcjsKICAgICAgICBvZmZzZXRJbkJ1ZmZlciA9IGZ1bmN0aW9uIG9mZnNldEluQnVmZmVyKG9mZnNldCkgewogICAgICAgICAgcmV0dXJuIG9mZnNldDsKICAgICAgICB9OwogICAgICAgIHNlYXJjaGVyLnJlc2V0KHN0YXJ0KTsKICAgICAgfQogICAgICBkbyB7CiAgICAgICAgbSA9IHNlYXJjaGVyLm5leHQoc2VhcmNoVGV4dCk7CiAgICAgICAgaWYgKG0pIHsKICAgICAgICAgIGlmIChvZmZzZXRJbkJ1ZmZlcihtLmluZGV4KSA+PSBlbmQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdExlbjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMucG9zaXRpb25JbkJ1ZmZlcihub2RlLCBvZmZzZXRJbkJ1ZmZlcihtLmluZGV4KSAtIHN0YXJ0T2Zmc2V0SW5CdWZmZXIsIHJldCk7CiAgICAgICAgICB2YXIgbGluZUZlZWRDbnQgPSB0aGlzLmdldExpbmVGZWVkQ250KG5vZGUucGllY2UuYnVmZmVySW5kZXgsIHN0YXJ0Q3Vyc29yLCByZXQpOwogICAgICAgICAgdmFyIHJldFN0YXJ0Q29sdW1uID0gcmV0LmxpbmUgPT09IHN0YXJ0Q3Vyc29yLmxpbmUgPyByZXQuY29sdW1uIC0gc3RhcnRDdXJzb3IuY29sdW1uICsgc3RhcnRDb2x1bW4gOiByZXQuY29sdW1uICsgMTsKICAgICAgICAgIHZhciByZXRFbmRDb2x1bW4gPSByZXRTdGFydENvbHVtbiArIG1bMF0ubGVuZ3RoOwogICAgICAgICAgcmVzdWx0W3Jlc3VsdExlbisrXSA9IGNyZWF0ZUZpbmRNYXRjaChuZXcgUmFuZ2Uoc3RhcnRMaW5lTnVtYmVyICsgbGluZUZlZWRDbnQsIHJldFN0YXJ0Q29sdW1uLCBzdGFydExpbmVOdW1iZXIgKyBsaW5lRmVlZENudCwgcmV0RW5kQ29sdW1uKSwgbSwgY2FwdHVyZU1hdGNoZXMpOwogICAgICAgICAgaWYgKG9mZnNldEluQnVmZmVyKG0uaW5kZXgpICsgbVswXS5sZW5ndGggPj0gZW5kKSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHRMZW47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzdWx0TGVuID49IGxpbWl0UmVzdWx0Q291bnQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdExlbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gd2hpbGUgKG0pOwogICAgICByZXR1cm4gcmVzdWx0TGVuOwogICAgfQogIH0sIHsKICAgIGtleTogImZpbmRNYXRjaGVzTGluZUJ5TGluZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZE1hdGNoZXNMaW5lQnlMaW5lKHNlYXJjaFJhbmdlLCBzZWFyY2hEYXRhLCBjYXB0dXJlTWF0Y2hlcywgbGltaXRSZXN1bHRDb3VudCkgewogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgIHZhciByZXN1bHRMZW4gPSAwOwogICAgICB2YXIgc2VhcmNoZXIgPSBuZXcgU2VhcmNoZXIoc2VhcmNoRGF0YS53b3JkU2VwYXJhdG9ycywgc2VhcmNoRGF0YS5yZWdleCk7CiAgICAgIHZhciBzdGFydFBvc2l0aW9uID0gdGhpcy5ub2RlQXQyKHNlYXJjaFJhbmdlLnN0YXJ0TGluZU51bWJlciwgc2VhcmNoUmFuZ2Uuc3RhcnRDb2x1bW4pOwogICAgICBpZiAoc3RhcnRQb3NpdGlvbiA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICB2YXIgZW5kUG9zaXRpb24gPSB0aGlzLm5vZGVBdDIoc2VhcmNoUmFuZ2UuZW5kTGluZU51bWJlciwgc2VhcmNoUmFuZ2UuZW5kQ29sdW1uKTsKICAgICAgaWYgKGVuZFBvc2l0aW9uID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIHZhciBzdGFydCA9IHRoaXMucG9zaXRpb25JbkJ1ZmZlcihzdGFydFBvc2l0aW9uLm5vZGUsIHN0YXJ0UG9zaXRpb24ucmVtYWluZGVyKTsKICAgICAgdmFyIGVuZCA9IHRoaXMucG9zaXRpb25JbkJ1ZmZlcihlbmRQb3NpdGlvbi5ub2RlLCBlbmRQb3NpdGlvbi5yZW1haW5kZXIpOwogICAgICBpZiAoc3RhcnRQb3NpdGlvbi5ub2RlID09PSBlbmRQb3NpdGlvbi5ub2RlKSB7CiAgICAgICAgdGhpcy5maW5kTWF0Y2hlc0luTm9kZShzdGFydFBvc2l0aW9uLm5vZGUsIHNlYXJjaGVyLCBzZWFyY2hSYW5nZS5zdGFydExpbmVOdW1iZXIsIHNlYXJjaFJhbmdlLnN0YXJ0Q29sdW1uLCBzdGFydCwgZW5kLCBzZWFyY2hEYXRhLCBjYXB0dXJlTWF0Y2hlcywgbGltaXRSZXN1bHRDb3VudCwgcmVzdWx0TGVuLCByZXN1bHQpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgdmFyIHN0YXJ0TGluZU51bWJlciA9IHNlYXJjaFJhbmdlLnN0YXJ0TGluZU51bWJlcjsKICAgICAgdmFyIGN1cnJlbnROb2RlID0gc3RhcnRQb3NpdGlvbi5ub2RlOwogICAgICB3aGlsZSAoY3VycmVudE5vZGUgIT09IGVuZFBvc2l0aW9uLm5vZGUpIHsKICAgICAgICB2YXIgbGluZUJyZWFrQ250ID0gdGhpcy5nZXRMaW5lRmVlZENudChjdXJyZW50Tm9kZS5waWVjZS5idWZmZXJJbmRleCwgc3RhcnQsIGN1cnJlbnROb2RlLnBpZWNlLmVuZCk7CiAgICAgICAgaWYgKGxpbmVCcmVha0NudCA+PSAxKSB7CiAgICAgICAgICAvLyBsYXN0IGxpbmUgYnJlYWsgcG9zaXRpb24KICAgICAgICAgIHZhciBsaW5lU3RhcnRzID0gdGhpcy5fYnVmZmVyc1tjdXJyZW50Tm9kZS5waWVjZS5idWZmZXJJbmRleF0ubGluZVN0YXJ0czsKICAgICAgICAgIHZhciBzdGFydE9mZnNldEluQnVmZmVyID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihjdXJyZW50Tm9kZS5waWVjZS5idWZmZXJJbmRleCwgY3VycmVudE5vZGUucGllY2Uuc3RhcnQpOwogICAgICAgICAgdmFyIG5leHRMaW5lU3RhcnRPZmZzZXQgPSBsaW5lU3RhcnRzW3N0YXJ0LmxpbmUgKyBsaW5lQnJlYWtDbnRdOwogICAgICAgICAgdmFyIF9zdGFydENvbHVtbjIgPSBzdGFydExpbmVOdW1iZXIgPT09IHNlYXJjaFJhbmdlLnN0YXJ0TGluZU51bWJlciA/IHNlYXJjaFJhbmdlLnN0YXJ0Q29sdW1uIDogMTsKICAgICAgICAgIHJlc3VsdExlbiA9IHRoaXMuZmluZE1hdGNoZXNJbk5vZGUoY3VycmVudE5vZGUsIHNlYXJjaGVyLCBzdGFydExpbmVOdW1iZXIsIF9zdGFydENvbHVtbjIsIHN0YXJ0LCB0aGlzLnBvc2l0aW9uSW5CdWZmZXIoY3VycmVudE5vZGUsIG5leHRMaW5lU3RhcnRPZmZzZXQgLSBzdGFydE9mZnNldEluQnVmZmVyKSwgc2VhcmNoRGF0YSwgY2FwdHVyZU1hdGNoZXMsIGxpbWl0UmVzdWx0Q291bnQsIHJlc3VsdExlbiwgcmVzdWx0KTsKICAgICAgICAgIGlmIChyZXN1bHRMZW4gPj0gbGltaXRSZXN1bHRDb3VudCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgc3RhcnRMaW5lTnVtYmVyICs9IGxpbmVCcmVha0NudDsKICAgICAgICB9CiAgICAgICAgdmFyIF9zdGFydENvbHVtbiA9IHN0YXJ0TGluZU51bWJlciA9PT0gc2VhcmNoUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyID8gc2VhcmNoUmFuZ2Uuc3RhcnRDb2x1bW4gLSAxIDogMDsKICAgICAgICAvLyBzZWFyY2ggZm9yIHRoZSByZW1haW5pbmcgY29udGVudAogICAgICAgIGlmIChzdGFydExpbmVOdW1iZXIgPT09IHNlYXJjaFJhbmdlLmVuZExpbmVOdW1iZXIpIHsKICAgICAgICAgIHZhciB0ZXh0ID0gdGhpcy5nZXRMaW5lQ29udGVudChzdGFydExpbmVOdW1iZXIpLnN1YnN0cmluZyhfc3RhcnRDb2x1bW4sIHNlYXJjaFJhbmdlLmVuZENvbHVtbiAtIDEpOwogICAgICAgICAgcmVzdWx0TGVuID0gdGhpcy5fZmluZE1hdGNoZXNJbkxpbmUoc2VhcmNoRGF0YSwgc2VhcmNoZXIsIHRleHQsIHNlYXJjaFJhbmdlLmVuZExpbmVOdW1iZXIsIF9zdGFydENvbHVtbiwgcmVzdWx0TGVuLCByZXN1bHQsIGNhcHR1cmVNYXRjaGVzLCBsaW1pdFJlc3VsdENvdW50KTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHJlc3VsdExlbiA9IHRoaXMuX2ZpbmRNYXRjaGVzSW5MaW5lKHNlYXJjaERhdGEsIHNlYXJjaGVyLCB0aGlzLmdldExpbmVDb250ZW50KHN0YXJ0TGluZU51bWJlcikuc3Vic3RyKF9zdGFydENvbHVtbiksIHN0YXJ0TGluZU51bWJlciwgX3N0YXJ0Q29sdW1uLCByZXN1bHRMZW4sIHJlc3VsdCwgY2FwdHVyZU1hdGNoZXMsIGxpbWl0UmVzdWx0Q291bnQpOwogICAgICAgIGlmIChyZXN1bHRMZW4gPj0gbGltaXRSZXN1bHRDb3VudCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgc3RhcnRMaW5lTnVtYmVyKys7CiAgICAgICAgc3RhcnRQb3NpdGlvbiA9IHRoaXMubm9kZUF0MihzdGFydExpbmVOdW1iZXIsIDEpOwogICAgICAgIGN1cnJlbnROb2RlID0gc3RhcnRQb3NpdGlvbi5ub2RlOwogICAgICAgIHN0YXJ0ID0gdGhpcy5wb3NpdGlvbkluQnVmZmVyKHN0YXJ0UG9zaXRpb24ubm9kZSwgc3RhcnRQb3NpdGlvbi5yZW1haW5kZXIpOwogICAgICB9CiAgICAgIGlmIChzdGFydExpbmVOdW1iZXIgPT09IHNlYXJjaFJhbmdlLmVuZExpbmVOdW1iZXIpIHsKICAgICAgICB2YXIgX3N0YXJ0Q29sdW1uMyA9IHN0YXJ0TGluZU51bWJlciA9PT0gc2VhcmNoUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyID8gc2VhcmNoUmFuZ2Uuc3RhcnRDb2x1bW4gLSAxIDogMDsKICAgICAgICB2YXIgX3RleHQgPSB0aGlzLmdldExpbmVDb250ZW50KHN0YXJ0TGluZU51bWJlcikuc3Vic3RyaW5nKF9zdGFydENvbHVtbjMsIHNlYXJjaFJhbmdlLmVuZENvbHVtbiAtIDEpOwogICAgICAgIHJlc3VsdExlbiA9IHRoaXMuX2ZpbmRNYXRjaGVzSW5MaW5lKHNlYXJjaERhdGEsIHNlYXJjaGVyLCBfdGV4dCwgc2VhcmNoUmFuZ2UuZW5kTGluZU51bWJlciwgX3N0YXJ0Q29sdW1uMywgcmVzdWx0TGVuLCByZXN1bHQsIGNhcHR1cmVNYXRjaGVzLCBsaW1pdFJlc3VsdENvdW50KTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIHZhciBzdGFydENvbHVtbiA9IHN0YXJ0TGluZU51bWJlciA9PT0gc2VhcmNoUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyID8gc2VhcmNoUmFuZ2Uuc3RhcnRDb2x1bW4gOiAxOwogICAgICByZXN1bHRMZW4gPSB0aGlzLmZpbmRNYXRjaGVzSW5Ob2RlKGVuZFBvc2l0aW9uLm5vZGUsIHNlYXJjaGVyLCBzdGFydExpbmVOdW1iZXIsIHN0YXJ0Q29sdW1uLCBzdGFydCwgZW5kLCBzZWFyY2hEYXRhLCBjYXB0dXJlTWF0Y2hlcywgbGltaXRSZXN1bHRDb3VudCwgcmVzdWx0TGVuLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0sIHsKICAgIGtleTogIl9maW5kTWF0Y2hlc0luTGluZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRNYXRjaGVzSW5MaW5lKHNlYXJjaERhdGEsIHNlYXJjaGVyLCB0ZXh0LCBsaW5lTnVtYmVyLCBkZWx0YU9mZnNldCwgcmVzdWx0TGVuLCByZXN1bHQsIGNhcHR1cmVNYXRjaGVzLCBsaW1pdFJlc3VsdENvdW50KSB7CiAgICAgIHZhciB3b3JkU2VwYXJhdG9ycyA9IHNlYXJjaERhdGEud29yZFNlcGFyYXRvcnM7CiAgICAgIGlmICghY2FwdHVyZU1hdGNoZXMgJiYgc2VhcmNoRGF0YS5zaW1wbGVTZWFyY2gpIHsKICAgICAgICB2YXIgc2VhcmNoU3RyaW5nID0gc2VhcmNoRGF0YS5zaW1wbGVTZWFyY2g7CiAgICAgICAgdmFyIHNlYXJjaFN0cmluZ0xlbiA9IHNlYXJjaFN0cmluZy5sZW5ndGg7CiAgICAgICAgdmFyIHRleHRMZW5ndGggPSB0ZXh0Lmxlbmd0aDsKICAgICAgICB2YXIgbGFzdE1hdGNoSW5kZXggPSAtc2VhcmNoU3RyaW5nTGVuOwogICAgICAgIHdoaWxlICgobGFzdE1hdGNoSW5kZXggPSB0ZXh0LmluZGV4T2Yoc2VhcmNoU3RyaW5nLCBsYXN0TWF0Y2hJbmRleCArIHNlYXJjaFN0cmluZ0xlbikpICE9PSAtMSkgewogICAgICAgICAgaWYgKCF3b3JkU2VwYXJhdG9ycyB8fCBpc1ZhbGlkTWF0Y2god29yZFNlcGFyYXRvcnMsIHRleHQsIHRleHRMZW5ndGgsIGxhc3RNYXRjaEluZGV4LCBzZWFyY2hTdHJpbmdMZW4pKSB7CiAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRMZW4rK10gPSBuZXcgRmluZE1hdGNoKG5ldyBSYW5nZShsaW5lTnVtYmVyLCBsYXN0TWF0Y2hJbmRleCArIDEgKyBkZWx0YU9mZnNldCwgbGluZU51bWJlciwgbGFzdE1hdGNoSW5kZXggKyAxICsgc2VhcmNoU3RyaW5nTGVuICsgZGVsdGFPZmZzZXQpLCBudWxsKTsKICAgICAgICAgICAgaWYgKHJlc3VsdExlbiA+PSBsaW1pdFJlc3VsdENvdW50KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdExlbjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0TGVuOwogICAgICB9CiAgICAgIHZhciBtOwogICAgICAvLyBSZXNldCByZWdleCB0byBzZWFyY2ggZnJvbSB0aGUgYmVnaW5uaW5nCiAgICAgIHNlYXJjaGVyLnJlc2V0KDApOwogICAgICBkbyB7CiAgICAgICAgbSA9IHNlYXJjaGVyLm5leHQodGV4dCk7CiAgICAgICAgaWYgKG0pIHsKICAgICAgICAgIHJlc3VsdFtyZXN1bHRMZW4rK10gPSBjcmVhdGVGaW5kTWF0Y2gobmV3IFJhbmdlKGxpbmVOdW1iZXIsIG0uaW5kZXggKyAxICsgZGVsdGFPZmZzZXQsIGxpbmVOdW1iZXIsIG0uaW5kZXggKyAxICsgbVswXS5sZW5ndGggKyBkZWx0YU9mZnNldCksIG0sIGNhcHR1cmVNYXRjaGVzKTsKICAgICAgICAgIGlmIChyZXN1bHRMZW4gPj0gbGltaXRSZXN1bHRDb3VudCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0TGVuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAobSk7CiAgICAgIHJldHVybiByZXN1bHRMZW47CiAgICB9CiAgICAvLyAjZW5kcmVnaW9uCiAgICAvLyAjcmVnaW9uIFBpZWNlIFRhYmxlCiAgfSwgewogICAga2V5OiAiaW5zZXJ0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbnNlcnQob2Zmc2V0LCB2YWx1ZSkgewogICAgICB2YXIgZW9sTm9ybWFsaXplZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7CiAgICAgIHRoaXMuX0VPTE5vcm1hbGl6ZWQgPSB0aGlzLl9FT0xOb3JtYWxpemVkICYmIGVvbE5vcm1hbGl6ZWQ7CiAgICAgIHRoaXMuX2xhc3RWaXNpdGVkTGluZS5saW5lTnVtYmVyID0gMDsKICAgICAgdGhpcy5fbGFzdFZpc2l0ZWRMaW5lLnZhbHVlID0gJyc7CiAgICAgIGlmICh0aGlzLnJvb3QgIT09IFNFTlRJTkVMKSB7CiAgICAgICAgdmFyIF90aGlzJG5vZGVBdCA9IHRoaXMubm9kZUF0KG9mZnNldCksCiAgICAgICAgICBub2RlID0gX3RoaXMkbm9kZUF0Lm5vZGUsCiAgICAgICAgICByZW1haW5kZXIgPSBfdGhpcyRub2RlQXQucmVtYWluZGVyLAogICAgICAgICAgbm9kZVN0YXJ0T2Zmc2V0ID0gX3RoaXMkbm9kZUF0Lm5vZGVTdGFydE9mZnNldDsKICAgICAgICB2YXIgcGllY2UgPSBub2RlLnBpZWNlOwogICAgICAgIHZhciBidWZmZXJJbmRleCA9IHBpZWNlLmJ1ZmZlckluZGV4OwogICAgICAgIHZhciBpbnNlcnRQb3NJbkJ1ZmZlciA9IHRoaXMucG9zaXRpb25JbkJ1ZmZlcihub2RlLCByZW1haW5kZXIpOwogICAgICAgIGlmIChub2RlLnBpZWNlLmJ1ZmZlckluZGV4ID09PSAwICYmIHBpZWNlLmVuZC5saW5lID09PSB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zLmxpbmUgJiYgcGllY2UuZW5kLmNvbHVtbiA9PT0gdGhpcy5fbGFzdENoYW5nZUJ1ZmZlclBvcy5jb2x1bW4gJiYgbm9kZVN0YXJ0T2Zmc2V0ICsgcGllY2UubGVuZ3RoID09PSBvZmZzZXQgJiYgdmFsdWUubGVuZ3RoIDwgQXZlcmFnZUJ1ZmZlclNpemUpIHsKICAgICAgICAgIC8vIGNoYW5nZWQgYnVmZmVyCiAgICAgICAgICB0aGlzLmFwcGVuZFRvTm9kZShub2RlLCB2YWx1ZSk7CiAgICAgICAgICB0aGlzLmNvbXB1dGVCdWZmZXJNZXRhZGF0YSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAobm9kZVN0YXJ0T2Zmc2V0ID09PSBvZmZzZXQpIHsKICAgICAgICAgIHRoaXMuaW5zZXJ0Q29udGVudFRvTm9kZUxlZnQodmFsdWUsIG5vZGUpOwogICAgICAgICAgdGhpcy5fc2VhcmNoQ2FjaGUudmFsaWRhdGUob2Zmc2V0KTsKICAgICAgICB9IGVsc2UgaWYgKG5vZGVTdGFydE9mZnNldCArIG5vZGUucGllY2UubGVuZ3RoID4gb2Zmc2V0KSB7CiAgICAgICAgICAvLyB3ZSBhcmUgaW5zZXJ0aW5nIGludG8gdGhlIG1pZGRsZSBvZiBhIG5vZGUuCiAgICAgICAgICB2YXIgbm9kZXNUb0RlbCA9IFtdOwogICAgICAgICAgdmFyIG5ld1JpZ2h0UGllY2UgPSBuZXcgUGllY2UocGllY2UuYnVmZmVySW5kZXgsIGluc2VydFBvc0luQnVmZmVyLCBwaWVjZS5lbmQsIHRoaXMuZ2V0TGluZUZlZWRDbnQocGllY2UuYnVmZmVySW5kZXgsIGluc2VydFBvc0luQnVmZmVyLCBwaWVjZS5lbmQpLCB0aGlzLm9mZnNldEluQnVmZmVyKGJ1ZmZlckluZGV4LCBwaWVjZS5lbmQpIC0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihidWZmZXJJbmRleCwgaW5zZXJ0UG9zSW5CdWZmZXIpKTsKICAgICAgICAgIGlmICh0aGlzLnNob3VsZENoZWNrQ1JMRigpICYmIHRoaXMuZW5kV2l0aENSKHZhbHVlKSkgewogICAgICAgICAgICB2YXIgaGVhZE9mUmlnaHQgPSB0aGlzLm5vZGVDaGFyQ29kZUF0KG5vZGUsIHJlbWFpbmRlcik7CiAgICAgICAgICAgIGlmIChoZWFkT2ZSaWdodCA9PT0gMTAgLyoqIFxuICovKSB7CiAgICAgICAgICAgICAgdmFyIG5ld1N0YXJ0ID0gewogICAgICAgICAgICAgICAgbGluZTogbmV3UmlnaHRQaWVjZS5zdGFydC5saW5lICsgMSwKICAgICAgICAgICAgICAgIGNvbHVtbjogMAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgbmV3UmlnaHRQaWVjZSA9IG5ldyBQaWVjZShuZXdSaWdodFBpZWNlLmJ1ZmZlckluZGV4LCBuZXdTdGFydCwgbmV3UmlnaHRQaWVjZS5lbmQsIHRoaXMuZ2V0TGluZUZlZWRDbnQobmV3UmlnaHRQaWVjZS5idWZmZXJJbmRleCwgbmV3U3RhcnQsIG5ld1JpZ2h0UGllY2UuZW5kKSwgbmV3UmlnaHRQaWVjZS5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICB2YWx1ZSArPSAnXG4nOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyByZXVzZSBub2RlIGZvciBjb250ZW50IGJlZm9yZSBpbnNlcnRpb24gcG9pbnQuCiAgICAgICAgICBpZiAodGhpcy5zaG91bGRDaGVja0NSTEYoKSAmJiB0aGlzLnN0YXJ0V2l0aExGKHZhbHVlKSkgewogICAgICAgICAgICB2YXIgdGFpbE9mTGVmdCA9IHRoaXMubm9kZUNoYXJDb2RlQXQobm9kZSwgcmVtYWluZGVyIC0gMSk7CiAgICAgICAgICAgIGlmICh0YWlsT2ZMZWZ0ID09PSAxMyAvKiogXHIgKi8pIHsKICAgICAgICAgICAgICB2YXIgcHJldmlvdXNQb3MgPSB0aGlzLnBvc2l0aW9uSW5CdWZmZXIobm9kZSwgcmVtYWluZGVyIC0gMSk7CiAgICAgICAgICAgICAgdGhpcy5kZWxldGVOb2RlVGFpbChub2RlLCBwcmV2aW91c1Bvcyk7CiAgICAgICAgICAgICAgdmFsdWUgPSAnXHInICsgdmFsdWU7CiAgICAgICAgICAgICAgaWYgKG5vZGUucGllY2UubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBub2Rlc1RvRGVsLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZGVsZXRlTm9kZVRhaWwobm9kZSwgaW5zZXJ0UG9zSW5CdWZmZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmRlbGV0ZU5vZGVUYWlsKG5vZGUsIGluc2VydFBvc0luQnVmZmVyKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBuZXdQaWVjZXMgPSB0aGlzLmNyZWF0ZU5ld1BpZWNlcyh2YWx1ZSk7CiAgICAgICAgICBpZiAobmV3UmlnaHRQaWVjZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMucmJJbnNlcnRSaWdodChub2RlLCBuZXdSaWdodFBpZWNlKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB0bXBOb2RlID0gbm9kZTsKICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbmV3UGllY2VzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIHRtcE5vZGUgPSB0aGlzLnJiSW5zZXJ0UmlnaHQodG1wTm9kZSwgbmV3UGllY2VzW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZGVsZXRlTm9kZXMobm9kZXNUb0RlbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaW5zZXJ0Q29udGVudFRvTm9kZVJpZ2h0KHZhbHVlLCBub2RlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gaW5zZXJ0IG5ldyBub2RlCiAgICAgICAgdmFyIHBpZWNlcyA9IHRoaXMuY3JlYXRlTmV3UGllY2VzKHZhbHVlKTsKICAgICAgICB2YXIgX25vZGUgPSB0aGlzLnJiSW5zZXJ0TGVmdChudWxsLCBwaWVjZXNbMF0pOwogICAgICAgIGZvciAodmFyIF9rID0gMTsgX2sgPCBwaWVjZXMubGVuZ3RoOyBfaysrKSB7CiAgICAgICAgICBfbm9kZSA9IHRoaXMucmJJbnNlcnRSaWdodChfbm9kZSwgcGllY2VzW19rXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIHRvZG8sIHRoaXMgaXMgdG9vIGJydXRhbC4gVG90YWwgbGluZSBmZWVkIGNvdW50IHNob3VsZCBiZSB1cGRhdGVkIHRoZSBzYW1lIHdheSBhcyBsZl9sZWZ0LgogICAgICB0aGlzLmNvbXB1dGVCdWZmZXJNZXRhZGF0YSgpOwogICAgfQogIH0sIHsKICAgIGtleTogImRlbGV0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2RlbGV0ZShvZmZzZXQsIGNudCkgewogICAgICB0aGlzLl9sYXN0VmlzaXRlZExpbmUubGluZU51bWJlciA9IDA7CiAgICAgIHRoaXMuX2xhc3RWaXNpdGVkTGluZS52YWx1ZSA9ICcnOwogICAgICBpZiAoY250IDw9IDAgfHwgdGhpcy5yb290ID09PSBTRU5USU5FTCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgc3RhcnRQb3NpdGlvbiA9IHRoaXMubm9kZUF0KG9mZnNldCk7CiAgICAgIHZhciBlbmRQb3NpdGlvbiA9IHRoaXMubm9kZUF0KG9mZnNldCArIGNudCk7CiAgICAgIHZhciBzdGFydE5vZGUgPSBzdGFydFBvc2l0aW9uLm5vZGU7CiAgICAgIHZhciBlbmROb2RlID0gZW5kUG9zaXRpb24ubm9kZTsKICAgICAgaWYgKHN0YXJ0Tm9kZSA9PT0gZW5kTm9kZSkgewogICAgICAgIHZhciBfc3RhcnRTcGxpdFBvc0luQnVmZmVyID0gdGhpcy5wb3NpdGlvbkluQnVmZmVyKHN0YXJ0Tm9kZSwgc3RhcnRQb3NpdGlvbi5yZW1haW5kZXIpOwogICAgICAgIHZhciBfZW5kU3BsaXRQb3NJbkJ1ZmZlciA9IHRoaXMucG9zaXRpb25JbkJ1ZmZlcihzdGFydE5vZGUsIGVuZFBvc2l0aW9uLnJlbWFpbmRlcik7CiAgICAgICAgaWYgKHN0YXJ0UG9zaXRpb24ubm9kZVN0YXJ0T2Zmc2V0ID09PSBvZmZzZXQpIHsKICAgICAgICAgIGlmIChjbnQgPT09IHN0YXJ0Tm9kZS5waWVjZS5sZW5ndGgpIHsKICAgICAgICAgICAgLy8gZGVsZXRlIG5vZGUKICAgICAgICAgICAgdmFyIG5leHQgPSBzdGFydE5vZGUubmV4dCgpOwogICAgICAgICAgICByYkRlbGV0ZSh0aGlzLCBzdGFydE5vZGUpOwogICAgICAgICAgICB0aGlzLnZhbGlkYXRlQ1JMRldpdGhQcmV2Tm9kZShuZXh0KTsKICAgICAgICAgICAgdGhpcy5jb21wdXRlQnVmZmVyTWV0YWRhdGEoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5kZWxldGVOb2RlSGVhZChzdGFydE5vZGUsIF9lbmRTcGxpdFBvc0luQnVmZmVyKTsKICAgICAgICAgIHRoaXMuX3NlYXJjaENhY2hlLnZhbGlkYXRlKG9mZnNldCk7CiAgICAgICAgICB0aGlzLnZhbGlkYXRlQ1JMRldpdGhQcmV2Tm9kZShzdGFydE5vZGUpOwogICAgICAgICAgdGhpcy5jb21wdXRlQnVmZmVyTWV0YWRhdGEoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXJ0UG9zaXRpb24ubm9kZVN0YXJ0T2Zmc2V0ICsgc3RhcnROb2RlLnBpZWNlLmxlbmd0aCA9PT0gb2Zmc2V0ICsgY250KSB7CiAgICAgICAgICB0aGlzLmRlbGV0ZU5vZGVUYWlsKHN0YXJ0Tm9kZSwgX3N0YXJ0U3BsaXRQb3NJbkJ1ZmZlcik7CiAgICAgICAgICB0aGlzLnZhbGlkYXRlQ1JMRldpdGhOZXh0Tm9kZShzdGFydE5vZGUpOwogICAgICAgICAgdGhpcy5jb21wdXRlQnVmZmVyTWV0YWRhdGEoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gZGVsZXRlIGNvbnRlbnQgaW4gdGhlIG1pZGRsZSwgdGhpcyBub2RlIHdpbGwgYmUgc3BsaXR0ZWQgdG8gbm9kZXMKICAgICAgICB0aGlzLnNocmlua05vZGUoc3RhcnROb2RlLCBfc3RhcnRTcGxpdFBvc0luQnVmZmVyLCBfZW5kU3BsaXRQb3NJbkJ1ZmZlcik7CiAgICAgICAgdGhpcy5jb21wdXRlQnVmZmVyTWV0YWRhdGEoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIG5vZGVzVG9EZWwgPSBbXTsKICAgICAgdmFyIHN0YXJ0U3BsaXRQb3NJbkJ1ZmZlciA9IHRoaXMucG9zaXRpb25JbkJ1ZmZlcihzdGFydE5vZGUsIHN0YXJ0UG9zaXRpb24ucmVtYWluZGVyKTsKICAgICAgdGhpcy5kZWxldGVOb2RlVGFpbChzdGFydE5vZGUsIHN0YXJ0U3BsaXRQb3NJbkJ1ZmZlcik7CiAgICAgIHRoaXMuX3NlYXJjaENhY2hlLnZhbGlkYXRlKG9mZnNldCk7CiAgICAgIGlmIChzdGFydE5vZGUucGllY2UubGVuZ3RoID09PSAwKSB7CiAgICAgICAgbm9kZXNUb0RlbC5wdXNoKHN0YXJ0Tm9kZSk7CiAgICAgIH0KICAgICAgLy8gdXBkYXRlIGxhc3QgdG91Y2hlZCBub2RlCiAgICAgIHZhciBlbmRTcGxpdFBvc0luQnVmZmVyID0gdGhpcy5wb3NpdGlvbkluQnVmZmVyKGVuZE5vZGUsIGVuZFBvc2l0aW9uLnJlbWFpbmRlcik7CiAgICAgIHRoaXMuZGVsZXRlTm9kZUhlYWQoZW5kTm9kZSwgZW5kU3BsaXRQb3NJbkJ1ZmZlcik7CiAgICAgIGlmIChlbmROb2RlLnBpZWNlLmxlbmd0aCA9PT0gMCkgewogICAgICAgIG5vZGVzVG9EZWwucHVzaChlbmROb2RlKTsKICAgICAgfQogICAgICAvLyBkZWxldGUgbm9kZXMgaW4gYmV0d2VlbgogICAgICB2YXIgc2Vjb25kTm9kZSA9IHN0YXJ0Tm9kZS5uZXh0KCk7CiAgICAgIGZvciAodmFyIG5vZGUgPSBzZWNvbmROb2RlOyBub2RlICE9PSBTRU5USU5FTCAmJiBub2RlICE9PSBlbmROb2RlOyBub2RlID0gbm9kZS5uZXh0KCkpIHsKICAgICAgICBub2Rlc1RvRGVsLnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgdmFyIHByZXYgPSBzdGFydE5vZGUucGllY2UubGVuZ3RoID09PSAwID8gc3RhcnROb2RlLnByZXYoKSA6IHN0YXJ0Tm9kZTsKICAgICAgdGhpcy5kZWxldGVOb2Rlcyhub2Rlc1RvRGVsKTsKICAgICAgdGhpcy52YWxpZGF0ZUNSTEZXaXRoTmV4dE5vZGUocHJldik7CiAgICAgIHRoaXMuY29tcHV0ZUJ1ZmZlck1ldGFkYXRhKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5zZXJ0Q29udGVudFRvTm9kZUxlZnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluc2VydENvbnRlbnRUb05vZGVMZWZ0KHZhbHVlLCBub2RlKSB7CiAgICAgIC8vIHdlIGFyZSBpbnNlcnRpbmcgY29udGVudCB0byB0aGUgYmVnaW5uaW5nIG9mIG5vZGUKICAgICAgdmFyIG5vZGVzVG9EZWwgPSBbXTsKICAgICAgaWYgKHRoaXMuc2hvdWxkQ2hlY2tDUkxGKCkgJiYgdGhpcy5lbmRXaXRoQ1IodmFsdWUpICYmIHRoaXMuc3RhcnRXaXRoTEYobm9kZSkpIHsKICAgICAgICAvLyBtb3ZlIGBcbmAgdG8gbmV3IG5vZGUuCiAgICAgICAgdmFyIHBpZWNlID0gbm9kZS5waWVjZTsKICAgICAgICB2YXIgbmV3U3RhcnQgPSB7CiAgICAgICAgICBsaW5lOiBwaWVjZS5zdGFydC5saW5lICsgMSwKICAgICAgICAgIGNvbHVtbjogMAogICAgICAgIH07CiAgICAgICAgdmFyIG5QaWVjZSA9IG5ldyBQaWVjZShwaWVjZS5idWZmZXJJbmRleCwgbmV3U3RhcnQsIHBpZWNlLmVuZCwgdGhpcy5nZXRMaW5lRmVlZENudChwaWVjZS5idWZmZXJJbmRleCwgbmV3U3RhcnQsIHBpZWNlLmVuZCksIHBpZWNlLmxlbmd0aCAtIDEpOwogICAgICAgIG5vZGUucGllY2UgPSBuUGllY2U7CiAgICAgICAgdmFsdWUgKz0gJ1xuJzsKICAgICAgICB1cGRhdGVUcmVlTWV0YWRhdGEodGhpcywgbm9kZSwgLTEsIC0xKTsKICAgICAgICBpZiAobm9kZS5waWVjZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIG5vZGVzVG9EZWwucHVzaChub2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIG5ld1BpZWNlcyA9IHRoaXMuY3JlYXRlTmV3UGllY2VzKHZhbHVlKTsKICAgICAgdmFyIG5ld05vZGUgPSB0aGlzLnJiSW5zZXJ0TGVmdChub2RlLCBuZXdQaWVjZXNbbmV3UGllY2VzLmxlbmd0aCAtIDFdKTsKICAgICAgZm9yICh2YXIgayA9IG5ld1BpZWNlcy5sZW5ndGggLSAyOyBrID49IDA7IGstLSkgewogICAgICAgIG5ld05vZGUgPSB0aGlzLnJiSW5zZXJ0TGVmdChuZXdOb2RlLCBuZXdQaWVjZXNba10pOwogICAgICB9CiAgICAgIHRoaXMudmFsaWRhdGVDUkxGV2l0aFByZXZOb2RlKG5ld05vZGUpOwogICAgICB0aGlzLmRlbGV0ZU5vZGVzKG5vZGVzVG9EZWwpOwogICAgfQogIH0sIHsKICAgIGtleTogImluc2VydENvbnRlbnRUb05vZGVSaWdodCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zZXJ0Q29udGVudFRvTm9kZVJpZ2h0KHZhbHVlLCBub2RlKSB7CiAgICAgIC8vIHdlIGFyZSBpbnNlcnRpbmcgdG8gdGhlIHJpZ2h0IG9mIHRoaXMgbm9kZS4KICAgICAgaWYgKHRoaXMuYWRqdXN0Q2FycmlhZ2VSZXR1cm5Gcm9tTmV4dCh2YWx1ZSwgbm9kZSkpIHsKICAgICAgICAvLyBtb3ZlIFxuIHRvIHRoZSBuZXcgbm9kZS4KICAgICAgICB2YWx1ZSArPSAnXG4nOwogICAgICB9CiAgICAgIHZhciBuZXdQaWVjZXMgPSB0aGlzLmNyZWF0ZU5ld1BpZWNlcyh2YWx1ZSk7CiAgICAgIHZhciBuZXdOb2RlID0gdGhpcy5yYkluc2VydFJpZ2h0KG5vZGUsIG5ld1BpZWNlc1swXSk7CiAgICAgIHZhciB0bXBOb2RlID0gbmV3Tm9kZTsKICAgICAgZm9yICh2YXIgayA9IDE7IGsgPCBuZXdQaWVjZXMubGVuZ3RoOyBrKyspIHsKICAgICAgICB0bXBOb2RlID0gdGhpcy5yYkluc2VydFJpZ2h0KHRtcE5vZGUsIG5ld1BpZWNlc1trXSk7CiAgICAgIH0KICAgICAgdGhpcy52YWxpZGF0ZUNSTEZXaXRoUHJldk5vZGUobmV3Tm9kZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicG9zaXRpb25JbkJ1ZmZlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcG9zaXRpb25JbkJ1ZmZlcihub2RlLCByZW1haW5kZXIsIHJldCkgewogICAgICB2YXIgcGllY2UgPSBub2RlLnBpZWNlOwogICAgICB2YXIgYnVmZmVySW5kZXggPSBub2RlLnBpZWNlLmJ1ZmZlckluZGV4OwogICAgICB2YXIgbGluZVN0YXJ0cyA9IHRoaXMuX2J1ZmZlcnNbYnVmZmVySW5kZXhdLmxpbmVTdGFydHM7CiAgICAgIHZhciBzdGFydE9mZnNldCA9IGxpbmVTdGFydHNbcGllY2Uuc3RhcnQubGluZV0gKyBwaWVjZS5zdGFydC5jb2x1bW47CiAgICAgIHZhciBvZmZzZXQgPSBzdGFydE9mZnNldCArIHJlbWFpbmRlcjsKICAgICAgLy8gYmluYXJ5IHNlYXJjaCBvZmZzZXQgYmV0d2VlbiBzdGFydE9mZnNldCBhbmQgZW5kT2Zmc2V0CiAgICAgIHZhciBsb3cgPSBwaWVjZS5zdGFydC5saW5lOwogICAgICB2YXIgaGlnaCA9IHBpZWNlLmVuZC5saW5lOwogICAgICB2YXIgbWlkID0gMDsKICAgICAgdmFyIG1pZFN0b3AgPSAwOwogICAgICB2YXIgbWlkU3RhcnQgPSAwOwogICAgICB3aGlsZSAobG93IDw9IGhpZ2gpIHsKICAgICAgICBtaWQgPSBsb3cgKyAoaGlnaCAtIGxvdykgLyAyIHwgMDsKICAgICAgICBtaWRTdGFydCA9IGxpbmVTdGFydHNbbWlkXTsKICAgICAgICBpZiAobWlkID09PSBoaWdoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbWlkU3RvcCA9IGxpbmVTdGFydHNbbWlkICsgMV07CiAgICAgICAgaWYgKG9mZnNldCA8IG1pZFN0YXJ0KSB7CiAgICAgICAgICBoaWdoID0gbWlkIC0gMTsKICAgICAgICB9IGVsc2UgaWYgKG9mZnNldCA+PSBtaWRTdG9wKSB7CiAgICAgICAgICBsb3cgPSBtaWQgKyAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHJldCkgewogICAgICAgIHJldC5saW5lID0gbWlkOwogICAgICAgIHJldC5jb2x1bW4gPSBvZmZzZXQgLSBtaWRTdGFydDsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGxpbmU6IG1pZCwKICAgICAgICBjb2x1bW46IG9mZnNldCAtIG1pZFN0YXJ0CiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGluZUZlZWRDbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExpbmVGZWVkQ250KGJ1ZmZlckluZGV4LCBzdGFydCwgZW5kKSB7CiAgICAgIC8vIHdlIGRvbid0IG5lZWQgdG8gd29ycnkgYWJvdXQgc3RhcnQ6IGFiY1xyfFxuLCBvciBhYmN8XHIsIG9yIGFiY3xcbiwgb3IgYWJjfFxyXG4gZG9lc24ndCBjaGFuZ2UgdGhlIGZhY3QgdGhhdCwgdGhlcmUgaXMgb25lIGxpbmUgYnJlYWsgYWZ0ZXIgc3RhcnQuCiAgICAgIC8vIG5vdyBsZXQncyB0YWtlIGNhcmUgb2YgZW5kOiBhYmNccnxcbiwgaWYgZW5kIGlzIGluIGJldHdlZW4gXHIgYW5kIFxuLCB3ZSBuZWVkIHRvIGFkZCBsaW5lIGZlZWQgY291bnQgYnkgMQogICAgICBpZiAoZW5kLmNvbHVtbiA9PT0gMCkgewogICAgICAgIHJldHVybiBlbmQubGluZSAtIHN0YXJ0LmxpbmU7CiAgICAgIH0KICAgICAgdmFyIGxpbmVTdGFydHMgPSB0aGlzLl9idWZmZXJzW2J1ZmZlckluZGV4XS5saW5lU3RhcnRzOwogICAgICBpZiAoZW5kLmxpbmUgPT09IGxpbmVTdGFydHMubGVuZ3RoIC0gMSkgewogICAgICAgIC8vIGl0IG1lYW5zLCB0aGVyZSBpcyBubyBcbiBhZnRlciBlbmQsIG90aGVyd2lzZSwgdGhlcmUgd2lsbCBiZSBvbmUgbW9yZSBsaW5lU3RhcnQuCiAgICAgICAgcmV0dXJuIGVuZC5saW5lIC0gc3RhcnQubGluZTsKICAgICAgfQogICAgICB2YXIgbmV4dExpbmVTdGFydE9mZnNldCA9IGxpbmVTdGFydHNbZW5kLmxpbmUgKyAxXTsKICAgICAgdmFyIGVuZE9mZnNldCA9IGxpbmVTdGFydHNbZW5kLmxpbmVdICsgZW5kLmNvbHVtbjsKICAgICAgaWYgKG5leHRMaW5lU3RhcnRPZmZzZXQgPiBlbmRPZmZzZXQgKyAxKSB7CiAgICAgICAgLy8gdGhlcmUgYXJlIG1vcmUgdGhhbiAxIGNoYXJhY3RlciBhZnRlciBlbmQsIHdoaWNoIG1lYW5zIGl0IGNhbid0IGJlIFxuCiAgICAgICAgcmV0dXJuIGVuZC5saW5lIC0gc3RhcnQubGluZTsKICAgICAgfQogICAgICAvLyBlbmRPZmZzZXQgKyAxID09PSBuZXh0TGluZVN0YXJ0T2Zmc2V0CiAgICAgIC8vIGNoYXJhY3RlciBhdCBlbmRPZmZzZXQgaXMgXG4sIHNvIHdlIGNoZWNrIHRoZSBjaGFyYWN0ZXIgYmVmb3JlIGZpcnN0CiAgICAgIC8vIGlmIGNoYXJhY3RlciBhdCBlbmRPZmZzZXQgaXMgXHIsIGVuZC5jb2x1bW4gaXMgMCBhbmQgd2UgY2FuJ3QgZ2V0IGhlcmUuCiAgICAgIHZhciBwcmV2aW91c0NoYXJPZmZzZXQgPSBlbmRPZmZzZXQgLSAxOyAvLyBlbmQuY29sdW1uID4gMCBzbyBpdCdzIG9rYXkuCiAgICAgIHZhciBidWZmZXIgPSB0aGlzLl9idWZmZXJzW2J1ZmZlckluZGV4XS5idWZmZXI7CiAgICAgIGlmIChidWZmZXIuY2hhckNvZGVBdChwcmV2aW91c0NoYXJPZmZzZXQpID09PSAxMykgewogICAgICAgIHJldHVybiBlbmQubGluZSAtIHN0YXJ0LmxpbmUgKyAxOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBlbmQubGluZSAtIHN0YXJ0LmxpbmU7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJvZmZzZXRJbkJ1ZmZlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb2Zmc2V0SW5CdWZmZXIoYnVmZmVySW5kZXgsIGN1cnNvcikgewogICAgICB2YXIgbGluZVN0YXJ0cyA9IHRoaXMuX2J1ZmZlcnNbYnVmZmVySW5kZXhdLmxpbmVTdGFydHM7CiAgICAgIHJldHVybiBsaW5lU3RhcnRzW2N1cnNvci5saW5lXSArIGN1cnNvci5jb2x1bW47CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVsZXRlTm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlbGV0ZU5vZGVzKG5vZGVzKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICByYkRlbGV0ZSh0aGlzLCBub2Rlc1tpXSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVOZXdQaWVjZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZU5ld1BpZWNlcyh0ZXh0KSB7CiAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IEF2ZXJhZ2VCdWZmZXJTaXplKSB7CiAgICAgICAgLy8gdGhlIGNvbnRlbnQgaXMgbGFyZ2UsIG9wZXJhdGlvbnMgbGlrZSBzdWJzdHJpbmcsIGNoYXJDb2RlIGJlY29tZXMgc2xvdwogICAgICAgIC8vIHNvIGhlcmUgd2Ugc3BsaXQgaXQgaW50byBzbWFsbGVyIGNodW5rcywganVzdCBsaWtlIHdoYXQgd2UgZGlkIGZvciBDUi9MRiBub3JtYWxpemF0aW9uCiAgICAgICAgdmFyIG5ld1BpZWNlcyA9IFtdOwogICAgICAgIHdoaWxlICh0ZXh0Lmxlbmd0aCA+IEF2ZXJhZ2VCdWZmZXJTaXplKSB7CiAgICAgICAgICB2YXIgbGFzdENoYXIgPSB0ZXh0LmNoYXJDb2RlQXQoQXZlcmFnZUJ1ZmZlclNpemUgLSAxKTsKICAgICAgICAgIHZhciBzcGxpdFRleHQgPSB2b2lkIDA7CiAgICAgICAgICBpZiAobGFzdENoYXIgPT09IDEzIC8qIENoYXJDb2RlLkNhcnJpYWdlUmV0dXJuICovIHx8IGxhc3RDaGFyID49IDB4RDgwMCAmJiBsYXN0Q2hhciA8PSAweERCRkYpIHsKICAgICAgICAgICAgLy8gbGFzdCBjaGFyYWN0ZXIgaXMgXHIgb3IgYSBoaWdoIHN1cnJvZ2F0ZSA9PiBrZWVwIGl0IGJhY2sKICAgICAgICAgICAgc3BsaXRUZXh0ID0gdGV4dC5zdWJzdHJpbmcoMCwgQXZlcmFnZUJ1ZmZlclNpemUgLSAxKTsKICAgICAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKEF2ZXJhZ2VCdWZmZXJTaXplIC0gMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzcGxpdFRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBBdmVyYWdlQnVmZmVyU2l6ZSk7CiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cmluZyhBdmVyYWdlQnVmZmVyU2l6ZSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgX2xpbmVTdGFydHMyID0gY3JlYXRlTGluZVN0YXJ0c0Zhc3Qoc3BsaXRUZXh0KTsKICAgICAgICAgIG5ld1BpZWNlcy5wdXNoKG5ldyBQaWVjZSh0aGlzLl9idWZmZXJzLmxlbmd0aCwgLyogYnVmZmVyIGluZGV4ICovewogICAgICAgICAgICBsaW5lOiAwLAogICAgICAgICAgICBjb2x1bW46IDAKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbGluZTogX2xpbmVTdGFydHMyLmxlbmd0aCAtIDEsCiAgICAgICAgICAgIGNvbHVtbjogc3BsaXRUZXh0Lmxlbmd0aCAtIF9saW5lU3RhcnRzMltfbGluZVN0YXJ0czIubGVuZ3RoIC0gMV0KICAgICAgICAgIH0sIF9saW5lU3RhcnRzMi5sZW5ndGggLSAxLCBzcGxpdFRleHQubGVuZ3RoKSk7CiAgICAgICAgICB0aGlzLl9idWZmZXJzLnB1c2gobmV3IFN0cmluZ0J1ZmZlcihzcGxpdFRleHQsIF9saW5lU3RhcnRzMikpOwogICAgICAgIH0KICAgICAgICB2YXIgX2xpbmVTdGFydHMgPSBjcmVhdGVMaW5lU3RhcnRzRmFzdCh0ZXh0KTsKICAgICAgICBuZXdQaWVjZXMucHVzaChuZXcgUGllY2UodGhpcy5fYnVmZmVycy5sZW5ndGgsIC8qIGJ1ZmZlciBpbmRleCAqL3sKICAgICAgICAgIGxpbmU6IDAsCiAgICAgICAgICBjb2x1bW46IDAKICAgICAgICB9LCB7CiAgICAgICAgICBsaW5lOiBfbGluZVN0YXJ0cy5sZW5ndGggLSAxLAogICAgICAgICAgY29sdW1uOiB0ZXh0Lmxlbmd0aCAtIF9saW5lU3RhcnRzW19saW5lU3RhcnRzLmxlbmd0aCAtIDFdCiAgICAgICAgfSwgX2xpbmVTdGFydHMubGVuZ3RoIC0gMSwgdGV4dC5sZW5ndGgpKTsKICAgICAgICB0aGlzLl9idWZmZXJzLnB1c2gobmV3IFN0cmluZ0J1ZmZlcih0ZXh0LCBfbGluZVN0YXJ0cykpOwogICAgICAgIHJldHVybiBuZXdQaWVjZXM7CiAgICAgIH0KICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gdGhpcy5fYnVmZmVyc1swXS5idWZmZXIubGVuZ3RoOwogICAgICB2YXIgbGluZVN0YXJ0cyA9IGNyZWF0ZUxpbmVTdGFydHNGYXN0KHRleHQsIGZhbHNlKTsKICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5fbGFzdENoYW5nZUJ1ZmZlclBvczsKICAgICAgaWYgKHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0c1t0aGlzLl9idWZmZXJzWzBdLmxpbmVTdGFydHMubGVuZ3RoIC0gMV0gPT09IHN0YXJ0T2Zmc2V0ICYmIHN0YXJ0T2Zmc2V0ICE9PSAwICYmIHRoaXMuc3RhcnRXaXRoTEYodGV4dCkgJiYgdGhpcy5lbmRXaXRoQ1IodGhpcy5fYnVmZmVyc1swXS5idWZmZXIpIC8vIHRvZG8sIHdlIGNhbiBjaGVjayB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zJ3MgY29sdW1uIGFzIGl0J3MgdGhlIGxhc3Qgb25lCiAgICAgICkgewogICAgICAgIHRoaXMuX2xhc3RDaGFuZ2VCdWZmZXJQb3MgPSB7CiAgICAgICAgICBsaW5lOiB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zLmxpbmUsCiAgICAgICAgICBjb2x1bW46IHRoaXMuX2xhc3RDaGFuZ2VCdWZmZXJQb3MuY29sdW1uICsgMQogICAgICAgIH07CiAgICAgICAgc3RhcnQgPSB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVN0YXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgbGluZVN0YXJ0c1tpXSArPSBzdGFydE9mZnNldCArIDE7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0cyA9IHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0cy5jb25jYXQobGluZVN0YXJ0cy5zbGljZSgxKSk7CiAgICAgICAgdGhpcy5fYnVmZmVyc1swXS5idWZmZXIgKz0gJ18nICsgdGV4dDsKICAgICAgICBzdGFydE9mZnNldCArPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChzdGFydE9mZnNldCAhPT0gMCkgewogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGxpbmVTdGFydHMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIGxpbmVTdGFydHNbX2ldICs9IHN0YXJ0T2Zmc2V0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl9idWZmZXJzWzBdLmxpbmVTdGFydHMgPSB0aGlzLl9idWZmZXJzWzBdLmxpbmVTdGFydHMuY29uY2F0KGxpbmVTdGFydHMuc2xpY2UoMSkpOwogICAgICAgIHRoaXMuX2J1ZmZlcnNbMF0uYnVmZmVyICs9IHRleHQ7CiAgICAgIH0KICAgICAgdmFyIGVuZE9mZnNldCA9IHRoaXMuX2J1ZmZlcnNbMF0uYnVmZmVyLmxlbmd0aDsKICAgICAgdmFyIGVuZEluZGV4ID0gdGhpcy5fYnVmZmVyc1swXS5saW5lU3RhcnRzLmxlbmd0aCAtIDE7CiAgICAgIHZhciBlbmRDb2x1bW4gPSBlbmRPZmZzZXQgLSB0aGlzLl9idWZmZXJzWzBdLmxpbmVTdGFydHNbZW5kSW5kZXhdOwogICAgICB2YXIgZW5kUG9zID0gewogICAgICAgIGxpbmU6IGVuZEluZGV4LAogICAgICAgIGNvbHVtbjogZW5kQ29sdW1uCiAgICAgIH07CiAgICAgIHZhciBuZXdQaWVjZSA9IG5ldyBQaWVjZSgwLCAvKiogdG9kb0BwZW5nICovc3RhcnQsIGVuZFBvcywgdGhpcy5nZXRMaW5lRmVlZENudCgwLCBzdGFydCwgZW5kUG9zKSwgZW5kT2Zmc2V0IC0gc3RhcnRPZmZzZXQpOwogICAgICB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zID0gZW5kUG9zOwogICAgICByZXR1cm4gW25ld1BpZWNlXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMaW5lUmF3Q29udGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGluZVJhd0NvbnRlbnQobGluZU51bWJlcikgewogICAgICB2YXIgZW5kT2Zmc2V0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwOwogICAgICB2YXIgeCA9IHRoaXMucm9vdDsKICAgICAgdmFyIHJldCA9ICcnOwogICAgICB2YXIgY2FjaGUgPSB0aGlzLl9zZWFyY2hDYWNoZS5nZXQyKGxpbmVOdW1iZXIpOwogICAgICBpZiAoY2FjaGUpIHsKICAgICAgICB4ID0gY2FjaGUubm9kZTsKICAgICAgICB2YXIgcHJldkFjY3VtdWxhdGVkVmFsdWUgPSB0aGlzLmdldEFjY3VtdWxhdGVkVmFsdWUoeCwgbGluZU51bWJlciAtIGNhY2hlLm5vZGVTdGFydExpbmVOdW1iZXIgLSAxKTsKICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fYnVmZmVyc1t4LnBpZWNlLmJ1ZmZlckluZGV4XS5idWZmZXI7CiAgICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcih4LnBpZWNlLmJ1ZmZlckluZGV4LCB4LnBpZWNlLnN0YXJ0KTsKICAgICAgICBpZiAoY2FjaGUubm9kZVN0YXJ0TGluZU51bWJlciArIHgucGllY2UubGluZUZlZWRDbnQgPT09IGxpbmVOdW1iZXIpIHsKICAgICAgICAgIHJldCA9IGJ1ZmZlci5zdWJzdHJpbmcoc3RhcnRPZmZzZXQgKyBwcmV2QWNjdW11bGF0ZWRWYWx1ZSwgc3RhcnRPZmZzZXQgKyB4LnBpZWNlLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBhY2N1bXVsYXRlZFZhbHVlID0gdGhpcy5nZXRBY2N1bXVsYXRlZFZhbHVlKHgsIGxpbmVOdW1iZXIgLSBjYWNoZS5ub2RlU3RhcnRMaW5lTnVtYmVyKTsKICAgICAgICAgIHJldHVybiBidWZmZXIuc3Vic3RyaW5nKHN0YXJ0T2Zmc2V0ICsgcHJldkFjY3VtdWxhdGVkVmFsdWUsIHN0YXJ0T2Zmc2V0ICsgYWNjdW11bGF0ZWRWYWx1ZSAtIGVuZE9mZnNldCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBub2RlU3RhcnRPZmZzZXQgPSAwOwogICAgICAgIHZhciBvcmlnaW5hbExpbmVOdW1iZXIgPSBsaW5lTnVtYmVyOwogICAgICAgIHdoaWxlICh4ICE9PSBTRU5USU5FTCkgewogICAgICAgICAgaWYgKHgubGVmdCAhPT0gU0VOVElORUwgJiYgeC5sZl9sZWZ0ID49IGxpbmVOdW1iZXIgLSAxKSB7CiAgICAgICAgICAgIHggPSB4LmxlZnQ7CiAgICAgICAgICB9IGVsc2UgaWYgKHgubGZfbGVmdCArIHgucGllY2UubGluZUZlZWRDbnQgPiBsaW5lTnVtYmVyIC0gMSkgewogICAgICAgICAgICB2YXIgX3ByZXZBY2N1bXVsYXRlZFZhbHVlID0gdGhpcy5nZXRBY2N1bXVsYXRlZFZhbHVlKHgsIGxpbmVOdW1iZXIgLSB4LmxmX2xlZnQgLSAyKTsKICAgICAgICAgICAgdmFyIF9hY2N1bXVsYXRlZFZhbHVlID0gdGhpcy5nZXRBY2N1bXVsYXRlZFZhbHVlKHgsIGxpbmVOdW1iZXIgLSB4LmxmX2xlZnQgLSAxKTsKICAgICAgICAgICAgdmFyIF9idWZmZXI0ID0gdGhpcy5fYnVmZmVyc1t4LnBpZWNlLmJ1ZmZlckluZGV4XS5idWZmZXI7CiAgICAgICAgICAgIHZhciBfc3RhcnRPZmZzZXQ0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcih4LnBpZWNlLmJ1ZmZlckluZGV4LCB4LnBpZWNlLnN0YXJ0KTsKICAgICAgICAgICAgbm9kZVN0YXJ0T2Zmc2V0ICs9IHguc2l6ZV9sZWZ0OwogICAgICAgICAgICB0aGlzLl9zZWFyY2hDYWNoZS5zZXQoewogICAgICAgICAgICAgIG5vZGU6IHgsCiAgICAgICAgICAgICAgbm9kZVN0YXJ0T2Zmc2V0OiBub2RlU3RhcnRPZmZzZXQsCiAgICAgICAgICAgICAgbm9kZVN0YXJ0TGluZU51bWJlcjogb3JpZ2luYWxMaW5lTnVtYmVyIC0gKGxpbmVOdW1iZXIgLSAxIC0geC5sZl9sZWZ0KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIF9idWZmZXI0LnN1YnN0cmluZyhfc3RhcnRPZmZzZXQ0ICsgX3ByZXZBY2N1bXVsYXRlZFZhbHVlLCBfc3RhcnRPZmZzZXQ0ICsgX2FjY3VtdWxhdGVkVmFsdWUgLSBlbmRPZmZzZXQpOwogICAgICAgICAgfSBlbHNlIGlmICh4LmxmX2xlZnQgKyB4LnBpZWNlLmxpbmVGZWVkQ250ID09PSBsaW5lTnVtYmVyIC0gMSkgewogICAgICAgICAgICB2YXIgX3ByZXZBY2N1bXVsYXRlZFZhbHVlMiA9IHRoaXMuZ2V0QWNjdW11bGF0ZWRWYWx1ZSh4LCBsaW5lTnVtYmVyIC0geC5sZl9sZWZ0IC0gMik7CiAgICAgICAgICAgIHZhciBfYnVmZmVyNSA9IHRoaXMuX2J1ZmZlcnNbeC5waWVjZS5idWZmZXJJbmRleF0uYnVmZmVyOwogICAgICAgICAgICB2YXIgX3N0YXJ0T2Zmc2V0NSA9IHRoaXMub2Zmc2V0SW5CdWZmZXIoeC5waWVjZS5idWZmZXJJbmRleCwgeC5waWVjZS5zdGFydCk7CiAgICAgICAgICAgIHJldCA9IF9idWZmZXI1LnN1YnN0cmluZyhfc3RhcnRPZmZzZXQ1ICsgX3ByZXZBY2N1bXVsYXRlZFZhbHVlMiwgX3N0YXJ0T2Zmc2V0NSArIHgucGllY2UubGVuZ3RoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5lTnVtYmVyIC09IHgubGZfbGVmdCArIHgucGllY2UubGluZUZlZWRDbnQ7CiAgICAgICAgICAgIG5vZGVTdGFydE9mZnNldCArPSB4LnNpemVfbGVmdCArIHgucGllY2UubGVuZ3RoOwogICAgICAgICAgICB4ID0geC5yaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gc2VhcmNoIGluIG9yZGVyLCB0byBmaW5kIHRoZSBub2RlIGNvbnRhaW5zIGVuZCBjb2x1bW4KICAgICAgeCA9IHgubmV4dCgpOwogICAgICB3aGlsZSAoeCAhPT0gU0VOVElORUwpIHsKICAgICAgICB2YXIgX2J1ZmZlcjYgPSB0aGlzLl9idWZmZXJzW3gucGllY2UuYnVmZmVySW5kZXhdLmJ1ZmZlcjsKICAgICAgICBpZiAoeC5waWVjZS5saW5lRmVlZENudCA+IDApIHsKICAgICAgICAgIHZhciBfYWNjdW11bGF0ZWRWYWx1ZTIgPSB0aGlzLmdldEFjY3VtdWxhdGVkVmFsdWUoeCwgMCk7CiAgICAgICAgICB2YXIgX3N0YXJ0T2Zmc2V0NiA9IHRoaXMub2Zmc2V0SW5CdWZmZXIoeC5waWVjZS5idWZmZXJJbmRleCwgeC5waWVjZS5zdGFydCk7CiAgICAgICAgICByZXQgKz0gX2J1ZmZlcjYuc3Vic3RyaW5nKF9zdGFydE9mZnNldDYsIF9zdGFydE9mZnNldDYgKyBfYWNjdW11bGF0ZWRWYWx1ZTIgLSBlbmRPZmZzZXQpOwogICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIF9zdGFydE9mZnNldDcgPSB0aGlzLm9mZnNldEluQnVmZmVyKHgucGllY2UuYnVmZmVySW5kZXgsIHgucGllY2Uuc3RhcnQpOwogICAgICAgICAgcmV0ICs9IF9idWZmZXI2LnN1YnN0cihfc3RhcnRPZmZzZXQ3LCB4LnBpZWNlLmxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHggPSB4Lm5leHQoKTsKICAgICAgfQogICAgICByZXR1cm4gcmV0OwogICAgfQogIH0sIHsKICAgIGtleTogImNvbXB1dGVCdWZmZXJNZXRhZGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcHV0ZUJ1ZmZlck1ldGFkYXRhKCkgewogICAgICB2YXIgeCA9IHRoaXMucm9vdDsKICAgICAgdmFyIGxmQ250ID0gMTsKICAgICAgdmFyIGxlbiA9IDA7CiAgICAgIHdoaWxlICh4ICE9PSBTRU5USU5FTCkgewogICAgICAgIGxmQ250ICs9IHgubGZfbGVmdCArIHgucGllY2UubGluZUZlZWRDbnQ7CiAgICAgICAgbGVuICs9IHguc2l6ZV9sZWZ0ICsgeC5waWVjZS5sZW5ndGg7CiAgICAgICAgeCA9IHgucmlnaHQ7CiAgICAgIH0KICAgICAgdGhpcy5fbGluZUNudCA9IGxmQ250OwogICAgICB0aGlzLl9sZW5ndGggPSBsZW47CiAgICAgIHRoaXMuX3NlYXJjaENhY2hlLnZhbGlkYXRlKHRoaXMuX2xlbmd0aCk7CiAgICB9CiAgICAvLyAjcmVnaW9uIG5vZGUgb3BlcmF0aW9ucwogIH0sIHsKICAgIGtleTogImdldEluZGV4T2YiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluZGV4T2Yobm9kZSwgYWNjdW11bGF0ZWRWYWx1ZSkgewogICAgICB2YXIgcGllY2UgPSBub2RlLnBpZWNlOwogICAgICB2YXIgcG9zID0gdGhpcy5wb3NpdGlvbkluQnVmZmVyKG5vZGUsIGFjY3VtdWxhdGVkVmFsdWUpOwogICAgICB2YXIgbGluZUNudCA9IHBvcy5saW5lIC0gcGllY2Uuc3RhcnQubGluZTsKICAgICAgaWYgKHRoaXMub2Zmc2V0SW5CdWZmZXIocGllY2UuYnVmZmVySW5kZXgsIHBpZWNlLmVuZCkgLSB0aGlzLm9mZnNldEluQnVmZmVyKHBpZWNlLmJ1ZmZlckluZGV4LCBwaWVjZS5zdGFydCkgPT09IGFjY3VtdWxhdGVkVmFsdWUpIHsKICAgICAgICAvLyB3ZSBhcmUgY2hlY2tpbmcgdGhlIGVuZCBvZiB0aGlzIG5vZGUsIHNvIGEgQ1JMRiBjaGVjayBpcyBuZWNlc3NhcnkuCiAgICAgICAgdmFyIHJlYWxMaW5lQ250ID0gdGhpcy5nZXRMaW5lRmVlZENudChub2RlLnBpZWNlLmJ1ZmZlckluZGV4LCBwaWVjZS5zdGFydCwgcG9zKTsKICAgICAgICBpZiAocmVhbExpbmVDbnQgIT09IGxpbmVDbnQpIHsKICAgICAgICAgIC8vIGFoYSB5ZXMsIENSTEYKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGluZGV4OiByZWFsTGluZUNudCwKICAgICAgICAgICAgcmVtYWluZGVyOiAwCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIGluZGV4OiBsaW5lQ250LAogICAgICAgIHJlbWFpbmRlcjogcG9zLmNvbHVtbgogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldEFjY3VtdWxhdGVkVmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFjY3VtdWxhdGVkVmFsdWUobm9kZSwgaW5kZXgpIHsKICAgICAgaWYgKGluZGV4IDwgMCkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIHZhciBwaWVjZSA9IG5vZGUucGllY2U7CiAgICAgIHZhciBsaW5lU3RhcnRzID0gdGhpcy5fYnVmZmVyc1twaWVjZS5idWZmZXJJbmRleF0ubGluZVN0YXJ0czsKICAgICAgdmFyIGV4cGVjdGVkTGluZVN0YXJ0SW5kZXggPSBwaWVjZS5zdGFydC5saW5lICsgaW5kZXggKyAxOwogICAgICBpZiAoZXhwZWN0ZWRMaW5lU3RhcnRJbmRleCA+IHBpZWNlLmVuZC5saW5lKSB7CiAgICAgICAgcmV0dXJuIGxpbmVTdGFydHNbcGllY2UuZW5kLmxpbmVdICsgcGllY2UuZW5kLmNvbHVtbiAtIGxpbmVTdGFydHNbcGllY2Uuc3RhcnQubGluZV0gLSBwaWVjZS5zdGFydC5jb2x1bW47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGxpbmVTdGFydHNbZXhwZWN0ZWRMaW5lU3RhcnRJbmRleF0gLSBsaW5lU3RhcnRzW3BpZWNlLnN0YXJ0LmxpbmVdIC0gcGllY2Uuc3RhcnQuY29sdW1uOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVsZXRlTm9kZVRhaWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlbGV0ZU5vZGVUYWlsKG5vZGUsIHBvcykgewogICAgICB2YXIgcGllY2UgPSBub2RlLnBpZWNlOwogICAgICB2YXIgb3JpZ2luYWxMRkNudCA9IHBpZWNlLmxpbmVGZWVkQ250OwogICAgICB2YXIgb3JpZ2luYWxFbmRPZmZzZXQgPSB0aGlzLm9mZnNldEluQnVmZmVyKHBpZWNlLmJ1ZmZlckluZGV4LCBwaWVjZS5lbmQpOwogICAgICB2YXIgbmV3RW5kID0gcG9zOwogICAgICB2YXIgbmV3RW5kT2Zmc2V0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihwaWVjZS5idWZmZXJJbmRleCwgbmV3RW5kKTsKICAgICAgdmFyIG5ld0xpbmVGZWVkQ250ID0gdGhpcy5nZXRMaW5lRmVlZENudChwaWVjZS5idWZmZXJJbmRleCwgcGllY2Uuc3RhcnQsIG5ld0VuZCk7CiAgICAgIHZhciBsZl9kZWx0YSA9IG5ld0xpbmVGZWVkQ250IC0gb3JpZ2luYWxMRkNudDsKICAgICAgdmFyIHNpemVfZGVsdGEgPSBuZXdFbmRPZmZzZXQgLSBvcmlnaW5hbEVuZE9mZnNldDsKICAgICAgdmFyIG5ld0xlbmd0aCA9IHBpZWNlLmxlbmd0aCArIHNpemVfZGVsdGE7CiAgICAgIG5vZGUucGllY2UgPSBuZXcgUGllY2UocGllY2UuYnVmZmVySW5kZXgsIHBpZWNlLnN0YXJ0LCBuZXdFbmQsIG5ld0xpbmVGZWVkQ250LCBuZXdMZW5ndGgpOwogICAgICB1cGRhdGVUcmVlTWV0YWRhdGEodGhpcywgbm9kZSwgc2l6ZV9kZWx0YSwgbGZfZGVsdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogImRlbGV0ZU5vZGVIZWFkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWxldGVOb2RlSGVhZChub2RlLCBwb3MpIHsKICAgICAgdmFyIHBpZWNlID0gbm9kZS5waWVjZTsKICAgICAgdmFyIG9yaWdpbmFsTEZDbnQgPSBwaWVjZS5saW5lRmVlZENudDsKICAgICAgdmFyIG9yaWdpbmFsU3RhcnRPZmZzZXQgPSB0aGlzLm9mZnNldEluQnVmZmVyKHBpZWNlLmJ1ZmZlckluZGV4LCBwaWVjZS5zdGFydCk7CiAgICAgIHZhciBuZXdTdGFydCA9IHBvczsKICAgICAgdmFyIG5ld0xpbmVGZWVkQ250ID0gdGhpcy5nZXRMaW5lRmVlZENudChwaWVjZS5idWZmZXJJbmRleCwgbmV3U3RhcnQsIHBpZWNlLmVuZCk7CiAgICAgIHZhciBuZXdTdGFydE9mZnNldCA9IHRoaXMub2Zmc2V0SW5CdWZmZXIocGllY2UuYnVmZmVySW5kZXgsIG5ld1N0YXJ0KTsKICAgICAgdmFyIGxmX2RlbHRhID0gbmV3TGluZUZlZWRDbnQgLSBvcmlnaW5hbExGQ250OwogICAgICB2YXIgc2l6ZV9kZWx0YSA9IG9yaWdpbmFsU3RhcnRPZmZzZXQgLSBuZXdTdGFydE9mZnNldDsKICAgICAgdmFyIG5ld0xlbmd0aCA9IHBpZWNlLmxlbmd0aCArIHNpemVfZGVsdGE7CiAgICAgIG5vZGUucGllY2UgPSBuZXcgUGllY2UocGllY2UuYnVmZmVySW5kZXgsIG5ld1N0YXJ0LCBwaWVjZS5lbmQsIG5ld0xpbmVGZWVkQ250LCBuZXdMZW5ndGgpOwogICAgICB1cGRhdGVUcmVlTWV0YWRhdGEodGhpcywgbm9kZSwgc2l6ZV9kZWx0YSwgbGZfZGVsdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogInNocmlua05vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNocmlua05vZGUobm9kZSwgc3RhcnQsIGVuZCkgewogICAgICB2YXIgcGllY2UgPSBub2RlLnBpZWNlOwogICAgICB2YXIgb3JpZ2luYWxTdGFydFBvcyA9IHBpZWNlLnN0YXJ0OwogICAgICB2YXIgb3JpZ2luYWxFbmRQb3MgPSBwaWVjZS5lbmQ7CiAgICAgIC8vIG9sZCBwaWVjZSwgb3JpZ2luYWxTdGFydFBvcywgc3RhcnQKICAgICAgdmFyIG9sZExlbmd0aCA9IHBpZWNlLmxlbmd0aDsKICAgICAgdmFyIG9sZExGQ250ID0gcGllY2UubGluZUZlZWRDbnQ7CiAgICAgIHZhciBuZXdFbmQgPSBzdGFydDsKICAgICAgdmFyIG5ld0xpbmVGZWVkQ250ID0gdGhpcy5nZXRMaW5lRmVlZENudChwaWVjZS5idWZmZXJJbmRleCwgcGllY2Uuc3RhcnQsIG5ld0VuZCk7CiAgICAgIHZhciBuZXdMZW5ndGggPSB0aGlzLm9mZnNldEluQnVmZmVyKHBpZWNlLmJ1ZmZlckluZGV4LCBzdGFydCkgLSB0aGlzLm9mZnNldEluQnVmZmVyKHBpZWNlLmJ1ZmZlckluZGV4LCBvcmlnaW5hbFN0YXJ0UG9zKTsKICAgICAgbm9kZS5waWVjZSA9IG5ldyBQaWVjZShwaWVjZS5idWZmZXJJbmRleCwgcGllY2Uuc3RhcnQsIG5ld0VuZCwgbmV3TGluZUZlZWRDbnQsIG5ld0xlbmd0aCk7CiAgICAgIHVwZGF0ZVRyZWVNZXRhZGF0YSh0aGlzLCBub2RlLCBuZXdMZW5ndGggLSBvbGRMZW5ndGgsIG5ld0xpbmVGZWVkQ250IC0gb2xkTEZDbnQpOwogICAgICAvLyBuZXcgcmlnaHQgcGllY2UsIGVuZCwgb3JpZ2luYWxFbmRQb3MKICAgICAgdmFyIG5ld1BpZWNlID0gbmV3IFBpZWNlKHBpZWNlLmJ1ZmZlckluZGV4LCBlbmQsIG9yaWdpbmFsRW5kUG9zLCB0aGlzLmdldExpbmVGZWVkQ250KHBpZWNlLmJ1ZmZlckluZGV4LCBlbmQsIG9yaWdpbmFsRW5kUG9zKSwgdGhpcy5vZmZzZXRJbkJ1ZmZlcihwaWVjZS5idWZmZXJJbmRleCwgb3JpZ2luYWxFbmRQb3MpIC0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihwaWVjZS5idWZmZXJJbmRleCwgZW5kKSk7CiAgICAgIHZhciBuZXdOb2RlID0gdGhpcy5yYkluc2VydFJpZ2h0KG5vZGUsIG5ld1BpZWNlKTsKICAgICAgdGhpcy52YWxpZGF0ZUNSTEZXaXRoUHJldk5vZGUobmV3Tm9kZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYXBwZW5kVG9Ob2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmRUb05vZGUobm9kZSwgdmFsdWUpIHsKICAgICAgaWYgKHRoaXMuYWRqdXN0Q2FycmlhZ2VSZXR1cm5Gcm9tTmV4dCh2YWx1ZSwgbm9kZSkpIHsKICAgICAgICB2YWx1ZSArPSAnXG4nOwogICAgICB9CiAgICAgIHZhciBoaXRDUkxGID0gdGhpcy5zaG91bGRDaGVja0NSTEYoKSAmJiB0aGlzLnN0YXJ0V2l0aExGKHZhbHVlKSAmJiB0aGlzLmVuZFdpdGhDUihub2RlKTsKICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gdGhpcy5fYnVmZmVyc1swXS5idWZmZXIubGVuZ3RoOwogICAgICB0aGlzLl9idWZmZXJzWzBdLmJ1ZmZlciArPSB2YWx1ZTsKICAgICAgdmFyIGxpbmVTdGFydHMgPSBjcmVhdGVMaW5lU3RhcnRzRmFzdCh2YWx1ZSwgZmFsc2UpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVTdGFydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsaW5lU3RhcnRzW2ldICs9IHN0YXJ0T2Zmc2V0OwogICAgICB9CiAgICAgIGlmIChoaXRDUkxGKSB7CiAgICAgICAgdmFyIHByZXZTdGFydE9mZnNldCA9IHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0c1t0aGlzLl9idWZmZXJzWzBdLmxpbmVTdGFydHMubGVuZ3RoIC0gMl07CiAgICAgICAgdGhpcy5fYnVmZmVyc1swXS5saW5lU3RhcnRzLnBvcCgpOwogICAgICAgIC8vIF9sYXN0Q2hhbmdlQnVmZmVyUG9zIGlzIGFscmVhZHkgd3JvbmcKICAgICAgICB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zID0gewogICAgICAgICAgbGluZTogdGhpcy5fbGFzdENoYW5nZUJ1ZmZlclBvcy5saW5lIC0gMSwKICAgICAgICAgIGNvbHVtbjogc3RhcnRPZmZzZXQgLSBwcmV2U3RhcnRPZmZzZXQKICAgICAgICB9OwogICAgICB9CiAgICAgIHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0cyA9IHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0cy5jb25jYXQobGluZVN0YXJ0cy5zbGljZSgxKSk7CiAgICAgIHZhciBlbmRJbmRleCA9IHRoaXMuX2J1ZmZlcnNbMF0ubGluZVN0YXJ0cy5sZW5ndGggLSAxOwogICAgICB2YXIgZW5kQ29sdW1uID0gdGhpcy5fYnVmZmVyc1swXS5idWZmZXIubGVuZ3RoIC0gdGhpcy5fYnVmZmVyc1swXS5saW5lU3RhcnRzW2VuZEluZGV4XTsKICAgICAgdmFyIG5ld0VuZCA9IHsKICAgICAgICBsaW5lOiBlbmRJbmRleCwKICAgICAgICBjb2x1bW46IGVuZENvbHVtbgogICAgICB9OwogICAgICB2YXIgbmV3TGVuZ3RoID0gbm9kZS5waWVjZS5sZW5ndGggKyB2YWx1ZS5sZW5ndGg7CiAgICAgIHZhciBvbGRMaW5lRmVlZENudCA9IG5vZGUucGllY2UubGluZUZlZWRDbnQ7CiAgICAgIHZhciBuZXdMaW5lRmVlZENudCA9IHRoaXMuZ2V0TGluZUZlZWRDbnQoMCwgbm9kZS5waWVjZS5zdGFydCwgbmV3RW5kKTsKICAgICAgdmFyIGxmX2RlbHRhID0gbmV3TGluZUZlZWRDbnQgLSBvbGRMaW5lRmVlZENudDsKICAgICAgbm9kZS5waWVjZSA9IG5ldyBQaWVjZShub2RlLnBpZWNlLmJ1ZmZlckluZGV4LCBub2RlLnBpZWNlLnN0YXJ0LCBuZXdFbmQsIG5ld0xpbmVGZWVkQ250LCBuZXdMZW5ndGgpOwogICAgICB0aGlzLl9sYXN0Q2hhbmdlQnVmZmVyUG9zID0gbmV3RW5kOwogICAgICB1cGRhdGVUcmVlTWV0YWRhdGEodGhpcywgbm9kZSwgdmFsdWUubGVuZ3RoLCBsZl9kZWx0YSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibm9kZUF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBub2RlQXQob2Zmc2V0KSB7CiAgICAgIHZhciB4ID0gdGhpcy5yb290OwogICAgICB2YXIgY2FjaGUgPSB0aGlzLl9zZWFyY2hDYWNoZS5nZXQob2Zmc2V0KTsKICAgICAgaWYgKGNhY2hlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG5vZGU6IGNhY2hlLm5vZGUsCiAgICAgICAgICBub2RlU3RhcnRPZmZzZXQ6IGNhY2hlLm5vZGVTdGFydE9mZnNldCwKICAgICAgICAgIHJlbWFpbmRlcjogb2Zmc2V0IC0gY2FjaGUubm9kZVN0YXJ0T2Zmc2V0CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgbm9kZVN0YXJ0T2Zmc2V0ID0gMDsKICAgICAgd2hpbGUgKHggIT09IFNFTlRJTkVMKSB7CiAgICAgICAgaWYgKHguc2l6ZV9sZWZ0ID4gb2Zmc2V0KSB7CiAgICAgICAgICB4ID0geC5sZWZ0OwogICAgICAgIH0gZWxzZSBpZiAoeC5zaXplX2xlZnQgKyB4LnBpZWNlLmxlbmd0aCA+PSBvZmZzZXQpIHsKICAgICAgICAgIG5vZGVTdGFydE9mZnNldCArPSB4LnNpemVfbGVmdDsKICAgICAgICAgIHZhciByZXQgPSB7CiAgICAgICAgICAgIG5vZGU6IHgsCiAgICAgICAgICAgIHJlbWFpbmRlcjogb2Zmc2V0IC0geC5zaXplX2xlZnQsCiAgICAgICAgICAgIG5vZGVTdGFydE9mZnNldDogbm9kZVN0YXJ0T2Zmc2V0CiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5fc2VhcmNoQ2FjaGUuc2V0KHJldCk7CiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvZmZzZXQgLT0geC5zaXplX2xlZnQgKyB4LnBpZWNlLmxlbmd0aDsKICAgICAgICAgIG5vZGVTdGFydE9mZnNldCArPSB4LnNpemVfbGVmdCArIHgucGllY2UubGVuZ3RoOwogICAgICAgICAgeCA9IHgucmlnaHQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIm5vZGVBdDIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5vZGVBdDIobGluZU51bWJlciwgY29sdW1uKSB7CiAgICAgIHZhciB4ID0gdGhpcy5yb290OwogICAgICB2YXIgbm9kZVN0YXJ0T2Zmc2V0ID0gMDsKICAgICAgd2hpbGUgKHggIT09IFNFTlRJTkVMKSB7CiAgICAgICAgaWYgKHgubGVmdCAhPT0gU0VOVElORUwgJiYgeC5sZl9sZWZ0ID49IGxpbmVOdW1iZXIgLSAxKSB7CiAgICAgICAgICB4ID0geC5sZWZ0OwogICAgICAgIH0gZWxzZSBpZiAoeC5sZl9sZWZ0ICsgeC5waWVjZS5saW5lRmVlZENudCA+IGxpbmVOdW1iZXIgLSAxKSB7CiAgICAgICAgICB2YXIgcHJldkFjY3VtdWFsdGVkVmFsdWUgPSB0aGlzLmdldEFjY3VtdWxhdGVkVmFsdWUoeCwgbGluZU51bWJlciAtIHgubGZfbGVmdCAtIDIpOwogICAgICAgICAgdmFyIGFjY3VtdWxhdGVkVmFsdWUgPSB0aGlzLmdldEFjY3VtdWxhdGVkVmFsdWUoeCwgbGluZU51bWJlciAtIHgubGZfbGVmdCAtIDEpOwogICAgICAgICAgbm9kZVN0YXJ0T2Zmc2V0ICs9IHguc2l6ZV9sZWZ0OwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbm9kZTogeCwKICAgICAgICAgICAgcmVtYWluZGVyOiBNYXRoLm1pbihwcmV2QWNjdW11YWx0ZWRWYWx1ZSArIGNvbHVtbiAtIDEsIGFjY3VtdWxhdGVkVmFsdWUpLAogICAgICAgICAgICBub2RlU3RhcnRPZmZzZXQ6IG5vZGVTdGFydE9mZnNldAogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHgubGZfbGVmdCArIHgucGllY2UubGluZUZlZWRDbnQgPT09IGxpbmVOdW1iZXIgLSAxKSB7CiAgICAgICAgICB2YXIgX3ByZXZBY2N1bXVhbHRlZFZhbHVlID0gdGhpcy5nZXRBY2N1bXVsYXRlZFZhbHVlKHgsIGxpbmVOdW1iZXIgLSB4LmxmX2xlZnQgLSAyKTsKICAgICAgICAgIGlmIChfcHJldkFjY3VtdWFsdGVkVmFsdWUgKyBjb2x1bW4gLSAxIDw9IHgucGllY2UubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbm9kZTogeCwKICAgICAgICAgICAgICByZW1haW5kZXI6IF9wcmV2QWNjdW11YWx0ZWRWYWx1ZSArIGNvbHVtbiAtIDEsCiAgICAgICAgICAgICAgbm9kZVN0YXJ0T2Zmc2V0OiBub2RlU3RhcnRPZmZzZXQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbHVtbiAtPSB4LnBpZWNlLmxlbmd0aCAtIF9wcmV2QWNjdW11YWx0ZWRWYWx1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxpbmVOdW1iZXIgLT0geC5sZl9sZWZ0ICsgeC5waWVjZS5saW5lRmVlZENudDsKICAgICAgICAgIG5vZGVTdGFydE9mZnNldCArPSB4LnNpemVfbGVmdCArIHgucGllY2UubGVuZ3RoOwogICAgICAgICAgeCA9IHgucmlnaHQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIHNlYXJjaCBpbiBvcmRlciwgdG8gZmluZCB0aGUgbm9kZSBjb250YWlucyBwb3NpdGlvbi5jb2x1bW4KICAgICAgeCA9IHgubmV4dCgpOwogICAgICB3aGlsZSAoeCAhPT0gU0VOVElORUwpIHsKICAgICAgICBpZiAoeC5waWVjZS5saW5lRmVlZENudCA+IDApIHsKICAgICAgICAgIHZhciBfYWNjdW11bGF0ZWRWYWx1ZTMgPSB0aGlzLmdldEFjY3VtdWxhdGVkVmFsdWUoeCwgMCk7CiAgICAgICAgICB2YXIgX25vZGVTdGFydE9mZnNldCA9IHRoaXMub2Zmc2V0T2ZOb2RlKHgpOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbm9kZTogeCwKICAgICAgICAgICAgcmVtYWluZGVyOiBNYXRoLm1pbihjb2x1bW4gLSAxLCBfYWNjdW11bGF0ZWRWYWx1ZTMpLAogICAgICAgICAgICBub2RlU3RhcnRPZmZzZXQ6IF9ub2RlU3RhcnRPZmZzZXQKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh4LnBpZWNlLmxlbmd0aCA+PSBjb2x1bW4gLSAxKSB7CiAgICAgICAgICAgIHZhciBfbm9kZVN0YXJ0T2Zmc2V0MiA9IHRoaXMub2Zmc2V0T2ZOb2RlKHgpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG5vZGU6IHgsCiAgICAgICAgICAgICAgcmVtYWluZGVyOiBjb2x1bW4gLSAxLAogICAgICAgICAgICAgIG5vZGVTdGFydE9mZnNldDogX25vZGVTdGFydE9mZnNldDIKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbHVtbiAtPSB4LnBpZWNlLmxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgeCA9IHgubmV4dCgpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIm5vZGVDaGFyQ29kZUF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBub2RlQ2hhckNvZGVBdChub2RlLCBvZmZzZXQpIHsKICAgICAgaWYgKG5vZGUucGllY2UubGluZUZlZWRDbnQgPCAxKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHZhciBidWZmZXIgPSB0aGlzLl9idWZmZXJzW25vZGUucGllY2UuYnVmZmVySW5kZXhdOwogICAgICB2YXIgbmV3T2Zmc2V0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihub2RlLnBpZWNlLmJ1ZmZlckluZGV4LCBub2RlLnBpZWNlLnN0YXJ0KSArIG9mZnNldDsKICAgICAgcmV0dXJuIGJ1ZmZlci5idWZmZXIuY2hhckNvZGVBdChuZXdPZmZzZXQpOwogICAgfQogIH0sIHsKICAgIGtleTogIm9mZnNldE9mTm9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb2Zmc2V0T2ZOb2RlKG5vZGUpIHsKICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgdmFyIHBvcyA9IG5vZGUuc2l6ZV9sZWZ0OwogICAgICB3aGlsZSAobm9kZSAhPT0gdGhpcy5yb290KSB7CiAgICAgICAgaWYgKG5vZGUucGFyZW50LnJpZ2h0ID09PSBub2RlKSB7CiAgICAgICAgICBwb3MgKz0gbm9kZS5wYXJlbnQuc2l6ZV9sZWZ0ICsgbm9kZS5wYXJlbnQucGllY2UubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7CiAgICAgIH0KICAgICAgcmV0dXJuIHBvczsKICAgIH0KICAgIC8vICNlbmRyZWdpb24KICAgIC8vICNyZWdpb24gQ1JMRgogIH0sIHsKICAgIGtleTogInNob3VsZENoZWNrQ1JMRiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdWxkQ2hlY2tDUkxGKCkgewogICAgICByZXR1cm4gISh0aGlzLl9FT0xOb3JtYWxpemVkICYmIHRoaXMuX0VPTCA9PT0gJ1xuJyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic3RhcnRXaXRoTEYiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN0YXJ0V2l0aExGKHZhbCkgewogICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgICAgICByZXR1cm4gdmFsLmNoYXJDb2RlQXQoMCkgPT09IDEwOwogICAgICB9CiAgICAgIGlmICh2YWwgPT09IFNFTlRJTkVMIHx8IHZhbC5waWVjZS5saW5lRmVlZENudCA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgcGllY2UgPSB2YWwucGllY2U7CiAgICAgIHZhciBsaW5lU3RhcnRzID0gdGhpcy5fYnVmZmVyc1twaWVjZS5idWZmZXJJbmRleF0ubGluZVN0YXJ0czsKICAgICAgdmFyIGxpbmUgPSBwaWVjZS5zdGFydC5saW5lOwogICAgICB2YXIgc3RhcnRPZmZzZXQgPSBsaW5lU3RhcnRzW2xpbmVdICsgcGllY2Uuc3RhcnQuY29sdW1uOwogICAgICBpZiAobGluZSA9PT0gbGluZVN0YXJ0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgLy8gbGFzdCBsaW5lLCBzbyB0aGVyZSBpcyBubyBsaW5lIGZlZWQgYXQgdGhlIGVuZCBvZiB0aGlzIGxpbmUKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdmFyIG5leHRMaW5lT2Zmc2V0ID0gbGluZVN0YXJ0c1tsaW5lICsgMV07CiAgICAgIGlmIChuZXh0TGluZU9mZnNldCA+IHN0YXJ0T2Zmc2V0ICsgMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fYnVmZmVyc1twaWVjZS5idWZmZXJJbmRleF0uYnVmZmVyLmNoYXJDb2RlQXQoc3RhcnRPZmZzZXQpID09PSAxMDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJlbmRXaXRoQ1IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVuZFdpdGhDUih2YWwpIHsKICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHZhbC5jaGFyQ29kZUF0KHZhbC5sZW5ndGggLSAxKSA9PT0gMTM7CiAgICAgIH0KICAgICAgaWYgKHZhbCA9PT0gU0VOVElORUwgfHwgdmFsLnBpZWNlLmxpbmVGZWVkQ250ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm5vZGVDaGFyQ29kZUF0KHZhbCwgdmFsLnBpZWNlLmxlbmd0aCAtIDEpID09PSAxMzsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZUNSTEZXaXRoUHJldk5vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlQ1JMRldpdGhQcmV2Tm9kZShuZXh0Tm9kZSkgewogICAgICBpZiAodGhpcy5zaG91bGRDaGVja0NSTEYoKSAmJiB0aGlzLnN0YXJ0V2l0aExGKG5leHROb2RlKSkgewogICAgICAgIHZhciBub2RlID0gbmV4dE5vZGUucHJldigpOwogICAgICAgIGlmICh0aGlzLmVuZFdpdGhDUihub2RlKSkgewogICAgICAgICAgdGhpcy5maXhDUkxGKG5vZGUsIG5leHROb2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZUNSTEZXaXRoTmV4dE5vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlQ1JMRldpdGhOZXh0Tm9kZShub2RlKSB7CiAgICAgIGlmICh0aGlzLnNob3VsZENoZWNrQ1JMRigpICYmIHRoaXMuZW5kV2l0aENSKG5vZGUpKSB7CiAgICAgICAgdmFyIG5leHROb2RlID0gbm9kZS5uZXh0KCk7CiAgICAgICAgaWYgKHRoaXMuc3RhcnRXaXRoTEYobmV4dE5vZGUpKSB7CiAgICAgICAgICB0aGlzLmZpeENSTEYobm9kZSwgbmV4dE5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImZpeENSTEYiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpeENSTEYocHJldiwgbmV4dCkgewogICAgICB2YXIgbm9kZXNUb0RlbCA9IFtdOwogICAgICAvLyB1cGRhdGUgbm9kZQogICAgICB2YXIgbGluZVN0YXJ0cyA9IHRoaXMuX2J1ZmZlcnNbcHJldi5waWVjZS5idWZmZXJJbmRleF0ubGluZVN0YXJ0czsKICAgICAgdmFyIG5ld0VuZDsKICAgICAgaWYgKHByZXYucGllY2UuZW5kLmNvbHVtbiA9PT0gMCkgewogICAgICAgIC8vIGl0IG1lYW5zLCBsYXN0IGxpbmUgZW5kcyB3aXRoIFxyLCBub3QgXHJcbgogICAgICAgIG5ld0VuZCA9IHsKICAgICAgICAgIGxpbmU6IHByZXYucGllY2UuZW5kLmxpbmUgLSAxLAogICAgICAgICAgY29sdW1uOiBsaW5lU3RhcnRzW3ByZXYucGllY2UuZW5kLmxpbmVdIC0gbGluZVN0YXJ0c1twcmV2LnBpZWNlLmVuZC5saW5lIC0gMV0gLSAxCiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBcclxuCiAgICAgICAgbmV3RW5kID0gewogICAgICAgICAgbGluZTogcHJldi5waWVjZS5lbmQubGluZSwKICAgICAgICAgIGNvbHVtbjogcHJldi5waWVjZS5lbmQuY29sdW1uIC0gMQogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyIHByZXZOZXdMZW5ndGggPSBwcmV2LnBpZWNlLmxlbmd0aCAtIDE7CiAgICAgIHZhciBwcmV2TmV3TEZDbnQgPSBwcmV2LnBpZWNlLmxpbmVGZWVkQ250IC0gMTsKICAgICAgcHJldi5waWVjZSA9IG5ldyBQaWVjZShwcmV2LnBpZWNlLmJ1ZmZlckluZGV4LCBwcmV2LnBpZWNlLnN0YXJ0LCBuZXdFbmQsIHByZXZOZXdMRkNudCwgcHJldk5ld0xlbmd0aCk7CiAgICAgIHVwZGF0ZVRyZWVNZXRhZGF0YSh0aGlzLCBwcmV2LCAtMSwgLTEpOwogICAgICBpZiAocHJldi5waWVjZS5sZW5ndGggPT09IDApIHsKICAgICAgICBub2Rlc1RvRGVsLnB1c2gocHJldik7CiAgICAgIH0KICAgICAgLy8gdXBkYXRlIG5leHROb2RlCiAgICAgIHZhciBuZXdTdGFydCA9IHsKICAgICAgICBsaW5lOiBuZXh0LnBpZWNlLnN0YXJ0LmxpbmUgKyAxLAogICAgICAgIGNvbHVtbjogMAogICAgICB9OwogICAgICB2YXIgbmV3TGVuZ3RoID0gbmV4dC5waWVjZS5sZW5ndGggLSAxOwogICAgICB2YXIgbmV3TGluZUZlZWRDbnQgPSB0aGlzLmdldExpbmVGZWVkQ250KG5leHQucGllY2UuYnVmZmVySW5kZXgsIG5ld1N0YXJ0LCBuZXh0LnBpZWNlLmVuZCk7CiAgICAgIG5leHQucGllY2UgPSBuZXcgUGllY2UobmV4dC5waWVjZS5idWZmZXJJbmRleCwgbmV3U3RhcnQsIG5leHQucGllY2UuZW5kLCBuZXdMaW5lRmVlZENudCwgbmV3TGVuZ3RoKTsKICAgICAgdXBkYXRlVHJlZU1ldGFkYXRhKHRoaXMsIG5leHQsIC0xLCAtMSk7CiAgICAgIGlmIChuZXh0LnBpZWNlLmxlbmd0aCA9PT0gMCkgewogICAgICAgIG5vZGVzVG9EZWwucHVzaChuZXh0KTsKICAgICAgfQogICAgICAvLyBjcmVhdGUgbmV3IHBpZWNlIHdoaWNoIGNvbnRhaW5zIFxyXG4KICAgICAgdmFyIHBpZWNlcyA9IHRoaXMuY3JlYXRlTmV3UGllY2VzKCdcclxuJyk7CiAgICAgIHRoaXMucmJJbnNlcnRSaWdodChwcmV2LCBwaWVjZXNbMF0pOwogICAgICAvLyBkZWxldGUgZW1wdHkgbm9kZXMKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlc1RvRGVsLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcmJEZWxldGUodGhpcywgbm9kZXNUb0RlbFtpXSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGp1c3RDYXJyaWFnZVJldHVybkZyb21OZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGp1c3RDYXJyaWFnZVJldHVybkZyb21OZXh0KHZhbHVlLCBub2RlKSB7CiAgICAgIGlmICh0aGlzLnNob3VsZENoZWNrQ1JMRigpICYmIHRoaXMuZW5kV2l0aENSKHZhbHVlKSkgewogICAgICAgIHZhciBuZXh0Tm9kZSA9IG5vZGUubmV4dCgpOwogICAgICAgIGlmICh0aGlzLnN0YXJ0V2l0aExGKG5leHROb2RlKSkgewogICAgICAgICAgLy8gbW92ZSBgXG5gIGZvcndhcmQKICAgICAgICAgIHZhbHVlICs9ICdcbic7CiAgICAgICAgICBpZiAobmV4dE5vZGUucGllY2UubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHJiRGVsZXRlKHRoaXMsIG5leHROb2RlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBwaWVjZSA9IG5leHROb2RlLnBpZWNlOwogICAgICAgICAgICB2YXIgbmV3U3RhcnQgPSB7CiAgICAgICAgICAgICAgbGluZTogcGllY2Uuc3RhcnQubGluZSArIDEsCiAgICAgICAgICAgICAgY29sdW1uOiAwCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBuZXdMZW5ndGggPSBwaWVjZS5sZW5ndGggLSAxOwogICAgICAgICAgICB2YXIgbmV3TGluZUZlZWRDbnQgPSB0aGlzLmdldExpbmVGZWVkQ250KHBpZWNlLmJ1ZmZlckluZGV4LCBuZXdTdGFydCwgcGllY2UuZW5kKTsKICAgICAgICAgICAgbmV4dE5vZGUucGllY2UgPSBuZXcgUGllY2UocGllY2UuYnVmZmVySW5kZXgsIG5ld1N0YXJ0LCBwaWVjZS5lbmQsIG5ld0xpbmVGZWVkQ250LCBuZXdMZW5ndGgpOwogICAgICAgICAgICB1cGRhdGVUcmVlTWV0YWRhdGEodGhpcywgbmV4dE5vZGUsIC0xLCAtMSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gI2VuZHJlZ2lvbgogICAgLy8gI2VuZHJlZ2lvbgogICAgLy8gI3JlZ2lvbiBUcmVlIG9wZXJhdGlvbnMKICB9LCB7CiAgICBrZXk6ICJpdGVyYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpdGVyYXRlKG5vZGUsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChub2RlID09PSBTRU5USU5FTCkgewogICAgICAgIHJldHVybiBjYWxsYmFjayhTRU5USU5FTCk7CiAgICAgIH0KICAgICAgdmFyIGxlZnRSZXQgPSB0aGlzLml0ZXJhdGUobm9kZS5sZWZ0LCBjYWxsYmFjayk7CiAgICAgIGlmICghbGVmdFJldCkgewogICAgICAgIHJldHVybiBsZWZ0UmV0OwogICAgICB9CiAgICAgIHJldHVybiBjYWxsYmFjayhub2RlKSAmJiB0aGlzLml0ZXJhdGUobm9kZS5yaWdodCwgY2FsbGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogImdldE5vZGVDb250ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROb2RlQ29udGVudChub2RlKSB7CiAgICAgIGlmIChub2RlID09PSBTRU5USU5FTCkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgICB2YXIgYnVmZmVyID0gdGhpcy5fYnVmZmVyc1tub2RlLnBpZWNlLmJ1ZmZlckluZGV4XTsKICAgICAgdmFyIHBpZWNlID0gbm9kZS5waWVjZTsKICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihwaWVjZS5idWZmZXJJbmRleCwgcGllY2Uuc3RhcnQpOwogICAgICB2YXIgZW5kT2Zmc2V0ID0gdGhpcy5vZmZzZXRJbkJ1ZmZlcihwaWVjZS5idWZmZXJJbmRleCwgcGllY2UuZW5kKTsKICAgICAgdmFyIGN1cnJlbnRDb250ZW50ID0gYnVmZmVyLmJ1ZmZlci5zdWJzdHJpbmcoc3RhcnRPZmZzZXQsIGVuZE9mZnNldCk7CiAgICAgIHJldHVybiBjdXJyZW50Q29udGVudDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRQaWVjZUNvbnRlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBpZWNlQ29udGVudChwaWVjZSkgewogICAgICB2YXIgYnVmZmVyID0gdGhpcy5fYnVmZmVyc1twaWVjZS5idWZmZXJJbmRleF07CiAgICAgIHZhciBzdGFydE9mZnNldCA9IHRoaXMub2Zmc2V0SW5CdWZmZXIocGllY2UuYnVmZmVySW5kZXgsIHBpZWNlLnN0YXJ0KTsKICAgICAgdmFyIGVuZE9mZnNldCA9IHRoaXMub2Zmc2V0SW5CdWZmZXIocGllY2UuYnVmZmVySW5kZXgsIHBpZWNlLmVuZCk7CiAgICAgIHZhciBjdXJyZW50Q29udGVudCA9IGJ1ZmZlci5idWZmZXIuc3Vic3RyaW5nKHN0YXJ0T2Zmc2V0LCBlbmRPZmZzZXQpOwogICAgICByZXR1cm4gY3VycmVudENvbnRlbnQ7CiAgICB9CiAgICAvKioKICAgICAqICAgICAgbm9kZSAgICAgICAgICAgICAgbm9kZQogICAgICogICAgIC8gIFwgICAgICAgICAgICAgIC8gIFwKICAgICAqICAgIGEgICBiICAgIDwtLS0tICAgYSAgICBiCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAvCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgIHoKICAgICAqLwogIH0sIHsKICAgIGtleTogInJiSW5zZXJ0UmlnaHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJiSW5zZXJ0UmlnaHQobm9kZSwgcCkgewogICAgICB2YXIgeiA9IG5ldyBUcmVlTm9kZShwLCAxIC8qIE5vZGVDb2xvci5SZWQgKi8pOwogICAgICB6LmxlZnQgPSBTRU5USU5FTDsKICAgICAgei5yaWdodCA9IFNFTlRJTkVMOwogICAgICB6LnBhcmVudCA9IFNFTlRJTkVMOwogICAgICB6LnNpemVfbGVmdCA9IDA7CiAgICAgIHoubGZfbGVmdCA9IDA7CiAgICAgIHZhciB4ID0gdGhpcy5yb290OwogICAgICBpZiAoeCA9PT0gU0VOVElORUwpIHsKICAgICAgICB0aGlzLnJvb3QgPSB6OwogICAgICAgIHouY29sb3IgPSAwIC8qIE5vZGVDb2xvci5CbGFjayAqLzsKICAgICAgfSBlbHNlIGlmIChub2RlLnJpZ2h0ID09PSBTRU5USU5FTCkgewogICAgICAgIG5vZGUucmlnaHQgPSB6OwogICAgICAgIHoucGFyZW50ID0gbm9kZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgbmV4dE5vZGUgPSBsZWZ0ZXN0KG5vZGUucmlnaHQpOwogICAgICAgIG5leHROb2RlLmxlZnQgPSB6OwogICAgICAgIHoucGFyZW50ID0gbmV4dE5vZGU7CiAgICAgIH0KICAgICAgZml4SW5zZXJ0KHRoaXMsIHopOwogICAgICByZXR1cm4gejsKICAgIH0KICAgIC8qKgogICAgICogICAgICBub2RlICAgICAgICAgICAgICBub2RlCiAgICAgKiAgICAgLyAgXCAgICAgICAgICAgICAgLyAgXAogICAgICogICAgYSAgIGIgICAgIC0tLS0+ICAgYSAgICBiCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgXAogICAgICogICAgICAgICAgICAgICAgICAgICAgICB6CiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJyYkluc2VydExlZnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJiSW5zZXJ0TGVmdChub2RlLCBwKSB7CiAgICAgIHZhciB6ID0gbmV3IFRyZWVOb2RlKHAsIDEgLyogTm9kZUNvbG9yLlJlZCAqLyk7CiAgICAgIHoubGVmdCA9IFNFTlRJTkVMOwogICAgICB6LnJpZ2h0ID0gU0VOVElORUw7CiAgICAgIHoucGFyZW50ID0gU0VOVElORUw7CiAgICAgIHouc2l6ZV9sZWZ0ID0gMDsKICAgICAgei5sZl9sZWZ0ID0gMDsKICAgICAgaWYgKHRoaXMucm9vdCA9PT0gU0VOVElORUwpIHsKICAgICAgICB0aGlzLnJvb3QgPSB6OwogICAgICAgIHouY29sb3IgPSAwIC8qIE5vZGVDb2xvci5CbGFjayAqLzsKICAgICAgfSBlbHNlIGlmIChub2RlLmxlZnQgPT09IFNFTlRJTkVMKSB7CiAgICAgICAgbm9kZS5sZWZ0ID0gejsKICAgICAgICB6LnBhcmVudCA9IG5vZGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHByZXZOb2RlID0gcmlnaHR0ZXN0KG5vZGUubGVmdCk7IC8vIGEKICAgICAgICBwcmV2Tm9kZS5yaWdodCA9IHo7CiAgICAgICAgei5wYXJlbnQgPSBwcmV2Tm9kZTsKICAgICAgfQogICAgICBmaXhJbnNlcnQodGhpcywgeik7CiAgICAgIHJldHVybiB6OwogICAgfQogIH1dKTsKICByZXR1cm4gUGllY2VUcmVlQmFzZTsKfSgpOw=="},{"version":3,"names":["Position","Range","FindMatch","SENTINEL","TreeNode","fixInsert","leftest","rbDelete","righttest","updateTreeMetadata","Searcher","createFindMatch","isValidMatch","AverageBufferSize","createUintArray","arr","r","length","Uint16Array","Uint32Array","set","LineStarts","lineStarts","cr","lf","crlf","isBasicASCII","createLineStartsFast","str","readonly","rLength","i","len","chr","charCodeAt","createLineStarts","result","Piece","bufferIndex","start","end","lineFeedCnt","StringBuffer","buffer","PieceTreeSnapshot","tree","BOM","_pieces","_tree","_BOM","_index","root","iterate","node","push","piece","getPieceContent","PieceTreeSearchCache","limit","_limit","_cache","offset","nodePos","nodeStartOffset","lineNumber","nodeStartLineNumber","nodePosition","shift","hasInvalidVal","tmp","parent","newArr","entry","PieceTreeBase","chunks","eol","eolNormalized","create","_buffers","_lastChangeBufferPos","line","column","_lineCnt","_length","_EOL","_EOLLength","_EOLNormalized","lastNode","rbInsertRight","_searchCache","_lastVisitedLine","value","computeBufferMetadata","averageBufferSize","min","Math","floor","max","tempChunk","tempChunkLen","getNodeContent","text","replace","newEOL","normalizeEOL","leftLen","x","left","lf_left","size_left","accumualtedValInCurrentIndex","getAccumulatedValue","right","lfCnt","originalOffset","out","getIndexOf","index","lineStartOffset","getOffsetAt","remainder","range","startLineNumber","endLineNumber","startColumn","endColumn","startPosition","nodeAt2","endPosition","getValueInRange2","getEOL","startOffset","offsetInBuffer","substring","ret","next","substr","lines","linesLength","currentLine","danglingCR","pieceLength","pieceStartLine","pieceEndLine","pieceStartOffset","getLineRawContent","matchingNode","targetOffset","_getCharCode","getLineCount","getLength","searcher","startCursor","endCursor","searchData","captureMatches","limitResultCount","resultLen","startOffsetInBuffer","m","searchText","_wordSeparators","reset","positionInBuffer","getLineFeedCnt","retStartColumn","retEndColumn","searchRange","wordSeparators","regex","findMatchesInNode","currentNode","lineBreakCnt","nextLineStartOffset","getLineContent","_findMatchesInLine","deltaOffset","simpleSearch","searchString","searchStringLen","textLength","lastMatchIndex","indexOf","nodeAt","insertPosInBuffer","appendToNode","insertContentToNodeLeft","validate","nodesToDel","newRightPiece","shouldCheckCRLF","endWithCR","headOfRight","nodeCharCodeAt","newStart","startWithLF","tailOfLeft","previousPos","deleteNodeTail","newPieces","createNewPieces","tmpNode","k","deleteNodes","insertContentToNodeRight","pieces","rbInsertLeft","cnt","startNode","endNode","startSplitPosInBuffer","endSplitPosInBuffer","validateCRLFWithPrevNode","deleteNodeHead","validateCRLFWithNextNode","shrinkNode","secondNode","prev","nPiece","newNode","adjustCarriageReturnFromNext","low","high","mid","midStop","midStart","endOffset","previousCharOffset","cursor","nodes","lastChar","splitText","concat","slice","endIndex","endPos","newPiece","cache","get2","prevAccumulatedValue","accumulatedValue","originalLineNumber","pos","lineCnt","realLineCnt","expectedLineStartIndex","originalLFCnt","originalEndOffset","newEnd","newEndOffset","newLineFeedCnt","lf_delta","size_delta","newLength","originalStartOffset","newStartOffset","originalStartPos","originalEndPos","oldLength","oldLFCnt","hitCRLF","prevStartOffset","pop","oldLineFeedCnt","get","prevAccumualtedValue","offsetOfNode","newOffset","val","nextLineOffset","nextNode","fixCRLF","prevNewLength","prevNewLFCnt","callback","leftRet","currentContent","p","z","color","prevNode"],"sources":["/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/model/pieceTreeTextBuffer/pieceTreeBase.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Position } from '../../core/position.js';\nimport { Range } from '../../core/range.js';\nimport { FindMatch } from '../../model.js';\nimport { SENTINEL, TreeNode, fixInsert, leftest, rbDelete, righttest, updateTreeMetadata } from './rbTreeBase.js';\nimport { Searcher, createFindMatch, isValidMatch } from '../textModelSearch.js';\n// const lfRegex = new RegExp(/\\r\\n|\\r|\\n/g);\nexport const AverageBufferSize = 65535;\nexport function createUintArray(arr) {\n    let r;\n    if (arr[arr.length - 1] < 65536) {\n        r = new Uint16Array(arr.length);\n    }\n    else {\n        r = new Uint32Array(arr.length);\n    }\n    r.set(arr, 0);\n    return r;\n}\nexport class LineStarts {\n    constructor(lineStarts, cr, lf, crlf, isBasicASCII) {\n        this.lineStarts = lineStarts;\n        this.cr = cr;\n        this.lf = lf;\n        this.crlf = crlf;\n        this.isBasicASCII = isBasicASCII;\n    }\n}\nexport function createLineStartsFast(str, readonly = true) {\n    const r = [0];\n    let rLength = 1;\n    for (let i = 0, len = str.length; i < len; i++) {\n        const chr = str.charCodeAt(i);\n        if (chr === 13 /* CharCode.CarriageReturn */) {\n            if (i + 1 < len && str.charCodeAt(i + 1) === 10 /* CharCode.LineFeed */) {\n                // \\r\\n... case\n                r[rLength++] = i + 2;\n                i++; // skip \\n\n            }\n            else {\n                // \\r... case\n                r[rLength++] = i + 1;\n            }\n        }\n        else if (chr === 10 /* CharCode.LineFeed */) {\n            r[rLength++] = i + 1;\n        }\n    }\n    if (readonly) {\n        return createUintArray(r);\n    }\n    else {\n        return r;\n    }\n}\nexport function createLineStarts(r, str) {\n    r.length = 0;\n    r[0] = 0;\n    let rLength = 1;\n    let cr = 0, lf = 0, crlf = 0;\n    let isBasicASCII = true;\n    for (let i = 0, len = str.length; i < len; i++) {\n        const chr = str.charCodeAt(i);\n        if (chr === 13 /* CharCode.CarriageReturn */) {\n            if (i + 1 < len && str.charCodeAt(i + 1) === 10 /* CharCode.LineFeed */) {\n                // \\r\\n... case\n                crlf++;\n                r[rLength++] = i + 2;\n                i++; // skip \\n\n            }\n            else {\n                cr++;\n                // \\r... case\n                r[rLength++] = i + 1;\n            }\n        }\n        else if (chr === 10 /* CharCode.LineFeed */) {\n            lf++;\n            r[rLength++] = i + 1;\n        }\n        else {\n            if (isBasicASCII) {\n                if (chr !== 9 /* CharCode.Tab */ && (chr < 32 || chr > 126)) {\n                    isBasicASCII = false;\n                }\n            }\n        }\n    }\n    const result = new LineStarts(createUintArray(r), cr, lf, crlf, isBasicASCII);\n    r.length = 0;\n    return result;\n}\nexport class Piece {\n    constructor(bufferIndex, start, end, lineFeedCnt, length) {\n        this.bufferIndex = bufferIndex;\n        this.start = start;\n        this.end = end;\n        this.lineFeedCnt = lineFeedCnt;\n        this.length = length;\n    }\n}\nexport class StringBuffer {\n    constructor(buffer, lineStarts) {\n        this.buffer = buffer;\n        this.lineStarts = lineStarts;\n    }\n}\n/**\n * Readonly snapshot for piece tree.\n * In a real multiple thread environment, to make snapshot reading always work correctly, we need to\n * 1. Make TreeNode.piece immutable, then reading and writing can run in parallel.\n * 2. TreeNode/Buffers normalization should not happen during snapshot reading.\n */\nclass PieceTreeSnapshot {\n    constructor(tree, BOM) {\n        this._pieces = [];\n        this._tree = tree;\n        this._BOM = BOM;\n        this._index = 0;\n        if (tree.root !== SENTINEL) {\n            tree.iterate(tree.root, node => {\n                if (node !== SENTINEL) {\n                    this._pieces.push(node.piece);\n                }\n                return true;\n            });\n        }\n    }\n    read() {\n        if (this._pieces.length === 0) {\n            if (this._index === 0) {\n                this._index++;\n                return this._BOM;\n            }\n            else {\n                return null;\n            }\n        }\n        if (this._index > this._pieces.length - 1) {\n            return null;\n        }\n        if (this._index === 0) {\n            return this._BOM + this._tree.getPieceContent(this._pieces[this._index++]);\n        }\n        return this._tree.getPieceContent(this._pieces[this._index++]);\n    }\n}\nclass PieceTreeSearchCache {\n    constructor(limit) {\n        this._limit = limit;\n        this._cache = [];\n    }\n    get(offset) {\n        for (let i = this._cache.length - 1; i >= 0; i--) {\n            const nodePos = this._cache[i];\n            if (nodePos.nodeStartOffset <= offset && nodePos.nodeStartOffset + nodePos.node.piece.length >= offset) {\n                return nodePos;\n            }\n        }\n        return null;\n    }\n    get2(lineNumber) {\n        for (let i = this._cache.length - 1; i >= 0; i--) {\n            const nodePos = this._cache[i];\n            if (nodePos.nodeStartLineNumber && nodePos.nodeStartLineNumber < lineNumber && nodePos.nodeStartLineNumber + nodePos.node.piece.lineFeedCnt >= lineNumber) {\n                return nodePos;\n            }\n        }\n        return null;\n    }\n    set(nodePosition) {\n        if (this._cache.length >= this._limit) {\n            this._cache.shift();\n        }\n        this._cache.push(nodePosition);\n    }\n    validate(offset) {\n        let hasInvalidVal = false;\n        const tmp = this._cache;\n        for (let i = 0; i < tmp.length; i++) {\n            const nodePos = tmp[i];\n            if (nodePos.node.parent === null || nodePos.nodeStartOffset >= offset) {\n                tmp[i] = null;\n                hasInvalidVal = true;\n                continue;\n            }\n        }\n        if (hasInvalidVal) {\n            const newArr = [];\n            for (const entry of tmp) {\n                if (entry !== null) {\n                    newArr.push(entry);\n                }\n            }\n            this._cache = newArr;\n        }\n    }\n}\nexport class PieceTreeBase {\n    constructor(chunks, eol, eolNormalized) {\n        this.create(chunks, eol, eolNormalized);\n    }\n    create(chunks, eol, eolNormalized) {\n        this._buffers = [\n            new StringBuffer('', [0])\n        ];\n        this._lastChangeBufferPos = { line: 0, column: 0 };\n        this.root = SENTINEL;\n        this._lineCnt = 1;\n        this._length = 0;\n        this._EOL = eol;\n        this._EOLLength = eol.length;\n        this._EOLNormalized = eolNormalized;\n        let lastNode = null;\n        for (let i = 0, len = chunks.length; i < len; i++) {\n            if (chunks[i].buffer.length > 0) {\n                if (!chunks[i].lineStarts) {\n                    chunks[i].lineStarts = createLineStartsFast(chunks[i].buffer);\n                }\n                const piece = new Piece(i + 1, { line: 0, column: 0 }, { line: chunks[i].lineStarts.length - 1, column: chunks[i].buffer.length - chunks[i].lineStarts[chunks[i].lineStarts.length - 1] }, chunks[i].lineStarts.length - 1, chunks[i].buffer.length);\n                this._buffers.push(chunks[i]);\n                lastNode = this.rbInsertRight(lastNode, piece);\n            }\n        }\n        this._searchCache = new PieceTreeSearchCache(1);\n        this._lastVisitedLine = { lineNumber: 0, value: '' };\n        this.computeBufferMetadata();\n    }\n    normalizeEOL(eol) {\n        const averageBufferSize = AverageBufferSize;\n        const min = averageBufferSize - Math.floor(averageBufferSize / 3);\n        const max = min * 2;\n        let tempChunk = '';\n        let tempChunkLen = 0;\n        const chunks = [];\n        this.iterate(this.root, node => {\n            const str = this.getNodeContent(node);\n            const len = str.length;\n            if (tempChunkLen <= min || tempChunkLen + len < max) {\n                tempChunk += str;\n                tempChunkLen += len;\n                return true;\n            }\n            // flush anyways\n            const text = tempChunk.replace(/\\r\\n|\\r|\\n/g, eol);\n            chunks.push(new StringBuffer(text, createLineStartsFast(text)));\n            tempChunk = str;\n            tempChunkLen = len;\n            return true;\n        });\n        if (tempChunkLen > 0) {\n            const text = tempChunk.replace(/\\r\\n|\\r|\\n/g, eol);\n            chunks.push(new StringBuffer(text, createLineStartsFast(text)));\n        }\n        this.create(chunks, eol, true);\n    }\n    // #region Buffer API\n    getEOL() {\n        return this._EOL;\n    }\n    setEOL(newEOL) {\n        this._EOL = newEOL;\n        this._EOLLength = this._EOL.length;\n        this.normalizeEOL(newEOL);\n    }\n    createSnapshot(BOM) {\n        return new PieceTreeSnapshot(this, BOM);\n    }\n    getOffsetAt(lineNumber, column) {\n        let leftLen = 0; // inorder\n        let x = this.root;\n        while (x !== SENTINEL) {\n            if (x.left !== SENTINEL && x.lf_left + 1 >= lineNumber) {\n                x = x.left;\n            }\n            else if (x.lf_left + x.piece.lineFeedCnt + 1 >= lineNumber) {\n                leftLen += x.size_left;\n                // lineNumber >= 2\n                const accumualtedValInCurrentIndex = this.getAccumulatedValue(x, lineNumber - x.lf_left - 2);\n                return leftLen += accumualtedValInCurrentIndex + column - 1;\n            }\n            else {\n                lineNumber -= x.lf_left + x.piece.lineFeedCnt;\n                leftLen += x.size_left + x.piece.length;\n                x = x.right;\n            }\n        }\n        return leftLen;\n    }\n    getPositionAt(offset) {\n        offset = Math.floor(offset);\n        offset = Math.max(0, offset);\n        let x = this.root;\n        let lfCnt = 0;\n        const originalOffset = offset;\n        while (x !== SENTINEL) {\n            if (x.size_left !== 0 && x.size_left >= offset) {\n                x = x.left;\n            }\n            else if (x.size_left + x.piece.length >= offset) {\n                const out = this.getIndexOf(x, offset - x.size_left);\n                lfCnt += x.lf_left + out.index;\n                if (out.index === 0) {\n                    const lineStartOffset = this.getOffsetAt(lfCnt + 1, 1);\n                    const column = originalOffset - lineStartOffset;\n                    return new Position(lfCnt + 1, column + 1);\n                }\n                return new Position(lfCnt + 1, out.remainder + 1);\n            }\n            else {\n                offset -= x.size_left + x.piece.length;\n                lfCnt += x.lf_left + x.piece.lineFeedCnt;\n                if (x.right === SENTINEL) {\n                    // last node\n                    const lineStartOffset = this.getOffsetAt(lfCnt + 1, 1);\n                    const column = originalOffset - offset - lineStartOffset;\n                    return new Position(lfCnt + 1, column + 1);\n                }\n                else {\n                    x = x.right;\n                }\n            }\n        }\n        return new Position(1, 1);\n    }\n    getValueInRange(range, eol) {\n        if (range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn) {\n            return '';\n        }\n        const startPosition = this.nodeAt2(range.startLineNumber, range.startColumn);\n        const endPosition = this.nodeAt2(range.endLineNumber, range.endColumn);\n        const value = this.getValueInRange2(startPosition, endPosition);\n        if (eol) {\n            if (eol !== this._EOL || !this._EOLNormalized) {\n                return value.replace(/\\r\\n|\\r|\\n/g, eol);\n            }\n            if (eol === this.getEOL() && this._EOLNormalized) {\n                if (eol === '\\r\\n') {\n                }\n                return value;\n            }\n            return value.replace(/\\r\\n|\\r|\\n/g, eol);\n        }\n        return value;\n    }\n    getValueInRange2(startPosition, endPosition) {\n        if (startPosition.node === endPosition.node) {\n            const node = startPosition.node;\n            const buffer = this._buffers[node.piece.bufferIndex].buffer;\n            const startOffset = this.offsetInBuffer(node.piece.bufferIndex, node.piece.start);\n            return buffer.substring(startOffset + startPosition.remainder, startOffset + endPosition.remainder);\n        }\n        let x = startPosition.node;\n        const buffer = this._buffers[x.piece.bufferIndex].buffer;\n        const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n        let ret = buffer.substring(startOffset + startPosition.remainder, startOffset + x.piece.length);\n        x = x.next();\n        while (x !== SENTINEL) {\n            const buffer = this._buffers[x.piece.bufferIndex].buffer;\n            const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n            if (x === endPosition.node) {\n                ret += buffer.substring(startOffset, startOffset + endPosition.remainder);\n                break;\n            }\n            else {\n                ret += buffer.substr(startOffset, x.piece.length);\n            }\n            x = x.next();\n        }\n        return ret;\n    }\n    getLinesContent() {\n        const lines = [];\n        let linesLength = 0;\n        let currentLine = '';\n        let danglingCR = false;\n        this.iterate(this.root, node => {\n            if (node === SENTINEL) {\n                return true;\n            }\n            const piece = node.piece;\n            let pieceLength = piece.length;\n            if (pieceLength === 0) {\n                return true;\n            }\n            const buffer = this._buffers[piece.bufferIndex].buffer;\n            const lineStarts = this._buffers[piece.bufferIndex].lineStarts;\n            const pieceStartLine = piece.start.line;\n            const pieceEndLine = piece.end.line;\n            let pieceStartOffset = lineStarts[pieceStartLine] + piece.start.column;\n            if (danglingCR) {\n                if (buffer.charCodeAt(pieceStartOffset) === 10 /* CharCode.LineFeed */) {\n                    // pretend the \\n was in the previous piece..\n                    pieceStartOffset++;\n                    pieceLength--;\n                }\n                lines[linesLength++] = currentLine;\n                currentLine = '';\n                danglingCR = false;\n                if (pieceLength === 0) {\n                    return true;\n                }\n            }\n            if (pieceStartLine === pieceEndLine) {\n                // this piece has no new lines\n                if (!this._EOLNormalized && buffer.charCodeAt(pieceStartOffset + pieceLength - 1) === 13 /* CharCode.CarriageReturn */) {\n                    danglingCR = true;\n                    currentLine += buffer.substr(pieceStartOffset, pieceLength - 1);\n                }\n                else {\n                    currentLine += buffer.substr(pieceStartOffset, pieceLength);\n                }\n                return true;\n            }\n            // add the text before the first line start in this piece\n            currentLine += (this._EOLNormalized\n                ? buffer.substring(pieceStartOffset, Math.max(pieceStartOffset, lineStarts[pieceStartLine + 1] - this._EOLLength))\n                : buffer.substring(pieceStartOffset, lineStarts[pieceStartLine + 1]).replace(/(\\r\\n|\\r|\\n)$/, ''));\n            lines[linesLength++] = currentLine;\n            for (let line = pieceStartLine + 1; line < pieceEndLine; line++) {\n                currentLine = (this._EOLNormalized\n                    ? buffer.substring(lineStarts[line], lineStarts[line + 1] - this._EOLLength)\n                    : buffer.substring(lineStarts[line], lineStarts[line + 1]).replace(/(\\r\\n|\\r|\\n)$/, ''));\n                lines[linesLength++] = currentLine;\n            }\n            if (!this._EOLNormalized && buffer.charCodeAt(lineStarts[pieceEndLine] + piece.end.column - 1) === 13 /* CharCode.CarriageReturn */) {\n                danglingCR = true;\n                if (piece.end.column === 0) {\n                    // The last line ended with a \\r, let's undo the push, it will be pushed by next iteration\n                    linesLength--;\n                }\n                else {\n                    currentLine = buffer.substr(lineStarts[pieceEndLine], piece.end.column - 1);\n                }\n            }\n            else {\n                currentLine = buffer.substr(lineStarts[pieceEndLine], piece.end.column);\n            }\n            return true;\n        });\n        if (danglingCR) {\n            lines[linesLength++] = currentLine;\n            currentLine = '';\n        }\n        lines[linesLength++] = currentLine;\n        return lines;\n    }\n    getLength() {\n        return this._length;\n    }\n    getLineCount() {\n        return this._lineCnt;\n    }\n    getLineContent(lineNumber) {\n        if (this._lastVisitedLine.lineNumber === lineNumber) {\n            return this._lastVisitedLine.value;\n        }\n        this._lastVisitedLine.lineNumber = lineNumber;\n        if (lineNumber === this._lineCnt) {\n            this._lastVisitedLine.value = this.getLineRawContent(lineNumber);\n        }\n        else if (this._EOLNormalized) {\n            this._lastVisitedLine.value = this.getLineRawContent(lineNumber, this._EOLLength);\n        }\n        else {\n            this._lastVisitedLine.value = this.getLineRawContent(lineNumber).replace(/(\\r\\n|\\r|\\n)$/, '');\n        }\n        return this._lastVisitedLine.value;\n    }\n    _getCharCode(nodePos) {\n        if (nodePos.remainder === nodePos.node.piece.length) {\n            // the char we want to fetch is at the head of next node.\n            const matchingNode = nodePos.node.next();\n            if (!matchingNode) {\n                return 0;\n            }\n            const buffer = this._buffers[matchingNode.piece.bufferIndex];\n            const startOffset = this.offsetInBuffer(matchingNode.piece.bufferIndex, matchingNode.piece.start);\n            return buffer.buffer.charCodeAt(startOffset);\n        }\n        else {\n            const buffer = this._buffers[nodePos.node.piece.bufferIndex];\n            const startOffset = this.offsetInBuffer(nodePos.node.piece.bufferIndex, nodePos.node.piece.start);\n            const targetOffset = startOffset + nodePos.remainder;\n            return buffer.buffer.charCodeAt(targetOffset);\n        }\n    }\n    getLineCharCode(lineNumber, index) {\n        const nodePos = this.nodeAt2(lineNumber, index + 1);\n        return this._getCharCode(nodePos);\n    }\n    getLineLength(lineNumber) {\n        if (lineNumber === this.getLineCount()) {\n            const startOffset = this.getOffsetAt(lineNumber, 1);\n            return this.getLength() - startOffset;\n        }\n        return this.getOffsetAt(lineNumber + 1, 1) - this.getOffsetAt(lineNumber, 1) - this._EOLLength;\n    }\n    findMatchesInNode(node, searcher, startLineNumber, startColumn, startCursor, endCursor, searchData, captureMatches, limitResultCount, resultLen, result) {\n        const buffer = this._buffers[node.piece.bufferIndex];\n        const startOffsetInBuffer = this.offsetInBuffer(node.piece.bufferIndex, node.piece.start);\n        const start = this.offsetInBuffer(node.piece.bufferIndex, startCursor);\n        const end = this.offsetInBuffer(node.piece.bufferIndex, endCursor);\n        let m;\n        // Reset regex to search from the beginning\n        const ret = { line: 0, column: 0 };\n        let searchText;\n        let offsetInBuffer;\n        if (searcher._wordSeparators) {\n            searchText = buffer.buffer.substring(start, end);\n            offsetInBuffer = (offset) => offset + start;\n            searcher.reset(0);\n        }\n        else {\n            searchText = buffer.buffer;\n            offsetInBuffer = (offset) => offset;\n            searcher.reset(start);\n        }\n        do {\n            m = searcher.next(searchText);\n            if (m) {\n                if (offsetInBuffer(m.index) >= end) {\n                    return resultLen;\n                }\n                this.positionInBuffer(node, offsetInBuffer(m.index) - startOffsetInBuffer, ret);\n                const lineFeedCnt = this.getLineFeedCnt(node.piece.bufferIndex, startCursor, ret);\n                const retStartColumn = ret.line === startCursor.line ? ret.column - startCursor.column + startColumn : ret.column + 1;\n                const retEndColumn = retStartColumn + m[0].length;\n                result[resultLen++] = createFindMatch(new Range(startLineNumber + lineFeedCnt, retStartColumn, startLineNumber + lineFeedCnt, retEndColumn), m, captureMatches);\n                if (offsetInBuffer(m.index) + m[0].length >= end) {\n                    return resultLen;\n                }\n                if (resultLen >= limitResultCount) {\n                    return resultLen;\n                }\n            }\n        } while (m);\n        return resultLen;\n    }\n    findMatchesLineByLine(searchRange, searchData, captureMatches, limitResultCount) {\n        const result = [];\n        let resultLen = 0;\n        const searcher = new Searcher(searchData.wordSeparators, searchData.regex);\n        let startPosition = this.nodeAt2(searchRange.startLineNumber, searchRange.startColumn);\n        if (startPosition === null) {\n            return [];\n        }\n        const endPosition = this.nodeAt2(searchRange.endLineNumber, searchRange.endColumn);\n        if (endPosition === null) {\n            return [];\n        }\n        let start = this.positionInBuffer(startPosition.node, startPosition.remainder);\n        const end = this.positionInBuffer(endPosition.node, endPosition.remainder);\n        if (startPosition.node === endPosition.node) {\n            this.findMatchesInNode(startPosition.node, searcher, searchRange.startLineNumber, searchRange.startColumn, start, end, searchData, captureMatches, limitResultCount, resultLen, result);\n            return result;\n        }\n        let startLineNumber = searchRange.startLineNumber;\n        let currentNode = startPosition.node;\n        while (currentNode !== endPosition.node) {\n            const lineBreakCnt = this.getLineFeedCnt(currentNode.piece.bufferIndex, start, currentNode.piece.end);\n            if (lineBreakCnt >= 1) {\n                // last line break position\n                const lineStarts = this._buffers[currentNode.piece.bufferIndex].lineStarts;\n                const startOffsetInBuffer = this.offsetInBuffer(currentNode.piece.bufferIndex, currentNode.piece.start);\n                const nextLineStartOffset = lineStarts[start.line + lineBreakCnt];\n                const startColumn = startLineNumber === searchRange.startLineNumber ? searchRange.startColumn : 1;\n                resultLen = this.findMatchesInNode(currentNode, searcher, startLineNumber, startColumn, start, this.positionInBuffer(currentNode, nextLineStartOffset - startOffsetInBuffer), searchData, captureMatches, limitResultCount, resultLen, result);\n                if (resultLen >= limitResultCount) {\n                    return result;\n                }\n                startLineNumber += lineBreakCnt;\n            }\n            const startColumn = startLineNumber === searchRange.startLineNumber ? searchRange.startColumn - 1 : 0;\n            // search for the remaining content\n            if (startLineNumber === searchRange.endLineNumber) {\n                const text = this.getLineContent(startLineNumber).substring(startColumn, searchRange.endColumn - 1);\n                resultLen = this._findMatchesInLine(searchData, searcher, text, searchRange.endLineNumber, startColumn, resultLen, result, captureMatches, limitResultCount);\n                return result;\n            }\n            resultLen = this._findMatchesInLine(searchData, searcher, this.getLineContent(startLineNumber).substr(startColumn), startLineNumber, startColumn, resultLen, result, captureMatches, limitResultCount);\n            if (resultLen >= limitResultCount) {\n                return result;\n            }\n            startLineNumber++;\n            startPosition = this.nodeAt2(startLineNumber, 1);\n            currentNode = startPosition.node;\n            start = this.positionInBuffer(startPosition.node, startPosition.remainder);\n        }\n        if (startLineNumber === searchRange.endLineNumber) {\n            const startColumn = startLineNumber === searchRange.startLineNumber ? searchRange.startColumn - 1 : 0;\n            const text = this.getLineContent(startLineNumber).substring(startColumn, searchRange.endColumn - 1);\n            resultLen = this._findMatchesInLine(searchData, searcher, text, searchRange.endLineNumber, startColumn, resultLen, result, captureMatches, limitResultCount);\n            return result;\n        }\n        const startColumn = startLineNumber === searchRange.startLineNumber ? searchRange.startColumn : 1;\n        resultLen = this.findMatchesInNode(endPosition.node, searcher, startLineNumber, startColumn, start, end, searchData, captureMatches, limitResultCount, resultLen, result);\n        return result;\n    }\n    _findMatchesInLine(searchData, searcher, text, lineNumber, deltaOffset, resultLen, result, captureMatches, limitResultCount) {\n        const wordSeparators = searchData.wordSeparators;\n        if (!captureMatches && searchData.simpleSearch) {\n            const searchString = searchData.simpleSearch;\n            const searchStringLen = searchString.length;\n            const textLength = text.length;\n            let lastMatchIndex = -searchStringLen;\n            while ((lastMatchIndex = text.indexOf(searchString, lastMatchIndex + searchStringLen)) !== -1) {\n                if (!wordSeparators || isValidMatch(wordSeparators, text, textLength, lastMatchIndex, searchStringLen)) {\n                    result[resultLen++] = new FindMatch(new Range(lineNumber, lastMatchIndex + 1 + deltaOffset, lineNumber, lastMatchIndex + 1 + searchStringLen + deltaOffset), null);\n                    if (resultLen >= limitResultCount) {\n                        return resultLen;\n                    }\n                }\n            }\n            return resultLen;\n        }\n        let m;\n        // Reset regex to search from the beginning\n        searcher.reset(0);\n        do {\n            m = searcher.next(text);\n            if (m) {\n                result[resultLen++] = createFindMatch(new Range(lineNumber, m.index + 1 + deltaOffset, lineNumber, m.index + 1 + m[0].length + deltaOffset), m, captureMatches);\n                if (resultLen >= limitResultCount) {\n                    return resultLen;\n                }\n            }\n        } while (m);\n        return resultLen;\n    }\n    // #endregion\n    // #region Piece Table\n    insert(offset, value, eolNormalized = false) {\n        this._EOLNormalized = this._EOLNormalized && eolNormalized;\n        this._lastVisitedLine.lineNumber = 0;\n        this._lastVisitedLine.value = '';\n        if (this.root !== SENTINEL) {\n            const { node, remainder, nodeStartOffset } = this.nodeAt(offset);\n            const piece = node.piece;\n            const bufferIndex = piece.bufferIndex;\n            const insertPosInBuffer = this.positionInBuffer(node, remainder);\n            if (node.piece.bufferIndex === 0 &&\n                piece.end.line === this._lastChangeBufferPos.line &&\n                piece.end.column === this._lastChangeBufferPos.column &&\n                (nodeStartOffset + piece.length === offset) &&\n                value.length < AverageBufferSize) {\n                // changed buffer\n                this.appendToNode(node, value);\n                this.computeBufferMetadata();\n                return;\n            }\n            if (nodeStartOffset === offset) {\n                this.insertContentToNodeLeft(value, node);\n                this._searchCache.validate(offset);\n            }\n            else if (nodeStartOffset + node.piece.length > offset) {\n                // we are inserting into the middle of a node.\n                const nodesToDel = [];\n                let newRightPiece = new Piece(piece.bufferIndex, insertPosInBuffer, piece.end, this.getLineFeedCnt(piece.bufferIndex, insertPosInBuffer, piece.end), this.offsetInBuffer(bufferIndex, piece.end) - this.offsetInBuffer(bufferIndex, insertPosInBuffer));\n                if (this.shouldCheckCRLF() && this.endWithCR(value)) {\n                    const headOfRight = this.nodeCharCodeAt(node, remainder);\n                    if (headOfRight === 10 /** \\n */) {\n                        const newStart = { line: newRightPiece.start.line + 1, column: 0 };\n                        newRightPiece = new Piece(newRightPiece.bufferIndex, newStart, newRightPiece.end, this.getLineFeedCnt(newRightPiece.bufferIndex, newStart, newRightPiece.end), newRightPiece.length - 1);\n                        value += '\\n';\n                    }\n                }\n                // reuse node for content before insertion point.\n                if (this.shouldCheckCRLF() && this.startWithLF(value)) {\n                    const tailOfLeft = this.nodeCharCodeAt(node, remainder - 1);\n                    if (tailOfLeft === 13 /** \\r */) {\n                        const previousPos = this.positionInBuffer(node, remainder - 1);\n                        this.deleteNodeTail(node, previousPos);\n                        value = '\\r' + value;\n                        if (node.piece.length === 0) {\n                            nodesToDel.push(node);\n                        }\n                    }\n                    else {\n                        this.deleteNodeTail(node, insertPosInBuffer);\n                    }\n                }\n                else {\n                    this.deleteNodeTail(node, insertPosInBuffer);\n                }\n                const newPieces = this.createNewPieces(value);\n                if (newRightPiece.length > 0) {\n                    this.rbInsertRight(node, newRightPiece);\n                }\n                let tmpNode = node;\n                for (let k = 0; k < newPieces.length; k++) {\n                    tmpNode = this.rbInsertRight(tmpNode, newPieces[k]);\n                }\n                this.deleteNodes(nodesToDel);\n            }\n            else {\n                this.insertContentToNodeRight(value, node);\n            }\n        }\n        else {\n            // insert new node\n            const pieces = this.createNewPieces(value);\n            let node = this.rbInsertLeft(null, pieces[0]);\n            for (let k = 1; k < pieces.length; k++) {\n                node = this.rbInsertRight(node, pieces[k]);\n            }\n        }\n        // todo, this is too brutal. Total line feed count should be updated the same way as lf_left.\n        this.computeBufferMetadata();\n    }\n    delete(offset, cnt) {\n        this._lastVisitedLine.lineNumber = 0;\n        this._lastVisitedLine.value = '';\n        if (cnt <= 0 || this.root === SENTINEL) {\n            return;\n        }\n        const startPosition = this.nodeAt(offset);\n        const endPosition = this.nodeAt(offset + cnt);\n        const startNode = startPosition.node;\n        const endNode = endPosition.node;\n        if (startNode === endNode) {\n            const startSplitPosInBuffer = this.positionInBuffer(startNode, startPosition.remainder);\n            const endSplitPosInBuffer = this.positionInBuffer(startNode, endPosition.remainder);\n            if (startPosition.nodeStartOffset === offset) {\n                if (cnt === startNode.piece.length) { // delete node\n                    const next = startNode.next();\n                    rbDelete(this, startNode);\n                    this.validateCRLFWithPrevNode(next);\n                    this.computeBufferMetadata();\n                    return;\n                }\n                this.deleteNodeHead(startNode, endSplitPosInBuffer);\n                this._searchCache.validate(offset);\n                this.validateCRLFWithPrevNode(startNode);\n                this.computeBufferMetadata();\n                return;\n            }\n            if (startPosition.nodeStartOffset + startNode.piece.length === offset + cnt) {\n                this.deleteNodeTail(startNode, startSplitPosInBuffer);\n                this.validateCRLFWithNextNode(startNode);\n                this.computeBufferMetadata();\n                return;\n            }\n            // delete content in the middle, this node will be splitted to nodes\n            this.shrinkNode(startNode, startSplitPosInBuffer, endSplitPosInBuffer);\n            this.computeBufferMetadata();\n            return;\n        }\n        const nodesToDel = [];\n        const startSplitPosInBuffer = this.positionInBuffer(startNode, startPosition.remainder);\n        this.deleteNodeTail(startNode, startSplitPosInBuffer);\n        this._searchCache.validate(offset);\n        if (startNode.piece.length === 0) {\n            nodesToDel.push(startNode);\n        }\n        // update last touched node\n        const endSplitPosInBuffer = this.positionInBuffer(endNode, endPosition.remainder);\n        this.deleteNodeHead(endNode, endSplitPosInBuffer);\n        if (endNode.piece.length === 0) {\n            nodesToDel.push(endNode);\n        }\n        // delete nodes in between\n        const secondNode = startNode.next();\n        for (let node = secondNode; node !== SENTINEL && node !== endNode; node = node.next()) {\n            nodesToDel.push(node);\n        }\n        const prev = startNode.piece.length === 0 ? startNode.prev() : startNode;\n        this.deleteNodes(nodesToDel);\n        this.validateCRLFWithNextNode(prev);\n        this.computeBufferMetadata();\n    }\n    insertContentToNodeLeft(value, node) {\n        // we are inserting content to the beginning of node\n        const nodesToDel = [];\n        if (this.shouldCheckCRLF() && this.endWithCR(value) && this.startWithLF(node)) {\n            // move `\\n` to new node.\n            const piece = node.piece;\n            const newStart = { line: piece.start.line + 1, column: 0 };\n            const nPiece = new Piece(piece.bufferIndex, newStart, piece.end, this.getLineFeedCnt(piece.bufferIndex, newStart, piece.end), piece.length - 1);\n            node.piece = nPiece;\n            value += '\\n';\n            updateTreeMetadata(this, node, -1, -1);\n            if (node.piece.length === 0) {\n                nodesToDel.push(node);\n            }\n        }\n        const newPieces = this.createNewPieces(value);\n        let newNode = this.rbInsertLeft(node, newPieces[newPieces.length - 1]);\n        for (let k = newPieces.length - 2; k >= 0; k--) {\n            newNode = this.rbInsertLeft(newNode, newPieces[k]);\n        }\n        this.validateCRLFWithPrevNode(newNode);\n        this.deleteNodes(nodesToDel);\n    }\n    insertContentToNodeRight(value, node) {\n        // we are inserting to the right of this node.\n        if (this.adjustCarriageReturnFromNext(value, node)) {\n            // move \\n to the new node.\n            value += '\\n';\n        }\n        const newPieces = this.createNewPieces(value);\n        const newNode = this.rbInsertRight(node, newPieces[0]);\n        let tmpNode = newNode;\n        for (let k = 1; k < newPieces.length; k++) {\n            tmpNode = this.rbInsertRight(tmpNode, newPieces[k]);\n        }\n        this.validateCRLFWithPrevNode(newNode);\n    }\n    positionInBuffer(node, remainder, ret) {\n        const piece = node.piece;\n        const bufferIndex = node.piece.bufferIndex;\n        const lineStarts = this._buffers[bufferIndex].lineStarts;\n        const startOffset = lineStarts[piece.start.line] + piece.start.column;\n        const offset = startOffset + remainder;\n        // binary search offset between startOffset and endOffset\n        let low = piece.start.line;\n        let high = piece.end.line;\n        let mid = 0;\n        let midStop = 0;\n        let midStart = 0;\n        while (low <= high) {\n            mid = low + ((high - low) / 2) | 0;\n            midStart = lineStarts[mid];\n            if (mid === high) {\n                break;\n            }\n            midStop = lineStarts[mid + 1];\n            if (offset < midStart) {\n                high = mid - 1;\n            }\n            else if (offset >= midStop) {\n                low = mid + 1;\n            }\n            else {\n                break;\n            }\n        }\n        if (ret) {\n            ret.line = mid;\n            ret.column = offset - midStart;\n            return null;\n        }\n        return {\n            line: mid,\n            column: offset - midStart\n        };\n    }\n    getLineFeedCnt(bufferIndex, start, end) {\n        // we don't need to worry about start: abc\\r|\\n, or abc|\\r, or abc|\\n, or abc|\\r\\n doesn't change the fact that, there is one line break after start.\n        // now let's take care of end: abc\\r|\\n, if end is in between \\r and \\n, we need to add line feed count by 1\n        if (end.column === 0) {\n            return end.line - start.line;\n        }\n        const lineStarts = this._buffers[bufferIndex].lineStarts;\n        if (end.line === lineStarts.length - 1) { // it means, there is no \\n after end, otherwise, there will be one more lineStart.\n            return end.line - start.line;\n        }\n        const nextLineStartOffset = lineStarts[end.line + 1];\n        const endOffset = lineStarts[end.line] + end.column;\n        if (nextLineStartOffset > endOffset + 1) { // there are more than 1 character after end, which means it can't be \\n\n            return end.line - start.line;\n        }\n        // endOffset + 1 === nextLineStartOffset\n        // character at endOffset is \\n, so we check the character before first\n        // if character at endOffset is \\r, end.column is 0 and we can't get here.\n        const previousCharOffset = endOffset - 1; // end.column > 0 so it's okay.\n        const buffer = this._buffers[bufferIndex].buffer;\n        if (buffer.charCodeAt(previousCharOffset) === 13) {\n            return end.line - start.line + 1;\n        }\n        else {\n            return end.line - start.line;\n        }\n    }\n    offsetInBuffer(bufferIndex, cursor) {\n        const lineStarts = this._buffers[bufferIndex].lineStarts;\n        return lineStarts[cursor.line] + cursor.column;\n    }\n    deleteNodes(nodes) {\n        for (let i = 0; i < nodes.length; i++) {\n            rbDelete(this, nodes[i]);\n        }\n    }\n    createNewPieces(text) {\n        if (text.length > AverageBufferSize) {\n            // the content is large, operations like substring, charCode becomes slow\n            // so here we split it into smaller chunks, just like what we did for CR/LF normalization\n            const newPieces = [];\n            while (text.length > AverageBufferSize) {\n                const lastChar = text.charCodeAt(AverageBufferSize - 1);\n                let splitText;\n                if (lastChar === 13 /* CharCode.CarriageReturn */ || (lastChar >= 0xD800 && lastChar <= 0xDBFF)) {\n                    // last character is \\r or a high surrogate => keep it back\n                    splitText = text.substring(0, AverageBufferSize - 1);\n                    text = text.substring(AverageBufferSize - 1);\n                }\n                else {\n                    splitText = text.substring(0, AverageBufferSize);\n                    text = text.substring(AverageBufferSize);\n                }\n                const lineStarts = createLineStartsFast(splitText);\n                newPieces.push(new Piece(this._buffers.length, /* buffer index */ { line: 0, column: 0 }, { line: lineStarts.length - 1, column: splitText.length - lineStarts[lineStarts.length - 1] }, lineStarts.length - 1, splitText.length));\n                this._buffers.push(new StringBuffer(splitText, lineStarts));\n            }\n            const lineStarts = createLineStartsFast(text);\n            newPieces.push(new Piece(this._buffers.length, /* buffer index */ { line: 0, column: 0 }, { line: lineStarts.length - 1, column: text.length - lineStarts[lineStarts.length - 1] }, lineStarts.length - 1, text.length));\n            this._buffers.push(new StringBuffer(text, lineStarts));\n            return newPieces;\n        }\n        let startOffset = this._buffers[0].buffer.length;\n        const lineStarts = createLineStartsFast(text, false);\n        let start = this._lastChangeBufferPos;\n        if (this._buffers[0].lineStarts[this._buffers[0].lineStarts.length - 1] === startOffset\n            && startOffset !== 0\n            && this.startWithLF(text)\n            && this.endWithCR(this._buffers[0].buffer) // todo, we can check this._lastChangeBufferPos's column as it's the last one\n        ) {\n            this._lastChangeBufferPos = { line: this._lastChangeBufferPos.line, column: this._lastChangeBufferPos.column + 1 };\n            start = this._lastChangeBufferPos;\n            for (let i = 0; i < lineStarts.length; i++) {\n                lineStarts[i] += startOffset + 1;\n            }\n            this._buffers[0].lineStarts = this._buffers[0].lineStarts.concat(lineStarts.slice(1));\n            this._buffers[0].buffer += '_' + text;\n            startOffset += 1;\n        }\n        else {\n            if (startOffset !== 0) {\n                for (let i = 0; i < lineStarts.length; i++) {\n                    lineStarts[i] += startOffset;\n                }\n            }\n            this._buffers[0].lineStarts = this._buffers[0].lineStarts.concat(lineStarts.slice(1));\n            this._buffers[0].buffer += text;\n        }\n        const endOffset = this._buffers[0].buffer.length;\n        const endIndex = this._buffers[0].lineStarts.length - 1;\n        const endColumn = endOffset - this._buffers[0].lineStarts[endIndex];\n        const endPos = { line: endIndex, column: endColumn };\n        const newPiece = new Piece(0, /** todo@peng */ start, endPos, this.getLineFeedCnt(0, start, endPos), endOffset - startOffset);\n        this._lastChangeBufferPos = endPos;\n        return [newPiece];\n    }\n    getLineRawContent(lineNumber, endOffset = 0) {\n        let x = this.root;\n        let ret = '';\n        const cache = this._searchCache.get2(lineNumber);\n        if (cache) {\n            x = cache.node;\n            const prevAccumulatedValue = this.getAccumulatedValue(x, lineNumber - cache.nodeStartLineNumber - 1);\n            const buffer = this._buffers[x.piece.bufferIndex].buffer;\n            const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n            if (cache.nodeStartLineNumber + x.piece.lineFeedCnt === lineNumber) {\n                ret = buffer.substring(startOffset + prevAccumulatedValue, startOffset + x.piece.length);\n            }\n            else {\n                const accumulatedValue = this.getAccumulatedValue(x, lineNumber - cache.nodeStartLineNumber);\n                return buffer.substring(startOffset + prevAccumulatedValue, startOffset + accumulatedValue - endOffset);\n            }\n        }\n        else {\n            let nodeStartOffset = 0;\n            const originalLineNumber = lineNumber;\n            while (x !== SENTINEL) {\n                if (x.left !== SENTINEL && x.lf_left >= lineNumber - 1) {\n                    x = x.left;\n                }\n                else if (x.lf_left + x.piece.lineFeedCnt > lineNumber - 1) {\n                    const prevAccumulatedValue = this.getAccumulatedValue(x, lineNumber - x.lf_left - 2);\n                    const accumulatedValue = this.getAccumulatedValue(x, lineNumber - x.lf_left - 1);\n                    const buffer = this._buffers[x.piece.bufferIndex].buffer;\n                    const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n                    nodeStartOffset += x.size_left;\n                    this._searchCache.set({\n                        node: x,\n                        nodeStartOffset,\n                        nodeStartLineNumber: originalLineNumber - (lineNumber - 1 - x.lf_left)\n                    });\n                    return buffer.substring(startOffset + prevAccumulatedValue, startOffset + accumulatedValue - endOffset);\n                }\n                else if (x.lf_left + x.piece.lineFeedCnt === lineNumber - 1) {\n                    const prevAccumulatedValue = this.getAccumulatedValue(x, lineNumber - x.lf_left - 2);\n                    const buffer = this._buffers[x.piece.bufferIndex].buffer;\n                    const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n                    ret = buffer.substring(startOffset + prevAccumulatedValue, startOffset + x.piece.length);\n                    break;\n                }\n                else {\n                    lineNumber -= x.lf_left + x.piece.lineFeedCnt;\n                    nodeStartOffset += x.size_left + x.piece.length;\n                    x = x.right;\n                }\n            }\n        }\n        // search in order, to find the node contains end column\n        x = x.next();\n        while (x !== SENTINEL) {\n            const buffer = this._buffers[x.piece.bufferIndex].buffer;\n            if (x.piece.lineFeedCnt > 0) {\n                const accumulatedValue = this.getAccumulatedValue(x, 0);\n                const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n                ret += buffer.substring(startOffset, startOffset + accumulatedValue - endOffset);\n                return ret;\n            }\n            else {\n                const startOffset = this.offsetInBuffer(x.piece.bufferIndex, x.piece.start);\n                ret += buffer.substr(startOffset, x.piece.length);\n            }\n            x = x.next();\n        }\n        return ret;\n    }\n    computeBufferMetadata() {\n        let x = this.root;\n        let lfCnt = 1;\n        let len = 0;\n        while (x !== SENTINEL) {\n            lfCnt += x.lf_left + x.piece.lineFeedCnt;\n            len += x.size_left + x.piece.length;\n            x = x.right;\n        }\n        this._lineCnt = lfCnt;\n        this._length = len;\n        this._searchCache.validate(this._length);\n    }\n    // #region node operations\n    getIndexOf(node, accumulatedValue) {\n        const piece = node.piece;\n        const pos = this.positionInBuffer(node, accumulatedValue);\n        const lineCnt = pos.line - piece.start.line;\n        if (this.offsetInBuffer(piece.bufferIndex, piece.end) - this.offsetInBuffer(piece.bufferIndex, piece.start) === accumulatedValue) {\n            // we are checking the end of this node, so a CRLF check is necessary.\n            const realLineCnt = this.getLineFeedCnt(node.piece.bufferIndex, piece.start, pos);\n            if (realLineCnt !== lineCnt) {\n                // aha yes, CRLF\n                return { index: realLineCnt, remainder: 0 };\n            }\n        }\n        return { index: lineCnt, remainder: pos.column };\n    }\n    getAccumulatedValue(node, index) {\n        if (index < 0) {\n            return 0;\n        }\n        const piece = node.piece;\n        const lineStarts = this._buffers[piece.bufferIndex].lineStarts;\n        const expectedLineStartIndex = piece.start.line + index + 1;\n        if (expectedLineStartIndex > piece.end.line) {\n            return lineStarts[piece.end.line] + piece.end.column - lineStarts[piece.start.line] - piece.start.column;\n        }\n        else {\n            return lineStarts[expectedLineStartIndex] - lineStarts[piece.start.line] - piece.start.column;\n        }\n    }\n    deleteNodeTail(node, pos) {\n        const piece = node.piece;\n        const originalLFCnt = piece.lineFeedCnt;\n        const originalEndOffset = this.offsetInBuffer(piece.bufferIndex, piece.end);\n        const newEnd = pos;\n        const newEndOffset = this.offsetInBuffer(piece.bufferIndex, newEnd);\n        const newLineFeedCnt = this.getLineFeedCnt(piece.bufferIndex, piece.start, newEnd);\n        const lf_delta = newLineFeedCnt - originalLFCnt;\n        const size_delta = newEndOffset - originalEndOffset;\n        const newLength = piece.length + size_delta;\n        node.piece = new Piece(piece.bufferIndex, piece.start, newEnd, newLineFeedCnt, newLength);\n        updateTreeMetadata(this, node, size_delta, lf_delta);\n    }\n    deleteNodeHead(node, pos) {\n        const piece = node.piece;\n        const originalLFCnt = piece.lineFeedCnt;\n        const originalStartOffset = this.offsetInBuffer(piece.bufferIndex, piece.start);\n        const newStart = pos;\n        const newLineFeedCnt = this.getLineFeedCnt(piece.bufferIndex, newStart, piece.end);\n        const newStartOffset = this.offsetInBuffer(piece.bufferIndex, newStart);\n        const lf_delta = newLineFeedCnt - originalLFCnt;\n        const size_delta = originalStartOffset - newStartOffset;\n        const newLength = piece.length + size_delta;\n        node.piece = new Piece(piece.bufferIndex, newStart, piece.end, newLineFeedCnt, newLength);\n        updateTreeMetadata(this, node, size_delta, lf_delta);\n    }\n    shrinkNode(node, start, end) {\n        const piece = node.piece;\n        const originalStartPos = piece.start;\n        const originalEndPos = piece.end;\n        // old piece, originalStartPos, start\n        const oldLength = piece.length;\n        const oldLFCnt = piece.lineFeedCnt;\n        const newEnd = start;\n        const newLineFeedCnt = this.getLineFeedCnt(piece.bufferIndex, piece.start, newEnd);\n        const newLength = this.offsetInBuffer(piece.bufferIndex, start) - this.offsetInBuffer(piece.bufferIndex, originalStartPos);\n        node.piece = new Piece(piece.bufferIndex, piece.start, newEnd, newLineFeedCnt, newLength);\n        updateTreeMetadata(this, node, newLength - oldLength, newLineFeedCnt - oldLFCnt);\n        // new right piece, end, originalEndPos\n        const newPiece = new Piece(piece.bufferIndex, end, originalEndPos, this.getLineFeedCnt(piece.bufferIndex, end, originalEndPos), this.offsetInBuffer(piece.bufferIndex, originalEndPos) - this.offsetInBuffer(piece.bufferIndex, end));\n        const newNode = this.rbInsertRight(node, newPiece);\n        this.validateCRLFWithPrevNode(newNode);\n    }\n    appendToNode(node, value) {\n        if (this.adjustCarriageReturnFromNext(value, node)) {\n            value += '\\n';\n        }\n        const hitCRLF = this.shouldCheckCRLF() && this.startWithLF(value) && this.endWithCR(node);\n        const startOffset = this._buffers[0].buffer.length;\n        this._buffers[0].buffer += value;\n        const lineStarts = createLineStartsFast(value, false);\n        for (let i = 0; i < lineStarts.length; i++) {\n            lineStarts[i] += startOffset;\n        }\n        if (hitCRLF) {\n            const prevStartOffset = this._buffers[0].lineStarts[this._buffers[0].lineStarts.length - 2];\n            this._buffers[0].lineStarts.pop();\n            // _lastChangeBufferPos is already wrong\n            this._lastChangeBufferPos = { line: this._lastChangeBufferPos.line - 1, column: startOffset - prevStartOffset };\n        }\n        this._buffers[0].lineStarts = this._buffers[0].lineStarts.concat(lineStarts.slice(1));\n        const endIndex = this._buffers[0].lineStarts.length - 1;\n        const endColumn = this._buffers[0].buffer.length - this._buffers[0].lineStarts[endIndex];\n        const newEnd = { line: endIndex, column: endColumn };\n        const newLength = node.piece.length + value.length;\n        const oldLineFeedCnt = node.piece.lineFeedCnt;\n        const newLineFeedCnt = this.getLineFeedCnt(0, node.piece.start, newEnd);\n        const lf_delta = newLineFeedCnt - oldLineFeedCnt;\n        node.piece = new Piece(node.piece.bufferIndex, node.piece.start, newEnd, newLineFeedCnt, newLength);\n        this._lastChangeBufferPos = newEnd;\n        updateTreeMetadata(this, node, value.length, lf_delta);\n    }\n    nodeAt(offset) {\n        let x = this.root;\n        const cache = this._searchCache.get(offset);\n        if (cache) {\n            return {\n                node: cache.node,\n                nodeStartOffset: cache.nodeStartOffset,\n                remainder: offset - cache.nodeStartOffset\n            };\n        }\n        let nodeStartOffset = 0;\n        while (x !== SENTINEL) {\n            if (x.size_left > offset) {\n                x = x.left;\n            }\n            else if (x.size_left + x.piece.length >= offset) {\n                nodeStartOffset += x.size_left;\n                const ret = {\n                    node: x,\n                    remainder: offset - x.size_left,\n                    nodeStartOffset\n                };\n                this._searchCache.set(ret);\n                return ret;\n            }\n            else {\n                offset -= x.size_left + x.piece.length;\n                nodeStartOffset += x.size_left + x.piece.length;\n                x = x.right;\n            }\n        }\n        return null;\n    }\n    nodeAt2(lineNumber, column) {\n        let x = this.root;\n        let nodeStartOffset = 0;\n        while (x !== SENTINEL) {\n            if (x.left !== SENTINEL && x.lf_left >= lineNumber - 1) {\n                x = x.left;\n            }\n            else if (x.lf_left + x.piece.lineFeedCnt > lineNumber - 1) {\n                const prevAccumualtedValue = this.getAccumulatedValue(x, lineNumber - x.lf_left - 2);\n                const accumulatedValue = this.getAccumulatedValue(x, lineNumber - x.lf_left - 1);\n                nodeStartOffset += x.size_left;\n                return {\n                    node: x,\n                    remainder: Math.min(prevAccumualtedValue + column - 1, accumulatedValue),\n                    nodeStartOffset\n                };\n            }\n            else if (x.lf_left + x.piece.lineFeedCnt === lineNumber - 1) {\n                const prevAccumualtedValue = this.getAccumulatedValue(x, lineNumber - x.lf_left - 2);\n                if (prevAccumualtedValue + column - 1 <= x.piece.length) {\n                    return {\n                        node: x,\n                        remainder: prevAccumualtedValue + column - 1,\n                        nodeStartOffset\n                    };\n                }\n                else {\n                    column -= x.piece.length - prevAccumualtedValue;\n                    break;\n                }\n            }\n            else {\n                lineNumber -= x.lf_left + x.piece.lineFeedCnt;\n                nodeStartOffset += x.size_left + x.piece.length;\n                x = x.right;\n            }\n        }\n        // search in order, to find the node contains position.column\n        x = x.next();\n        while (x !== SENTINEL) {\n            if (x.piece.lineFeedCnt > 0) {\n                const accumulatedValue = this.getAccumulatedValue(x, 0);\n                const nodeStartOffset = this.offsetOfNode(x);\n                return {\n                    node: x,\n                    remainder: Math.min(column - 1, accumulatedValue),\n                    nodeStartOffset\n                };\n            }\n            else {\n                if (x.piece.length >= column - 1) {\n                    const nodeStartOffset = this.offsetOfNode(x);\n                    return {\n                        node: x,\n                        remainder: column - 1,\n                        nodeStartOffset\n                    };\n                }\n                else {\n                    column -= x.piece.length;\n                }\n            }\n            x = x.next();\n        }\n        return null;\n    }\n    nodeCharCodeAt(node, offset) {\n        if (node.piece.lineFeedCnt < 1) {\n            return -1;\n        }\n        const buffer = this._buffers[node.piece.bufferIndex];\n        const newOffset = this.offsetInBuffer(node.piece.bufferIndex, node.piece.start) + offset;\n        return buffer.buffer.charCodeAt(newOffset);\n    }\n    offsetOfNode(node) {\n        if (!node) {\n            return 0;\n        }\n        let pos = node.size_left;\n        while (node !== this.root) {\n            if (node.parent.right === node) {\n                pos += node.parent.size_left + node.parent.piece.length;\n            }\n            node = node.parent;\n        }\n        return pos;\n    }\n    // #endregion\n    // #region CRLF\n    shouldCheckCRLF() {\n        return !(this._EOLNormalized && this._EOL === '\\n');\n    }\n    startWithLF(val) {\n        if (typeof val === 'string') {\n            return val.charCodeAt(0) === 10;\n        }\n        if (val === SENTINEL || val.piece.lineFeedCnt === 0) {\n            return false;\n        }\n        const piece = val.piece;\n        const lineStarts = this._buffers[piece.bufferIndex].lineStarts;\n        const line = piece.start.line;\n        const startOffset = lineStarts[line] + piece.start.column;\n        if (line === lineStarts.length - 1) {\n            // last line, so there is no line feed at the end of this line\n            return false;\n        }\n        const nextLineOffset = lineStarts[line + 1];\n        if (nextLineOffset > startOffset + 1) {\n            return false;\n        }\n        return this._buffers[piece.bufferIndex].buffer.charCodeAt(startOffset) === 10;\n    }\n    endWithCR(val) {\n        if (typeof val === 'string') {\n            return val.charCodeAt(val.length - 1) === 13;\n        }\n        if (val === SENTINEL || val.piece.lineFeedCnt === 0) {\n            return false;\n        }\n        return this.nodeCharCodeAt(val, val.piece.length - 1) === 13;\n    }\n    validateCRLFWithPrevNode(nextNode) {\n        if (this.shouldCheckCRLF() && this.startWithLF(nextNode)) {\n            const node = nextNode.prev();\n            if (this.endWithCR(node)) {\n                this.fixCRLF(node, nextNode);\n            }\n        }\n    }\n    validateCRLFWithNextNode(node) {\n        if (this.shouldCheckCRLF() && this.endWithCR(node)) {\n            const nextNode = node.next();\n            if (this.startWithLF(nextNode)) {\n                this.fixCRLF(node, nextNode);\n            }\n        }\n    }\n    fixCRLF(prev, next) {\n        const nodesToDel = [];\n        // update node\n        const lineStarts = this._buffers[prev.piece.bufferIndex].lineStarts;\n        let newEnd;\n        if (prev.piece.end.column === 0) {\n            // it means, last line ends with \\r, not \\r\\n\n            newEnd = { line: prev.piece.end.line - 1, column: lineStarts[prev.piece.end.line] - lineStarts[prev.piece.end.line - 1] - 1 };\n        }\n        else {\n            // \\r\\n\n            newEnd = { line: prev.piece.end.line, column: prev.piece.end.column - 1 };\n        }\n        const prevNewLength = prev.piece.length - 1;\n        const prevNewLFCnt = prev.piece.lineFeedCnt - 1;\n        prev.piece = new Piece(prev.piece.bufferIndex, prev.piece.start, newEnd, prevNewLFCnt, prevNewLength);\n        updateTreeMetadata(this, prev, -1, -1);\n        if (prev.piece.length === 0) {\n            nodesToDel.push(prev);\n        }\n        // update nextNode\n        const newStart = { line: next.piece.start.line + 1, column: 0 };\n        const newLength = next.piece.length - 1;\n        const newLineFeedCnt = this.getLineFeedCnt(next.piece.bufferIndex, newStart, next.piece.end);\n        next.piece = new Piece(next.piece.bufferIndex, newStart, next.piece.end, newLineFeedCnt, newLength);\n        updateTreeMetadata(this, next, -1, -1);\n        if (next.piece.length === 0) {\n            nodesToDel.push(next);\n        }\n        // create new piece which contains \\r\\n\n        const pieces = this.createNewPieces('\\r\\n');\n        this.rbInsertRight(prev, pieces[0]);\n        // delete empty nodes\n        for (let i = 0; i < nodesToDel.length; i++) {\n            rbDelete(this, nodesToDel[i]);\n        }\n    }\n    adjustCarriageReturnFromNext(value, node) {\n        if (this.shouldCheckCRLF() && this.endWithCR(value)) {\n            const nextNode = node.next();\n            if (this.startWithLF(nextNode)) {\n                // move `\\n` forward\n                value += '\\n';\n                if (nextNode.piece.length === 1) {\n                    rbDelete(this, nextNode);\n                }\n                else {\n                    const piece = nextNode.piece;\n                    const newStart = { line: piece.start.line + 1, column: 0 };\n                    const newLength = piece.length - 1;\n                    const newLineFeedCnt = this.getLineFeedCnt(piece.bufferIndex, newStart, piece.end);\n                    nextNode.piece = new Piece(piece.bufferIndex, newStart, piece.end, newLineFeedCnt, newLength);\n                    updateTreeMetadata(this, nextNode, -1, -1);\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n    // #endregion\n    // #endregion\n    // #region Tree operations\n    iterate(node, callback) {\n        if (node === SENTINEL) {\n            return callback(SENTINEL);\n        }\n        const leftRet = this.iterate(node.left, callback);\n        if (!leftRet) {\n            return leftRet;\n        }\n        return callback(node) && this.iterate(node.right, callback);\n    }\n    getNodeContent(node) {\n        if (node === SENTINEL) {\n            return '';\n        }\n        const buffer = this._buffers[node.piece.bufferIndex];\n        const piece = node.piece;\n        const startOffset = this.offsetInBuffer(piece.bufferIndex, piece.start);\n        const endOffset = this.offsetInBuffer(piece.bufferIndex, piece.end);\n        const currentContent = buffer.buffer.substring(startOffset, endOffset);\n        return currentContent;\n    }\n    getPieceContent(piece) {\n        const buffer = this._buffers[piece.bufferIndex];\n        const startOffset = this.offsetInBuffer(piece.bufferIndex, piece.start);\n        const endOffset = this.offsetInBuffer(piece.bufferIndex, piece.end);\n        const currentContent = buffer.buffer.substring(startOffset, endOffset);\n        return currentContent;\n    }\n    /**\n     *      node              node\n     *     /  \\              /  \\\n     *    a   b    <----   a    b\n     *                         /\n     *                        z\n     */\n    rbInsertRight(node, p) {\n        const z = new TreeNode(p, 1 /* NodeColor.Red */);\n        z.left = SENTINEL;\n        z.right = SENTINEL;\n        z.parent = SENTINEL;\n        z.size_left = 0;\n        z.lf_left = 0;\n        const x = this.root;\n        if (x === SENTINEL) {\n            this.root = z;\n            z.color = 0 /* NodeColor.Black */;\n        }\n        else if (node.right === SENTINEL) {\n            node.right = z;\n            z.parent = node;\n        }\n        else {\n            const nextNode = leftest(node.right);\n            nextNode.left = z;\n            z.parent = nextNode;\n        }\n        fixInsert(this, z);\n        return z;\n    }\n    /**\n     *      node              node\n     *     /  \\              /  \\\n     *    a   b     ---->   a    b\n     *                       \\\n     *                        z\n     */\n    rbInsertLeft(node, p) {\n        const z = new TreeNode(p, 1 /* NodeColor.Red */);\n        z.left = SENTINEL;\n        z.right = SENTINEL;\n        z.parent = SENTINEL;\n        z.size_left = 0;\n        z.lf_left = 0;\n        if (this.root === SENTINEL) {\n            this.root = z;\n            z.color = 0 /* NodeColor.Black */;\n        }\n        else if (node.left === SENTINEL) {\n            node.left = z;\n            z.parent = node;\n        }\n        else {\n            const prevNode = righttest(node.left); // a\n            prevNode.right = z;\n            z.parent = prevNode;\n        }\n        fixInsert(this, z);\n        return z;\n    }\n}\n"],"mappings":"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"}]}