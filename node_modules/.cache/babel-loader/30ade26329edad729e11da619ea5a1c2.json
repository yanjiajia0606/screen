{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/cursor/cursorTypeOperations.js","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/cursor/cursorTypeOperations.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/babel.config.js","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9nZXQgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9nZXQuanMiOwppbXBvcnQgX2dldFByb3RvdHlwZU9mIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZ2V0UHJvdG90eXBlT2YuanMiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMuanMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIuanMiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyLmpzIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMveWFuamlhamlhL0Rlc2t0b3Avd29ya3NwYWNlL2F2dWUtZGF0YS1uZXcvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrLmpzIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMveWFuamlhamlhL0Rlc2t0b3Avd29ya3NwYWNlL2F2dWUtZGF0YS1uZXcvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRlc3QuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuZW5kcy13aXRoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7Ci8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwppbXBvcnQgeyBvblVuZXhwZWN0ZWRFcnJvciB9IGZyb20gJy4uLy4uLy4uL2Jhc2UvY29tbW9uL2Vycm9ycy5qcyc7CmltcG9ydCAqIGFzIHN0cmluZ3MgZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vc3RyaW5ncy5qcyc7CmltcG9ydCB7IFJlcGxhY2VDb21tYW5kLCBSZXBsYWNlQ29tbWFuZFdpdGhPZmZzZXRDdXJzb3JTdGF0ZSwgUmVwbGFjZUNvbW1hbmRXaXRob3V0Q2hhbmdpbmdQb3NpdGlvbiwgUmVwbGFjZUNvbW1hbmRUaGF0UHJlc2VydmVzU2VsZWN0aW9uIH0gZnJvbSAnLi4vY29tbWFuZHMvcmVwbGFjZUNvbW1hbmQuanMnOwppbXBvcnQgeyBTaGlmdENvbW1hbmQgfSBmcm9tICcuLi9jb21tYW5kcy9zaGlmdENvbW1hbmQuanMnOwppbXBvcnQgeyBDb21wb3NpdGlvblN1cnJvdW5kU2VsZWN0aW9uQ29tbWFuZCwgU3Vycm91bmRTZWxlY3Rpb25Db21tYW5kIH0gZnJvbSAnLi4vY29tbWFuZHMvc3Vycm91bmRTZWxlY3Rpb25Db21tYW5kLmpzJzsKaW1wb3J0IHsgRWRpdE9wZXJhdGlvblJlc3VsdCwgaXNRdW90ZSB9IGZyb20gJy4uL2N1cnNvckNvbW1vbi5qcyc7CmltcG9ydCB7IGdldE1hcEZvcldvcmRTZXBhcmF0b3JzIH0gZnJvbSAnLi4vY29yZS93b3JkQ2hhcmFjdGVyQ2xhc3NpZmllci5qcyc7CmltcG9ydCB7IFJhbmdlIH0gZnJvbSAnLi4vY29yZS9yYW5nZS5qcyc7CmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vY29yZS9wb3NpdGlvbi5qcyc7CmltcG9ydCB7IEluZGVudEFjdGlvbiB9IGZyb20gJy4uL2xhbmd1YWdlcy9sYW5ndWFnZUNvbmZpZ3VyYXRpb24uanMnOwppbXBvcnQgeyBnZXRJbmRlbnRhdGlvbkF0UG9zaXRpb24gfSBmcm9tICcuLi9sYW5ndWFnZXMvbGFuZ3VhZ2VDb25maWd1cmF0aW9uUmVnaXN0cnkuanMnOwppbXBvcnQgeyBjcmVhdGVTY29wZWRMaW5lVG9rZW5zIH0gZnJvbSAnLi4vbGFuZ3VhZ2VzL3N1cHBvcnRzLmpzJzsKaW1wb3J0IHsgZ2V0SW5kZW50QWN0aW9uRm9yVHlwZSwgZ2V0SW5kZW50Rm9yRW50ZXIsIGdldEluaGVyaXRJbmRlbnRGb3JMaW5lIH0gZnJvbSAnLi4vbGFuZ3VhZ2VzL2F1dG9JbmRlbnQuanMnOwppbXBvcnQgeyBnZXRFbnRlckFjdGlvbiB9IGZyb20gJy4uL2xhbmd1YWdlcy9lbnRlckFjdGlvbi5qcyc7CmV4cG9ydCB2YXIgVHlwZU9wZXJhdGlvbnMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFR5cGVPcGVyYXRpb25zKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFR5cGVPcGVyYXRpb25zKTsKICB9CiAgX2NyZWF0ZUNsYXNzKFR5cGVPcGVyYXRpb25zLCBudWxsLCBbewogICAga2V5OiAiaW5kZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbmRlbnQoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucykgewogICAgICBpZiAobW9kZWwgPT09IG51bGwgfHwgc2VsZWN0aW9ucyA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICB2YXIgY29tbWFuZHMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlbGVjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBjb21tYW5kc1tpXSA9IG5ldyBTaGlmdENvbW1hbmQoc2VsZWN0aW9uc1tpXSwgewogICAgICAgICAgaXNVbnNoaWZ0OiBmYWxzZSwKICAgICAgICAgIHRhYlNpemU6IGNvbmZpZy50YWJTaXplLAogICAgICAgICAgaW5kZW50U2l6ZTogY29uZmlnLmluZGVudFNpemUsCiAgICAgICAgICBpbnNlcnRTcGFjZXM6IGNvbmZpZy5pbnNlcnRTcGFjZXMsCiAgICAgICAgICB1c2VUYWJTdG9wczogY29uZmlnLnVzZVRhYlN0b3BzLAogICAgICAgICAgYXV0b0luZGVudDogY29uZmlnLmF1dG9JbmRlbnQKICAgICAgICB9LCBjb25maWcubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbW1hbmRzOwogICAgfQogIH0sIHsKICAgIGtleTogIm91dGRlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG91dGRlbnQoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucykgewogICAgICB2YXIgY29tbWFuZHMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlbGVjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBjb21tYW5kc1tpXSA9IG5ldyBTaGlmdENvbW1hbmQoc2VsZWN0aW9uc1tpXSwgewogICAgICAgICAgaXNVbnNoaWZ0OiB0cnVlLAogICAgICAgICAgdGFiU2l6ZTogY29uZmlnLnRhYlNpemUsCiAgICAgICAgICBpbmRlbnRTaXplOiBjb25maWcuaW5kZW50U2l6ZSwKICAgICAgICAgIGluc2VydFNwYWNlczogY29uZmlnLmluc2VydFNwYWNlcywKICAgICAgICAgIHVzZVRhYlN0b3BzOiBjb25maWcudXNlVGFiU3RvcHMsCiAgICAgICAgICBhdXRvSW5kZW50OiBjb25maWcuYXV0b0luZGVudAogICAgICAgIH0sIGNvbmZpZy5sYW5ndWFnZUNvbmZpZ3VyYXRpb25TZXJ2aWNlKTsKICAgICAgfQogICAgICByZXR1cm4gY29tbWFuZHM7CiAgICB9CiAgfSwgewogICAga2V5OiAic2hpZnRJbmRlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNoaWZ0SW5kZW50KGNvbmZpZywgaW5kZW50YXRpb24sIGNvdW50KSB7CiAgICAgIGNvdW50ID0gY291bnQgfHwgMTsKICAgICAgcmV0dXJuIFNoaWZ0Q29tbWFuZC5zaGlmdEluZGVudChpbmRlbnRhdGlvbiwgaW5kZW50YXRpb24ubGVuZ3RoICsgY291bnQsIGNvbmZpZy50YWJTaXplLCBjb25maWcuaW5kZW50U2l6ZSwgY29uZmlnLmluc2VydFNwYWNlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAidW5zaGlmdEluZGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdW5zaGlmdEluZGVudChjb25maWcsIGluZGVudGF0aW9uLCBjb3VudCkgewogICAgICBjb3VudCA9IGNvdW50IHx8IDE7CiAgICAgIHJldHVybiBTaGlmdENvbW1hbmQudW5zaGlmdEluZGVudChpbmRlbnRhdGlvbiwgaW5kZW50YXRpb24ubGVuZ3RoICsgY291bnQsIGNvbmZpZy50YWJTaXplLCBjb25maWcuaW5kZW50U2l6ZSwgY29uZmlnLmluc2VydFNwYWNlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2Rpc3RyaWJ1dGVkUGFzdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9kaXN0cmlidXRlZFBhc3RlKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIHRleHQpIHsKICAgICAgdmFyIGNvbW1hbmRzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzZWxlY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgY29tbWFuZHNbaV0gPSBuZXcgUmVwbGFjZUNvbW1hbmQoc2VsZWN0aW9uc1tpXSwgdGV4dFtpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBFZGl0T3BlcmF0aW9uUmVzdWx0KDAgLyogRWRpdE9wZXJhdGlvblR5cGUuT3RoZXIgKi8sIGNvbW1hbmRzLCB7CiAgICAgICAgc2hvdWxkUHVzaFN0YWNrRWxlbWVudEJlZm9yZTogdHJ1ZSwKICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QWZ0ZXI6IHRydWUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3NpbXBsZVBhc3RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2ltcGxlUGFzdGUoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgdGV4dCwgcGFzdGVPbk5ld0xpbmUpIHsKICAgICAgdmFyIGNvbW1hbmRzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzZWxlY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIHNlbGVjdGlvbiA9IHNlbGVjdGlvbnNbaV07CiAgICAgICAgdmFyIHBvc2l0aW9uID0gc2VsZWN0aW9uLmdldFBvc2l0aW9uKCk7CiAgICAgICAgaWYgKHBhc3RlT25OZXdMaW5lICYmICFzZWxlY3Rpb24uaXNFbXB0eSgpKSB7CiAgICAgICAgICBwYXN0ZU9uTmV3TGluZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAocGFzdGVPbk5ld0xpbmUgJiYgdGV4dC5pbmRleE9mKCdcbicpICE9PSB0ZXh0Lmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHBhc3RlT25OZXdMaW5lID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChwYXN0ZU9uTmV3TGluZSkgewogICAgICAgICAgLy8gUGFzdGUgZW50aXJlIGxpbmUgYXQgdGhlIGJlZ2lubmluZyBvZiBsaW5lCiAgICAgICAgICB2YXIgdHlwZVNlbGVjdGlvbiA9IG5ldyBSYW5nZShwb3NpdGlvbi5saW5lTnVtYmVyLCAxLCBwb3NpdGlvbi5saW5lTnVtYmVyLCAxKTsKICAgICAgICAgIGNvbW1hbmRzW2ldID0gbmV3IFJlcGxhY2VDb21tYW5kVGhhdFByZXNlcnZlc1NlbGVjdGlvbih0eXBlU2VsZWN0aW9uLCB0ZXh0LCBzZWxlY3Rpb24sIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb21tYW5kc1tpXSA9IG5ldyBSZXBsYWNlQ29tbWFuZChzZWxlY3Rpb24sIHRleHQpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbmV3IEVkaXRPcGVyYXRpb25SZXN1bHQoMCAvKiBFZGl0T3BlcmF0aW9uVHlwZS5PdGhlciAqLywgY29tbWFuZHMsIHsKICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QmVmb3JlOiB0cnVlLAogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRBZnRlcjogdHJ1ZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZGlzdHJpYnV0ZVBhc3RlVG9DdXJzb3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZGlzdHJpYnV0ZVBhc3RlVG9DdXJzb3JzKGNvbmZpZywgc2VsZWN0aW9ucywgdGV4dCwgcGFzdGVPbk5ld0xpbmUsIG11bHRpY3Vyc29yVGV4dCkgewogICAgICBpZiAocGFzdGVPbk5ld0xpbmUpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoc2VsZWN0aW9ucy5sZW5ndGggPT09IDEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAobXVsdGljdXJzb3JUZXh0ICYmIG11bHRpY3Vyc29yVGV4dC5sZW5ndGggPT09IHNlbGVjdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG11bHRpY3Vyc29yVGV4dDsKICAgICAgfQogICAgICBpZiAoY29uZmlnLm11bHRpQ3Vyc29yUGFzdGUgPT09ICdzcHJlYWQnKSB7CiAgICAgICAgLy8gVHJ5IHRvIHNwcmVhZCB0aGUgcGFzdGVkIHRleHQgaW4gY2FzZSB0aGUgbGluZSBjb3VudCBtYXRjaGVzIHRoZSBjdXJzb3IgY291bnQKICAgICAgICAvLyBSZW1vdmUgdHJhaWxpbmcgXG4gaWYgcHJlc2VudAogICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQodGV4dC5sZW5ndGggLSAxKSA9PT0gMTAgLyogQ2hhckNvZGUuTGluZUZlZWQgKi8pIHsKICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cigwLCB0ZXh0Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KICAgICAgICAvLyBSZW1vdmUgdHJhaWxpbmcgXHIgaWYgcHJlc2VudAogICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQodGV4dC5sZW5ndGggLSAxKSA9PT0gMTMgLyogQ2hhckNvZGUuQ2FycmlhZ2VSZXR1cm4gKi8pIHsKICAgICAgICAgIHRleHQgPSB0ZXh0LnN1YnN0cigwLCB0ZXh0Lmxlbmd0aCAtIDEpOwogICAgICAgIH0KICAgICAgICB2YXIgbGluZXMgPSBzdHJpbmdzLnNwbGl0TGluZXModGV4dCk7CiAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA9PT0gc2VsZWN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiBsaW5lczsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicGFzdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBhc3RlKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIHRleHQsIHBhc3RlT25OZXdMaW5lLCBtdWx0aWN1cnNvclRleHQpIHsKICAgICAgdmFyIGRpc3RyaWJ1dGVkUGFzdGUgPSB0aGlzLl9kaXN0cmlidXRlUGFzdGVUb0N1cnNvcnMoY29uZmlnLCBzZWxlY3Rpb25zLCB0ZXh0LCBwYXN0ZU9uTmV3TGluZSwgbXVsdGljdXJzb3JUZXh0KTsKICAgICAgaWYgKGRpc3RyaWJ1dGVkUGFzdGUpIHsKICAgICAgICBzZWxlY3Rpb25zID0gc2VsZWN0aW9ucy5zb3J0KFJhbmdlLmNvbXBhcmVSYW5nZXNVc2luZ1N0YXJ0cyk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3RyaWJ1dGVkUGFzdGUoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgZGlzdHJpYnV0ZWRQYXN0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpbXBsZVBhc3RlKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIHRleHQsIHBhc3RlT25OZXdMaW5lKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIl9nb29kSW5kZW50Rm9yTGluZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dvb2RJbmRlbnRGb3JMaW5lKGNvbmZpZywgbW9kZWwsIGxpbmVOdW1iZXIpIHsKICAgICAgdmFyIGFjdGlvbiA9IG51bGw7CiAgICAgIHZhciBpbmRlbnRhdGlvbiA9ICcnOwogICAgICB2YXIgZXhwZWN0ZWRJbmRlbnRBY3Rpb24gPSBnZXRJbmhlcml0SW5kZW50Rm9yTGluZShjb25maWcuYXV0b0luZGVudCwgbW9kZWwsIGxpbmVOdW1iZXIsIGZhbHNlLCBjb25maWcubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZSk7CiAgICAgIGlmIChleHBlY3RlZEluZGVudEFjdGlvbikgewogICAgICAgIGFjdGlvbiA9IGV4cGVjdGVkSW5kZW50QWN0aW9uLmFjdGlvbjsKICAgICAgICBpbmRlbnRhdGlvbiA9IGV4cGVjdGVkSW5kZW50QWN0aW9uLmluZGVudGF0aW9uOwogICAgICB9IGVsc2UgaWYgKGxpbmVOdW1iZXIgPiAxKSB7CiAgICAgICAgdmFyIGxhc3RMaW5lTnVtYmVyOwogICAgICAgIGZvciAobGFzdExpbmVOdW1iZXIgPSBsaW5lTnVtYmVyIC0gMTsgbGFzdExpbmVOdW1iZXIgPj0gMTsgbGFzdExpbmVOdW1iZXItLSkgewogICAgICAgICAgdmFyIGxpbmVUZXh0ID0gbW9kZWwuZ2V0TGluZUNvbnRlbnQobGFzdExpbmVOdW1iZXIpOwogICAgICAgICAgdmFyIG5vbldoaXRlc3BhY2VJZHggPSBzdHJpbmdzLmxhc3ROb25XaGl0ZXNwYWNlSW5kZXgobGluZVRleHQpOwogICAgICAgICAgaWYgKG5vbldoaXRlc3BhY2VJZHggPj0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGxhc3RMaW5lTnVtYmVyIDwgMSkgewogICAgICAgICAgLy8gTm8gcHJldmlvdXMgbGluZSB3aXRoIGNvbnRlbnQgZm91bmQKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB2YXIgbWF4Q29sdW1uID0gbW9kZWwuZ2V0TGluZU1heENvbHVtbihsYXN0TGluZU51bWJlcik7CiAgICAgICAgdmFyIGV4cGVjdGVkRW50ZXJBY3Rpb24gPSBnZXRFbnRlckFjdGlvbihjb25maWcuYXV0b0luZGVudCwgbW9kZWwsIG5ldyBSYW5nZShsYXN0TGluZU51bWJlciwgbWF4Q29sdW1uLCBsYXN0TGluZU51bWJlciwgbWF4Q29sdW1uKSwgY29uZmlnLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UpOwogICAgICAgIGlmIChleHBlY3RlZEVudGVyQWN0aW9uKSB7CiAgICAgICAgICBpbmRlbnRhdGlvbiA9IGV4cGVjdGVkRW50ZXJBY3Rpb24uaW5kZW50YXRpb24gKyBleHBlY3RlZEVudGVyQWN0aW9uLmFwcGVuZFRleHQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChhY3Rpb24pIHsKICAgICAgICBpZiAoYWN0aW9uID09PSBJbmRlbnRBY3Rpb24uSW5kZW50KSB7CiAgICAgICAgICBpbmRlbnRhdGlvbiA9IFR5cGVPcGVyYXRpb25zLnNoaWZ0SW5kZW50KGNvbmZpZywgaW5kZW50YXRpb24pOwogICAgICAgIH0KICAgICAgICBpZiAoYWN0aW9uID09PSBJbmRlbnRBY3Rpb24uT3V0ZGVudCkgewogICAgICAgICAgaW5kZW50YXRpb24gPSBUeXBlT3BlcmF0aW9ucy51bnNoaWZ0SW5kZW50KGNvbmZpZywgaW5kZW50YXRpb24pOwogICAgICAgIH0KICAgICAgICBpbmRlbnRhdGlvbiA9IGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihpbmRlbnRhdGlvbik7CiAgICAgIH0KICAgICAgaWYgKCFpbmRlbnRhdGlvbikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBpbmRlbnRhdGlvbjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVwbGFjZUp1bXBUb05leHRJbmRlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZXBsYWNlSnVtcFRvTmV4dEluZGVudChjb25maWcsIG1vZGVsLCBzZWxlY3Rpb24sIGluc2VydHNBdXRvV2hpdGVzcGFjZSkgewogICAgICB2YXIgdHlwZVRleHQgPSAnJzsKICAgICAgdmFyIHBvc2l0aW9uID0gc2VsZWN0aW9uLmdldFN0YXJ0UG9zaXRpb24oKTsKICAgICAgaWYgKGNvbmZpZy5pbnNlcnRTcGFjZXMpIHsKICAgICAgICB2YXIgdmlzaWJsZUNvbHVtbkZyb21Db2x1bW4gPSBjb25maWcudmlzaWJsZUNvbHVtbkZyb21Db2x1bW4obW9kZWwsIHBvc2l0aW9uKTsKICAgICAgICB2YXIgaW5kZW50U2l6ZSA9IGNvbmZpZy5pbmRlbnRTaXplOwogICAgICAgIHZhciBzcGFjZXNDbnQgPSBpbmRlbnRTaXplIC0gdmlzaWJsZUNvbHVtbkZyb21Db2x1bW4gJSBpbmRlbnRTaXplOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhY2VzQ250OyBpKyspIHsKICAgICAgICAgIHR5cGVUZXh0ICs9ICcgJzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHlwZVRleHQgPSAnXHQnOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgUmVwbGFjZUNvbW1hbmQoc2VsZWN0aW9uLCB0eXBlVGV4dCwgaW5zZXJ0c0F1dG9XaGl0ZXNwYWNlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0YWIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRhYihjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zKSB7CiAgICAgIHZhciBjb21tYW5kcyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VsZWN0aW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBzZWxlY3Rpb25zW2ldOwogICAgICAgIGlmIChzZWxlY3Rpb24uaXNFbXB0eSgpKSB7CiAgICAgICAgICB2YXIgbGluZVRleHQgPSBtb2RlbC5nZXRMaW5lQ29udGVudChzZWxlY3Rpb24uc3RhcnRMaW5lTnVtYmVyKTsKICAgICAgICAgIGlmICgvXlxzKiQvLnRlc3QobGluZVRleHQpICYmIG1vZGVsLnRva2VuaXphdGlvbi5pc0NoZWFwVG9Ub2tlbml6ZShzZWxlY3Rpb24uc3RhcnRMaW5lTnVtYmVyKSkgewogICAgICAgICAgICB2YXIgZ29vZEluZGVudCA9IHRoaXMuX2dvb2RJbmRlbnRGb3JMaW5lKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbi5zdGFydExpbmVOdW1iZXIpOwogICAgICAgICAgICBnb29kSW5kZW50ID0gZ29vZEluZGVudCB8fCAnXHQnOwogICAgICAgICAgICB2YXIgcG9zc2libGVUeXBlVGV4dCA9IGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihnb29kSW5kZW50KTsKICAgICAgICAgICAgaWYgKCFsaW5lVGV4dC5zdGFydHNXaXRoKHBvc3NpYmxlVHlwZVRleHQpKSB7CiAgICAgICAgICAgICAgY29tbWFuZHNbaV0gPSBuZXcgUmVwbGFjZUNvbW1hbmQobmV3IFJhbmdlKHNlbGVjdGlvbi5zdGFydExpbmVOdW1iZXIsIDEsIHNlbGVjdGlvbi5zdGFydExpbmVOdW1iZXIsIGxpbmVUZXh0Lmxlbmd0aCArIDEpLCBwb3NzaWJsZVR5cGVUZXh0LCB0cnVlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29tbWFuZHNbaV0gPSB0aGlzLl9yZXBsYWNlSnVtcFRvTmV4dEluZGVudChjb25maWcsIG1vZGVsLCBzZWxlY3Rpb24sIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoc2VsZWN0aW9uLnN0YXJ0TGluZU51bWJlciA9PT0gc2VsZWN0aW9uLmVuZExpbmVOdW1iZXIpIHsKICAgICAgICAgICAgdmFyIGxpbmVNYXhDb2x1bW4gPSBtb2RlbC5nZXRMaW5lTWF4Q29sdW1uKHNlbGVjdGlvbi5zdGFydExpbmVOdW1iZXIpOwogICAgICAgICAgICBpZiAoc2VsZWN0aW9uLnN0YXJ0Q29sdW1uICE9PSAxIHx8IHNlbGVjdGlvbi5lbmRDb2x1bW4gIT09IGxpbmVNYXhDb2x1bW4pIHsKICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgc2luZ2xlIGxpbmUgc2VsZWN0aW9uIHRoYXQgaXMgbm90IHRoZSBlbnRpcmUgbGluZQogICAgICAgICAgICAgIGNvbW1hbmRzW2ldID0gdGhpcy5fcmVwbGFjZUp1bXBUb05leHRJbmRlbnQoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9uLCBmYWxzZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbW1hbmRzW2ldID0gbmV3IFNoaWZ0Q29tbWFuZChzZWxlY3Rpb24sIHsKICAgICAgICAgICAgaXNVbnNoaWZ0OiBmYWxzZSwKICAgICAgICAgICAgdGFiU2l6ZTogY29uZmlnLnRhYlNpemUsCiAgICAgICAgICAgIGluZGVudFNpemU6IGNvbmZpZy5pbmRlbnRTaXplLAogICAgICAgICAgICBpbnNlcnRTcGFjZXM6IGNvbmZpZy5pbnNlcnRTcGFjZXMsCiAgICAgICAgICAgIHVzZVRhYlN0b3BzOiBjb25maWcudXNlVGFiU3RvcHMsCiAgICAgICAgICAgIGF1dG9JbmRlbnQ6IGNvbmZpZy5hdXRvSW5kZW50CiAgICAgICAgICB9LCBjb25maWcubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjb21tYW5kczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb3NpdGlvblR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvc2l0aW9uVHlwZShwcmV2RWRpdE9wZXJhdGlvblR5cGUsIGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIHRleHQsIHJlcGxhY2VQcmV2Q2hhckNudCwgcmVwbGFjZU5leHRDaGFyQ250LCBwb3NpdGlvbkRlbHRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBjb21tYW5kcyA9IHNlbGVjdGlvbnMubWFwKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHsKICAgICAgICByZXR1cm4gX3RoaXMuX2NvbXBvc2l0aW9uVHlwZShtb2RlbCwgc2VsZWN0aW9uLCB0ZXh0LCByZXBsYWNlUHJldkNoYXJDbnQsIHJlcGxhY2VOZXh0Q2hhckNudCwgcG9zaXRpb25EZWx0YSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gbmV3IEVkaXRPcGVyYXRpb25SZXN1bHQoNCAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdPdGhlciAqLywgY29tbWFuZHMsIHsKICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QmVmb3JlOiBzaG91bGRQdXNoU3RhY2tFbGVtZW50QmV0d2VlbihwcmV2RWRpdE9wZXJhdGlvblR5cGUsIDQgLyogRWRpdE9wZXJhdGlvblR5cGUuVHlwaW5nT3RoZXIgKi8pLAogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRBZnRlcjogZmFsc2UKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2NvbXBvc2l0aW9uVHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbXBvc2l0aW9uVHlwZShtb2RlbCwgc2VsZWN0aW9uLCB0ZXh0LCByZXBsYWNlUHJldkNoYXJDbnQsIHJlcGxhY2VOZXh0Q2hhckNudCwgcG9zaXRpb25EZWx0YSkgewogICAgICBpZiAoIXNlbGVjdGlvbi5pc0VtcHR5KCkpIHsKICAgICAgICAvLyBsb29rcyBsaWtlIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvdnNjb2RlL2lzc3Vlcy8yNzczCiAgICAgICAgLy8gd2hlcmUgYSBjdXJzb3Igb3BlcmF0aW9uIG9jY3VycmVkIGJlZm9yZSBhIGNhbmNlbGVkIGNvbXBvc2l0aW9uCiAgICAgICAgLy8gPT4gaWdub3JlIGNvbXBvc2l0aW9uCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdmFyIHBvcyA9IHNlbGVjdGlvbi5nZXRQb3NpdGlvbigpOwogICAgICB2YXIgc3RhcnRDb2x1bW4gPSBNYXRoLm1heCgxLCBwb3MuY29sdW1uIC0gcmVwbGFjZVByZXZDaGFyQ250KTsKICAgICAgdmFyIGVuZENvbHVtbiA9IE1hdGgubWluKG1vZGVsLmdldExpbmVNYXhDb2x1bW4ocG9zLmxpbmVOdW1iZXIpLCBwb3MuY29sdW1uICsgcmVwbGFjZU5leHRDaGFyQ250KTsKICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHBvcy5saW5lTnVtYmVyLCBzdGFydENvbHVtbiwgcG9zLmxpbmVOdW1iZXIsIGVuZENvbHVtbik7CiAgICAgIHZhciBvbGRUZXh0ID0gbW9kZWwuZ2V0VmFsdWVJblJhbmdlKHJhbmdlKTsKICAgICAgaWYgKG9sZFRleHQgPT09IHRleHQgJiYgcG9zaXRpb25EZWx0YSA9PT0gMCkgewogICAgICAgIC8vID0+IGlnbm9yZSBjb21wb3NpdGlvbiB0aGF0IGRvZXNuJ3QgZG8gYW55dGhpbmcKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFJlcGxhY2VDb21tYW5kV2l0aE9mZnNldEN1cnNvclN0YXRlKHJhbmdlLCB0ZXh0LCAwLCBwb3NpdGlvbkRlbHRhKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdHlwZUNvbW1hbmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF90eXBlQ29tbWFuZChyYW5nZSwgdGV4dCwga2VlcFBvc2l0aW9uKSB7CiAgICAgIGlmIChrZWVwUG9zaXRpb24pIHsKICAgICAgICByZXR1cm4gbmV3IFJlcGxhY2VDb21tYW5kV2l0aG91dENoYW5naW5nUG9zaXRpb24ocmFuZ2UsIHRleHQsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgUmVwbGFjZUNvbW1hbmQocmFuZ2UsIHRleHQsIHRydWUpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX2VudGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW50ZXIoY29uZmlnLCBtb2RlbCwga2VlcFBvc2l0aW9uLCByYW5nZSkgewogICAgICBpZiAoY29uZmlnLmF1dG9JbmRlbnQgPT09IDAgLyogRWRpdG9yQXV0b0luZGVudFN0cmF0ZWd5Lk5vbmUgKi8pIHsKICAgICAgICByZXR1cm4gVHlwZU9wZXJhdGlvbnMuX3R5cGVDb21tYW5kKHJhbmdlLCAnXG4nLCBrZWVwUG9zaXRpb24pOwogICAgICB9CiAgICAgIGlmICghbW9kZWwudG9rZW5pemF0aW9uLmlzQ2hlYXBUb1Rva2VuaXplKHJhbmdlLmdldFN0YXJ0UG9zaXRpb24oKS5saW5lTnVtYmVyKSB8fCBjb25maWcuYXV0b0luZGVudCA9PT0gMSAvKiBFZGl0b3JBdXRvSW5kZW50U3RyYXRlZ3kuS2VlcCAqLykgewogICAgICAgIHZhciBfbGluZVRleHQgPSBtb2RlbC5nZXRMaW5lQ29udGVudChyYW5nZS5zdGFydExpbmVOdW1iZXIpOwogICAgICAgIHZhciBfaW5kZW50YXRpb24gPSBzdHJpbmdzLmdldExlYWRpbmdXaGl0ZXNwYWNlKF9saW5lVGV4dCkuc3Vic3RyaW5nKDAsIHJhbmdlLnN0YXJ0Q29sdW1uIC0gMSk7CiAgICAgICAgcmV0dXJuIFR5cGVPcGVyYXRpb25zLl90eXBlQ29tbWFuZChyYW5nZSwgJ1xuJyArIGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihfaW5kZW50YXRpb24pLCBrZWVwUG9zaXRpb24pOwogICAgICB9CiAgICAgIHZhciByID0gZ2V0RW50ZXJBY3Rpb24oY29uZmlnLmF1dG9JbmRlbnQsIG1vZGVsLCByYW5nZSwgY29uZmlnLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UpOwogICAgICBpZiAocikgewogICAgICAgIGlmIChyLmluZGVudEFjdGlvbiA9PT0gSW5kZW50QWN0aW9uLk5vbmUpIHsKICAgICAgICAgIC8vIE5vdGhpbmcgc3BlY2lhbAogICAgICAgICAgcmV0dXJuIFR5cGVPcGVyYXRpb25zLl90eXBlQ29tbWFuZChyYW5nZSwgJ1xuJyArIGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihyLmluZGVudGF0aW9uICsgci5hcHBlbmRUZXh0KSwga2VlcFBvc2l0aW9uKTsKICAgICAgICB9IGVsc2UgaWYgKHIuaW5kZW50QWN0aW9uID09PSBJbmRlbnRBY3Rpb24uSW5kZW50KSB7CiAgICAgICAgICAvLyBJbmRlbnQgb25jZQogICAgICAgICAgcmV0dXJuIFR5cGVPcGVyYXRpb25zLl90eXBlQ29tbWFuZChyYW5nZSwgJ1xuJyArIGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihyLmluZGVudGF0aW9uICsgci5hcHBlbmRUZXh0KSwga2VlcFBvc2l0aW9uKTsKICAgICAgICB9IGVsc2UgaWYgKHIuaW5kZW50QWN0aW9uID09PSBJbmRlbnRBY3Rpb24uSW5kZW50T3V0ZGVudCkgewogICAgICAgICAgLy8gVWx0cmEgc3BlY2lhbAogICAgICAgICAgdmFyIG5vcm1hbEluZGVudCA9IGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihyLmluZGVudGF0aW9uKTsKICAgICAgICAgIHZhciBpbmNyZWFzZWRJbmRlbnQgPSBjb25maWcubm9ybWFsaXplSW5kZW50YXRpb24oci5pbmRlbnRhdGlvbiArIHIuYXBwZW5kVGV4dCk7CiAgICAgICAgICB2YXIgdHlwZVRleHQgPSAnXG4nICsgaW5jcmVhc2VkSW5kZW50ICsgJ1xuJyArIG5vcm1hbEluZGVudDsKICAgICAgICAgIGlmIChrZWVwUG9zaXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXBsYWNlQ29tbWFuZFdpdGhvdXRDaGFuZ2luZ1Bvc2l0aW9uKHJhbmdlLCB0eXBlVGV4dCwgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbmV3IFJlcGxhY2VDb21tYW5kV2l0aE9mZnNldEN1cnNvclN0YXRlKHJhbmdlLCB0eXBlVGV4dCwgLTEsIGluY3JlYXNlZEluZGVudC5sZW5ndGggLSBub3JtYWxJbmRlbnQubGVuZ3RoLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHIuaW5kZW50QWN0aW9uID09PSBJbmRlbnRBY3Rpb24uT3V0ZGVudCkgewogICAgICAgICAgdmFyIGFjdHVhbEluZGVudGF0aW9uID0gVHlwZU9wZXJhdGlvbnMudW5zaGlmdEluZGVudChjb25maWcsIHIuaW5kZW50YXRpb24pOwogICAgICAgICAgcmV0dXJuIFR5cGVPcGVyYXRpb25zLl90eXBlQ29tbWFuZChyYW5nZSwgJ1xuJyArIGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihhY3R1YWxJbmRlbnRhdGlvbiArIHIuYXBwZW5kVGV4dCksIGtlZXBQb3NpdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBsaW5lVGV4dCA9IG1vZGVsLmdldExpbmVDb250ZW50KHJhbmdlLnN0YXJ0TGluZU51bWJlcik7CiAgICAgIHZhciBpbmRlbnRhdGlvbiA9IHN0cmluZ3MuZ2V0TGVhZGluZ1doaXRlc3BhY2UobGluZVRleHQpLnN1YnN0cmluZygwLCByYW5nZS5zdGFydENvbHVtbiAtIDEpOwogICAgICBpZiAoY29uZmlnLmF1dG9JbmRlbnQgPj0gNCAvKiBFZGl0b3JBdXRvSW5kZW50U3RyYXRlZ3kuRnVsbCAqLykgewogICAgICAgIHZhciBpciA9IGdldEluZGVudEZvckVudGVyKGNvbmZpZy5hdXRvSW5kZW50LCBtb2RlbCwgcmFuZ2UsIHsKICAgICAgICAgIHVuc2hpZnRJbmRlbnQ6IGZ1bmN0aW9uIHVuc2hpZnRJbmRlbnQoaW5kZW50KSB7CiAgICAgICAgICAgIHJldHVybiBUeXBlT3BlcmF0aW9ucy51bnNoaWZ0SW5kZW50KGNvbmZpZywgaW5kZW50KTsKICAgICAgICAgIH0sCiAgICAgICAgICBzaGlmdEluZGVudDogZnVuY3Rpb24gc2hpZnRJbmRlbnQoaW5kZW50KSB7CiAgICAgICAgICAgIHJldHVybiBUeXBlT3BlcmF0aW9ucy5zaGlmdEluZGVudChjb25maWcsIGluZGVudCk7CiAgICAgICAgICB9LAogICAgICAgICAgbm9ybWFsaXplSW5kZW50YXRpb246IGZ1bmN0aW9uIG5vcm1hbGl6ZUluZGVudGF0aW9uKGluZGVudCkgewogICAgICAgICAgICByZXR1cm4gY29uZmlnLm5vcm1hbGl6ZUluZGVudGF0aW9uKGluZGVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgY29uZmlnLmxhbmd1YWdlQ29uZmlndXJhdGlvblNlcnZpY2UpOwogICAgICAgIGlmIChpcikgewogICAgICAgICAgdmFyIG9sZEVuZFZpZXdDb2x1bW4gPSBjb25maWcudmlzaWJsZUNvbHVtbkZyb21Db2x1bW4obW9kZWwsIHJhbmdlLmdldEVuZFBvc2l0aW9uKCkpOwogICAgICAgICAgdmFyIG9sZEVuZENvbHVtbiA9IHJhbmdlLmVuZENvbHVtbjsKICAgICAgICAgIHZhciBuZXdMaW5lQ29udGVudCA9IG1vZGVsLmdldExpbmVDb250ZW50KHJhbmdlLmVuZExpbmVOdW1iZXIpOwogICAgICAgICAgdmFyIGZpcnN0Tm9uV2hpdGVzcGFjZSA9IHN0cmluZ3MuZmlyc3ROb25XaGl0ZXNwYWNlSW5kZXgobmV3TGluZUNvbnRlbnQpOwogICAgICAgICAgaWYgKGZpcnN0Tm9uV2hpdGVzcGFjZSA+PSAwKSB7CiAgICAgICAgICAgIHJhbmdlID0gcmFuZ2Uuc2V0RW5kUG9zaXRpb24ocmFuZ2UuZW5kTGluZU51bWJlciwgTWF0aC5tYXgocmFuZ2UuZW5kQ29sdW1uLCBmaXJzdE5vbldoaXRlc3BhY2UgKyAxKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByYW5nZSA9IHJhbmdlLnNldEVuZFBvc2l0aW9uKHJhbmdlLmVuZExpbmVOdW1iZXIsIG1vZGVsLmdldExpbmVNYXhDb2x1bW4ocmFuZ2UuZW5kTGluZU51bWJlcikpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGtlZXBQb3NpdGlvbikgewogICAgICAgICAgICByZXR1cm4gbmV3IFJlcGxhY2VDb21tYW5kV2l0aG91dENoYW5naW5nUG9zaXRpb24ocmFuZ2UsICdcbicgKyBjb25maWcubm9ybWFsaXplSW5kZW50YXRpb24oaXIuYWZ0ZXJFbnRlciksIHRydWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG9mZnNldCA9IDA7CiAgICAgICAgICAgIGlmIChvbGRFbmRDb2x1bW4gPD0gZmlyc3ROb25XaGl0ZXNwYWNlICsgMSkgewogICAgICAgICAgICAgIGlmICghY29uZmlnLmluc2VydFNwYWNlcykgewogICAgICAgICAgICAgICAgb2xkRW5kVmlld0NvbHVtbiA9IE1hdGguY2VpbChvbGRFbmRWaWV3Q29sdW1uIC8gY29uZmlnLmluZGVudFNpemUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBvZmZzZXQgPSBNYXRoLm1pbihvbGRFbmRWaWV3Q29sdW1uICsgMSAtIGNvbmZpZy5ub3JtYWxpemVJbmRlbnRhdGlvbihpci5hZnRlckVudGVyKS5sZW5ndGggLSAxLCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFJlcGxhY2VDb21tYW5kV2l0aE9mZnNldEN1cnNvclN0YXRlKHJhbmdlLCAnXG4nICsgY29uZmlnLm5vcm1hbGl6ZUluZGVudGF0aW9uKGlyLmFmdGVyRW50ZXIpLCAwLCBvZmZzZXQsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gVHlwZU9wZXJhdGlvbnMuX3R5cGVDb21tYW5kKHJhbmdlLCAnXG4nICsgY29uZmlnLm5vcm1hbGl6ZUluZGVudGF0aW9uKGluZGVudGF0aW9uKSwga2VlcFBvc2l0aW9uKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaXNBdXRvSW5kZW50VHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2lzQXV0b0luZGVudFR5cGUoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucykgewogICAgICBpZiAoY29uZmlnLmF1dG9JbmRlbnQgPCA0IC8qIEVkaXRvckF1dG9JbmRlbnRTdHJhdGVneS5GdWxsICovKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzZWxlY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKCFtb2RlbC50b2tlbml6YXRpb24uaXNDaGVhcFRvVG9rZW5pemUoc2VsZWN0aW9uc1tpXS5nZXRFbmRQb3NpdGlvbigpLmxpbmVOdW1iZXIpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogIl9ydW5BdXRvSW5kZW50VHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3J1bkF1dG9JbmRlbnRUeXBlKGNvbmZpZywgbW9kZWwsIHJhbmdlLCBjaCkgewogICAgICB2YXIgY3VycmVudEluZGVudGF0aW9uID0gZ2V0SW5kZW50YXRpb25BdFBvc2l0aW9uKG1vZGVsLCByYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLnN0YXJ0Q29sdW1uKTsKICAgICAgdmFyIGFjdHVhbEluZGVudGF0aW9uID0gZ2V0SW5kZW50QWN0aW9uRm9yVHlwZShjb25maWcuYXV0b0luZGVudCwgbW9kZWwsIHJhbmdlLCBjaCwgewogICAgICAgIHNoaWZ0SW5kZW50OiBmdW5jdGlvbiBzaGlmdEluZGVudChpbmRlbnRhdGlvbikgewogICAgICAgICAgcmV0dXJuIFR5cGVPcGVyYXRpb25zLnNoaWZ0SW5kZW50KGNvbmZpZywgaW5kZW50YXRpb24pOwogICAgICAgIH0sCiAgICAgICAgdW5zaGlmdEluZGVudDogZnVuY3Rpb24gdW5zaGlmdEluZGVudChpbmRlbnRhdGlvbikgewogICAgICAgICAgcmV0dXJuIFR5cGVPcGVyYXRpb25zLnVuc2hpZnRJbmRlbnQoY29uZmlnLCBpbmRlbnRhdGlvbik7CiAgICAgICAgfQogICAgICB9LCBjb25maWcubGFuZ3VhZ2VDb25maWd1cmF0aW9uU2VydmljZSk7CiAgICAgIGlmIChhY3R1YWxJbmRlbnRhdGlvbiA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGlmIChhY3R1YWxJbmRlbnRhdGlvbiAhPT0gY29uZmlnLm5vcm1hbGl6ZUluZGVudGF0aW9uKGN1cnJlbnRJbmRlbnRhdGlvbikpIHsKICAgICAgICB2YXIgZmlyc3ROb25XaGl0ZXNwYWNlID0gbW9kZWwuZ2V0TGluZUZpcnN0Tm9uV2hpdGVzcGFjZUNvbHVtbihyYW5nZS5zdGFydExpbmVOdW1iZXIpOwogICAgICAgIGlmIChmaXJzdE5vbldoaXRlc3BhY2UgPT09IDApIHsKICAgICAgICAgIHJldHVybiBUeXBlT3BlcmF0aW9ucy5fdHlwZUNvbW1hbmQobmV3IFJhbmdlKHJhbmdlLnN0YXJ0TGluZU51bWJlciwgMSwgcmFuZ2UuZW5kTGluZU51bWJlciwgcmFuZ2UuZW5kQ29sdW1uKSwgY29uZmlnLm5vcm1hbGl6ZUluZGVudGF0aW9uKGFjdHVhbEluZGVudGF0aW9uKSArIGNoLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBUeXBlT3BlcmF0aW9ucy5fdHlwZUNvbW1hbmQobmV3IFJhbmdlKHJhbmdlLnN0YXJ0TGluZU51bWJlciwgMSwgcmFuZ2UuZW5kTGluZU51bWJlciwgcmFuZ2UuZW5kQ29sdW1uKSwgY29uZmlnLm5vcm1hbGl6ZUluZGVudGF0aW9uKGFjdHVhbEluZGVudGF0aW9uKSArIG1vZGVsLmdldExpbmVDb250ZW50KHJhbmdlLnN0YXJ0TGluZU51bWJlcikuc3Vic3RyaW5nKGZpcnN0Tm9uV2hpdGVzcGFjZSAtIDEsIHJhbmdlLnN0YXJ0Q29sdW1uIC0gMSkgKyBjaCwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaXNBdXRvQ2xvc2luZ092ZXJ0eXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaXNBdXRvQ2xvc2luZ092ZXJ0eXBlKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIGF1dG9DbG9zZWRDaGFyYWN0ZXJzLCBjaCkgewogICAgICBpZiAoY29uZmlnLmF1dG9DbG9zaW5nT3ZlcnR5cGUgPT09ICduZXZlcicpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCFjb25maWcuYXV0b0Nsb3NpbmdQYWlycy5hdXRvQ2xvc2luZ1BhaXJzQ2xvc2VTaW5nbGVDaGFyLmhhcyhjaCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlbGVjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgc2VsZWN0aW9uID0gc2VsZWN0aW9uc1tpXTsKICAgICAgICBpZiAoIXNlbGVjdGlvbi5pc0VtcHR5KCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIHBvc2l0aW9uID0gc2VsZWN0aW9uLmdldFBvc2l0aW9uKCk7CiAgICAgICAgdmFyIGxpbmVUZXh0ID0gbW9kZWwuZ2V0TGluZUNvbnRlbnQocG9zaXRpb24ubGluZU51bWJlcik7CiAgICAgICAgdmFyIGFmdGVyQ2hhcmFjdGVyID0gbGluZVRleHQuY2hhckF0KHBvc2l0aW9uLmNvbHVtbiAtIDEpOwogICAgICAgIGlmIChhZnRlckNoYXJhY3RlciAhPT0gY2gpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gRG8gbm90IG92ZXItdHlwZSBxdW90ZXMgYWZ0ZXIgYSBiYWNrc2xhc2gKICAgICAgICB2YXIgY2hJc1F1b3RlID0gaXNRdW90ZShjaCk7CiAgICAgICAgdmFyIGJlZm9yZUNoYXJhY3RlciA9IHBvc2l0aW9uLmNvbHVtbiA+IDIgPyBsaW5lVGV4dC5jaGFyQ29kZUF0KHBvc2l0aW9uLmNvbHVtbiAtIDIpIDogMCAvKiBDaGFyQ29kZS5OdWxsICovOwogICAgICAgIGlmIChiZWZvcmVDaGFyYWN0ZXIgPT09IDkyIC8qIENoYXJDb2RlLkJhY2tzbGFzaCAqLyAmJiBjaElzUXVvdGUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gTXVzdCBvdmVyLXR5cGUgYSBjbG9zaW5nIGNoYXJhY3RlciB0eXBlZCBieSB0aGUgZWRpdG9yCiAgICAgICAgaWYgKGNvbmZpZy5hdXRvQ2xvc2luZ092ZXJ0eXBlID09PSAnYXV0bycpIHsKICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbkogPSBhdXRvQ2xvc2VkQ2hhcmFjdGVycy5sZW5ndGg7IGogPCBsZW5KOyBqKyspIHsKICAgICAgICAgICAgdmFyIGF1dG9DbG9zZWRDaGFyYWN0ZXIgPSBhdXRvQ2xvc2VkQ2hhcmFjdGVyc1tqXTsKICAgICAgICAgICAgaWYgKHBvc2l0aW9uLmxpbmVOdW1iZXIgPT09IGF1dG9DbG9zZWRDaGFyYWN0ZXIuc3RhcnRMaW5lTnVtYmVyICYmIHBvc2l0aW9uLmNvbHVtbiA9PT0gYXV0b0Nsb3NlZENoYXJhY3Rlci5zdGFydENvbHVtbikgewogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogIl9ydW5BdXRvQ2xvc2luZ092ZXJ0eXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcnVuQXV0b0Nsb3NpbmdPdmVydHlwZShwcmV2RWRpdE9wZXJhdGlvblR5cGUsIGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIGNoKSB7CiAgICAgIHZhciBjb21tYW5kcyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VsZWN0aW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBzZWxlY3Rpb25zW2ldOwogICAgICAgIHZhciBwb3NpdGlvbiA9IHNlbGVjdGlvbi5nZXRQb3NpdGlvbigpOwogICAgICAgIHZhciB0eXBlU2VsZWN0aW9uID0gbmV3IFJhbmdlKHBvc2l0aW9uLmxpbmVOdW1iZXIsIHBvc2l0aW9uLmNvbHVtbiwgcG9zaXRpb24ubGluZU51bWJlciwgcG9zaXRpb24uY29sdW1uICsgMSk7CiAgICAgICAgY29tbWFuZHNbaV0gPSBuZXcgUmVwbGFjZUNvbW1hbmQodHlwZVNlbGVjdGlvbiwgY2gpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgRWRpdE9wZXJhdGlvblJlc3VsdCg0IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ090aGVyICovLCBjb21tYW5kcywgewogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZXR3ZWVuKHByZXZFZGl0T3BlcmF0aW9uVHlwZSwgNCAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdPdGhlciAqLyksCiAgICAgICAgc2hvdWxkUHVzaFN0YWNrRWxlbWVudEFmdGVyOiBmYWxzZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaXNCZWZvcmVDbG9zaW5nQnJhY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pc0JlZm9yZUNsb3NpbmdCcmFjZShjb25maWcsIGxpbmVBZnRlcikgewogICAgICAvLyBJZiB0aGUgc3RhcnQgb2YgbGluZUFmdGVyIGNhbiBiZSBpbnRlcnByZXR0ZWQgYXMgYm90aCBhIHN0YXJ0aW5nIG9yIGVuZGluZyBicmFjZSwgZGVmYXVsdCB0byByZXR1cm5pbmcgZmFsc2UKICAgICAgdmFyIG5leHRDaGFyID0gbGluZUFmdGVyLmNoYXJBdCgwKTsKICAgICAgdmFyIHBvdGVudGlhbFN0YXJ0aW5nQnJhY2VzID0gY29uZmlnLmF1dG9DbG9zaW5nUGFpcnMuYXV0b0Nsb3NpbmdQYWlyc09wZW5CeVN0YXJ0LmdldChuZXh0Q2hhcikgfHwgW107CiAgICAgIHZhciBwb3RlbnRpYWxDbG9zaW5nQnJhY2VzID0gY29uZmlnLmF1dG9DbG9zaW5nUGFpcnMuYXV0b0Nsb3NpbmdQYWlyc0Nsb3NlQnlTdGFydC5nZXQobmV4dENoYXIpIHx8IFtdOwogICAgICB2YXIgaXNCZWZvcmVTdGFydGluZ0JyYWNlID0gcG90ZW50aWFsU3RhcnRpbmdCcmFjZXMuc29tZShmdW5jdGlvbiAoeCkgewogICAgICAgIHJldHVybiBsaW5lQWZ0ZXIuc3RhcnRzV2l0aCh4Lm9wZW4pOwogICAgICB9KTsKICAgICAgdmFyIGlzQmVmb3JlQ2xvc2luZ0JyYWNlID0gcG90ZW50aWFsQ2xvc2luZ0JyYWNlcy5zb21lKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgcmV0dXJuIGxpbmVBZnRlci5zdGFydHNXaXRoKHguY2xvc2UpOwogICAgICB9KTsKICAgICAgcmV0dXJuICFpc0JlZm9yZVN0YXJ0aW5nQnJhY2UgJiYgaXNCZWZvcmVDbG9zaW5nQnJhY2U7CiAgICB9CiAgICAvKioKICAgICAqIERldGVybWluZSBpZiB0eXBpbmcgYGNoYCBhdCBhbGwgYHBvc2l0aW9uc2AgaW4gdGhlIGBtb2RlbGAgcmVzdWx0cyBpbiBhbgogICAgICogYXV0byBjbG9zaW5nIG9wZW4gc2VxdWVuY2UgYmVpbmcgdHlwZWQuCiAgICAgKgogICAgICogQXV0byBjbG9zaW5nIG9wZW4gc2VxdWVuY2VzIGNhbiBjb25zaXN0IG9mIG11bHRpcGxlIGNoYXJhY3RlcnMsIHdoaWNoCiAgICAgKiBjYW4gbGVhZCB0byBhbWJpZ3VpdGllcy4gSW4gc3VjaCBhIGNhc2UsIHRoZSBsb25nZXN0IGF1dG8tY2xvc2luZyBvcGVuCiAgICAgKiBzZXF1ZW5jZSBpcyByZXR1cm5lZC4KICAgICAqLwogIH0sIHsKICAgIGtleTogIl9maW5kQXV0b0Nsb3NpbmdQYWlyT3BlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRBdXRvQ2xvc2luZ1BhaXJPcGVuKGNvbmZpZywgbW9kZWwsIHBvc2l0aW9ucywgY2gpIHsKICAgICAgdmFyIGNhbmRpZGF0ZXMgPSBjb25maWcuYXV0b0Nsb3NpbmdQYWlycy5hdXRvQ2xvc2luZ1BhaXJzT3BlbkJ5RW5kLmdldChjaCk7CiAgICAgIGlmICghY2FuZGlkYXRlcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIC8vIERldGVybWluZSB3aGljaCBhdXRvLWNsb3NpbmcgcGFpciBpdCBpcwogICAgICB2YXIgcmVzdWx0ID0gbnVsbDsKICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGNhbmRpZGF0ZXMpLAogICAgICAgIF9zdGVwOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgY2FuZGlkYXRlID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICBpZiAocmVzdWx0ID09PSBudWxsIHx8IGNhbmRpZGF0ZS5vcGVuLmxlbmd0aCA+IHJlc3VsdC5vcGVuLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgY2FuZGlkYXRlSXNNYXRjaCA9IHRydWU7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocG9zaXRpb25zKSwKICAgICAgICAgICAgICBfc3RlcDI7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgICAgIHZhciByZWxldmFudFRleHQgPSBtb2RlbC5nZXRWYWx1ZUluUmFuZ2UobmV3IFJhbmdlKHBvc2l0aW9uLmxpbmVOdW1iZXIsIHBvc2l0aW9uLmNvbHVtbiAtIGNhbmRpZGF0ZS5vcGVuLmxlbmd0aCArIDEsIHBvc2l0aW9uLmxpbmVOdW1iZXIsIHBvc2l0aW9uLmNvbHVtbikpOwogICAgICAgICAgICAgICAgaWYgKHJlbGV2YW50VGV4dCArIGNoICE9PSBjYW5kaWRhdGUub3BlbikgewogICAgICAgICAgICAgICAgICBjYW5kaWRhdGVJc01hdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZUlzTWF0Y2gpIHsKICAgICAgICAgICAgICByZXN1bHQgPSBjYW5kaWRhdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBGaW5kIGFub3RoZXIgYXV0by1jbG9zaW5nIHBhaXIgdGhhdCBpcyBjb250YWluZWQgYnkgdGhlIG9uZSBwYXNzZWQgaW4uCiAgICAgKgogICAgICogZS5nLiB3aGVuIGhhdmluZyBbKCwpXSBhbmQgWygqLCopXSBhcyBhdXRvLWNsb3NpbmcgcGFpcnMKICAgICAqIHRoaXMgbWV0aG9kIHdpbGwgZmluZCBbKCwpXSBhcyBhIGNvbnRhaW5tZW50IHBhaXIgZm9yIFsoKiwqKV0KICAgICAqLwogIH0sIHsKICAgIGtleTogIl9maW5kQ29udGFpbmVkQXV0b0Nsb3NpbmdQYWlyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZENvbnRhaW5lZEF1dG9DbG9zaW5nUGFpcihjb25maWcsIHBhaXIpIHsKICAgICAgaWYgKHBhaXIub3Blbi5sZW5ndGggPD0gMSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciBsYXN0Q2hhciA9IHBhaXIuY2xvc2UuY2hhckF0KHBhaXIuY2xvc2UubGVuZ3RoIC0gMSk7CiAgICAgIC8vIGdldCBjYW5kaWRhdGVzIHdpdGggdGhlIHNhbWUgbGFzdCBjaGFyYWN0ZXIgYXMgY2xvc2UKICAgICAgdmFyIGNhbmRpZGF0ZXMgPSBjb25maWcuYXV0b0Nsb3NpbmdQYWlycy5hdXRvQ2xvc2luZ1BhaXJzQ2xvc2VCeUVuZC5nZXQobGFzdENoYXIpIHx8IFtdOwogICAgICB2YXIgcmVzdWx0ID0gbnVsbDsKICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihjYW5kaWRhdGVzKSwKICAgICAgICBfc3RlcDM7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IzLnMoKTsgIShfc3RlcDMgPSBfaXRlcmF0b3IzLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBjYW5kaWRhdGUgPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICBpZiAoY2FuZGlkYXRlLm9wZW4gIT09IHBhaXIub3BlbiAmJiBwYWlyLm9wZW4uaW5jbHVkZXMoY2FuZGlkYXRlLm9wZW4pICYmIHBhaXIuY2xvc2UuZW5kc1dpdGgoY2FuZGlkYXRlLmNsb3NlKSkgewogICAgICAgICAgICBpZiAoIXJlc3VsdCB8fCBjYW5kaWRhdGUub3Blbi5sZW5ndGggPiByZXN1bHQub3Blbi5sZW5ndGgpIHsKICAgICAgICAgICAgICByZXN1bHQgPSBjYW5kaWRhdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjMuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldEF1dG9DbG9zaW5nUGFpckNsb3NlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0QXV0b0Nsb3NpbmdQYWlyQ2xvc2UoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgY2gsIGNoSXNBbHJlYWR5VHlwZWQpIHsKICAgICAgdmFyIGNoSXNRdW90ZSA9IGlzUXVvdGUoY2gpOwogICAgICB2YXIgYXV0b0Nsb3NlQ29uZmlnID0gY2hJc1F1b3RlID8gY29uZmlnLmF1dG9DbG9zaW5nUXVvdGVzIDogY29uZmlnLmF1dG9DbG9zaW5nQnJhY2tldHM7CiAgICAgIHZhciBzaG91bGRBdXRvQ2xvc2VCZWZvcmUgPSBjaElzUXVvdGUgPyBjb25maWcuc2hvdWxkQXV0b0Nsb3NlQmVmb3JlLnF1b3RlIDogY29uZmlnLnNob3VsZEF1dG9DbG9zZUJlZm9yZS5icmFja2V0OwogICAgICBpZiAoYXV0b0Nsb3NlQ29uZmlnID09PSAnbmV2ZXInKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihzZWxlY3Rpb25zKSwKICAgICAgICBfc3RlcDQ7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I0LnMoKTsgIShfc3RlcDQgPSBfaXRlcmF0b3I0Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSBfc3RlcDQudmFsdWU7CiAgICAgICAgICBpZiAoIXNlbGVjdGlvbi5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBib3RoIHdoZW4gdHlwaW5nIChyZWd1bGFybHkpIGFuZCB3aGVuIGNvbXBvc2l0aW9uIGVuZHMKICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgd2UgbmVlZCB0byB3b3JrIHdpdGggYSB0ZXh0IGJ1ZmZlciB3aGVyZSBzb21ldGltZXMgYGNoYCBpcyBub3QKICAgICAgICAvLyB0aGVyZSAoaXQgaXMgYmVpbmcgdHlwZWQgcmlnaHQgbm93KSBvciB3aXRoIGEgdGV4dCBidWZmZXIgd2hlcmUgYGNoYCBoYXMgYWxyZWFkeSBiZWVuIHR5cGVkCiAgICAgICAgLy8KICAgICAgICAvLyBJbiBvcmRlciB0byBhdm9pZCBhZGRpbmcgY2hlY2tzIGZvciBgY2hJc0FscmVhZHlUeXBlZGAgaW4gYWxsIHBsYWNlcywgd2Ugd2lsbCB3b3JrCiAgICAgICAgLy8gd2l0aCB0d28gY29uY2VwdHVhbCBwb3NpdGlvbnMsIHRoZSBwb3NpdGlvbiBiZWZvcmUgYGNoYCBhbmQgdGhlIHBvc2l0aW9uIGFmdGVyIGBjaGAKICAgICAgICAvLwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I0LmYoKTsKICAgICAgfQogICAgICB2YXIgcG9zaXRpb25zID0gc2VsZWN0aW9ucy5tYXAoZnVuY3Rpb24gKHMpIHsKICAgICAgICB2YXIgcG9zaXRpb24gPSBzLmdldFBvc2l0aW9uKCk7CiAgICAgICAgaWYgKGNoSXNBbHJlYWR5VHlwZWQpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbmVOdW1iZXI6IHBvc2l0aW9uLmxpbmVOdW1iZXIsCiAgICAgICAgICAgIGJlZm9yZUNvbHVtbjogcG9zaXRpb24uY29sdW1uIC0gY2gubGVuZ3RoLAogICAgICAgICAgICBhZnRlckNvbHVtbjogcG9zaXRpb24uY29sdW1uCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaW5lTnVtYmVyOiBwb3NpdGlvbi5saW5lTnVtYmVyLAogICAgICAgICAgICBiZWZvcmVDb2x1bW46IHBvc2l0aW9uLmNvbHVtbiwKICAgICAgICAgICAgYWZ0ZXJDb2x1bW46IHBvc2l0aW9uLmNvbHVtbgogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAvLyBGaW5kIHRoZSBsb25nZXN0IGF1dG8tY2xvc2luZyBvcGVuIHBhaXIgaW4gY2FzZSBvZiBtdWx0aXBsZSBlbmRpbmcgaW4gYGNoYAogICAgICAvLyBlLmcuIHdoZW4gaGF2aW5nIFtmIiwiXSBhbmQgWyIsIl0sIGl0IHBpY2tzIFtmIiwiXSBpZiB0aGUgY2hhcmFjdGVyIGJlZm9yZSBpcyBmCiAgICAgIHZhciBwYWlyID0gdGhpcy5fZmluZEF1dG9DbG9zaW5nUGFpck9wZW4oY29uZmlnLCBtb2RlbCwgcG9zaXRpb25zLm1hcChmdW5jdGlvbiAocCkgewogICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24ocC5saW5lTnVtYmVyLCBwLmJlZm9yZUNvbHVtbik7CiAgICAgIH0pLCBjaCk7CiAgICAgIGlmICghcGFpcikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIC8vIFNvbWV0aW1lcywgaXQgaXMgcG9zc2libGUgdG8gaGF2ZSB0d28gYXV0by1jbG9zaW5nIHBhaXJzIHRoYXQgaGF2ZSBhIGNvbnRhaW5tZW50IHJlbGF0aW9uc2hpcAogICAgICAvLyBlLmcuIHdoZW4gaGF2aW5nIFsoLCldIGFuZCBbKCosKildCiAgICAgIC8vIC0gd2hlbiB0eXBpbmcgKCwgdGhlIHJlc3VsdGluZyBzdGF0ZSBpcyAofCkKICAgICAgLy8gLSB3aGVuIHR5cGluZyAqLCB0aGUgZGVzaXJlZCByZXN1bHRpbmcgc3RhdGUgaXMgKCp8KiksIG5vdCAoKnwqKSkKICAgICAgdmFyIGNvbnRhaW5lZFBhaXIgPSB0aGlzLl9maW5kQ29udGFpbmVkQXV0b0Nsb3NpbmdQYWlyKGNvbmZpZywgcGFpcik7CiAgICAgIHZhciBjb250YWluZWRQYWlyQ2xvc2UgPSBjb250YWluZWRQYWlyID8gY29udGFpbmVkUGFpci5jbG9zZSA6ICcnOwogICAgICB2YXIgaXNDb250YWluZWRQYWlyUHJlc2VudCA9IHRydWU7CiAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocG9zaXRpb25zKSwKICAgICAgICBfc3RlcDU7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBwb3NpdGlvbiA9IF9zdGVwNS52YWx1ZTsKICAgICAgICAgIHZhciBsaW5lTnVtYmVyID0gcG9zaXRpb24ubGluZU51bWJlciwKICAgICAgICAgICAgYmVmb3JlQ29sdW1uID0gcG9zaXRpb24uYmVmb3JlQ29sdW1uLAogICAgICAgICAgICBhZnRlckNvbHVtbiA9IHBvc2l0aW9uLmFmdGVyQ29sdW1uOwogICAgICAgICAgdmFyIGxpbmVUZXh0ID0gbW9kZWwuZ2V0TGluZUNvbnRlbnQobGluZU51bWJlcik7CiAgICAgICAgICB2YXIgbGluZUJlZm9yZSA9IGxpbmVUZXh0LnN1YnN0cmluZygwLCBiZWZvcmVDb2x1bW4gLSAxKTsKICAgICAgICAgIHZhciBsaW5lQWZ0ZXIgPSBsaW5lVGV4dC5zdWJzdHJpbmcoYWZ0ZXJDb2x1bW4gLSAxKTsKICAgICAgICAgIGlmICghbGluZUFmdGVyLnN0YXJ0c1dpdGgoY29udGFpbmVkUGFpckNsb3NlKSkgewogICAgICAgICAgICBpc0NvbnRhaW5lZFBhaXJQcmVzZW50ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBPbmx5IGNvbnNpZGVyIGF1dG8gY2xvc2luZyB0aGUgcGFpciBpZiBhbiBhbGxvd2VkIGNoYXJhY3RlciBmb2xsb3dzIG9yIGlmIGFub3RoZXIgYXV0b2Nsb3NlZCBwYWlyIGNsb3NpbmcgYnJhY2UgZm9sbG93cwogICAgICAgICAgaWYgKGxpbmVBZnRlci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBjaGFyYWN0ZXJBZnRlciA9IGxpbmVBZnRlci5jaGFyQXQoMCk7CiAgICAgICAgICAgIHZhciBpc0JlZm9yZUNsb3NlQnJhY2UgPSBUeXBlT3BlcmF0aW9ucy5faXNCZWZvcmVDbG9zaW5nQnJhY2UoY29uZmlnLCBsaW5lQWZ0ZXIpOwogICAgICAgICAgICBpZiAoIWlzQmVmb3JlQ2xvc2VCcmFjZSAmJiAhc2hvdWxkQXV0b0Nsb3NlQmVmb3JlKGNoYXJhY3RlckFmdGVyKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBEbyBub3QgYXV0by1jbG9zZSAnIG9yICIgYWZ0ZXIgYSB3b3JkIGNoYXJhY3RlcgogICAgICAgICAgaWYgKHBhaXIub3Blbi5sZW5ndGggPT09IDEgJiYgKGNoID09PSAnXCcnIHx8IGNoID09PSAnIicpICYmIGF1dG9DbG9zZUNvbmZpZyAhPT0gJ2Fsd2F5cycpIHsKICAgICAgICAgICAgdmFyIHdvcmRTZXBhcmF0b3JzID0gZ2V0TWFwRm9yV29yZFNlcGFyYXRvcnMoY29uZmlnLndvcmRTZXBhcmF0b3JzKTsKICAgICAgICAgICAgaWYgKGxpbmVCZWZvcmUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHZhciBjaGFyYWN0ZXJCZWZvcmUgPSBsaW5lQmVmb3JlLmNoYXJDb2RlQXQobGluZUJlZm9yZS5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICBpZiAod29yZFNlcGFyYXRvcnMuZ2V0KGNoYXJhY3RlckJlZm9yZSkgPT09IDAgLyogV29yZENoYXJhY3RlckNsYXNzLlJlZ3VsYXIgKi8pIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFtb2RlbC50b2tlbml6YXRpb24uaXNDaGVhcFRvVG9rZW5pemUobGluZU51bWJlcikpIHsKICAgICAgICAgICAgLy8gRG8gbm90IGZvcmNlIHRva2VuaXphdGlvbgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG1vZGVsLnRva2VuaXphdGlvbi5mb3JjZVRva2VuaXphdGlvbihsaW5lTnVtYmVyKTsKICAgICAgICAgIHZhciBsaW5lVG9rZW5zID0gbW9kZWwudG9rZW5pemF0aW9uLmdldExpbmVUb2tlbnMobGluZU51bWJlcik7CiAgICAgICAgICB2YXIgc2NvcGVkTGluZVRva2VucyA9IGNyZWF0ZVNjb3BlZExpbmVUb2tlbnMobGluZVRva2VucywgYmVmb3JlQ29sdW1uIC0gMSk7CiAgICAgICAgICBpZiAoIXBhaXIuc2hvdWxkQXV0b0Nsb3NlKHNjb3BlZExpbmVUb2tlbnMsIGJlZm9yZUNvbHVtbiAtIHNjb3BlZExpbmVUb2tlbnMuZmlyc3RDaGFyT2Zmc2V0KSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIC8vIFR5cGluZyBmb3IgZXhhbXBsZSBhIHF1b3RlIGNvdWxkIGVpdGhlciBzdGFydCBhIG5ldyBzdHJpbmcsIGluIHdoaWNoIGNhc2UgYXV0by1jbG9zaW5nIGlzIGRlc2lyYWJsZQogICAgICAgICAgLy8gb3IgaXQgY291bGQgZW5kIGEgcHJldmlvdXNseSBzdGFydGVkIHN0cmluZywgaW4gd2hpY2ggY2FzZSBhdXRvLWNsb3NpbmcgaXMgbm90IGRlc2lyYWJsZQogICAgICAgICAgLy8KICAgICAgICAgIC8vIEluIGNlcnRhaW4gY2FzZXMsIGl0IGlzIHJlYWxseSBub3QgcG9zc2libGUgdG8gbG9vayBhdCB0aGUgcHJldmlvdXMgdG9rZW4gdG8gZGV0ZXJtaW5lCiAgICAgICAgICAvLyB3aGF0IHdvdWxkIGhhcHBlbi4gVGhhdCdzIHdoeSB3ZSBkbyBzb21ldGhpbmcgcmVhbGx5IHVudXN1YWwsIHdlIHByZXRlbmQgdG8gdHlwZSBhIGRpZmZlcmVudAogICAgICAgICAgLy8gY2hhcmFjdGVyIGFuZCBhc2sgdGhlIHRva2VuaXplciB3aGF0IHRoZSBvdXRjb21lIG9mIGRvaW5nIHRoYXQgaXM6IGFmdGVyIHR5cGluZyBhIG5ldXRyYWwKICAgICAgICAgIC8vIGNoYXJhY3RlciwgYXJlIHdlIGluIGEgc3RyaW5nIChpLmUuIHRoZSBxdW90ZSB3b3VsZCBtb3N0IGxpa2VseSBlbmQgYSBzdHJpbmcpIG9yIG5vdD8KICAgICAgICAgIC8vCiAgICAgICAgICB2YXIgbmV1dHJhbENoYXJhY3RlciA9IHBhaXIuZmluZE5ldXRyYWxDaGFyYWN0ZXIoKTsKICAgICAgICAgIGlmIChuZXV0cmFsQ2hhcmFjdGVyKSB7CiAgICAgICAgICAgIHZhciB0b2tlblR5cGUgPSBtb2RlbC50b2tlbml6YXRpb24uZ2V0VG9rZW5UeXBlSWZJbnNlcnRpbmdDaGFyYWN0ZXIobGluZU51bWJlciwgYmVmb3JlQ29sdW1uLCBuZXV0cmFsQ2hhcmFjdGVyKTsKICAgICAgICAgICAgaWYgKCFwYWlyLmlzT0sodG9rZW5UeXBlKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I1LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I1LmYoKTsKICAgICAgfQogICAgICBpZiAoaXNDb250YWluZWRQYWlyUHJlc2VudCkgewogICAgICAgIHJldHVybiBwYWlyLmNsb3NlLnN1YnN0cmluZygwLCBwYWlyLmNsb3NlLmxlbmd0aCAtIGNvbnRhaW5lZFBhaXJDbG9zZS5sZW5ndGgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBwYWlyLmNsb3NlOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX3J1bkF1dG9DbG9zaW5nT3BlbkNoYXJUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcnVuQXV0b0Nsb3NpbmdPcGVuQ2hhclR5cGUocHJldkVkaXRPcGVyYXRpb25UeXBlLCBjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zLCBjaCwgY2hJc0FscmVhZHlUeXBlZCwgYXV0b0Nsb3NpbmdQYWlyQ2xvc2UpIHsKICAgICAgdmFyIGNvbW1hbmRzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzZWxlY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIHNlbGVjdGlvbiA9IHNlbGVjdGlvbnNbaV07CiAgICAgICAgY29tbWFuZHNbaV0gPSBuZXcgVHlwZVdpdGhBdXRvQ2xvc2luZ0NvbW1hbmQoc2VsZWN0aW9uLCBjaCwgIWNoSXNBbHJlYWR5VHlwZWQsIGF1dG9DbG9zaW5nUGFpckNsb3NlKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IEVkaXRPcGVyYXRpb25SZXN1bHQoNCAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdPdGhlciAqLywgY29tbWFuZHMsIHsKICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QmVmb3JlOiB0cnVlLAogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRBZnRlcjogZmFsc2UKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3Nob3VsZFN1cnJvdW5kQ2hhciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Nob3VsZFN1cnJvdW5kQ2hhcihjb25maWcsIGNoKSB7CiAgICAgIGlmIChpc1F1b3RlKGNoKSkgewogICAgICAgIHJldHVybiBjb25maWcuYXV0b1N1cnJvdW5kID09PSAncXVvdGVzJyB8fCBjb25maWcuYXV0b1N1cnJvdW5kID09PSAnbGFuZ3VhZ2VEZWZpbmVkJzsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDaGFyYWN0ZXIgaXMgYSBicmFja2V0CiAgICAgICAgcmV0dXJuIGNvbmZpZy5hdXRvU3Vycm91bmQgPT09ICdicmFja2V0cycgfHwgY29uZmlnLmF1dG9TdXJyb3VuZCA9PT0gJ2xhbmd1YWdlRGVmaW5lZCc7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaXNTdXJyb3VuZFNlbGVjdGlvblR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9pc1N1cnJvdW5kU2VsZWN0aW9uVHlwZShjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zLCBjaCkgewogICAgICBpZiAoIVR5cGVPcGVyYXRpb25zLl9zaG91bGRTdXJyb3VuZENoYXIoY29uZmlnLCBjaCkgfHwgIWNvbmZpZy5zdXJyb3VuZGluZ1BhaXJzLmhhc093blByb3BlcnR5KGNoKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgaXNUeXBpbmdBUXVvdGVDaGFyYWN0ZXIgPSBpc1F1b3RlKGNoKTsKICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihzZWxlY3Rpb25zKSwKICAgICAgICBfc3RlcDY7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I2LnMoKTsgIShfc3RlcDYgPSBfaXRlcmF0b3I2Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSBfc3RlcDYudmFsdWU7CiAgICAgICAgICBpZiAoc2VsZWN0aW9uLmlzRW1wdHkoKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc2VsZWN0aW9uQ29udGFpbnNPbmx5V2hpdGVzcGFjZSA9IHRydWU7CiAgICAgICAgICBmb3IgKHZhciBsaW5lTnVtYmVyID0gc2VsZWN0aW9uLnN0YXJ0TGluZU51bWJlcjsgbGluZU51bWJlciA8PSBzZWxlY3Rpb24uZW5kTGluZU51bWJlcjsgbGluZU51bWJlcisrKSB7CiAgICAgICAgICAgIHZhciBsaW5lVGV4dCA9IG1vZGVsLmdldExpbmVDb250ZW50KGxpbmVOdW1iZXIpOwogICAgICAgICAgICB2YXIgc3RhcnRJbmRleCA9IGxpbmVOdW1iZXIgPT09IHNlbGVjdGlvbi5zdGFydExpbmVOdW1iZXIgPyBzZWxlY3Rpb24uc3RhcnRDb2x1bW4gLSAxIDogMDsKICAgICAgICAgICAgdmFyIGVuZEluZGV4ID0gbGluZU51bWJlciA9PT0gc2VsZWN0aW9uLmVuZExpbmVOdW1iZXIgPyBzZWxlY3Rpb24uZW5kQ29sdW1uIC0gMSA6IGxpbmVUZXh0Lmxlbmd0aDsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkVGV4dCA9IGxpbmVUZXh0LnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCk7CiAgICAgICAgICAgIGlmICgvW14gXHRdLy50ZXN0KHNlbGVjdGVkVGV4dCkpIHsKICAgICAgICAgICAgICAvLyB0aGlzIHNlbGVjdGVkIHRleHQgY29udGFpbnMgc29tZXRoaW5nIG90aGVyIHRoYW4gd2hpdGVzcGFjZQogICAgICAgICAgICAgIHNlbGVjdGlvbkNvbnRhaW5zT25seVdoaXRlc3BhY2UgPSBmYWxzZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHNlbGVjdGlvbkNvbnRhaW5zT25seVdoaXRlc3BhY2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzVHlwaW5nQVF1b3RlQ2hhcmFjdGVyICYmIHNlbGVjdGlvbi5zdGFydExpbmVOdW1iZXIgPT09IHNlbGVjdGlvbi5lbmRMaW5lTnVtYmVyICYmIHNlbGVjdGlvbi5zdGFydENvbHVtbiArIDEgPT09IHNlbGVjdGlvbi5lbmRDb2x1bW4pIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGlvblRleHQgPSBtb2RlbC5nZXRWYWx1ZUluUmFuZ2Uoc2VsZWN0aW9uKTsKICAgICAgICAgICAgaWYgKGlzUXVvdGUoc2VsZWN0aW9uVGV4dCkpIHsKICAgICAgICAgICAgICAvLyBUeXBpbmcgYSBxdW90ZSBjaGFyYWN0ZXIgb24gdG9wIG9mIGFub3RoZXIgcXVvdGUgY2hhcmFjdGVyCiAgICAgICAgICAgICAgLy8gPT4gZGlzYWJsZSBzdXJyb3VuZCBzZWxlY3Rpb24gdHlwZQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yNi5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yNi5mKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3J1blN1cnJvdW5kU2VsZWN0aW9uVHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3J1blN1cnJvdW5kU2VsZWN0aW9uVHlwZShwcmV2RWRpdE9wZXJhdGlvblR5cGUsIGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIGNoKSB7CiAgICAgIHZhciBjb21tYW5kcyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VsZWN0aW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBzZWxlY3Rpb25zW2ldOwogICAgICAgIHZhciBjbG9zZUNoYXJhY3RlciA9IGNvbmZpZy5zdXJyb3VuZGluZ1BhaXJzW2NoXTsKICAgICAgICBjb21tYW5kc1tpXSA9IG5ldyBTdXJyb3VuZFNlbGVjdGlvbkNvbW1hbmQoc2VsZWN0aW9uLCBjaCwgY2xvc2VDaGFyYWN0ZXIpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgRWRpdE9wZXJhdGlvblJlc3VsdCgwIC8qIEVkaXRPcGVyYXRpb25UeXBlLk90aGVyICovLCBjb21tYW5kcywgewogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IHRydWUsCiAgICAgICAgc2hvdWxkUHVzaFN0YWNrRWxlbWVudEFmdGVyOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9pc1R5cGVJbnRlcmNlcHRvckVsZWN0cmljQ2hhciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2lzVHlwZUludGVyY2VwdG9yRWxlY3RyaWNDaGFyKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMpIHsKICAgICAgaWYgKHNlbGVjdGlvbnMubGVuZ3RoID09PSAxICYmIG1vZGVsLnRva2VuaXphdGlvbi5pc0NoZWFwVG9Ub2tlbml6ZShzZWxlY3Rpb25zWzBdLmdldEVuZFBvc2l0aW9uKCkubGluZU51bWJlcikpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3R5cGVJbnRlcmNlcHRvckVsZWN0cmljQ2hhciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3R5cGVJbnRlcmNlcHRvckVsZWN0cmljQ2hhcihwcmV2RWRpdE9wZXJhdGlvblR5cGUsIGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbiwgY2gpIHsKICAgICAgaWYgKCFjb25maWcuZWxlY3RyaWNDaGFycy5oYXNPd25Qcm9wZXJ0eShjaCkgfHwgIXNlbGVjdGlvbi5pc0VtcHR5KCkpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICB2YXIgcG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0UG9zaXRpb24oKTsKICAgICAgbW9kZWwudG9rZW5pemF0aW9uLmZvcmNlVG9rZW5pemF0aW9uKHBvc2l0aW9uLmxpbmVOdW1iZXIpOwogICAgICB2YXIgbGluZVRva2VucyA9IG1vZGVsLnRva2VuaXphdGlvbi5nZXRMaW5lVG9rZW5zKHBvc2l0aW9uLmxpbmVOdW1iZXIpOwogICAgICB2YXIgZWxlY3RyaWNBY3Rpb247CiAgICAgIHRyeSB7CiAgICAgICAgZWxlY3RyaWNBY3Rpb24gPSBjb25maWcub25FbGVjdHJpY0NoYXJhY3RlcihjaCwgbGluZVRva2VucywgcG9zaXRpb24uY29sdW1uKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIG9uVW5leHBlY3RlZEVycm9yKGUpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGlmICghZWxlY3RyaWNBY3Rpb24pIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoZWxlY3RyaWNBY3Rpb24ubWF0Y2hPcGVuQnJhY2tldCkgewogICAgICAgIHZhciBlbmRDb2x1bW4gPSAobGluZVRva2Vucy5nZXRMaW5lQ29udGVudCgpICsgY2gpLmxhc3RJbmRleE9mKGVsZWN0cmljQWN0aW9uLm1hdGNoT3BlbkJyYWNrZXQpICsgMTsKICAgICAgICB2YXIgbWF0Y2ggPSBtb2RlbC5icmFja2V0UGFpcnMuZmluZE1hdGNoaW5nQnJhY2tldFVwKGVsZWN0cmljQWN0aW9uLm1hdGNoT3BlbkJyYWNrZXQsIHsKICAgICAgICAgIGxpbmVOdW1iZXI6IHBvc2l0aW9uLmxpbmVOdW1iZXIsCiAgICAgICAgICBjb2x1bW46IGVuZENvbHVtbgogICAgICAgIH0sIDUwMCAvKiBnaXZlIGF0IG1vc3QgNTAwbXMgdG8gY29tcHV0ZSAqLyk7CiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICBpZiAobWF0Y2guc3RhcnRMaW5lTnVtYmVyID09PSBwb3NpdGlvbi5saW5lTnVtYmVyKSB7CiAgICAgICAgICAgIC8vIG1hdGNoZWQgc29tZXRoaW5nIG9uIHRoZSBzYW1lIGxpbmUgPT4gbm8gY2hhbmdlIGluIGluZGVudGF0aW9uCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdmFyIG1hdGNoTGluZSA9IG1vZGVsLmdldExpbmVDb250ZW50KG1hdGNoLnN0YXJ0TGluZU51bWJlcik7CiAgICAgICAgICB2YXIgbWF0Y2hMaW5lSW5kZW50YXRpb24gPSBzdHJpbmdzLmdldExlYWRpbmdXaGl0ZXNwYWNlKG1hdGNoTGluZSk7CiAgICAgICAgICB2YXIgbmV3SW5kZW50YXRpb24gPSBjb25maWcubm9ybWFsaXplSW5kZW50YXRpb24obWF0Y2hMaW5lSW5kZW50YXRpb24pOwogICAgICAgICAgdmFyIGxpbmVUZXh0ID0gbW9kZWwuZ2V0TGluZUNvbnRlbnQocG9zaXRpb24ubGluZU51bWJlcik7CiAgICAgICAgICB2YXIgbGluZUZpcnN0Tm9uQmxhbmtDb2x1bW4gPSBtb2RlbC5nZXRMaW5lRmlyc3ROb25XaGl0ZXNwYWNlQ29sdW1uKHBvc2l0aW9uLmxpbmVOdW1iZXIpIHx8IHBvc2l0aW9uLmNvbHVtbjsKICAgICAgICAgIHZhciBwcmVmaXggPSBsaW5lVGV4dC5zdWJzdHJpbmcobGluZUZpcnN0Tm9uQmxhbmtDb2x1bW4gLSAxLCBwb3NpdGlvbi5jb2x1bW4gLSAxKTsKICAgICAgICAgIHZhciB0eXBlVGV4dCA9IG5ld0luZGVudGF0aW9uICsgcHJlZml4ICsgY2g7CiAgICAgICAgICB2YXIgdHlwZVNlbGVjdGlvbiA9IG5ldyBSYW5nZShwb3NpdGlvbi5saW5lTnVtYmVyLCAxLCBwb3NpdGlvbi5saW5lTnVtYmVyLCBwb3NpdGlvbi5jb2x1bW4pOwogICAgICAgICAgdmFyIGNvbW1hbmQgPSBuZXcgUmVwbGFjZUNvbW1hbmQodHlwZVNlbGVjdGlvbiwgdHlwZVRleHQpOwogICAgICAgICAgcmV0dXJuIG5ldyBFZGl0T3BlcmF0aW9uUmVzdWx0KGdldFR5cGluZ09wZXJhdGlvbih0eXBlVGV4dCwgcHJldkVkaXRPcGVyYXRpb25UeXBlKSwgW2NvbW1hbmRdLCB7CiAgICAgICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IGZhbHNlLAogICAgICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QWZ0ZXI6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogVGhpcyBpcyB2ZXJ5IHNpbWlsYXIgd2l0aCB0eXBpbmcsIGJ1dCB0aGUgY2hhcmFjdGVyIGlzIGFscmVhZHkgaW4gdGhlIHRleHQgYnVmZmVyIQogICAgICovCiAgfSwgewogICAga2V5OiAiY29tcG9zaXRpb25FbmRXaXRoSW50ZXJjZXB0b3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb3NpdGlvbkVuZFdpdGhJbnRlcmNlcHRvcnMocHJldkVkaXRPcGVyYXRpb25UeXBlLCBjb25maWcsIG1vZGVsLCBjb21wb3NpdGlvbnMsIHNlbGVjdGlvbnMsIGF1dG9DbG9zZWRDaGFyYWN0ZXJzKSB7CiAgICAgIGlmICghY29tcG9zaXRpb25zKSB7CiAgICAgICAgLy8gY291bGQgbm90IGRlZHVjZSB3aGF0IHRoZSBjb21wb3NpdGlvbiBkaWQKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICB2YXIgaW5zZXJ0ZWRUZXh0ID0gbnVsbDsKICAgICAgdmFyIF9pdGVyYXRvcjcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihjb21wb3NpdGlvbnMpLAogICAgICAgIF9zdGVwNzsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9jb21wb3NpdGlvbiA9IF9zdGVwNy52YWx1ZTsKICAgICAgICAgIGlmIChpbnNlcnRlZFRleHQgPT09IG51bGwpIHsKICAgICAgICAgICAgaW5zZXJ0ZWRUZXh0ID0gX2NvbXBvc2l0aW9uLmluc2VydGVkVGV4dDsKICAgICAgICAgIH0gZWxzZSBpZiAoaW5zZXJ0ZWRUZXh0ICE9PSBfY29tcG9zaXRpb24uaW5zZXJ0ZWRUZXh0KSB7CiAgICAgICAgICAgIC8vIG5vdCBhbGwgc2VsZWN0aW9ucyBhZ3JlZSBvbiB3aGF0IHdhcyB0eXBlZAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjcuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjcuZigpOwogICAgICB9CiAgICAgIGlmICghaW5zZXJ0ZWRUZXh0IHx8IGluc2VydGVkVGV4dC5sZW5ndGggIT09IDEpIHsKICAgICAgICAvLyB3ZSdyZSBvbmx5IGludGVyZXN0ZWQgaW4gdGhlIGNhc2Ugd2hlcmUgYSBzaW5nbGUgY2hhcmFjdGVyIHdhcyBpbnNlcnRlZAogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciBjaCA9IGluc2VydGVkVGV4dDsKICAgICAgdmFyIGhhc0RlbGV0aW9uID0gZmFsc2U7CiAgICAgIHZhciBfaXRlcmF0b3I4ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoY29tcG9zaXRpb25zKSwKICAgICAgICBfc3RlcDg7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I4LnMoKTsgIShfc3RlcDggPSBfaXRlcmF0b3I4Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfY29tcG9zaXRpb24yID0gX3N0ZXA4LnZhbHVlOwogICAgICAgICAgaWYgKF9jb21wb3NpdGlvbjIuZGVsZXRlZFRleHQubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgIGhhc0RlbGV0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I4LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I4LmYoKTsKICAgICAgfQogICAgICBpZiAoaGFzRGVsZXRpb24pIHsKICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGNvdWxkIGhhdmUgYmVlbiBhIHN1cnJvdW5kIHNlbGVjdGlvbgogICAgICAgIGlmICghVHlwZU9wZXJhdGlvbnMuX3Nob3VsZFN1cnJvdW5kQ2hhcihjb25maWcsIGNoKSB8fCAhY29uZmlnLnN1cnJvdW5kaW5nUGFpcnMuaGFzT3duUHJvcGVydHkoY2gpKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIGlzVHlwaW5nQVF1b3RlQ2hhcmFjdGVyID0gaXNRdW90ZShjaCk7CiAgICAgICAgdmFyIF9pdGVyYXRvcjkgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihjb21wb3NpdGlvbnMpLAogICAgICAgICAgX3N0ZXA5OwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjkucygpOyAhKF9zdGVwOSA9IF9pdGVyYXRvcjkubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgY29tcG9zaXRpb24gPSBfc3RlcDkudmFsdWU7CiAgICAgICAgICAgIGlmIChjb21wb3NpdGlvbi5kZWxldGVkU2VsZWN0aW9uU3RhcnQgIT09IDAgfHwgY29tcG9zaXRpb24uZGVsZXRlZFNlbGVjdGlvbkVuZCAhPT0gY29tcG9zaXRpb24uZGVsZXRlZFRleHQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgLy8gbW9yZSB0ZXh0IHdhcyBkZWxldGVkIHRoYW4gd2FzIHNlbGVjdGVkLCBzbyB0aGlzIGNvdWxkIG5vdCBoYXZlIGJlZW4gYSBzdXJyb3VuZCBzZWxlY3Rpb24KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoL15bIFx0XSskLy50ZXN0KGNvbXBvc2l0aW9uLmRlbGV0ZWRUZXh0KSkgewogICAgICAgICAgICAgIC8vIGRlbGV0ZWQgdGV4dCB3YXMgb25seSB3aGl0ZXNwYWNlCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzVHlwaW5nQVF1b3RlQ2hhcmFjdGVyICYmIGlzUXVvdGUoY29tcG9zaXRpb24uZGVsZXRlZFRleHQpKSB7CiAgICAgICAgICAgICAgLy8gZGVsZXRlZCB0ZXh0IHdhcyBhIHF1b3RlCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjkuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3I5LmYoKTsKICAgICAgICB9CiAgICAgICAgdmFyIHBvc2l0aW9ucyA9IFtdOwogICAgICAgIHZhciBfaXRlcmF0b3IxMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHNlbGVjdGlvbnMpLAogICAgICAgICAgX3N0ZXAxMDsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IxMC5zKCk7ICEoX3N0ZXAxMCA9IF9pdGVyYXRvcjEwLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGlvbiA9IF9zdGVwMTAudmFsdWU7CiAgICAgICAgICAgIGlmICghc2VsZWN0aW9uLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBvc2l0aW9ucy5wdXNoKHNlbGVjdGlvbi5nZXRQb3NpdGlvbigpKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjEwLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yMTAuZigpOwogICAgICAgIH0KICAgICAgICBpZiAocG9zaXRpb25zLmxlbmd0aCAhPT0gY29tcG9zaXRpb25zLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciBjb21tYW5kcyA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwb3NpdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGNvbW1hbmRzLnB1c2gobmV3IENvbXBvc2l0aW9uU3Vycm91bmRTZWxlY3Rpb25Db21tYW5kKHBvc2l0aW9uc1tpXSwgY29tcG9zaXRpb25zW2ldLmRlbGV0ZWRUZXh0LCBjaCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEVkaXRPcGVyYXRpb25SZXN1bHQoNCAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdPdGhlciAqLywgY29tbWFuZHMsIHsKICAgICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IHRydWUsCiAgICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QWZ0ZXI6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX2lzQXV0b0Nsb3NpbmdPdmVydHlwZShjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zLCBhdXRvQ2xvc2VkQ2hhcmFjdGVycywgY2gpKSB7CiAgICAgICAgLy8gVW5mb3J0dW5hdGVseSwgdGhlIGNsb3NlIGNoYXJhY3RlciBpcyBhdCB0aGlzIHBvaW50ICJkb3VibGVkIiwgc28gd2UgbmVlZCB0byBkZWxldGUgaXQuLi4KICAgICAgICB2YXIgX2NvbW1hbmRzID0gc2VsZWN0aW9ucy5tYXAoZnVuY3Rpb24gKHMpIHsKICAgICAgICAgIHJldHVybiBuZXcgUmVwbGFjZUNvbW1hbmQobmV3IFJhbmdlKHMucG9zaXRpb25MaW5lTnVtYmVyLCBzLnBvc2l0aW9uQ29sdW1uLCBzLnBvc2l0aW9uTGluZU51bWJlciwgcy5wb3NpdGlvbkNvbHVtbiArIDEpLCAnJywgZmFsc2UpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBuZXcgRWRpdE9wZXJhdGlvblJlc3VsdCg0IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ090aGVyICovLCBfY29tbWFuZHMsIHsKICAgICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IHRydWUsCiAgICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QWZ0ZXI6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdmFyIGF1dG9DbG9zaW5nUGFpckNsb3NlID0gdGhpcy5fZ2V0QXV0b0Nsb3NpbmdQYWlyQ2xvc2UoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgY2gsIHRydWUpOwogICAgICBpZiAoYXV0b0Nsb3NpbmdQYWlyQ2xvc2UgIT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVuQXV0b0Nsb3NpbmdPcGVuQ2hhclR5cGUocHJldkVkaXRPcGVyYXRpb25UeXBlLCBjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zLCBjaCwgdHJ1ZSwgYXV0b0Nsb3NpbmdQYWlyQ2xvc2UpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInR5cGVXaXRoSW50ZXJjZXB0b3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0eXBlV2l0aEludGVyY2VwdG9ycyhpc0RvaW5nQ29tcG9zaXRpb24sIHByZXZFZGl0T3BlcmF0aW9uVHlwZSwgY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgYXV0b0Nsb3NlZENoYXJhY3RlcnMsIGNoKSB7CiAgICAgIGlmICghaXNEb2luZ0NvbXBvc2l0aW9uICYmIGNoID09PSAnXG4nKSB7CiAgICAgICAgdmFyIF9jb21tYW5kczIgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VsZWN0aW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgX2NvbW1hbmRzMltpXSA9IFR5cGVPcGVyYXRpb25zLl9lbnRlcihjb25maWcsIG1vZGVsLCBmYWxzZSwgc2VsZWN0aW9uc1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgRWRpdE9wZXJhdGlvblJlc3VsdCg0IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ090aGVyICovLCBfY29tbWFuZHMyLCB7CiAgICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QmVmb3JlOiB0cnVlLAogICAgICAgICAgc2hvdWxkUHVzaFN0YWNrRWxlbWVudEFmdGVyOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICghaXNEb2luZ0NvbXBvc2l0aW9uICYmIHRoaXMuX2lzQXV0b0luZGVudFR5cGUoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucykpIHsKICAgICAgICB2YXIgX2NvbW1hbmRzMyA9IFtdOwogICAgICAgIHZhciBhdXRvSW5kZW50RmFpbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9sZW4gPSBzZWxlY3Rpb25zLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICBfY29tbWFuZHMzW19pXSA9IHRoaXMuX3J1bkF1dG9JbmRlbnRUeXBlKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnNbX2ldLCBjaCk7CiAgICAgICAgICBpZiAoIV9jb21tYW5kczNbX2ldKSB7CiAgICAgICAgICAgIGF1dG9JbmRlbnRGYWlscyA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWF1dG9JbmRlbnRGYWlscykgewogICAgICAgICAgcmV0dXJuIG5ldyBFZGl0T3BlcmF0aW9uUmVzdWx0KDQgLyogRWRpdE9wZXJhdGlvblR5cGUuVHlwaW5nT3RoZXIgKi8sIF9jb21tYW5kczMsIHsKICAgICAgICAgICAgc2hvdWxkUHVzaFN0YWNrRWxlbWVudEJlZm9yZTogdHJ1ZSwKICAgICAgICAgICAgc2hvdWxkUHVzaFN0YWNrRWxlbWVudEFmdGVyOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLl9pc0F1dG9DbG9zaW5nT3ZlcnR5cGUoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgYXV0b0Nsb3NlZENoYXJhY3RlcnMsIGNoKSkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW5BdXRvQ2xvc2luZ092ZXJ0eXBlKHByZXZFZGl0T3BlcmF0aW9uVHlwZSwgY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgY2gpOwogICAgICB9CiAgICAgIGlmICghaXNEb2luZ0NvbXBvc2l0aW9uKSB7CiAgICAgICAgdmFyIGF1dG9DbG9zaW5nUGFpckNsb3NlID0gdGhpcy5fZ2V0QXV0b0Nsb3NpbmdQYWlyQ2xvc2UoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgY2gsIGZhbHNlKTsKICAgICAgICBpZiAoYXV0b0Nsb3NpbmdQYWlyQ2xvc2UpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9ydW5BdXRvQ2xvc2luZ09wZW5DaGFyVHlwZShwcmV2RWRpdE9wZXJhdGlvblR5cGUsIGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIGNoLCBmYWxzZSwgYXV0b0Nsb3NpbmdQYWlyQ2xvc2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWlzRG9pbmdDb21wb3NpdGlvbiAmJiB0aGlzLl9pc1N1cnJvdW5kU2VsZWN0aW9uVHlwZShjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zLCBjaCkpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVuU3Vycm91bmRTZWxlY3Rpb25UeXBlKHByZXZFZGl0T3BlcmF0aW9uVHlwZSwgY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucywgY2gpOwogICAgICB9CiAgICAgIC8vIEVsZWN0cmljIGNoYXJhY3RlcnMgbWFrZSBzZW5zZSBvbmx5IHdoZW4gZGVhbGluZyB3aXRoIGEgc2luZ2xlIGN1cnNvciwKICAgICAgLy8gYXMgbXVsdGlwbGUgY3Vyc29ycyB0eXBpbmcgYnJhY2tldHMgZm9yIGV4YW1wbGUgd291bGQgaW50ZXJmZXIgd2l0aCBicmFja2V0IG1hdGNoaW5nCiAgICAgIGlmICghaXNEb2luZ0NvbXBvc2l0aW9uICYmIHRoaXMuX2lzVHlwZUludGVyY2VwdG9yRWxlY3RyaWNDaGFyKGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMpKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLl90eXBlSW50ZXJjZXB0b3JFbGVjdHJpY0NoYXIocHJldkVkaXRPcGVyYXRpb25UeXBlLCBjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zWzBdLCBjaCk7CiAgICAgICAgaWYgKHIpIHsKICAgICAgICAgIHJldHVybiByOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyBBIHNpbXBsZSBjaGFyYWN0ZXIgdHlwZQogICAgICB2YXIgY29tbWFuZHMgPSBbXTsKICAgICAgZm9yICh2YXIgX2kyID0gMCwgX2xlbjIgPSBzZWxlY3Rpb25zLmxlbmd0aDsgX2kyIDwgX2xlbjI7IF9pMisrKSB7CiAgICAgICAgY29tbWFuZHNbX2kyXSA9IG5ldyBSZXBsYWNlQ29tbWFuZChzZWxlY3Rpb25zW19pMl0sIGNoKTsKICAgICAgfQogICAgICB2YXIgb3BUeXBlID0gZ2V0VHlwaW5nT3BlcmF0aW9uKGNoLCBwcmV2RWRpdE9wZXJhdGlvblR5cGUpOwogICAgICByZXR1cm4gbmV3IEVkaXRPcGVyYXRpb25SZXN1bHQob3BUeXBlLCBjb21tYW5kcywgewogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZXR3ZWVuKHByZXZFZGl0T3BlcmF0aW9uVHlwZSwgb3BUeXBlKSwKICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QWZ0ZXI6IGZhbHNlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInR5cGVXaXRob3V0SW50ZXJjZXB0b3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0eXBlV2l0aG91dEludGVyY2VwdG9ycyhwcmV2RWRpdE9wZXJhdGlvblR5cGUsIGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMsIHN0cikgewogICAgICB2YXIgY29tbWFuZHMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlbGVjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBjb21tYW5kc1tpXSA9IG5ldyBSZXBsYWNlQ29tbWFuZChzZWxlY3Rpb25zW2ldLCBzdHIpOwogICAgICB9CiAgICAgIHZhciBvcFR5cGUgPSBnZXRUeXBpbmdPcGVyYXRpb24oc3RyLCBwcmV2RWRpdE9wZXJhdGlvblR5cGUpOwogICAgICByZXR1cm4gbmV3IEVkaXRPcGVyYXRpb25SZXN1bHQob3BUeXBlLCBjb21tYW5kcywgewogICAgICAgIHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZWZvcmU6IHNob3VsZFB1c2hTdGFja0VsZW1lbnRCZXR3ZWVuKHByZXZFZGl0T3BlcmF0aW9uVHlwZSwgb3BUeXBlKSwKICAgICAgICBzaG91bGRQdXNoU3RhY2tFbGVtZW50QWZ0ZXI6IGZhbHNlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImxpbmVJbnNlcnRCZWZvcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxpbmVJbnNlcnRCZWZvcmUoY29uZmlnLCBtb2RlbCwgc2VsZWN0aW9ucykgewogICAgICBpZiAobW9kZWwgPT09IG51bGwgfHwgc2VsZWN0aW9ucyA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICB2YXIgY29tbWFuZHMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlbGVjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgbGluZU51bWJlciA9IHNlbGVjdGlvbnNbaV0ucG9zaXRpb25MaW5lTnVtYmVyOwogICAgICAgIGlmIChsaW5lTnVtYmVyID09PSAxKSB7CiAgICAgICAgICBjb21tYW5kc1tpXSA9IG5ldyBSZXBsYWNlQ29tbWFuZFdpdGhvdXRDaGFuZ2luZ1Bvc2l0aW9uKG5ldyBSYW5nZSgxLCAxLCAxLCAxKSwgJ1xuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxpbmVOdW1iZXItLTsKICAgICAgICAgIHZhciBjb2x1bW4gPSBtb2RlbC5nZXRMaW5lTWF4Q29sdW1uKGxpbmVOdW1iZXIpOwogICAgICAgICAgY29tbWFuZHNbaV0gPSB0aGlzLl9lbnRlcihjb25maWcsIG1vZGVsLCBmYWxzZSwgbmV3IFJhbmdlKGxpbmVOdW1iZXIsIGNvbHVtbiwgbGluZU51bWJlciwgY29sdW1uKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjb21tYW5kczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsaW5lSW5zZXJ0QWZ0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxpbmVJbnNlcnRBZnRlcihjb25maWcsIG1vZGVsLCBzZWxlY3Rpb25zKSB7CiAgICAgIGlmIChtb2RlbCA9PT0gbnVsbCB8fCBzZWxlY3Rpb25zID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIHZhciBjb21tYW5kcyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VsZWN0aW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBsaW5lTnVtYmVyID0gc2VsZWN0aW9uc1tpXS5wb3NpdGlvbkxpbmVOdW1iZXI7CiAgICAgICAgdmFyIGNvbHVtbiA9IG1vZGVsLmdldExpbmVNYXhDb2x1bW4obGluZU51bWJlcik7CiAgICAgICAgY29tbWFuZHNbaV0gPSB0aGlzLl9lbnRlcihjb25maWcsIG1vZGVsLCBmYWxzZSwgbmV3IFJhbmdlKGxpbmVOdW1iZXIsIGNvbHVtbiwgbGluZU51bWJlciwgY29sdW1uKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbW1hbmRzOwogICAgfQogIH0sIHsKICAgIGtleTogImxpbmVCcmVha0luc2VydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbGluZUJyZWFrSW5zZXJ0KGNvbmZpZywgbW9kZWwsIHNlbGVjdGlvbnMpIHsKICAgICAgdmFyIGNvbW1hbmRzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzZWxlY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgY29tbWFuZHNbaV0gPSB0aGlzLl9lbnRlcihjb25maWcsIG1vZGVsLCB0cnVlLCBzZWxlY3Rpb25zW2ldKTsKICAgICAgfQogICAgICByZXR1cm4gY29tbWFuZHM7CiAgICB9CiAgfV0pOwogIHJldHVybiBUeXBlT3BlcmF0aW9uczsKfSgpOwpleHBvcnQgdmFyIFR5cGVXaXRoQXV0b0Nsb3NpbmdDb21tYW5kID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfUmVwbGFjZUNvbW1hbmRXaXRoT2YpIHsKICBfaW5oZXJpdHMoVHlwZVdpdGhBdXRvQ2xvc2luZ0NvbW1hbmQsIF9SZXBsYWNlQ29tbWFuZFdpdGhPZik7CiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihUeXBlV2l0aEF1dG9DbG9zaW5nQ29tbWFuZCk7CiAgZnVuY3Rpb24gVHlwZVdpdGhBdXRvQ2xvc2luZ0NvbW1hbmQoc2VsZWN0aW9uLCBvcGVuQ2hhcmFjdGVyLCBpbnNlcnRPcGVuQ2hhcmFjdGVyLCBjbG9zZUNoYXJhY3RlcikgewogICAgdmFyIF90aGlzMjsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUeXBlV2l0aEF1dG9DbG9zaW5nQ29tbWFuZCk7CiAgICBfdGhpczIgPSBfc3VwZXIuY2FsbCh0aGlzLCBzZWxlY3Rpb24sIChpbnNlcnRPcGVuQ2hhcmFjdGVyID8gb3BlbkNoYXJhY3RlciA6ICcnKSArIGNsb3NlQ2hhcmFjdGVyLCAwLCAtY2xvc2VDaGFyYWN0ZXIubGVuZ3RoKTsKICAgIF90aGlzMi5fb3BlbkNoYXJhY3RlciA9IG9wZW5DaGFyYWN0ZXI7CiAgICBfdGhpczIuX2Nsb3NlQ2hhcmFjdGVyID0gY2xvc2VDaGFyYWN0ZXI7CiAgICBfdGhpczIuY2xvc2VDaGFyYWN0ZXJSYW5nZSA9IG51bGw7CiAgICBfdGhpczIuZW5jbG9zaW5nUmFuZ2UgPSBudWxsOwogICAgcmV0dXJuIF90aGlzMjsKICB9CiAgX2NyZWF0ZUNsYXNzKFR5cGVXaXRoQXV0b0Nsb3NpbmdDb21tYW5kLCBbewogICAga2V5OiAiY29tcHV0ZUN1cnNvclN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wdXRlQ3Vyc29yU3RhdGUobW9kZWwsIGhlbHBlcikgewogICAgICB2YXIgaW52ZXJzZUVkaXRPcGVyYXRpb25zID0gaGVscGVyLmdldEludmVyc2VFZGl0T3BlcmF0aW9ucygpOwogICAgICB2YXIgcmFuZ2UgPSBpbnZlcnNlRWRpdE9wZXJhdGlvbnNbMF0ucmFuZ2U7CiAgICAgIHRoaXMuY2xvc2VDaGFyYWN0ZXJSYW5nZSA9IG5ldyBSYW5nZShyYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLmVuZENvbHVtbiAtIHRoaXMuX2Nsb3NlQ2hhcmFjdGVyLmxlbmd0aCwgcmFuZ2UuZW5kTGluZU51bWJlciwgcmFuZ2UuZW5kQ29sdW1uKTsKICAgICAgdGhpcy5lbmNsb3NpbmdSYW5nZSA9IG5ldyBSYW5nZShyYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLmVuZENvbHVtbiAtIHRoaXMuX29wZW5DaGFyYWN0ZXIubGVuZ3RoIC0gdGhpcy5fY2xvc2VDaGFyYWN0ZXIubGVuZ3RoLCByYW5nZS5lbmRMaW5lTnVtYmVyLCByYW5nZS5lbmRDb2x1bW4pOwogICAgICByZXR1cm4gX2dldChfZ2V0UHJvdG90eXBlT2YoVHlwZVdpdGhBdXRvQ2xvc2luZ0NvbW1hbmQucHJvdG90eXBlKSwgImNvbXB1dGVDdXJzb3JTdGF0ZSIsIHRoaXMpLmNhbGwodGhpcywgbW9kZWwsIGhlbHBlcik7CiAgICB9CiAgfV0pOwogIHJldHVybiBUeXBlV2l0aEF1dG9DbG9zaW5nQ29tbWFuZDsKfShSZXBsYWNlQ29tbWFuZFdpdGhPZmZzZXRDdXJzb3JTdGF0ZSk7CmV4cG9ydCB2YXIgQ29tcG9zaXRpb25PdXRjb21lID0gLyojX19QVVJFX18qL19jcmVhdGVDbGFzcyhmdW5jdGlvbiBDb21wb3NpdGlvbk91dGNvbWUoZGVsZXRlZFRleHQsIGRlbGV0ZWRTZWxlY3Rpb25TdGFydCwgZGVsZXRlZFNlbGVjdGlvbkVuZCwgaW5zZXJ0ZWRUZXh0LCBpbnNlcnRlZFNlbGVjdGlvblN0YXJ0LCBpbnNlcnRlZFNlbGVjdGlvbkVuZCkgewogIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb21wb3NpdGlvbk91dGNvbWUpOwogIHRoaXMuZGVsZXRlZFRleHQgPSBkZWxldGVkVGV4dDsKICB0aGlzLmRlbGV0ZWRTZWxlY3Rpb25TdGFydCA9IGRlbGV0ZWRTZWxlY3Rpb25TdGFydDsKICB0aGlzLmRlbGV0ZWRTZWxlY3Rpb25FbmQgPSBkZWxldGVkU2VsZWN0aW9uRW5kOwogIHRoaXMuaW5zZXJ0ZWRUZXh0ID0gaW5zZXJ0ZWRUZXh0OwogIHRoaXMuaW5zZXJ0ZWRTZWxlY3Rpb25TdGFydCA9IGluc2VydGVkU2VsZWN0aW9uU3RhcnQ7CiAgdGhpcy5pbnNlcnRlZFNlbGVjdGlvbkVuZCA9IGluc2VydGVkU2VsZWN0aW9uRW5kOwp9KTsKZnVuY3Rpb24gZ2V0VHlwaW5nT3BlcmF0aW9uKHR5cGVkVGV4dCwgcHJldmlvdXNUeXBpbmdPcGVyYXRpb24pIHsKICBpZiAodHlwZWRUZXh0ID09PSAnICcpIHsKICAgIHJldHVybiBwcmV2aW91c1R5cGluZ09wZXJhdGlvbiA9PT0gNSAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdGaXJzdFNwYWNlICovIHx8IHByZXZpb3VzVHlwaW5nT3BlcmF0aW9uID09PSA2IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ0NvbnNlY3V0aXZlU3BhY2UgKi8gPyA2IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ0NvbnNlY3V0aXZlU3BhY2UgKi8gOiA1IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ0ZpcnN0U3BhY2UgKi87CiAgfQoKICByZXR1cm4gNCAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdPdGhlciAqLzsKfQoKZnVuY3Rpb24gc2hvdWxkUHVzaFN0YWNrRWxlbWVudEJldHdlZW4ocHJldmlvdXNUeXBpbmdPcGVyYXRpb24sIHR5cGluZ09wZXJhdGlvbikgewogIGlmIChpc1R5cGluZ09wZXJhdGlvbihwcmV2aW91c1R5cGluZ09wZXJhdGlvbikgJiYgIWlzVHlwaW5nT3BlcmF0aW9uKHR5cGluZ09wZXJhdGlvbikpIHsKICAgIC8vIEFsd2F5cyBzZXQgYW4gdW5kbyBzdG9wIGJlZm9yZSBub24tdHlwZSBvcGVyYXRpb25zCiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaWYgKHByZXZpb3VzVHlwaW5nT3BlcmF0aW9uID09PSA1IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ0ZpcnN0U3BhY2UgKi8pIHsKICAgIC8vIGBhYmMgfGRgOiBObyB1bmRvIHN0b3AKICAgIC8vIGBhYmMgIHxkYDogVW5kbyBzdG9wCiAgICByZXR1cm4gZmFsc2U7CiAgfQogIC8vIEluc2VydCB1bmRvIHN0b3AgYmV0d2VlbiBkaWZmZXJlbnQgb3BlcmF0aW9uIHR5cGVzCiAgcmV0dXJuIG5vcm1hbGl6ZU9wZXJhdGlvblR5cGUocHJldmlvdXNUeXBpbmdPcGVyYXRpb24pICE9PSBub3JtYWxpemVPcGVyYXRpb25UeXBlKHR5cGluZ09wZXJhdGlvbik7Cn0KZnVuY3Rpb24gbm9ybWFsaXplT3BlcmF0aW9uVHlwZSh0eXBlKSB7CiAgcmV0dXJuIHR5cGUgPT09IDYgLyogRWRpdE9wZXJhdGlvblR5cGUuVHlwaW5nQ29uc2VjdXRpdmVTcGFjZSAqLyB8fCB0eXBlID09PSA1IC8qIEVkaXRPcGVyYXRpb25UeXBlLlR5cGluZ0ZpcnN0U3BhY2UgKi8gPyAnc3BhY2UnIDogdHlwZTsKfQpmdW5jdGlvbiBpc1R5cGluZ09wZXJhdGlvbih0eXBlKSB7CiAgcmV0dXJuIHR5cGUgPT09IDQgLyogRWRpdE9wZXJhdGlvblR5cGUuVHlwaW5nT3RoZXIgKi8gfHwgdHlwZSA9PT0gNSAvKiBFZGl0T3BlcmF0aW9uVHlwZS5UeXBpbmdGaXJzdFNwYWNlICovIHx8IHR5cGUgPT09IDYgLyogRWRpdE9wZXJhdGlvblR5cGUuVHlwaW5nQ29uc2VjdXRpdmVTcGFjZSAqLzsKfQ=="},{"version":3,"names":["onUnexpectedError","strings","ReplaceCommand","ReplaceCommandWithOffsetCursorState","ReplaceCommandWithoutChangingPosition","ReplaceCommandThatPreservesSelection","ShiftCommand","CompositionSurroundSelectionCommand","SurroundSelectionCommand","EditOperationResult","isQuote","getMapForWordSeparators","Range","Position","IndentAction","getIndentationAtPosition","createScopedLineTokens","getIndentActionForType","getIndentForEnter","getInheritIndentForLine","getEnterAction","TypeOperations","config","model","selections","commands","i","len","length","isUnshift","tabSize","indentSize","insertSpaces","useTabStops","autoIndent","languageConfigurationService","indentation","count","shiftIndent","unshiftIndent","text","shouldPushStackElementBefore","shouldPushStackElementAfter","pasteOnNewLine","selection","position","getPosition","isEmpty","indexOf","typeSelection","lineNumber","multicursorText","multiCursorPaste","charCodeAt","substr","lines","splitLines","distributedPaste","_distributePasteToCursors","sort","compareRangesUsingStarts","_distributedPaste","_simplePaste","action","expectedIndentAction","lastLineNumber","lineText","getLineContent","nonWhitespaceIdx","lastNonWhitespaceIndex","maxColumn","getLineMaxColumn","expectedEnterAction","appendText","Indent","Outdent","normalizeIndentation","insertsAutoWhitespace","typeText","getStartPosition","visibleColumnFromColumn","spacesCnt","startLineNumber","test","tokenization","isCheapToTokenize","goodIndent","_goodIndentForLine","possibleTypeText","startsWith","_replaceJumpToNextIndent","endLineNumber","lineMaxColumn","startColumn","endColumn","prevEditOperationType","replacePrevCharCnt","replaceNextCharCnt","positionDelta","map","_compositionType","shouldPushStackElementBetween","pos","Math","max","column","min","range","oldText","getValueInRange","keepPosition","_typeCommand","getLeadingWhitespace","substring","r","indentAction","None","IndentOutdent","normalIndent","increasedIndent","actualIndentation","ir","indent","oldEndViewColumn","getEndPosition","oldEndColumn","newLineContent","firstNonWhitespace","firstNonWhitespaceIndex","setEndPosition","afterEnter","offset","ceil","ch","currentIndentation","getLineFirstNonWhitespaceColumn","autoClosedCharacters","autoClosingOvertype","autoClosingPairs","autoClosingPairsCloseSingleChar","has","afterCharacter","charAt","chIsQuote","beforeCharacter","found","j","lenJ","autoClosedCharacter","lineAfter","nextChar","potentialStartingBraces","autoClosingPairsOpenByStart","get","potentialClosingBraces","autoClosingPairsCloseByStart","isBeforeStartingBrace","some","x","open","isBeforeClosingBrace","close","positions","candidates","autoClosingPairsOpenByEnd","result","candidate","candidateIsMatch","relevantText","pair","lastChar","autoClosingPairsCloseByEnd","includes","endsWith","chIsAlreadyTyped","autoCloseConfig","autoClosingQuotes","autoClosingBrackets","shouldAutoCloseBefore","quote","bracket","s","beforeColumn","afterColumn","_findAutoClosingPairOpen","p","containedPair","_findContainedAutoClosingPair","containedPairClose","isContainedPairPresent","lineBefore","characterAfter","isBeforeCloseBrace","_isBeforeClosingBrace","wordSeparators","characterBefore","forceTokenization","lineTokens","getLineTokens","scopedLineTokens","shouldAutoClose","firstCharOffset","neutralCharacter","findNeutralCharacter","tokenType","getTokenTypeIfInsertingCharacter","isOK","autoClosingPairClose","TypeWithAutoClosingCommand","autoSurround","_shouldSurroundChar","surroundingPairs","hasOwnProperty","isTypingAQuoteCharacter","selectionContainsOnlyWhitespace","startIndex","endIndex","selectedText","selectionText","closeCharacter","electricChars","electricAction","onElectricCharacter","e","matchOpenBracket","lastIndexOf","match","bracketPairs","findMatchingBracketUp","matchLine","matchLineIndentation","newIndentation","lineFirstNonBlankColumn","prefix","command","getTypingOperation","compositions","insertedText","composition","hasDeletion","deletedText","deletedSelectionStart","deletedSelectionEnd","push","_isAutoClosingOvertype","positionLineNumber","positionColumn","_getAutoClosingPairClose","_runAutoClosingOpenCharType","isDoingComposition","_enter","_isAutoIndentType","autoIndentFails","_runAutoIndentType","_runAutoClosingOvertype","_isSurroundSelectionType","_runSurroundSelectionType","_isTypeInterceptorElectricChar","_typeInterceptorElectricChar","opType","str","openCharacter","insertOpenCharacter","_openCharacter","_closeCharacter","closeCharacterRange","enclosingRange","helper","inverseEditOperations","getInverseEditOperations","CompositionOutcome","insertedSelectionStart","insertedSelectionEnd","typedText","previousTypingOperation","typingOperation","isTypingOperation","normalizeOperationType","type"],"sources":["/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/cursor/cursorTypeOperations.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport * as strings from '../../../base/common/strings.js';\nimport { ReplaceCommand, ReplaceCommandWithOffsetCursorState, ReplaceCommandWithoutChangingPosition, ReplaceCommandThatPreservesSelection } from '../commands/replaceCommand.js';\nimport { ShiftCommand } from '../commands/shiftCommand.js';\nimport { CompositionSurroundSelectionCommand, SurroundSelectionCommand } from '../commands/surroundSelectionCommand.js';\nimport { EditOperationResult, isQuote } from '../cursorCommon.js';\nimport { getMapForWordSeparators } from '../core/wordCharacterClassifier.js';\nimport { Range } from '../core/range.js';\nimport { Position } from '../core/position.js';\nimport { IndentAction } from '../languages/languageConfiguration.js';\nimport { getIndentationAtPosition } from '../languages/languageConfigurationRegistry.js';\nimport { createScopedLineTokens } from '../languages/supports.js';\nimport { getIndentActionForType, getIndentForEnter, getInheritIndentForLine } from '../languages/autoIndent.js';\nimport { getEnterAction } from '../languages/enterAction.js';\nexport class TypeOperations {\n    static indent(config, model, selections) {\n        if (model === null || selections === null) {\n            return [];\n        }\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            commands[i] = new ShiftCommand(selections[i], {\n                isUnshift: false,\n                tabSize: config.tabSize,\n                indentSize: config.indentSize,\n                insertSpaces: config.insertSpaces,\n                useTabStops: config.useTabStops,\n                autoIndent: config.autoIndent\n            }, config.languageConfigurationService);\n        }\n        return commands;\n    }\n    static outdent(config, model, selections) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            commands[i] = new ShiftCommand(selections[i], {\n                isUnshift: true,\n                tabSize: config.tabSize,\n                indentSize: config.indentSize,\n                insertSpaces: config.insertSpaces,\n                useTabStops: config.useTabStops,\n                autoIndent: config.autoIndent\n            }, config.languageConfigurationService);\n        }\n        return commands;\n    }\n    static shiftIndent(config, indentation, count) {\n        count = count || 1;\n        return ShiftCommand.shiftIndent(indentation, indentation.length + count, config.tabSize, config.indentSize, config.insertSpaces);\n    }\n    static unshiftIndent(config, indentation, count) {\n        count = count || 1;\n        return ShiftCommand.unshiftIndent(indentation, indentation.length + count, config.tabSize, config.indentSize, config.insertSpaces);\n    }\n    static _distributedPaste(config, model, selections, text) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            commands[i] = new ReplaceCommand(selections[i], text[i]);\n        }\n        return new EditOperationResult(0 /* EditOperationType.Other */, commands, {\n            shouldPushStackElementBefore: true,\n            shouldPushStackElementAfter: true\n        });\n    }\n    static _simplePaste(config, model, selections, text, pasteOnNewLine) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const selection = selections[i];\n            const position = selection.getPosition();\n            if (pasteOnNewLine && !selection.isEmpty()) {\n                pasteOnNewLine = false;\n            }\n            if (pasteOnNewLine && text.indexOf('\\n') !== text.length - 1) {\n                pasteOnNewLine = false;\n            }\n            if (pasteOnNewLine) {\n                // Paste entire line at the beginning of line\n                const typeSelection = new Range(position.lineNumber, 1, position.lineNumber, 1);\n                commands[i] = new ReplaceCommandThatPreservesSelection(typeSelection, text, selection, true);\n            }\n            else {\n                commands[i] = new ReplaceCommand(selection, text);\n            }\n        }\n        return new EditOperationResult(0 /* EditOperationType.Other */, commands, {\n            shouldPushStackElementBefore: true,\n            shouldPushStackElementAfter: true\n        });\n    }\n    static _distributePasteToCursors(config, selections, text, pasteOnNewLine, multicursorText) {\n        if (pasteOnNewLine) {\n            return null;\n        }\n        if (selections.length === 1) {\n            return null;\n        }\n        if (multicursorText && multicursorText.length === selections.length) {\n            return multicursorText;\n        }\n        if (config.multiCursorPaste === 'spread') {\n            // Try to spread the pasted text in case the line count matches the cursor count\n            // Remove trailing \\n if present\n            if (text.charCodeAt(text.length - 1) === 10 /* CharCode.LineFeed */) {\n                text = text.substr(0, text.length - 1);\n            }\n            // Remove trailing \\r if present\n            if (text.charCodeAt(text.length - 1) === 13 /* CharCode.CarriageReturn */) {\n                text = text.substr(0, text.length - 1);\n            }\n            const lines = strings.splitLines(text);\n            if (lines.length === selections.length) {\n                return lines;\n            }\n        }\n        return null;\n    }\n    static paste(config, model, selections, text, pasteOnNewLine, multicursorText) {\n        const distributedPaste = this._distributePasteToCursors(config, selections, text, pasteOnNewLine, multicursorText);\n        if (distributedPaste) {\n            selections = selections.sort(Range.compareRangesUsingStarts);\n            return this._distributedPaste(config, model, selections, distributedPaste);\n        }\n        else {\n            return this._simplePaste(config, model, selections, text, pasteOnNewLine);\n        }\n    }\n    static _goodIndentForLine(config, model, lineNumber) {\n        let action = null;\n        let indentation = '';\n        const expectedIndentAction = getInheritIndentForLine(config.autoIndent, model, lineNumber, false, config.languageConfigurationService);\n        if (expectedIndentAction) {\n            action = expectedIndentAction.action;\n            indentation = expectedIndentAction.indentation;\n        }\n        else if (lineNumber > 1) {\n            let lastLineNumber;\n            for (lastLineNumber = lineNumber - 1; lastLineNumber >= 1; lastLineNumber--) {\n                const lineText = model.getLineContent(lastLineNumber);\n                const nonWhitespaceIdx = strings.lastNonWhitespaceIndex(lineText);\n                if (nonWhitespaceIdx >= 0) {\n                    break;\n                }\n            }\n            if (lastLineNumber < 1) {\n                // No previous line with content found\n                return null;\n            }\n            const maxColumn = model.getLineMaxColumn(lastLineNumber);\n            const expectedEnterAction = getEnterAction(config.autoIndent, model, new Range(lastLineNumber, maxColumn, lastLineNumber, maxColumn), config.languageConfigurationService);\n            if (expectedEnterAction) {\n                indentation = expectedEnterAction.indentation + expectedEnterAction.appendText;\n            }\n        }\n        if (action) {\n            if (action === IndentAction.Indent) {\n                indentation = TypeOperations.shiftIndent(config, indentation);\n            }\n            if (action === IndentAction.Outdent) {\n                indentation = TypeOperations.unshiftIndent(config, indentation);\n            }\n            indentation = config.normalizeIndentation(indentation);\n        }\n        if (!indentation) {\n            return null;\n        }\n        return indentation;\n    }\n    static _replaceJumpToNextIndent(config, model, selection, insertsAutoWhitespace) {\n        let typeText = '';\n        const position = selection.getStartPosition();\n        if (config.insertSpaces) {\n            const visibleColumnFromColumn = config.visibleColumnFromColumn(model, position);\n            const indentSize = config.indentSize;\n            const spacesCnt = indentSize - (visibleColumnFromColumn % indentSize);\n            for (let i = 0; i < spacesCnt; i++) {\n                typeText += ' ';\n            }\n        }\n        else {\n            typeText = '\\t';\n        }\n        return new ReplaceCommand(selection, typeText, insertsAutoWhitespace);\n    }\n    static tab(config, model, selections) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const selection = selections[i];\n            if (selection.isEmpty()) {\n                const lineText = model.getLineContent(selection.startLineNumber);\n                if (/^\\s*$/.test(lineText) && model.tokenization.isCheapToTokenize(selection.startLineNumber)) {\n                    let goodIndent = this._goodIndentForLine(config, model, selection.startLineNumber);\n                    goodIndent = goodIndent || '\\t';\n                    const possibleTypeText = config.normalizeIndentation(goodIndent);\n                    if (!lineText.startsWith(possibleTypeText)) {\n                        commands[i] = new ReplaceCommand(new Range(selection.startLineNumber, 1, selection.startLineNumber, lineText.length + 1), possibleTypeText, true);\n                        continue;\n                    }\n                }\n                commands[i] = this._replaceJumpToNextIndent(config, model, selection, true);\n            }\n            else {\n                if (selection.startLineNumber === selection.endLineNumber) {\n                    const lineMaxColumn = model.getLineMaxColumn(selection.startLineNumber);\n                    if (selection.startColumn !== 1 || selection.endColumn !== lineMaxColumn) {\n                        // This is a single line selection that is not the entire line\n                        commands[i] = this._replaceJumpToNextIndent(config, model, selection, false);\n                        continue;\n                    }\n                }\n                commands[i] = new ShiftCommand(selection, {\n                    isUnshift: false,\n                    tabSize: config.tabSize,\n                    indentSize: config.indentSize,\n                    insertSpaces: config.insertSpaces,\n                    useTabStops: config.useTabStops,\n                    autoIndent: config.autoIndent\n                }, config.languageConfigurationService);\n            }\n        }\n        return commands;\n    }\n    static compositionType(prevEditOperationType, config, model, selections, text, replacePrevCharCnt, replaceNextCharCnt, positionDelta) {\n        const commands = selections.map(selection => this._compositionType(model, selection, text, replacePrevCharCnt, replaceNextCharCnt, positionDelta));\n        return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n            shouldPushStackElementBefore: shouldPushStackElementBetween(prevEditOperationType, 4 /* EditOperationType.TypingOther */),\n            shouldPushStackElementAfter: false\n        });\n    }\n    static _compositionType(model, selection, text, replacePrevCharCnt, replaceNextCharCnt, positionDelta) {\n        if (!selection.isEmpty()) {\n            // looks like https://github.com/microsoft/vscode/issues/2773\n            // where a cursor operation occurred before a canceled composition\n            // => ignore composition\n            return null;\n        }\n        const pos = selection.getPosition();\n        const startColumn = Math.max(1, pos.column - replacePrevCharCnt);\n        const endColumn = Math.min(model.getLineMaxColumn(pos.lineNumber), pos.column + replaceNextCharCnt);\n        const range = new Range(pos.lineNumber, startColumn, pos.lineNumber, endColumn);\n        const oldText = model.getValueInRange(range);\n        if (oldText === text && positionDelta === 0) {\n            // => ignore composition that doesn't do anything\n            return null;\n        }\n        return new ReplaceCommandWithOffsetCursorState(range, text, 0, positionDelta);\n    }\n    static _typeCommand(range, text, keepPosition) {\n        if (keepPosition) {\n            return new ReplaceCommandWithoutChangingPosition(range, text, true);\n        }\n        else {\n            return new ReplaceCommand(range, text, true);\n        }\n    }\n    static _enter(config, model, keepPosition, range) {\n        if (config.autoIndent === 0 /* EditorAutoIndentStrategy.None */) {\n            return TypeOperations._typeCommand(range, '\\n', keepPosition);\n        }\n        if (!model.tokenization.isCheapToTokenize(range.getStartPosition().lineNumber) || config.autoIndent === 1 /* EditorAutoIndentStrategy.Keep */) {\n            const lineText = model.getLineContent(range.startLineNumber);\n            const indentation = strings.getLeadingWhitespace(lineText).substring(0, range.startColumn - 1);\n            return TypeOperations._typeCommand(range, '\\n' + config.normalizeIndentation(indentation), keepPosition);\n        }\n        const r = getEnterAction(config.autoIndent, model, range, config.languageConfigurationService);\n        if (r) {\n            if (r.indentAction === IndentAction.None) {\n                // Nothing special\n                return TypeOperations._typeCommand(range, '\\n' + config.normalizeIndentation(r.indentation + r.appendText), keepPosition);\n            }\n            else if (r.indentAction === IndentAction.Indent) {\n                // Indent once\n                return TypeOperations._typeCommand(range, '\\n' + config.normalizeIndentation(r.indentation + r.appendText), keepPosition);\n            }\n            else if (r.indentAction === IndentAction.IndentOutdent) {\n                // Ultra special\n                const normalIndent = config.normalizeIndentation(r.indentation);\n                const increasedIndent = config.normalizeIndentation(r.indentation + r.appendText);\n                const typeText = '\\n' + increasedIndent + '\\n' + normalIndent;\n                if (keepPosition) {\n                    return new ReplaceCommandWithoutChangingPosition(range, typeText, true);\n                }\n                else {\n                    return new ReplaceCommandWithOffsetCursorState(range, typeText, -1, increasedIndent.length - normalIndent.length, true);\n                }\n            }\n            else if (r.indentAction === IndentAction.Outdent) {\n                const actualIndentation = TypeOperations.unshiftIndent(config, r.indentation);\n                return TypeOperations._typeCommand(range, '\\n' + config.normalizeIndentation(actualIndentation + r.appendText), keepPosition);\n            }\n        }\n        const lineText = model.getLineContent(range.startLineNumber);\n        const indentation = strings.getLeadingWhitespace(lineText).substring(0, range.startColumn - 1);\n        if (config.autoIndent >= 4 /* EditorAutoIndentStrategy.Full */) {\n            const ir = getIndentForEnter(config.autoIndent, model, range, {\n                unshiftIndent: (indent) => {\n                    return TypeOperations.unshiftIndent(config, indent);\n                },\n                shiftIndent: (indent) => {\n                    return TypeOperations.shiftIndent(config, indent);\n                },\n                normalizeIndentation: (indent) => {\n                    return config.normalizeIndentation(indent);\n                }\n            }, config.languageConfigurationService);\n            if (ir) {\n                let oldEndViewColumn = config.visibleColumnFromColumn(model, range.getEndPosition());\n                const oldEndColumn = range.endColumn;\n                const newLineContent = model.getLineContent(range.endLineNumber);\n                const firstNonWhitespace = strings.firstNonWhitespaceIndex(newLineContent);\n                if (firstNonWhitespace >= 0) {\n                    range = range.setEndPosition(range.endLineNumber, Math.max(range.endColumn, firstNonWhitespace + 1));\n                }\n                else {\n                    range = range.setEndPosition(range.endLineNumber, model.getLineMaxColumn(range.endLineNumber));\n                }\n                if (keepPosition) {\n                    return new ReplaceCommandWithoutChangingPosition(range, '\\n' + config.normalizeIndentation(ir.afterEnter), true);\n                }\n                else {\n                    let offset = 0;\n                    if (oldEndColumn <= firstNonWhitespace + 1) {\n                        if (!config.insertSpaces) {\n                            oldEndViewColumn = Math.ceil(oldEndViewColumn / config.indentSize);\n                        }\n                        offset = Math.min(oldEndViewColumn + 1 - config.normalizeIndentation(ir.afterEnter).length - 1, 0);\n                    }\n                    return new ReplaceCommandWithOffsetCursorState(range, '\\n' + config.normalizeIndentation(ir.afterEnter), 0, offset, true);\n                }\n            }\n        }\n        return TypeOperations._typeCommand(range, '\\n' + config.normalizeIndentation(indentation), keepPosition);\n    }\n    static _isAutoIndentType(config, model, selections) {\n        if (config.autoIndent < 4 /* EditorAutoIndentStrategy.Full */) {\n            return false;\n        }\n        for (let i = 0, len = selections.length; i < len; i++) {\n            if (!model.tokenization.isCheapToTokenize(selections[i].getEndPosition().lineNumber)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    static _runAutoIndentType(config, model, range, ch) {\n        const currentIndentation = getIndentationAtPosition(model, range.startLineNumber, range.startColumn);\n        const actualIndentation = getIndentActionForType(config.autoIndent, model, range, ch, {\n            shiftIndent: (indentation) => {\n                return TypeOperations.shiftIndent(config, indentation);\n            },\n            unshiftIndent: (indentation) => {\n                return TypeOperations.unshiftIndent(config, indentation);\n            },\n        }, config.languageConfigurationService);\n        if (actualIndentation === null) {\n            return null;\n        }\n        if (actualIndentation !== config.normalizeIndentation(currentIndentation)) {\n            const firstNonWhitespace = model.getLineFirstNonWhitespaceColumn(range.startLineNumber);\n            if (firstNonWhitespace === 0) {\n                return TypeOperations._typeCommand(new Range(range.startLineNumber, 1, range.endLineNumber, range.endColumn), config.normalizeIndentation(actualIndentation) + ch, false);\n            }\n            else {\n                return TypeOperations._typeCommand(new Range(range.startLineNumber, 1, range.endLineNumber, range.endColumn), config.normalizeIndentation(actualIndentation) +\n                    model.getLineContent(range.startLineNumber).substring(firstNonWhitespace - 1, range.startColumn - 1) + ch, false);\n            }\n        }\n        return null;\n    }\n    static _isAutoClosingOvertype(config, model, selections, autoClosedCharacters, ch) {\n        if (config.autoClosingOvertype === 'never') {\n            return false;\n        }\n        if (!config.autoClosingPairs.autoClosingPairsCloseSingleChar.has(ch)) {\n            return false;\n        }\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const selection = selections[i];\n            if (!selection.isEmpty()) {\n                return false;\n            }\n            const position = selection.getPosition();\n            const lineText = model.getLineContent(position.lineNumber);\n            const afterCharacter = lineText.charAt(position.column - 1);\n            if (afterCharacter !== ch) {\n                return false;\n            }\n            // Do not over-type quotes after a backslash\n            const chIsQuote = isQuote(ch);\n            const beforeCharacter = position.column > 2 ? lineText.charCodeAt(position.column - 2) : 0 /* CharCode.Null */;\n            if (beforeCharacter === 92 /* CharCode.Backslash */ && chIsQuote) {\n                return false;\n            }\n            // Must over-type a closing character typed by the editor\n            if (config.autoClosingOvertype === 'auto') {\n                let found = false;\n                for (let j = 0, lenJ = autoClosedCharacters.length; j < lenJ; j++) {\n                    const autoClosedCharacter = autoClosedCharacters[j];\n                    if (position.lineNumber === autoClosedCharacter.startLineNumber && position.column === autoClosedCharacter.startColumn) {\n                        found = true;\n                        break;\n                    }\n                }\n                if (!found) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    static _runAutoClosingOvertype(prevEditOperationType, config, model, selections, ch) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const selection = selections[i];\n            const position = selection.getPosition();\n            const typeSelection = new Range(position.lineNumber, position.column, position.lineNumber, position.column + 1);\n            commands[i] = new ReplaceCommand(typeSelection, ch);\n        }\n        return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n            shouldPushStackElementBefore: shouldPushStackElementBetween(prevEditOperationType, 4 /* EditOperationType.TypingOther */),\n            shouldPushStackElementAfter: false\n        });\n    }\n    static _isBeforeClosingBrace(config, lineAfter) {\n        // If the start of lineAfter can be interpretted as both a starting or ending brace, default to returning false\n        const nextChar = lineAfter.charAt(0);\n        const potentialStartingBraces = config.autoClosingPairs.autoClosingPairsOpenByStart.get(nextChar) || [];\n        const potentialClosingBraces = config.autoClosingPairs.autoClosingPairsCloseByStart.get(nextChar) || [];\n        const isBeforeStartingBrace = potentialStartingBraces.some(x => lineAfter.startsWith(x.open));\n        const isBeforeClosingBrace = potentialClosingBraces.some(x => lineAfter.startsWith(x.close));\n        return !isBeforeStartingBrace && isBeforeClosingBrace;\n    }\n    /**\n     * Determine if typing `ch` at all `positions` in the `model` results in an\n     * auto closing open sequence being typed.\n     *\n     * Auto closing open sequences can consist of multiple characters, which\n     * can lead to ambiguities. In such a case, the longest auto-closing open\n     * sequence is returned.\n     */\n    static _findAutoClosingPairOpen(config, model, positions, ch) {\n        const candidates = config.autoClosingPairs.autoClosingPairsOpenByEnd.get(ch);\n        if (!candidates) {\n            return null;\n        }\n        // Determine which auto-closing pair it is\n        let result = null;\n        for (const candidate of candidates) {\n            if (result === null || candidate.open.length > result.open.length) {\n                let candidateIsMatch = true;\n                for (const position of positions) {\n                    const relevantText = model.getValueInRange(new Range(position.lineNumber, position.column - candidate.open.length + 1, position.lineNumber, position.column));\n                    if (relevantText + ch !== candidate.open) {\n                        candidateIsMatch = false;\n                        break;\n                    }\n                }\n                if (candidateIsMatch) {\n                    result = candidate;\n                }\n            }\n        }\n        return result;\n    }\n    /**\n     * Find another auto-closing pair that is contained by the one passed in.\n     *\n     * e.g. when having [(,)] and [(*,*)] as auto-closing pairs\n     * this method will find [(,)] as a containment pair for [(*,*)]\n     */\n    static _findContainedAutoClosingPair(config, pair) {\n        if (pair.open.length <= 1) {\n            return null;\n        }\n        const lastChar = pair.close.charAt(pair.close.length - 1);\n        // get candidates with the same last character as close\n        const candidates = config.autoClosingPairs.autoClosingPairsCloseByEnd.get(lastChar) || [];\n        let result = null;\n        for (const candidate of candidates) {\n            if (candidate.open !== pair.open && pair.open.includes(candidate.open) && pair.close.endsWith(candidate.close)) {\n                if (!result || candidate.open.length > result.open.length) {\n                    result = candidate;\n                }\n            }\n        }\n        return result;\n    }\n    static _getAutoClosingPairClose(config, model, selections, ch, chIsAlreadyTyped) {\n        const chIsQuote = isQuote(ch);\n        const autoCloseConfig = (chIsQuote ? config.autoClosingQuotes : config.autoClosingBrackets);\n        const shouldAutoCloseBefore = (chIsQuote ? config.shouldAutoCloseBefore.quote : config.shouldAutoCloseBefore.bracket);\n        if (autoCloseConfig === 'never') {\n            return null;\n        }\n        for (const selection of selections) {\n            if (!selection.isEmpty()) {\n                return null;\n            }\n        }\n        // This method is called both when typing (regularly) and when composition ends\n        // This means that we need to work with a text buffer where sometimes `ch` is not\n        // there (it is being typed right now) or with a text buffer where `ch` has already been typed\n        //\n        // In order to avoid adding checks for `chIsAlreadyTyped` in all places, we will work\n        // with two conceptual positions, the position before `ch` and the position after `ch`\n        //\n        const positions = selections.map((s) => {\n            const position = s.getPosition();\n            if (chIsAlreadyTyped) {\n                return { lineNumber: position.lineNumber, beforeColumn: position.column - ch.length, afterColumn: position.column };\n            }\n            else {\n                return { lineNumber: position.lineNumber, beforeColumn: position.column, afterColumn: position.column };\n            }\n        });\n        // Find the longest auto-closing open pair in case of multiple ending in `ch`\n        // e.g. when having [f\",\"] and [\",\"], it picks [f\",\"] if the character before is f\n        const pair = this._findAutoClosingPairOpen(config, model, positions.map(p => new Position(p.lineNumber, p.beforeColumn)), ch);\n        if (!pair) {\n            return null;\n        }\n        // Sometimes, it is possible to have two auto-closing pairs that have a containment relationship\n        // e.g. when having [(,)] and [(*,*)]\n        // - when typing (, the resulting state is (|)\n        // - when typing *, the desired resulting state is (*|*), not (*|*))\n        const containedPair = this._findContainedAutoClosingPair(config, pair);\n        const containedPairClose = containedPair ? containedPair.close : '';\n        let isContainedPairPresent = true;\n        for (const position of positions) {\n            const { lineNumber, beforeColumn, afterColumn } = position;\n            const lineText = model.getLineContent(lineNumber);\n            const lineBefore = lineText.substring(0, beforeColumn - 1);\n            const lineAfter = lineText.substring(afterColumn - 1);\n            if (!lineAfter.startsWith(containedPairClose)) {\n                isContainedPairPresent = false;\n            }\n            // Only consider auto closing the pair if an allowed character follows or if another autoclosed pair closing brace follows\n            if (lineAfter.length > 0) {\n                const characterAfter = lineAfter.charAt(0);\n                const isBeforeCloseBrace = TypeOperations._isBeforeClosingBrace(config, lineAfter);\n                if (!isBeforeCloseBrace && !shouldAutoCloseBefore(characterAfter)) {\n                    return null;\n                }\n            }\n            // Do not auto-close ' or \" after a word character\n            if (pair.open.length === 1 && (ch === '\\'' || ch === '\"') && autoCloseConfig !== 'always') {\n                const wordSeparators = getMapForWordSeparators(config.wordSeparators);\n                if (lineBefore.length > 0) {\n                    const characterBefore = lineBefore.charCodeAt(lineBefore.length - 1);\n                    if (wordSeparators.get(characterBefore) === 0 /* WordCharacterClass.Regular */) {\n                        return null;\n                    }\n                }\n            }\n            if (!model.tokenization.isCheapToTokenize(lineNumber)) {\n                // Do not force tokenization\n                return null;\n            }\n            model.tokenization.forceTokenization(lineNumber);\n            const lineTokens = model.tokenization.getLineTokens(lineNumber);\n            const scopedLineTokens = createScopedLineTokens(lineTokens, beforeColumn - 1);\n            if (!pair.shouldAutoClose(scopedLineTokens, beforeColumn - scopedLineTokens.firstCharOffset)) {\n                return null;\n            }\n            // Typing for example a quote could either start a new string, in which case auto-closing is desirable\n            // or it could end a previously started string, in which case auto-closing is not desirable\n            //\n            // In certain cases, it is really not possible to look at the previous token to determine\n            // what would happen. That's why we do something really unusual, we pretend to type a different\n            // character and ask the tokenizer what the outcome of doing that is: after typing a neutral\n            // character, are we in a string (i.e. the quote would most likely end a string) or not?\n            //\n            const neutralCharacter = pair.findNeutralCharacter();\n            if (neutralCharacter) {\n                const tokenType = model.tokenization.getTokenTypeIfInsertingCharacter(lineNumber, beforeColumn, neutralCharacter);\n                if (!pair.isOK(tokenType)) {\n                    return null;\n                }\n            }\n        }\n        if (isContainedPairPresent) {\n            return pair.close.substring(0, pair.close.length - containedPairClose.length);\n        }\n        else {\n            return pair.close;\n        }\n    }\n    static _runAutoClosingOpenCharType(prevEditOperationType, config, model, selections, ch, chIsAlreadyTyped, autoClosingPairClose) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const selection = selections[i];\n            commands[i] = new TypeWithAutoClosingCommand(selection, ch, !chIsAlreadyTyped, autoClosingPairClose);\n        }\n        return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n            shouldPushStackElementBefore: true,\n            shouldPushStackElementAfter: false\n        });\n    }\n    static _shouldSurroundChar(config, ch) {\n        if (isQuote(ch)) {\n            return (config.autoSurround === 'quotes' || config.autoSurround === 'languageDefined');\n        }\n        else {\n            // Character is a bracket\n            return (config.autoSurround === 'brackets' || config.autoSurround === 'languageDefined');\n        }\n    }\n    static _isSurroundSelectionType(config, model, selections, ch) {\n        if (!TypeOperations._shouldSurroundChar(config, ch) || !config.surroundingPairs.hasOwnProperty(ch)) {\n            return false;\n        }\n        const isTypingAQuoteCharacter = isQuote(ch);\n        for (const selection of selections) {\n            if (selection.isEmpty()) {\n                return false;\n            }\n            let selectionContainsOnlyWhitespace = true;\n            for (let lineNumber = selection.startLineNumber; lineNumber <= selection.endLineNumber; lineNumber++) {\n                const lineText = model.getLineContent(lineNumber);\n                const startIndex = (lineNumber === selection.startLineNumber ? selection.startColumn - 1 : 0);\n                const endIndex = (lineNumber === selection.endLineNumber ? selection.endColumn - 1 : lineText.length);\n                const selectedText = lineText.substring(startIndex, endIndex);\n                if (/[^ \\t]/.test(selectedText)) {\n                    // this selected text contains something other than whitespace\n                    selectionContainsOnlyWhitespace = false;\n                    break;\n                }\n            }\n            if (selectionContainsOnlyWhitespace) {\n                return false;\n            }\n            if (isTypingAQuoteCharacter && selection.startLineNumber === selection.endLineNumber && selection.startColumn + 1 === selection.endColumn) {\n                const selectionText = model.getValueInRange(selection);\n                if (isQuote(selectionText)) {\n                    // Typing a quote character on top of another quote character\n                    // => disable surround selection type\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n    static _runSurroundSelectionType(prevEditOperationType, config, model, selections, ch) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const selection = selections[i];\n            const closeCharacter = config.surroundingPairs[ch];\n            commands[i] = new SurroundSelectionCommand(selection, ch, closeCharacter);\n        }\n        return new EditOperationResult(0 /* EditOperationType.Other */, commands, {\n            shouldPushStackElementBefore: true,\n            shouldPushStackElementAfter: true\n        });\n    }\n    static _isTypeInterceptorElectricChar(config, model, selections) {\n        if (selections.length === 1 && model.tokenization.isCheapToTokenize(selections[0].getEndPosition().lineNumber)) {\n            return true;\n        }\n        return false;\n    }\n    static _typeInterceptorElectricChar(prevEditOperationType, config, model, selection, ch) {\n        if (!config.electricChars.hasOwnProperty(ch) || !selection.isEmpty()) {\n            return null;\n        }\n        const position = selection.getPosition();\n        model.tokenization.forceTokenization(position.lineNumber);\n        const lineTokens = model.tokenization.getLineTokens(position.lineNumber);\n        let electricAction;\n        try {\n            electricAction = config.onElectricCharacter(ch, lineTokens, position.column);\n        }\n        catch (e) {\n            onUnexpectedError(e);\n            return null;\n        }\n        if (!electricAction) {\n            return null;\n        }\n        if (electricAction.matchOpenBracket) {\n            const endColumn = (lineTokens.getLineContent() + ch).lastIndexOf(electricAction.matchOpenBracket) + 1;\n            const match = model.bracketPairs.findMatchingBracketUp(electricAction.matchOpenBracket, {\n                lineNumber: position.lineNumber,\n                column: endColumn\n            }, 500 /* give at most 500ms to compute */);\n            if (match) {\n                if (match.startLineNumber === position.lineNumber) {\n                    // matched something on the same line => no change in indentation\n                    return null;\n                }\n                const matchLine = model.getLineContent(match.startLineNumber);\n                const matchLineIndentation = strings.getLeadingWhitespace(matchLine);\n                const newIndentation = config.normalizeIndentation(matchLineIndentation);\n                const lineText = model.getLineContent(position.lineNumber);\n                const lineFirstNonBlankColumn = model.getLineFirstNonWhitespaceColumn(position.lineNumber) || position.column;\n                const prefix = lineText.substring(lineFirstNonBlankColumn - 1, position.column - 1);\n                const typeText = newIndentation + prefix + ch;\n                const typeSelection = new Range(position.lineNumber, 1, position.lineNumber, position.column);\n                const command = new ReplaceCommand(typeSelection, typeText);\n                return new EditOperationResult(getTypingOperation(typeText, prevEditOperationType), [command], {\n                    shouldPushStackElementBefore: false,\n                    shouldPushStackElementAfter: true\n                });\n            }\n        }\n        return null;\n    }\n    /**\n     * This is very similar with typing, but the character is already in the text buffer!\n     */\n    static compositionEndWithInterceptors(prevEditOperationType, config, model, compositions, selections, autoClosedCharacters) {\n        if (!compositions) {\n            // could not deduce what the composition did\n            return null;\n        }\n        let insertedText = null;\n        for (const composition of compositions) {\n            if (insertedText === null) {\n                insertedText = composition.insertedText;\n            }\n            else if (insertedText !== composition.insertedText) {\n                // not all selections agree on what was typed\n                return null;\n            }\n        }\n        if (!insertedText || insertedText.length !== 1) {\n            // we're only interested in the case where a single character was inserted\n            return null;\n        }\n        const ch = insertedText;\n        let hasDeletion = false;\n        for (const composition of compositions) {\n            if (composition.deletedText.length !== 0) {\n                hasDeletion = true;\n                break;\n            }\n        }\n        if (hasDeletion) {\n            // Check if this could have been a surround selection\n            if (!TypeOperations._shouldSurroundChar(config, ch) || !config.surroundingPairs.hasOwnProperty(ch)) {\n                return null;\n            }\n            const isTypingAQuoteCharacter = isQuote(ch);\n            for (const composition of compositions) {\n                if (composition.deletedSelectionStart !== 0 || composition.deletedSelectionEnd !== composition.deletedText.length) {\n                    // more text was deleted than was selected, so this could not have been a surround selection\n                    return null;\n                }\n                if (/^[ \\t]+$/.test(composition.deletedText)) {\n                    // deleted text was only whitespace\n                    return null;\n                }\n                if (isTypingAQuoteCharacter && isQuote(composition.deletedText)) {\n                    // deleted text was a quote\n                    return null;\n                }\n            }\n            const positions = [];\n            for (const selection of selections) {\n                if (!selection.isEmpty()) {\n                    return null;\n                }\n                positions.push(selection.getPosition());\n            }\n            if (positions.length !== compositions.length) {\n                return null;\n            }\n            const commands = [];\n            for (let i = 0, len = positions.length; i < len; i++) {\n                commands.push(new CompositionSurroundSelectionCommand(positions[i], compositions[i].deletedText, ch));\n            }\n            return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n                shouldPushStackElementBefore: true,\n                shouldPushStackElementAfter: false\n            });\n        }\n        if (this._isAutoClosingOvertype(config, model, selections, autoClosedCharacters, ch)) {\n            // Unfortunately, the close character is at this point \"doubled\", so we need to delete it...\n            const commands = selections.map(s => new ReplaceCommand(new Range(s.positionLineNumber, s.positionColumn, s.positionLineNumber, s.positionColumn + 1), '', false));\n            return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n                shouldPushStackElementBefore: true,\n                shouldPushStackElementAfter: false\n            });\n        }\n        const autoClosingPairClose = this._getAutoClosingPairClose(config, model, selections, ch, true);\n        if (autoClosingPairClose !== null) {\n            return this._runAutoClosingOpenCharType(prevEditOperationType, config, model, selections, ch, true, autoClosingPairClose);\n        }\n        return null;\n    }\n    static typeWithInterceptors(isDoingComposition, prevEditOperationType, config, model, selections, autoClosedCharacters, ch) {\n        if (!isDoingComposition && ch === '\\n') {\n            const commands = [];\n            for (let i = 0, len = selections.length; i < len; i++) {\n                commands[i] = TypeOperations._enter(config, model, false, selections[i]);\n            }\n            return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n                shouldPushStackElementBefore: true,\n                shouldPushStackElementAfter: false,\n            });\n        }\n        if (!isDoingComposition && this._isAutoIndentType(config, model, selections)) {\n            const commands = [];\n            let autoIndentFails = false;\n            for (let i = 0, len = selections.length; i < len; i++) {\n                commands[i] = this._runAutoIndentType(config, model, selections[i], ch);\n                if (!commands[i]) {\n                    autoIndentFails = true;\n                    break;\n                }\n            }\n            if (!autoIndentFails) {\n                return new EditOperationResult(4 /* EditOperationType.TypingOther */, commands, {\n                    shouldPushStackElementBefore: true,\n                    shouldPushStackElementAfter: false,\n                });\n            }\n        }\n        if (this._isAutoClosingOvertype(config, model, selections, autoClosedCharacters, ch)) {\n            return this._runAutoClosingOvertype(prevEditOperationType, config, model, selections, ch);\n        }\n        if (!isDoingComposition) {\n            const autoClosingPairClose = this._getAutoClosingPairClose(config, model, selections, ch, false);\n            if (autoClosingPairClose) {\n                return this._runAutoClosingOpenCharType(prevEditOperationType, config, model, selections, ch, false, autoClosingPairClose);\n            }\n        }\n        if (!isDoingComposition && this._isSurroundSelectionType(config, model, selections, ch)) {\n            return this._runSurroundSelectionType(prevEditOperationType, config, model, selections, ch);\n        }\n        // Electric characters make sense only when dealing with a single cursor,\n        // as multiple cursors typing brackets for example would interfer with bracket matching\n        if (!isDoingComposition && this._isTypeInterceptorElectricChar(config, model, selections)) {\n            const r = this._typeInterceptorElectricChar(prevEditOperationType, config, model, selections[0], ch);\n            if (r) {\n                return r;\n            }\n        }\n        // A simple character type\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            commands[i] = new ReplaceCommand(selections[i], ch);\n        }\n        const opType = getTypingOperation(ch, prevEditOperationType);\n        return new EditOperationResult(opType, commands, {\n            shouldPushStackElementBefore: shouldPushStackElementBetween(prevEditOperationType, opType),\n            shouldPushStackElementAfter: false\n        });\n    }\n    static typeWithoutInterceptors(prevEditOperationType, config, model, selections, str) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            commands[i] = new ReplaceCommand(selections[i], str);\n        }\n        const opType = getTypingOperation(str, prevEditOperationType);\n        return new EditOperationResult(opType, commands, {\n            shouldPushStackElementBefore: shouldPushStackElementBetween(prevEditOperationType, opType),\n            shouldPushStackElementAfter: false\n        });\n    }\n    static lineInsertBefore(config, model, selections) {\n        if (model === null || selections === null) {\n            return [];\n        }\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            let lineNumber = selections[i].positionLineNumber;\n            if (lineNumber === 1) {\n                commands[i] = new ReplaceCommandWithoutChangingPosition(new Range(1, 1, 1, 1), '\\n');\n            }\n            else {\n                lineNumber--;\n                const column = model.getLineMaxColumn(lineNumber);\n                commands[i] = this._enter(config, model, false, new Range(lineNumber, column, lineNumber, column));\n            }\n        }\n        return commands;\n    }\n    static lineInsertAfter(config, model, selections) {\n        if (model === null || selections === null) {\n            return [];\n        }\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            const lineNumber = selections[i].positionLineNumber;\n            const column = model.getLineMaxColumn(lineNumber);\n            commands[i] = this._enter(config, model, false, new Range(lineNumber, column, lineNumber, column));\n        }\n        return commands;\n    }\n    static lineBreakInsert(config, model, selections) {\n        const commands = [];\n        for (let i = 0, len = selections.length; i < len; i++) {\n            commands[i] = this._enter(config, model, true, selections[i]);\n        }\n        return commands;\n    }\n}\nexport class TypeWithAutoClosingCommand extends ReplaceCommandWithOffsetCursorState {\n    constructor(selection, openCharacter, insertOpenCharacter, closeCharacter) {\n        super(selection, (insertOpenCharacter ? openCharacter : '') + closeCharacter, 0, -closeCharacter.length);\n        this._openCharacter = openCharacter;\n        this._closeCharacter = closeCharacter;\n        this.closeCharacterRange = null;\n        this.enclosingRange = null;\n    }\n    computeCursorState(model, helper) {\n        const inverseEditOperations = helper.getInverseEditOperations();\n        const range = inverseEditOperations[0].range;\n        this.closeCharacterRange = new Range(range.startLineNumber, range.endColumn - this._closeCharacter.length, range.endLineNumber, range.endColumn);\n        this.enclosingRange = new Range(range.startLineNumber, range.endColumn - this._openCharacter.length - this._closeCharacter.length, range.endLineNumber, range.endColumn);\n        return super.computeCursorState(model, helper);\n    }\n}\nexport class CompositionOutcome {\n    constructor(deletedText, deletedSelectionStart, deletedSelectionEnd, insertedText, insertedSelectionStart, insertedSelectionEnd) {\n        this.deletedText = deletedText;\n        this.deletedSelectionStart = deletedSelectionStart;\n        this.deletedSelectionEnd = deletedSelectionEnd;\n        this.insertedText = insertedText;\n        this.insertedSelectionStart = insertedSelectionStart;\n        this.insertedSelectionEnd = insertedSelectionEnd;\n    }\n}\nfunction getTypingOperation(typedText, previousTypingOperation) {\n    if (typedText === ' ') {\n        return previousTypingOperation === 5 /* EditOperationType.TypingFirstSpace */\n            || previousTypingOperation === 6 /* EditOperationType.TypingConsecutiveSpace */\n            ? 6 /* EditOperationType.TypingConsecutiveSpace */\n            : 5 /* EditOperationType.TypingFirstSpace */;\n    }\n    return 4 /* EditOperationType.TypingOther */;\n}\nfunction shouldPushStackElementBetween(previousTypingOperation, typingOperation) {\n    if (isTypingOperation(previousTypingOperation) && !isTypingOperation(typingOperation)) {\n        // Always set an undo stop before non-type operations\n        return true;\n    }\n    if (previousTypingOperation === 5 /* EditOperationType.TypingFirstSpace */) {\n        // `abc |d`: No undo stop\n        // `abc  |d`: Undo stop\n        return false;\n    }\n    // Insert undo stop between different operation types\n    return normalizeOperationType(previousTypingOperation) !== normalizeOperationType(typingOperation);\n}\nfunction normalizeOperationType(type) {\n    return (type === 6 /* EditOperationType.TypingConsecutiveSpace */ || type === 5 /* EditOperationType.TypingFirstSpace */)\n        ? 'space'\n        : type;\n}\nfunction isTypingOperation(type) {\n    return type === 4 /* EditOperationType.TypingOther */\n        || type === 5 /* EditOperationType.TypingFirstSpace */\n        || type === 6 /* EditOperationType.TypingConsecutiveSpace */;\n}\n"],"mappings":"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"}]}