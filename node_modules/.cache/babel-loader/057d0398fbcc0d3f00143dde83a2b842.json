{"remainingRequest":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js!/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/viewModel/viewModelLines.js","dependencies":[{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/viewModel/viewModelLines.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/babel.config.js","mtime":1668271197000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy95YW5qaWFqaWEvRGVza3RvcC93b3Jrc3BhY2UvYXZ1ZS1kYXRhLW5ldy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjay5qcyI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL3lhbmppYWppYS9EZXNrdG9wL3dvcmtzcGFjZS9hdnVlLWRhdGEtbmV3L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvcnQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbC5qcyI7Ci8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uCiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwppbXBvcnQgKiBhcyBhcnJheXMgZnJvbSAnLi4vLi4vLi4vYmFzZS9jb21tb24vYXJyYXlzLmpzJzsKaW1wb3J0IHsgUG9zaXRpb24gfSBmcm9tICcuLi9jb3JlL3Bvc2l0aW9uLmpzJzsKaW1wb3J0IHsgUmFuZ2UgfSBmcm9tICcuLi9jb3JlL3JhbmdlLmpzJzsKaW1wb3J0IHsgSW5kZW50R3VpZGUsIEluZGVudEd1aWRlSG9yaXpvbnRhbExpbmUgfSBmcm9tICcuLi90ZXh0TW9kZWxHdWlkZXMuanMnOwppbXBvcnQgeyBNb2RlbERlY29yYXRpb25PcHRpb25zIH0gZnJvbSAnLi4vbW9kZWwvdGV4dE1vZGVsLmpzJzsKaW1wb3J0IHsgTGluZUluamVjdGVkVGV4dCB9IGZyb20gJy4uL3RleHRNb2RlbEV2ZW50cy5qcyc7CmltcG9ydCAqIGFzIHZpZXdFdmVudHMgZnJvbSAnLi4vdmlld0V2ZW50cy5qcyc7CmltcG9ydCB7IGNyZWF0ZU1vZGVsTGluZVByb2plY3Rpb24gfSBmcm9tICcuL21vZGVsTGluZVByb2plY3Rpb24uanMnOwppbXBvcnQgeyBDb25zdGFudFRpbWVQcmVmaXhTdW1Db21wdXRlciB9IGZyb20gJy4uL21vZGVsL3ByZWZpeFN1bUNvbXB1dGVyLmpzJzsKaW1wb3J0IHsgVmlld0xpbmVEYXRhIH0gZnJvbSAnLi4vdmlld01vZGVsLmpzJzsKZXhwb3J0IHZhciBWaWV3TW9kZWxMaW5lc0Zyb21Qcm9qZWN0ZWRNb2RlbCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gVmlld01vZGVsTGluZXNGcm9tUHJvamVjdGVkTW9kZWwoZWRpdG9ySWQsIG1vZGVsLCBkb21MaW5lQnJlYWtzQ29tcHV0ZXJGYWN0b3J5LCBtb25vc3BhY2VMaW5lQnJlYWtzQ29tcHV0ZXJGYWN0b3J5LCBmb250SW5mbywgdGFiU2l6ZSwgd3JhcHBpbmdTdHJhdGVneSwgd3JhcHBpbmdDb2x1bW4sIHdyYXBwaW5nSW5kZW50KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmlld01vZGVsTGluZXNGcm9tUHJvamVjdGVkTW9kZWwpOwogICAgdGhpcy5fZWRpdG9ySWQgPSBlZGl0b3JJZDsKICAgIHRoaXMubW9kZWwgPSBtb2RlbDsKICAgIHRoaXMuX3ZhbGlkTW9kZWxWZXJzaW9uSWQgPSAtMTsKICAgIHRoaXMuX2RvbUxpbmVCcmVha3NDb21wdXRlckZhY3RvcnkgPSBkb21MaW5lQnJlYWtzQ29tcHV0ZXJGYWN0b3J5OwogICAgdGhpcy5fbW9ub3NwYWNlTGluZUJyZWFrc0NvbXB1dGVyRmFjdG9yeSA9IG1vbm9zcGFjZUxpbmVCcmVha3NDb21wdXRlckZhY3Rvcnk7CiAgICB0aGlzLmZvbnRJbmZvID0gZm9udEluZm87CiAgICB0aGlzLnRhYlNpemUgPSB0YWJTaXplOwogICAgdGhpcy53cmFwcGluZ1N0cmF0ZWd5ID0gd3JhcHBpbmdTdHJhdGVneTsKICAgIHRoaXMud3JhcHBpbmdDb2x1bW4gPSB3cmFwcGluZ0NvbHVtbjsKICAgIHRoaXMud3JhcHBpbmdJbmRlbnQgPSB3cmFwcGluZ0luZGVudDsKICAgIHRoaXMuX2NvbnN0cnVjdExpbmVzKCAvKnJlc2V0SGlkZGVuQXJlYXMqL3RydWUsIG51bGwpOwogIH0KICBfY3JlYXRlQ2xhc3MoVmlld01vZGVsTGluZXNGcm9tUHJvamVjdGVkTW9kZWwsIFt7CiAgICBrZXk6ICJkaXNwb3NlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICB0aGlzLmhpZGRlbkFyZWFzRGVjb3JhdGlvbklkcyA9IHRoaXMubW9kZWwuZGVsdGFEZWNvcmF0aW9ucyh0aGlzLmhpZGRlbkFyZWFzRGVjb3JhdGlvbklkcywgW10pOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUNvb3JkaW5hdGVzQ29udmVydGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDb29yZGluYXRlc0NvbnZlcnRlcigpIHsKICAgICAgcmV0dXJuIG5ldyBDb29yZGluYXRlc0NvbnZlcnRlcih0aGlzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfY29uc3RydWN0TGluZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jb25zdHJ1Y3RMaW5lcyhyZXNldEhpZGRlbkFyZWFzLCBwcmV2aW91c0xpbmVCcmVha3MpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9ucyA9IFtdOwogICAgICBpZiAocmVzZXRIaWRkZW5BcmVhcykgewogICAgICAgIHRoaXMuaGlkZGVuQXJlYXNEZWNvcmF0aW9uSWRzID0gdGhpcy5tb2RlbC5kZWx0YURlY29yYXRpb25zKHRoaXMuaGlkZGVuQXJlYXNEZWNvcmF0aW9uSWRzLCBbXSk7CiAgICAgIH0KICAgICAgdmFyIGxpbmVzQ29udGVudCA9IHRoaXMubW9kZWwuZ2V0TGluZXNDb250ZW50KCk7CiAgICAgIHZhciBpbmplY3RlZFRleHREZWNvcmF0aW9ucyA9IHRoaXMubW9kZWwuZ2V0SW5qZWN0ZWRUZXh0RGVjb3JhdGlvbnModGhpcy5fZWRpdG9ySWQpOwogICAgICB2YXIgbGluZUNvdW50ID0gbGluZXNDb250ZW50Lmxlbmd0aDsKICAgICAgdmFyIGxpbmVCcmVha3NDb21wdXRlciA9IHRoaXMuY3JlYXRlTGluZUJyZWFrc0NvbXB1dGVyKCk7CiAgICAgIHZhciBpbmplY3RlZFRleHRRdWV1ZSA9IG5ldyBhcnJheXMuQXJyYXlRdWV1ZShMaW5lSW5qZWN0ZWRUZXh0LmZyb21EZWNvcmF0aW9ucyhpbmplY3RlZFRleHREZWNvcmF0aW9ucykpOwogICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChpKSB7CiAgICAgICAgdmFyIGxpbmVJbmplY3RlZFRleHQgPSBpbmplY3RlZFRleHRRdWV1ZS50YWtlV2hpbGUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmxpbmVOdW1iZXIgPT09IGkgKyAxOwogICAgICAgIH0pOwogICAgICAgIGxpbmVCcmVha3NDb21wdXRlci5hZGRSZXF1ZXN0KGxpbmVzQ29udGVudFtpXSwgbGluZUluamVjdGVkVGV4dCwgcHJldmlvdXNMaW5lQnJlYWtzID8gcHJldmlvdXNMaW5lQnJlYWtzW2ldIDogbnVsbCk7CiAgICAgIH07CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZUNvdW50OyBpKyspIHsKICAgICAgICBfbG9vcChpKTsKICAgICAgfQogICAgICB2YXIgbGluZXNCcmVha3MgPSBsaW5lQnJlYWtzQ29tcHV0ZXIuZmluYWxpemUoKTsKICAgICAgdmFyIHZhbHVlcyA9IFtdOwogICAgICB2YXIgaGlkZGVuQXJlYXMgPSB0aGlzLmhpZGRlbkFyZWFzRGVjb3JhdGlvbklkcy5tYXAoZnVuY3Rpb24gKGFyZWFJZCkgewogICAgICAgIHJldHVybiBfdGhpcy5tb2RlbC5nZXREZWNvcmF0aW9uUmFuZ2UoYXJlYUlkKTsKICAgICAgfSkuc29ydChSYW5nZS5jb21wYXJlUmFuZ2VzVXNpbmdTdGFydHMpOwogICAgICB2YXIgaGlkZGVuQXJlYVN0YXJ0ID0gMSwKICAgICAgICBoaWRkZW5BcmVhRW5kID0gMDsKICAgICAgdmFyIGhpZGRlbkFyZWFJZHggPSAtMTsKICAgICAgdmFyIG5leHRMaW5lTnVtYmVyVG9VcGRhdGVIaWRkZW5BcmVhID0gaGlkZGVuQXJlYUlkeCArIDEgPCBoaWRkZW5BcmVhcy5sZW5ndGggPyBoaWRkZW5BcmVhRW5kICsgMSA6IGxpbmVDb3VudCArIDI7CiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBsaW5lQ291bnQ7IF9pKyspIHsKICAgICAgICB2YXIgbGluZU51bWJlciA9IF9pICsgMTsKICAgICAgICBpZiAobGluZU51bWJlciA9PT0gbmV4dExpbmVOdW1iZXJUb1VwZGF0ZUhpZGRlbkFyZWEpIHsKICAgICAgICAgIGhpZGRlbkFyZWFJZHgrKzsKICAgICAgICAgIGhpZGRlbkFyZWFTdGFydCA9IGhpZGRlbkFyZWFzW2hpZGRlbkFyZWFJZHhdLnN0YXJ0TGluZU51bWJlcjsKICAgICAgICAgIGhpZGRlbkFyZWFFbmQgPSBoaWRkZW5BcmVhc1toaWRkZW5BcmVhSWR4XS5lbmRMaW5lTnVtYmVyOwogICAgICAgICAgbmV4dExpbmVOdW1iZXJUb1VwZGF0ZUhpZGRlbkFyZWEgPSBoaWRkZW5BcmVhSWR4ICsgMSA8IGhpZGRlbkFyZWFzLmxlbmd0aCA/IGhpZGRlbkFyZWFFbmQgKyAxIDogbGluZUNvdW50ICsgMjsKICAgICAgICB9CiAgICAgICAgdmFyIGlzSW5IaWRkZW5BcmVhID0gbGluZU51bWJlciA+PSBoaWRkZW5BcmVhU3RhcnQgJiYgbGluZU51bWJlciA8PSBoaWRkZW5BcmVhRW5kOwogICAgICAgIHZhciBsaW5lID0gY3JlYXRlTW9kZWxMaW5lUHJvamVjdGlvbihsaW5lc0JyZWFrc1tfaV0sICFpc0luSGlkZGVuQXJlYSk7CiAgICAgICAgdmFsdWVzW19pXSA9IGxpbmUuZ2V0Vmlld0xpbmVDb3VudCgpOwogICAgICAgIHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbX2ldID0gbGluZTsKICAgICAgfQogICAgICB0aGlzLl92YWxpZE1vZGVsVmVyc2lvbklkID0gdGhpcy5tb2RlbC5nZXRWZXJzaW9uSWQoKTsKICAgICAgdGhpcy5wcm9qZWN0ZWRNb2RlbExpbmVMaW5lQ291bnRzID0gbmV3IENvbnN0YW50VGltZVByZWZpeFN1bUNvbXB1dGVyKHZhbHVlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SGlkZGVuQXJlYXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEhpZGRlbkFyZWFzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXMuaGlkZGVuQXJlYXNEZWNvcmF0aW9uSWRzLm1hcChmdW5jdGlvbiAoZGVjSWQpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLm1vZGVsLmdldERlY29yYXRpb25SYW5nZShkZWNJZCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEhpZGRlbkFyZWFzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRIaWRkZW5BcmVhcyhfcmFuZ2VzKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgICB2YXIgdmFsaWRhdGVkUmFuZ2VzID0gX3Jhbmdlcy5tYXAoZnVuY3Rpb24gKHIpIHsKICAgICAgICByZXR1cm4gX3RoaXMzLm1vZGVsLnZhbGlkYXRlUmFuZ2Uocik7CiAgICAgIH0pOwogICAgICB2YXIgbmV3UmFuZ2VzID0gbm9ybWFsaXplTGluZVJhbmdlcyh2YWxpZGF0ZWRSYW5nZXMpOwogICAgICAvLyBUT0RPQE1hcnRpbjogUGxlYXNlIHN0b3AgY2FsbGluZyB0aGlzIG1ldGhvZCBvbiBlYWNoIG1vZGVsIGNoYW5nZSEKICAgICAgLy8gVGhpcyBjaGVja3MgaWYgdGhlcmUgcmVhbGx5IHdhcyBhIGNoYW5nZQogICAgICB2YXIgb2xkUmFuZ2VzID0gdGhpcy5oaWRkZW5BcmVhc0RlY29yYXRpb25JZHMubWFwKGZ1bmN0aW9uIChhcmVhSWQpIHsKICAgICAgICByZXR1cm4gX3RoaXMzLm1vZGVsLmdldERlY29yYXRpb25SYW5nZShhcmVhSWQpOwogICAgICB9KS5zb3J0KFJhbmdlLmNvbXBhcmVSYW5nZXNVc2luZ1N0YXJ0cyk7CiAgICAgIGlmIChuZXdSYW5nZXMubGVuZ3RoID09PSBvbGRSYW5nZXMubGVuZ3RoKSB7CiAgICAgICAgdmFyIGhhc0RpZmZlcmVuY2UgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld1Jhbmdlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKCFuZXdSYW5nZXNbaV0uZXF1YWxzUmFuZ2Uob2xkUmFuZ2VzW2ldKSkgewogICAgICAgICAgICBoYXNEaWZmZXJlbmNlID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghaGFzRGlmZmVyZW5jZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgbmV3RGVjb3JhdGlvbnMgPSBuZXdSYW5nZXMubWFwKGZ1bmN0aW9uIChyKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJhbmdlOiByLAogICAgICAgICAgb3B0aW9uczogTW9kZWxEZWNvcmF0aW9uT3B0aW9ucy5FTVBUWQogICAgICAgIH07CiAgICAgIH0pOwogICAgICB0aGlzLmhpZGRlbkFyZWFzRGVjb3JhdGlvbklkcyA9IHRoaXMubW9kZWwuZGVsdGFEZWNvcmF0aW9ucyh0aGlzLmhpZGRlbkFyZWFzRGVjb3JhdGlvbklkcywgbmV3RGVjb3JhdGlvbnMpOwogICAgICB2YXIgaGlkZGVuQXJlYXMgPSBuZXdSYW5nZXM7CiAgICAgIHZhciBoaWRkZW5BcmVhU3RhcnQgPSAxLAogICAgICAgIGhpZGRlbkFyZWFFbmQgPSAwOwogICAgICB2YXIgaGlkZGVuQXJlYUlkeCA9IC0xOwogICAgICB2YXIgbmV4dExpbmVOdW1iZXJUb1VwZGF0ZUhpZGRlbkFyZWEgPSBoaWRkZW5BcmVhSWR4ICsgMSA8IGhpZGRlbkFyZWFzLmxlbmd0aCA/IGhpZGRlbkFyZWFFbmQgKyAxIDogdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9ucy5sZW5ndGggKyAyOwogICAgICB2YXIgaGFzVmlzaWJsZUxpbmUgPSBmYWxzZTsKICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9ucy5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgdmFyIGxpbmVOdW1iZXIgPSBfaTIgKyAxOwogICAgICAgIGlmIChsaW5lTnVtYmVyID09PSBuZXh0TGluZU51bWJlclRvVXBkYXRlSGlkZGVuQXJlYSkgewogICAgICAgICAgaGlkZGVuQXJlYUlkeCsrOwogICAgICAgICAgaGlkZGVuQXJlYVN0YXJ0ID0gaGlkZGVuQXJlYXNbaGlkZGVuQXJlYUlkeF0uc3RhcnRMaW5lTnVtYmVyOwogICAgICAgICAgaGlkZGVuQXJlYUVuZCA9IGhpZGRlbkFyZWFzW2hpZGRlbkFyZWFJZHhdLmVuZExpbmVOdW1iZXI7CiAgICAgICAgICBuZXh0TGluZU51bWJlclRvVXBkYXRlSGlkZGVuQXJlYSA9IGhpZGRlbkFyZWFJZHggKyAxIDwgaGlkZGVuQXJlYXMubGVuZ3RoID8gaGlkZGVuQXJlYUVuZCArIDEgOiB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zLmxlbmd0aCArIDI7CiAgICAgICAgfQogICAgICAgIHZhciBsaW5lQ2hhbmdlZCA9IGZhbHNlOwogICAgICAgIGlmIChsaW5lTnVtYmVyID49IGhpZGRlbkFyZWFTdGFydCAmJiBsaW5lTnVtYmVyIDw9IGhpZGRlbkFyZWFFbmQpIHsKICAgICAgICAgIC8vIExpbmUgc2hvdWxkIGJlIGhpZGRlbgogICAgICAgICAgaWYgKHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbX2kyXS5pc1Zpc2libGUoKSkgewogICAgICAgICAgICB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW19pMl0gPSB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW19pMl0uc2V0VmlzaWJsZShmYWxzZSk7CiAgICAgICAgICAgIGxpbmVDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGFzVmlzaWJsZUxpbmUgPSB0cnVlOwogICAgICAgICAgLy8gTGluZSBzaG91bGQgYmUgdmlzaWJsZQogICAgICAgICAgaWYgKCF0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW19pMl0uaXNWaXNpYmxlKCkpIHsKICAgICAgICAgICAgdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tfaTJdID0gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tfaTJdLnNldFZpc2libGUodHJ1ZSk7CiAgICAgICAgICAgIGxpbmVDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGxpbmVDaGFuZ2VkKSB7CiAgICAgICAgICB2YXIgbmV3T3V0cHV0TGluZUNvdW50ID0gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tfaTJdLmdldFZpZXdMaW5lQ291bnQoKTsKICAgICAgICAgIHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5zZXRWYWx1ZShfaTIsIG5ld091dHB1dExpbmVDb3VudCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghaGFzVmlzaWJsZUxpbmUpIHsKICAgICAgICAvLyBDYW5ub3QgaGF2ZSBldmVyeXRoaW5nIGJlIGhpZGRlbiA9PiByZXZlYWwgZXZlcnl0aGluZyEKICAgICAgICB0aGlzLnNldEhpZGRlbkFyZWFzKFtdKTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtb2RlbFBvc2l0aW9uSXNWaXNpYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtb2RlbFBvc2l0aW9uSXNWaXNpYmxlKG1vZGVsTGluZU51bWJlciwgX21vZGVsQ29sdW1uKSB7CiAgICAgIGlmIChtb2RlbExpbmVOdW1iZXIgPCAxIHx8IG1vZGVsTGluZU51bWJlciA+IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgLy8gaW52YWxpZCBhcmd1bWVudHMKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbW9kZWxMaW5lTnVtYmVyIC0gMV0uaXNWaXNpYmxlKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TW9kZWxMaW5lVmlld0xpbmVDb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TW9kZWxMaW5lVmlld0xpbmVDb3VudChtb2RlbExpbmVOdW1iZXIpIHsKICAgICAgaWYgKG1vZGVsTGluZU51bWJlciA8IDEgfHwgbW9kZWxMaW5lTnVtYmVyID4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAvLyBpbnZhbGlkIGFyZ3VtZW50cwogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW21vZGVsTGluZU51bWJlciAtIDFdLmdldFZpZXdMaW5lQ291bnQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRUYWJTaXplIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUYWJTaXplKG5ld1RhYlNpemUpIHsKICAgICAgaWYgKHRoaXMudGFiU2l6ZSA9PT0gbmV3VGFiU2l6ZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLnRhYlNpemUgPSBuZXdUYWJTaXplOwogICAgICB0aGlzLl9jb25zdHJ1Y3RMaW5lcyggLypyZXNldEhpZGRlbkFyZWFzKi9mYWxzZSwgbnVsbCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFdyYXBwaW5nU2V0dGluZ3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFdyYXBwaW5nU2V0dGluZ3MoZm9udEluZm8sIHdyYXBwaW5nU3RyYXRlZ3ksIHdyYXBwaW5nQ29sdW1uLCB3cmFwcGluZ0luZGVudCkgewogICAgICB2YXIgZXF1YWxGb250SW5mbyA9IHRoaXMuZm9udEluZm8uZXF1YWxzKGZvbnRJbmZvKTsKICAgICAgdmFyIGVxdWFsV3JhcHBpbmdTdHJhdGVneSA9IHRoaXMud3JhcHBpbmdTdHJhdGVneSA9PT0gd3JhcHBpbmdTdHJhdGVneTsKICAgICAgdmFyIGVxdWFsV3JhcHBpbmdDb2x1bW4gPSB0aGlzLndyYXBwaW5nQ29sdW1uID09PSB3cmFwcGluZ0NvbHVtbjsKICAgICAgdmFyIGVxdWFsV3JhcHBpbmdJbmRlbnQgPSB0aGlzLndyYXBwaW5nSW5kZW50ID09PSB3cmFwcGluZ0luZGVudDsKICAgICAgaWYgKGVxdWFsRm9udEluZm8gJiYgZXF1YWxXcmFwcGluZ1N0cmF0ZWd5ICYmIGVxdWFsV3JhcHBpbmdDb2x1bW4gJiYgZXF1YWxXcmFwcGluZ0luZGVudCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIgb25seVdyYXBwaW5nQ29sdW1uQ2hhbmdlZCA9IGVxdWFsRm9udEluZm8gJiYgZXF1YWxXcmFwcGluZ1N0cmF0ZWd5ICYmICFlcXVhbFdyYXBwaW5nQ29sdW1uICYmIGVxdWFsV3JhcHBpbmdJbmRlbnQ7CiAgICAgIHRoaXMuZm9udEluZm8gPSBmb250SW5mbzsKICAgICAgdGhpcy53cmFwcGluZ1N0cmF0ZWd5ID0gd3JhcHBpbmdTdHJhdGVneTsKICAgICAgdGhpcy53cmFwcGluZ0NvbHVtbiA9IHdyYXBwaW5nQ29sdW1uOwogICAgICB0aGlzLndyYXBwaW5nSW5kZW50ID0gd3JhcHBpbmdJbmRlbnQ7CiAgICAgIHZhciBwcmV2aW91c0xpbmVCcmVha3MgPSBudWxsOwogICAgICBpZiAob25seVdyYXBwaW5nQ29sdW1uQ2hhbmdlZCkgewogICAgICAgIHByZXZpb3VzTGluZUJyZWFrcyA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBwcmV2aW91c0xpbmVCcmVha3NbaV0gPSB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2ldLmdldFByb2plY3Rpb25EYXRhKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX2NvbnN0cnVjdExpbmVzKCAvKnJlc2V0SGlkZGVuQXJlYXMqL2ZhbHNlLCBwcmV2aW91c0xpbmVCcmVha3MpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVMaW5lQnJlYWtzQ29tcHV0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUxpbmVCcmVha3NDb21wdXRlcigpIHsKICAgICAgdmFyIGxpbmVCcmVha3NDb21wdXRlckZhY3RvcnkgPSB0aGlzLndyYXBwaW5nU3RyYXRlZ3kgPT09ICdhZHZhbmNlZCcgPyB0aGlzLl9kb21MaW5lQnJlYWtzQ29tcHV0ZXJGYWN0b3J5IDogdGhpcy5fbW9ub3NwYWNlTGluZUJyZWFrc0NvbXB1dGVyRmFjdG9yeTsKICAgICAgcmV0dXJuIGxpbmVCcmVha3NDb21wdXRlckZhY3RvcnkuY3JlYXRlTGluZUJyZWFrc0NvbXB1dGVyKHRoaXMuZm9udEluZm8sIHRoaXMudGFiU2l6ZSwgdGhpcy53cmFwcGluZ0NvbHVtbiwgdGhpcy53cmFwcGluZ0luZGVudCk7CiAgICB9CiAgfSwgewogICAga2V5OiAib25Nb2RlbEZsdXNoZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uTW9kZWxGbHVzaGVkKCkgewogICAgICB0aGlzLl9jb25zdHJ1Y3RMaW5lcyggLypyZXNldEhpZGRlbkFyZWFzKi90cnVlLCBudWxsKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbk1vZGVsTGluZXNEZWxldGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vZGVsTGluZXNEZWxldGVkKHZlcnNpb25JZCwgZnJvbUxpbmVOdW1iZXIsIHRvTGluZU51bWJlcikgewogICAgICBpZiAoIXZlcnNpb25JZCB8fCB2ZXJzaW9uSWQgPD0gdGhpcy5fdmFsaWRNb2RlbFZlcnNpb25JZCkgewogICAgICAgIC8vIEhlcmUgd2UgY2hlY2sgZm9yIHZlcnNpb25JZCBpbiBjYXNlIHRoZSBsaW5lcyB3ZXJlIHJlY29uc3RydWN0ZWQgaW4gdGhlIG1lYW50aW1lLgogICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gYXBwbHkgc3RhbGUgY2hhbmdlIGV2ZW50cyBvbiB0b3Agb2YgYSBuZXdlciByZWFkIG1vZGVsIHN0YXRlLgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciBvdXRwdXRGcm9tTGluZU51bWJlciA9IGZyb21MaW5lTnVtYmVyID09PSAxID8gMSA6IHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0oZnJvbUxpbmVOdW1iZXIgLSAxKSArIDE7CiAgICAgIHZhciBvdXRwdXRUb0xpbmVOdW1iZXIgPSB0aGlzLnByb2plY3RlZE1vZGVsTGluZUxpbmVDb3VudHMuZ2V0UHJlZml4U3VtKHRvTGluZU51bWJlcik7CiAgICAgIHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnMuc3BsaWNlKGZyb21MaW5lTnVtYmVyIC0gMSwgdG9MaW5lTnVtYmVyIC0gZnJvbUxpbmVOdW1iZXIgKyAxKTsKICAgICAgdGhpcy5wcm9qZWN0ZWRNb2RlbExpbmVMaW5lQ291bnRzLnJlbW92ZVZhbHVlcyhmcm9tTGluZU51bWJlciAtIDEsIHRvTGluZU51bWJlciAtIGZyb21MaW5lTnVtYmVyICsgMSk7CiAgICAgIHJldHVybiBuZXcgdmlld0V2ZW50cy5WaWV3TGluZXNEZWxldGVkRXZlbnQob3V0cHV0RnJvbUxpbmVOdW1iZXIsIG91dHB1dFRvTGluZU51bWJlcik7CiAgICB9CiAgfSwgewogICAga2V5OiAib25Nb2RlbExpbmVzSW5zZXJ0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uTW9kZWxMaW5lc0luc2VydGVkKHZlcnNpb25JZCwgZnJvbUxpbmVOdW1iZXIsIF90b0xpbmVOdW1iZXIsIGxpbmVCcmVha3MpIHsKICAgICAgaWYgKCF2ZXJzaW9uSWQgfHwgdmVyc2lvbklkIDw9IHRoaXMuX3ZhbGlkTW9kZWxWZXJzaW9uSWQpIHsKICAgICAgICAvLyBIZXJlIHdlIGNoZWNrIGZvciB2ZXJzaW9uSWQgaW4gY2FzZSB0aGUgbGluZXMgd2VyZSByZWNvbnN0cnVjdGVkIGluIHRoZSBtZWFudGltZS4KICAgICAgICAvLyBXZSBkb24ndCB3YW50IHRvIGFwcGx5IHN0YWxlIGNoYW5nZSBldmVudHMgb24gdG9wIG9mIGEgbmV3ZXIgcmVhZCBtb2RlbCBzdGF0ZS4KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICAvLyBjYW5ub3QgdXNlIHRoaXMuZ2V0SGlkZGVuQXJlYXMoKSBiZWNhdXNlIHRob3NlIGRlY29yYXRpb25zIGhhdmUgYWxyZWFkeSBzZWVuIHRoZSBlZmZlY3Qgb2YgdGhpcyBtb2RlbCBjaGFuZ2UKICAgICAgdmFyIGlzSW5IaWRkZW5BcmVhID0gZnJvbUxpbmVOdW1iZXIgPiAyICYmICF0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2Zyb21MaW5lTnVtYmVyIC0gMl0uaXNWaXNpYmxlKCk7CiAgICAgIHZhciBvdXRwdXRGcm9tTGluZU51bWJlciA9IGZyb21MaW5lTnVtYmVyID09PSAxID8gMSA6IHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0oZnJvbUxpbmVOdW1iZXIgLSAxKSArIDE7CiAgICAgIHZhciB0b3RhbE91dHB1dExpbmVDb3VudCA9IDA7CiAgICAgIHZhciBpbnNlcnRMaW5lcyA9IFtdOwogICAgICB2YXIgaW5zZXJ0UHJlZml4U3VtVmFsdWVzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaW5lQnJlYWtzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGxpbmUgPSBjcmVhdGVNb2RlbExpbmVQcm9qZWN0aW9uKGxpbmVCcmVha3NbaV0sICFpc0luSGlkZGVuQXJlYSk7CiAgICAgICAgaW5zZXJ0TGluZXMucHVzaChsaW5lKTsKICAgICAgICB2YXIgb3V0cHV0TGluZUNvdW50ID0gbGluZS5nZXRWaWV3TGluZUNvdW50KCk7CiAgICAgICAgdG90YWxPdXRwdXRMaW5lQ291bnQgKz0gb3V0cHV0TGluZUNvdW50OwogICAgICAgIGluc2VydFByZWZpeFN1bVZhbHVlc1tpXSA9IG91dHB1dExpbmVDb3VudDsKICAgICAgfQogICAgICAvLyBUT0RPQEFsZXg6IHVzZSBhcnJheXMuYXJyYXlJbnNlcnQKICAgICAgdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9ucyA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnMuc2xpY2UoMCwgZnJvbUxpbmVOdW1iZXIgLSAxKS5jb25jYXQoaW5zZXJ0TGluZXMpLmNvbmNhdCh0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zLnNsaWNlKGZyb21MaW5lTnVtYmVyIC0gMSkpOwogICAgICB0aGlzLnByb2plY3RlZE1vZGVsTGluZUxpbmVDb3VudHMuaW5zZXJ0VmFsdWVzKGZyb21MaW5lTnVtYmVyIC0gMSwgaW5zZXJ0UHJlZml4U3VtVmFsdWVzKTsKICAgICAgcmV0dXJuIG5ldyB2aWV3RXZlbnRzLlZpZXdMaW5lc0luc2VydGVkRXZlbnQob3V0cHV0RnJvbUxpbmVOdW1iZXIsIG91dHB1dEZyb21MaW5lTnVtYmVyICsgdG90YWxPdXRwdXRMaW5lQ291bnQgLSAxKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbk1vZGVsTGluZUNoYW5nZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uTW9kZWxMaW5lQ2hhbmdlZCh2ZXJzaW9uSWQsIGxpbmVOdW1iZXIsIGxpbmVCcmVha0RhdGEpIHsKICAgICAgaWYgKHZlcnNpb25JZCAhPT0gbnVsbCAmJiB2ZXJzaW9uSWQgPD0gdGhpcy5fdmFsaWRNb2RlbFZlcnNpb25JZCkgewogICAgICAgIC8vIEhlcmUgd2UgY2hlY2sgZm9yIHZlcnNpb25JZCBpbiBjYXNlIHRoZSBsaW5lcyB3ZXJlIHJlY29uc3RydWN0ZWQgaW4gdGhlIG1lYW50aW1lLgogICAgICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gYXBwbHkgc3RhbGUgY2hhbmdlIGV2ZW50cyBvbiB0b3Agb2YgYSBuZXdlciByZWFkIG1vZGVsIHN0YXRlLgogICAgICAgIHJldHVybiBbZmFsc2UsIG51bGwsIG51bGwsIG51bGxdOwogICAgICB9CiAgICAgIHZhciBsaW5lSW5kZXggPSBsaW5lTnVtYmVyIC0gMTsKICAgICAgdmFyIG9sZE91dHB1dExpbmVDb3VudCA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XS5nZXRWaWV3TGluZUNvdW50KCk7CiAgICAgIHZhciBpc1Zpc2libGUgPSB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2xpbmVJbmRleF0uaXNWaXNpYmxlKCk7CiAgICAgIHZhciBsaW5lID0gY3JlYXRlTW9kZWxMaW5lUHJvamVjdGlvbihsaW5lQnJlYWtEYXRhLCBpc1Zpc2libGUpOwogICAgICB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2xpbmVJbmRleF0gPSBsaW5lOwogICAgICB2YXIgbmV3T3V0cHV0TGluZUNvdW50ID0gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tsaW5lSW5kZXhdLmdldFZpZXdMaW5lQ291bnQoKTsKICAgICAgdmFyIGxpbmVNYXBwaW5nQ2hhbmdlZCA9IGZhbHNlOwogICAgICB2YXIgY2hhbmdlRnJvbSA9IDA7CiAgICAgIHZhciBjaGFuZ2VUbyA9IC0xOwogICAgICB2YXIgaW5zZXJ0RnJvbSA9IDA7CiAgICAgIHZhciBpbnNlcnRUbyA9IC0xOwogICAgICB2YXIgZGVsZXRlRnJvbSA9IDA7CiAgICAgIHZhciBkZWxldGVUbyA9IC0xOwogICAgICBpZiAob2xkT3V0cHV0TGluZUNvdW50ID4gbmV3T3V0cHV0TGluZUNvdW50KSB7CiAgICAgICAgY2hhbmdlRnJvbSA9IHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0obGluZU51bWJlciAtIDEpICsgMTsKICAgICAgICBjaGFuZ2VUbyA9IGNoYW5nZUZyb20gKyBuZXdPdXRwdXRMaW5lQ291bnQgLSAxOwogICAgICAgIGRlbGV0ZUZyb20gPSBjaGFuZ2VUbyArIDE7CiAgICAgICAgZGVsZXRlVG8gPSBkZWxldGVGcm9tICsgKG9sZE91dHB1dExpbmVDb3VudCAtIG5ld091dHB1dExpbmVDb3VudCkgLSAxOwogICAgICAgIGxpbmVNYXBwaW5nQ2hhbmdlZCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAob2xkT3V0cHV0TGluZUNvdW50IDwgbmV3T3V0cHV0TGluZUNvdW50KSB7CiAgICAgICAgY2hhbmdlRnJvbSA9IHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0obGluZU51bWJlciAtIDEpICsgMTsKICAgICAgICBjaGFuZ2VUbyA9IGNoYW5nZUZyb20gKyBvbGRPdXRwdXRMaW5lQ291bnQgLSAxOwogICAgICAgIGluc2VydEZyb20gPSBjaGFuZ2VUbyArIDE7CiAgICAgICAgaW5zZXJ0VG8gPSBpbnNlcnRGcm9tICsgKG5ld091dHB1dExpbmVDb3VudCAtIG9sZE91dHB1dExpbmVDb3VudCkgLSAxOwogICAgICAgIGxpbmVNYXBwaW5nQ2hhbmdlZCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2hhbmdlRnJvbSA9IHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0obGluZU51bWJlciAtIDEpICsgMTsKICAgICAgICBjaGFuZ2VUbyA9IGNoYW5nZUZyb20gKyBuZXdPdXRwdXRMaW5lQ291bnQgLSAxOwogICAgICB9CiAgICAgIHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5zZXRWYWx1ZShsaW5lSW5kZXgsIG5ld091dHB1dExpbmVDb3VudCk7CiAgICAgIHZhciB2aWV3TGluZXNDaGFuZ2VkRXZlbnQgPSBjaGFuZ2VGcm9tIDw9IGNoYW5nZVRvID8gbmV3IHZpZXdFdmVudHMuVmlld0xpbmVzQ2hhbmdlZEV2ZW50KGNoYW5nZUZyb20sIGNoYW5nZVRvIC0gY2hhbmdlRnJvbSArIDEpIDogbnVsbDsKICAgICAgdmFyIHZpZXdMaW5lc0luc2VydGVkRXZlbnQgPSBpbnNlcnRGcm9tIDw9IGluc2VydFRvID8gbmV3IHZpZXdFdmVudHMuVmlld0xpbmVzSW5zZXJ0ZWRFdmVudChpbnNlcnRGcm9tLCBpbnNlcnRUbykgOiBudWxsOwogICAgICB2YXIgdmlld0xpbmVzRGVsZXRlZEV2ZW50ID0gZGVsZXRlRnJvbSA8PSBkZWxldGVUbyA/IG5ldyB2aWV3RXZlbnRzLlZpZXdMaW5lc0RlbGV0ZWRFdmVudChkZWxldGVGcm9tLCBkZWxldGVUbykgOiBudWxsOwogICAgICByZXR1cm4gW2xpbmVNYXBwaW5nQ2hhbmdlZCwgdmlld0xpbmVzQ2hhbmdlZEV2ZW50LCB2aWV3TGluZXNJbnNlcnRlZEV2ZW50LCB2aWV3TGluZXNEZWxldGVkRXZlbnRdOwogICAgfQogIH0sIHsKICAgIGtleTogImFjY2VwdFZlcnNpb25JZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWNjZXB0VmVyc2lvbklkKHZlcnNpb25JZCkgewogICAgICB0aGlzLl92YWxpZE1vZGVsVmVyc2lvbklkID0gdmVyc2lvbklkOwogICAgICBpZiAodGhpcy5tb2RlbExpbmVQcm9qZWN0aW9ucy5sZW5ndGggPT09IDEgJiYgIXRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbMF0uaXNWaXNpYmxlKCkpIHsKICAgICAgICAvLyBBdCBsZWFzdCBvbmUgbGluZSBtdXN0IGJlIHZpc2libGUgPT4gcmVzZXQgaGlkZGVuIGFyZWFzCiAgICAgICAgdGhpcy5zZXRIaWRkZW5BcmVhcyhbXSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZUNvdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3TGluZUNvdW50KCkgewogICAgICByZXR1cm4gdGhpcy5wcm9qZWN0ZWRNb2RlbExpbmVMaW5lQ291bnRzLmdldFRvdGFsU3VtKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3RvVmFsaWRWaWV3TGluZU51bWJlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3RvVmFsaWRWaWV3TGluZU51bWJlcih2aWV3TGluZU51bWJlcikgewogICAgICBpZiAodmlld0xpbmVOdW1iZXIgPCAxKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KICAgICAgdmFyIHZpZXdMaW5lQ291bnQgPSB0aGlzLmdldFZpZXdMaW5lQ291bnQoKTsKICAgICAgaWYgKHZpZXdMaW5lTnVtYmVyID4gdmlld0xpbmVDb3VudCkgewogICAgICAgIHJldHVybiB2aWV3TGluZUNvdW50OwogICAgICB9CiAgICAgIHJldHVybiB2aWV3TGluZU51bWJlciB8IDA7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QWN0aXZlSW5kZW50R3VpZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFjdGl2ZUluZGVudEd1aWRlKHZpZXdMaW5lTnVtYmVyLCBtaW5MaW5lTnVtYmVyLCBtYXhMaW5lTnVtYmVyKSB7CiAgICAgIHZpZXdMaW5lTnVtYmVyID0gdGhpcy5fdG9WYWxpZFZpZXdMaW5lTnVtYmVyKHZpZXdMaW5lTnVtYmVyKTsKICAgICAgbWluTGluZU51bWJlciA9IHRoaXMuX3RvVmFsaWRWaWV3TGluZU51bWJlcihtaW5MaW5lTnVtYmVyKTsKICAgICAgbWF4TGluZU51bWJlciA9IHRoaXMuX3RvVmFsaWRWaWV3TGluZU51bWJlcihtYXhMaW5lTnVtYmVyKTsKICAgICAgdmFyIG1vZGVsUG9zaXRpb24gPSB0aGlzLmNvbnZlcnRWaWV3UG9zaXRpb25Ub01vZGVsUG9zaXRpb24odmlld0xpbmVOdW1iZXIsIHRoaXMuZ2V0Vmlld0xpbmVNaW5Db2x1bW4odmlld0xpbmVOdW1iZXIpKTsKICAgICAgdmFyIG1vZGVsTWluUG9zaXRpb24gPSB0aGlzLmNvbnZlcnRWaWV3UG9zaXRpb25Ub01vZGVsUG9zaXRpb24obWluTGluZU51bWJlciwgdGhpcy5nZXRWaWV3TGluZU1pbkNvbHVtbihtaW5MaW5lTnVtYmVyKSk7CiAgICAgIHZhciBtb2RlbE1heFBvc2l0aW9uID0gdGhpcy5jb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uKG1heExpbmVOdW1iZXIsIHRoaXMuZ2V0Vmlld0xpbmVNaW5Db2x1bW4obWF4TGluZU51bWJlcikpOwogICAgICB2YXIgcmVzdWx0ID0gdGhpcy5tb2RlbC5ndWlkZXMuZ2V0QWN0aXZlSW5kZW50R3VpZGUobW9kZWxQb3NpdGlvbi5saW5lTnVtYmVyLCBtb2RlbE1pblBvc2l0aW9uLmxpbmVOdW1iZXIsIG1vZGVsTWF4UG9zaXRpb24ubGluZU51bWJlcik7CiAgICAgIHZhciB2aWV3U3RhcnRQb3NpdGlvbiA9IHRoaXMuY29udmVydE1vZGVsUG9zaXRpb25Ub1ZpZXdQb3NpdGlvbihyZXN1bHQuc3RhcnRMaW5lTnVtYmVyLCAxKTsKICAgICAgdmFyIHZpZXdFbmRQb3NpdGlvbiA9IHRoaXMuY29udmVydE1vZGVsUG9zaXRpb25Ub1ZpZXdQb3NpdGlvbihyZXN1bHQuZW5kTGluZU51bWJlciwgdGhpcy5tb2RlbC5nZXRMaW5lTWF4Q29sdW1uKHJlc3VsdC5lbmRMaW5lTnVtYmVyKSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3RhcnRMaW5lTnVtYmVyOiB2aWV3U3RhcnRQb3NpdGlvbi5saW5lTnVtYmVyLAogICAgICAgIGVuZExpbmVOdW1iZXI6IHZpZXdFbmRQb3NpdGlvbi5saW5lTnVtYmVyLAogICAgICAgIGluZGVudDogcmVzdWx0LmluZGVudAogICAgICB9OwogICAgfQogICAgLy8gI3JlZ2lvbiBWaWV3TGluZUluZm8KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZUluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lSW5mbyh2aWV3TGluZU51bWJlcikgewogICAgICB2aWV3TGluZU51bWJlciA9IHRoaXMuX3RvVmFsaWRWaWV3TGluZU51bWJlcih2aWV3TGluZU51bWJlcik7CiAgICAgIHZhciByID0gdGhpcy5wcm9qZWN0ZWRNb2RlbExpbmVMaW5lQ291bnRzLmdldEluZGV4T2Yodmlld0xpbmVOdW1iZXIgLSAxKTsKICAgICAgdmFyIGxpbmVJbmRleCA9IHIuaW5kZXg7CiAgICAgIHZhciByZW1haW5kZXIgPSByLnJlbWFpbmRlcjsKICAgICAgcmV0dXJuIG5ldyBWaWV3TGluZUluZm8obGluZUluZGV4ICsgMSwgcmVtYWluZGVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNaW5Db2x1bW5PZlZpZXdMaW5lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNaW5Db2x1bW5PZlZpZXdMaW5lKHZpZXdMaW5lSW5mbykgewogICAgICByZXR1cm4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1t2aWV3TGluZUluZm8ubW9kZWxMaW5lTnVtYmVyIC0gMV0uZ2V0Vmlld0xpbmVNaW5Db2x1bW4odGhpcy5tb2RlbCwgdmlld0xpbmVJbmZvLm1vZGVsTGluZU51bWJlciwgdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNYXhDb2x1bW5PZlZpZXdMaW5lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNYXhDb2x1bW5PZlZpZXdMaW5lKHZpZXdMaW5lSW5mbykgewogICAgICByZXR1cm4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1t2aWV3TGluZUluZm8ubW9kZWxMaW5lTnVtYmVyIC0gMV0uZ2V0Vmlld0xpbmVNYXhDb2x1bW4odGhpcy5tb2RlbCwgdmlld0xpbmVJbmZvLm1vZGVsTGluZU51bWJlciwgdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNb2RlbFN0YXJ0UG9zaXRpb25PZlZpZXdMaW5lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNb2RlbFN0YXJ0UG9zaXRpb25PZlZpZXdMaW5lKHZpZXdMaW5lSW5mbykgewogICAgICB2YXIgbGluZSA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbdmlld0xpbmVJbmZvLm1vZGVsTGluZU51bWJlciAtIDFdOwogICAgICB2YXIgbWluVmlld0NvbHVtbiA9IGxpbmUuZ2V0Vmlld0xpbmVNaW5Db2x1bW4odGhpcy5tb2RlbCwgdmlld0xpbmVJbmZvLm1vZGVsTGluZU51bWJlciwgdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KTsKICAgICAgdmFyIGNvbHVtbiA9IGxpbmUuZ2V0TW9kZWxDb2x1bW5PZlZpZXdQb3NpdGlvbih2aWV3TGluZUluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgsIG1pblZpZXdDb2x1bW4pOwogICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKHZpZXdMaW5lSW5mby5tb2RlbExpbmVOdW1iZXIsIGNvbHVtbik7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TW9kZWxFbmRQb3NpdGlvbk9mVmlld0xpbmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE1vZGVsRW5kUG9zaXRpb25PZlZpZXdMaW5lKHZpZXdMaW5lSW5mbykgewogICAgICB2YXIgbGluZSA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbdmlld0xpbmVJbmZvLm1vZGVsTGluZU51bWJlciAtIDFdOwogICAgICB2YXIgbWF4Vmlld0NvbHVtbiA9IGxpbmUuZ2V0Vmlld0xpbmVNYXhDb2x1bW4odGhpcy5tb2RlbCwgdmlld0xpbmVJbmZvLm1vZGVsTGluZU51bWJlciwgdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KTsKICAgICAgdmFyIGNvbHVtbiA9IGxpbmUuZ2V0TW9kZWxDb2x1bW5PZlZpZXdQb3NpdGlvbih2aWV3TGluZUluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgsIG1heFZpZXdDb2x1bW4pOwogICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKHZpZXdMaW5lSW5mby5tb2RlbExpbmVOdW1iZXIsIGNvbHVtbik7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld0xpbmVJbmZvc0dyb3VwZWRCeU1vZGVsUmFuZ2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3TGluZUluZm9zR3JvdXBlZEJ5TW9kZWxSYW5nZXModmlld1N0YXJ0TGluZU51bWJlciwgdmlld0VuZExpbmVOdW1iZXIpIHsKICAgICAgdmFyIHN0YXJ0Vmlld0xpbmUgPSB0aGlzLmdldFZpZXdMaW5lSW5mbyh2aWV3U3RhcnRMaW5lTnVtYmVyKTsKICAgICAgdmFyIGVuZFZpZXdMaW5lID0gdGhpcy5nZXRWaWV3TGluZUluZm8odmlld0VuZExpbmVOdW1iZXIpOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IEFycmF5KCk7CiAgICAgIHZhciBsYXN0VmlzaWJsZU1vZGVsUG9zID0gdGhpcy5nZXRNb2RlbFN0YXJ0UG9zaXRpb25PZlZpZXdMaW5lKHN0YXJ0Vmlld0xpbmUpOwogICAgICB2YXIgdmlld0xpbmVzID0gbmV3IEFycmF5KCk7CiAgICAgIGZvciAodmFyIGN1ck1vZGVsTGluZSA9IHN0YXJ0Vmlld0xpbmUubW9kZWxMaW5lTnVtYmVyOyBjdXJNb2RlbExpbmUgPD0gZW5kVmlld0xpbmUubW9kZWxMaW5lTnVtYmVyOyBjdXJNb2RlbExpbmUrKykgewogICAgICAgIHZhciBsaW5lID0gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tjdXJNb2RlbExpbmUgLSAxXTsKICAgICAgICBpZiAobGluZS5pc1Zpc2libGUoKSkgewogICAgICAgICAgdmFyIHN0YXJ0T2Zmc2V0ID0gY3VyTW9kZWxMaW5lID09PSBzdGFydFZpZXdMaW5lLm1vZGVsTGluZU51bWJlciA/IHN0YXJ0Vmlld0xpbmUubW9kZWxMaW5lV3JhcHBlZExpbmVJZHggOiAwOwogICAgICAgICAgdmFyIGVuZE9mZnNldCA9IGN1ck1vZGVsTGluZSA9PT0gZW5kVmlld0xpbmUubW9kZWxMaW5lTnVtYmVyID8gZW5kVmlld0xpbmUubW9kZWxMaW5lV3JhcHBlZExpbmVJZHggKyAxIDogbGluZS5nZXRWaWV3TGluZUNvdW50KCk7CiAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRPZmZzZXQ7IGkgPCBlbmRPZmZzZXQ7IGkrKykgewogICAgICAgICAgICB2aWV3TGluZXMucHVzaChuZXcgVmlld0xpbmVJbmZvKGN1ck1vZGVsTGluZSwgaSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWxpbmUuaXNWaXNpYmxlKCkgJiYgbGFzdFZpc2libGVNb2RlbFBvcykgewogICAgICAgICAgdmFyIGxhc3RWaXNpYmxlTW9kZWxQb3MyID0gbmV3IFBvc2l0aW9uKGN1ck1vZGVsTGluZSAtIDEsIHRoaXMubW9kZWwuZ2V0TGluZU1heENvbHVtbihjdXJNb2RlbExpbmUgLSAxKSArIDEpOwogICAgICAgICAgdmFyIG1vZGVsUmFuZ2UgPSBSYW5nZS5mcm9tUG9zaXRpb25zKGxhc3RWaXNpYmxlTW9kZWxQb3MsIGxhc3RWaXNpYmxlTW9kZWxQb3MyKTsKICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBWaWV3TGluZUluZm9Hcm91cGVkQnlNb2RlbFJhbmdlKG1vZGVsUmFuZ2UsIHZpZXdMaW5lcykpOwogICAgICAgICAgdmlld0xpbmVzID0gW107CiAgICAgICAgICBsYXN0VmlzaWJsZU1vZGVsUG9zID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYgKGxpbmUuaXNWaXNpYmxlKCkgJiYgIWxhc3RWaXNpYmxlTW9kZWxQb3MpIHsKICAgICAgICAgIGxhc3RWaXNpYmxlTW9kZWxQb3MgPSBuZXcgUG9zaXRpb24oY3VyTW9kZWxMaW5lLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGxhc3RWaXNpYmxlTW9kZWxQb3MpIHsKICAgICAgICB2YXIgX21vZGVsUmFuZ2UgPSBSYW5nZS5mcm9tUG9zaXRpb25zKGxhc3RWaXNpYmxlTW9kZWxQb3MsIHRoaXMuZ2V0TW9kZWxFbmRQb3NpdGlvbk9mVmlld0xpbmUoZW5kVmlld0xpbmUpKTsKICAgICAgICByZXN1bHQucHVzaChuZXcgVmlld0xpbmVJbmZvR3JvdXBlZEJ5TW9kZWxSYW5nZShfbW9kZWxSYW5nZSwgdmlld0xpbmVzKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8vICNlbmRyZWdpb24KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZXNCcmFja2V0R3VpZGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3TGluZXNCcmFja2V0R3VpZGVzKHZpZXdTdGFydExpbmVOdW1iZXIsIHZpZXdFbmRMaW5lTnVtYmVyLCBhY3RpdmVWaWV3UG9zaXRpb24sIG9wdGlvbnMpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgIHZhciBtb2RlbEFjdGl2ZVBvc2l0aW9uID0gYWN0aXZlVmlld1Bvc2l0aW9uID8gdGhpcy5jb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uKGFjdGl2ZVZpZXdQb3NpdGlvbi5saW5lTnVtYmVyLCBhY3RpdmVWaWV3UG9zaXRpb24uY29sdW1uKSA6IG51bGw7CiAgICAgIHZhciByZXN1bHRQZXJWaWV3TGluZSA9IFtdOwogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5nZXRWaWV3TGluZUluZm9zR3JvdXBlZEJ5TW9kZWxSYW5nZXModmlld1N0YXJ0TGluZU51bWJlciwgdmlld0VuZExpbmVOdW1iZXIpKSwKICAgICAgICBfc3RlcDsKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIGdyb3VwID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICB2YXIgbW9kZWxSYW5nZVN0YXJ0TGluZU51bWJlciA9IGdyb3VwLm1vZGVsUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyOwogICAgICAgICAgdmFyIGJyYWNrZXRHdWlkZXNQZXJNb2RlbExpbmUgPSB0aGlzLm1vZGVsLmd1aWRlcy5nZXRMaW5lc0JyYWNrZXRHdWlkZXMobW9kZWxSYW5nZVN0YXJ0TGluZU51bWJlciwgZ3JvdXAubW9kZWxSYW5nZS5lbmRMaW5lTnVtYmVyLCBtb2RlbEFjdGl2ZVBvc2l0aW9uLCBvcHRpb25zKTsKICAgICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZ3JvdXAudmlld0xpbmVzKSwKICAgICAgICAgICAgX3N0ZXAyOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIF9sb29wMiA9IGZ1bmN0aW9uIF9sb29wMigpIHsKICAgICAgICAgICAgICB2YXIgdmlld0xpbmVJbmZvID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgIHZhciBicmFja2V0R3VpZGVzID0gYnJhY2tldEd1aWRlc1Blck1vZGVsTGluZVt2aWV3TGluZUluZm8ubW9kZWxMaW5lTnVtYmVyIC0gbW9kZWxSYW5nZVN0YXJ0TGluZU51bWJlcl07CiAgICAgICAgICAgICAgLy8gdmlzaWJsZUNvbHVtbnMgc3RheSBhcyB0aGV5IGFyZSAodGhpcyBpcyBhIGJ1ZyBhbmQgbmVlZHMgdG8gYmUgZml4ZWQsIGJ1dCBpdCBpcyBub3QgYSByZWdyZXNzaW9uKQogICAgICAgICAgICAgIC8vIG1vZGVsLWNvbHVtbnMgbXVzdCBiZSBjb252ZXJ0ZWQgdG8gdmlldy1tb2RlbCBjb2x1bW5zLgogICAgICAgICAgICAgIHZhciByZXN1bHQgPSBicmFja2V0R3VpZGVzLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgICAgICAgICAgaWYgKGcuZm9yV3JhcHBlZExpbmVzQWZ0ZXJDb2x1bW4gIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcCA9IF90aGlzNC5tb2RlbExpbmVQcm9qZWN0aW9uc1t2aWV3TGluZUluZm8ubW9kZWxMaW5lTnVtYmVyIC0gMV0uZ2V0Vmlld1Bvc2l0aW9uT2ZNb2RlbFBvc2l0aW9uKDAsIGcuZm9yV3JhcHBlZExpbmVzQWZ0ZXJDb2x1bW4pOwogICAgICAgICAgICAgICAgICBpZiAoX3AubGluZU51bWJlciA+PSB2aWV3TGluZUluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZy5mb3JXcmFwcGVkTGluZXNCZWZvcmVPckF0Q29sdW1uICE9PSAtMSkgewogICAgICAgICAgICAgICAgICB2YXIgX3AyID0gX3RoaXM0Lm1vZGVsTGluZVByb2plY3Rpb25zW3ZpZXdMaW5lSW5mby5tb2RlbExpbmVOdW1iZXIgLSAxXS5nZXRWaWV3UG9zaXRpb25PZk1vZGVsUG9zaXRpb24oMCwgZy5mb3JXcmFwcGVkTGluZXNCZWZvcmVPckF0Q29sdW1uKTsKICAgICAgICAgICAgICAgICAgaWYgKF9wMi5saW5lTnVtYmVyIDwgdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFnLmhvcml6b250YWxMaW5lKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGNvbHVtbiA9IC0xOwogICAgICAgICAgICAgICAgaWYgKGcuY29sdW1uICE9PSAtMSkgewogICAgICAgICAgICAgICAgICB2YXIgX3AzID0gX3RoaXM0Lm1vZGVsTGluZVByb2plY3Rpb25zW3ZpZXdMaW5lSW5mby5tb2RlbExpbmVOdW1iZXIgLSAxXS5nZXRWaWV3UG9zaXRpb25PZk1vZGVsUG9zaXRpb24oMCwgZy5jb2x1bW4pOwogICAgICAgICAgICAgICAgICBpZiAoX3AzLmxpbmVOdW1iZXIgPT09IHZpZXdMaW5lSW5mby5tb2RlbExpbmVXcmFwcGVkTGluZUlkeCkgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbiA9IF9wMy5jb2x1bW47CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3AzLmxpbmVOdW1iZXIgPCB2aWV3TGluZUluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgpIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW4gPSBfdGhpczQuZ2V0TWluQ29sdW1uT2ZWaWV3TGluZSh2aWV3TGluZUluZm8pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9wMy5saW5lTnVtYmVyID4gdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHZpZXdQb3NpdGlvbiA9IF90aGlzNC5jb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uKHZpZXdMaW5lSW5mby5tb2RlbExpbmVOdW1iZXIsIGcuaG9yaXpvbnRhbExpbmUuZW5kQ29sdW1uKTsKICAgICAgICAgICAgICAgIHZhciBwID0gX3RoaXM0Lm1vZGVsTGluZVByb2plY3Rpb25zW3ZpZXdMaW5lSW5mby5tb2RlbExpbmVOdW1iZXIgLSAxXS5nZXRWaWV3UG9zaXRpb25PZk1vZGVsUG9zaXRpb24oMCwgZy5ob3Jpem9udGFsTGluZS5lbmRDb2x1bW4pOwogICAgICAgICAgICAgICAgaWYgKHAubGluZU51bWJlciA9PT0gdmlld0xpbmVJbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW5kZW50R3VpZGUoZy52aXNpYmxlQ29sdW1uLCBjb2x1bW4sIGcuY2xhc3NOYW1lLCBuZXcgSW5kZW50R3VpZGVIb3Jpem9udGFsTGluZShnLmhvcml6b250YWxMaW5lLnRvcCwgdmlld1Bvc2l0aW9uLmNvbHVtbiksIC0xLCAtMSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHAubGluZU51bWJlciA8IHZpZXdMaW5lSW5mby5tb2RlbExpbmVXcmFwcGVkTGluZUlkeCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKGcudmlzaWJsZUNvbHVtbiAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBEb24ndCByZXBlYXQgaG9yaXpvbnRhbCBsaW5lcyB0aGF0IHVzZSB2aXNpYmxlQ29sdW1uIGZvciB1bnJlbGF0ZWQgbGluZXMuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluZGVudEd1aWRlKGcudmlzaWJsZUNvbHVtbiwgY29sdW1uLCBnLmNsYXNzTmFtZSwgbmV3IEluZGVudEd1aWRlSG9yaXpvbnRhbExpbmUoZy5ob3Jpem9udGFsTGluZS50b3AsIF90aGlzNC5nZXRNYXhDb2x1bW5PZlZpZXdMaW5lKHZpZXdMaW5lSW5mbykpLCAtMSwgLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJlc3VsdFBlclZpZXdMaW5lLnB1c2gocmVzdWx0LmZpbHRlcihmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgcmV0dXJuICEhcjsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgX2xvb3AyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHRQZXJWaWV3TGluZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZXNJbmRlbnRHdWlkZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lc0luZGVudEd1aWRlcyh2aWV3U3RhcnRMaW5lTnVtYmVyLCB2aWV3RW5kTGluZU51bWJlcikgewogICAgICAvLyBUT0RPOiBVc2UgdGhlIHNhbWUgY29kZSBhcyBpbiBgZ2V0Vmlld0xpbmVzQnJhY2tldEd1aWRlc2AuCiAgICAgIC8vIEZ1dHVyZSBUT0RPOiBNZXJnZSB3aXRoIGBnZXRWaWV3TGluZXNCcmFja2V0R3VpZGVzYC4KICAgICAgLy8gSG93ZXZlciwgdGhpcyByZXF1aXJlcyBtb3JlIHJlZmFjdG9yaW5nIG9mIGluZGVudCBndWlkZXMuCiAgICAgIHZpZXdTdGFydExpbmVOdW1iZXIgPSB0aGlzLl90b1ZhbGlkVmlld0xpbmVOdW1iZXIodmlld1N0YXJ0TGluZU51bWJlcik7CiAgICAgIHZpZXdFbmRMaW5lTnVtYmVyID0gdGhpcy5fdG9WYWxpZFZpZXdMaW5lTnVtYmVyKHZpZXdFbmRMaW5lTnVtYmVyKTsKICAgICAgdmFyIG1vZGVsU3RhcnQgPSB0aGlzLmNvbnZlcnRWaWV3UG9zaXRpb25Ub01vZGVsUG9zaXRpb24odmlld1N0YXJ0TGluZU51bWJlciwgdGhpcy5nZXRWaWV3TGluZU1pbkNvbHVtbih2aWV3U3RhcnRMaW5lTnVtYmVyKSk7CiAgICAgIHZhciBtb2RlbEVuZCA9IHRoaXMuY29udmVydFZpZXdQb3NpdGlvblRvTW9kZWxQb3NpdGlvbih2aWV3RW5kTGluZU51bWJlciwgdGhpcy5nZXRWaWV3TGluZU1heENvbHVtbih2aWV3RW5kTGluZU51bWJlcikpOwogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgIHZhciByZXN1bHRSZXBlYXRDb3VudCA9IFtdOwogICAgICB2YXIgcmVzdWx0UmVwZWF0T3B0aW9uID0gW107CiAgICAgIHZhciBtb2RlbFN0YXJ0TGluZUluZGV4ID0gbW9kZWxTdGFydC5saW5lTnVtYmVyIC0gMTsKICAgICAgdmFyIG1vZGVsRW5kTGluZUluZGV4ID0gbW9kZWxFbmQubGluZU51bWJlciAtIDE7CiAgICAgIHZhciByZXFTdGFydCA9IG51bGw7CiAgICAgIGZvciAodmFyIG1vZGVsTGluZUluZGV4ID0gbW9kZWxTdGFydExpbmVJbmRleDsgbW9kZWxMaW5lSW5kZXggPD0gbW9kZWxFbmRMaW5lSW5kZXg7IG1vZGVsTGluZUluZGV4KyspIHsKICAgICAgICB2YXIgbGluZSA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbW9kZWxMaW5lSW5kZXhdOwogICAgICAgIGlmIChsaW5lLmlzVmlzaWJsZSgpKSB7CiAgICAgICAgICB2YXIgdmlld0xpbmVTdGFydEluZGV4ID0gbGluZS5nZXRWaWV3TGluZU51bWJlck9mTW9kZWxQb3NpdGlvbigwLCBtb2RlbExpbmVJbmRleCA9PT0gbW9kZWxTdGFydExpbmVJbmRleCA/IG1vZGVsU3RhcnQuY29sdW1uIDogMSk7CiAgICAgICAgICB2YXIgdmlld0xpbmVFbmRJbmRleCA9IGxpbmUuZ2V0Vmlld0xpbmVOdW1iZXJPZk1vZGVsUG9zaXRpb24oMCwgdGhpcy5tb2RlbC5nZXRMaW5lTWF4Q29sdW1uKG1vZGVsTGluZUluZGV4ICsgMSkpOwogICAgICAgICAgdmFyIGNvdW50ID0gdmlld0xpbmVFbmRJbmRleCAtIHZpZXdMaW5lU3RhcnRJbmRleCArIDE7CiAgICAgICAgICB2YXIgb3B0aW9uID0gMCAvKiBJbmRlbnRHdWlkZVJlcGVhdE9wdGlvbi5CbG9ja05vbmUgKi87CiAgICAgICAgICBpZiAoY291bnQgPiAxICYmIGxpbmUuZ2V0Vmlld0xpbmVNaW5Db2x1bW4odGhpcy5tb2RlbCwgbW9kZWxMaW5lSW5kZXggKyAxLCB2aWV3TGluZUVuZEluZGV4KSA9PT0gMSkgewogICAgICAgICAgICAvLyB3cmFwcGVkIGxpbmVzIHNob3VsZCBibG9jayBpbmRlbnQgZ3VpZGVzCiAgICAgICAgICAgIG9wdGlvbiA9IHZpZXdMaW5lU3RhcnRJbmRleCA9PT0gMCA/IDEgLyogSW5kZW50R3VpZGVSZXBlYXRPcHRpb24uQmxvY2tTdWJzZXF1ZW50ICovIDogMiAvKiBJbmRlbnRHdWlkZVJlcGVhdE9wdGlvbi5CbG9ja0FsbCAqLzsKICAgICAgICAgIH0KCiAgICAgICAgICByZXN1bHRSZXBlYXRDb3VudC5wdXNoKGNvdW50KTsKICAgICAgICAgIHJlc3VsdFJlcGVhdE9wdGlvbi5wdXNoKG9wdGlvbik7CiAgICAgICAgICAvLyBtZXJnZSBpbnRvIHByZXZpb3VzIHJlcXVlc3QKICAgICAgICAgIGlmIChyZXFTdGFydCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXFTdGFydCA9IG5ldyBQb3NpdGlvbihtb2RlbExpbmVJbmRleCArIDEsIDApOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBoaXQgaW52aXNpYmxlIGxpbmUgPT4gZmx1c2ggcmVxdWVzdAogICAgICAgICAgaWYgKHJlcVN0YXJ0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQodGhpcy5tb2RlbC5ndWlkZXMuZ2V0TGluZXNJbmRlbnRHdWlkZXMocmVxU3RhcnQubGluZU51bWJlciwgbW9kZWxMaW5lSW5kZXgpKTsKICAgICAgICAgICAgcmVxU3RhcnQgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVxU3RhcnQgIT09IG51bGwpIHsKICAgICAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KHRoaXMubW9kZWwuZ3VpZGVzLmdldExpbmVzSW5kZW50R3VpZGVzKHJlcVN0YXJ0LmxpbmVOdW1iZXIsIG1vZGVsRW5kLmxpbmVOdW1iZXIpKTsKICAgICAgICByZXFTdGFydCA9IG51bGw7CiAgICAgIH0KICAgICAgdmFyIHZpZXdMaW5lQ291bnQgPSB2aWV3RW5kTGluZU51bWJlciAtIHZpZXdTdGFydExpbmVOdW1iZXIgKyAxOwogICAgICB2YXIgdmlld0luZGVudHMgPSBuZXcgQXJyYXkodmlld0xpbmVDb3VudCk7CiAgICAgIHZhciBjdXJySW5kZXggPSAwOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIHZhbHVlID0gcmVzdWx0W2ldOwogICAgICAgIHZhciBfY291bnQgPSBNYXRoLm1pbih2aWV3TGluZUNvdW50IC0gY3VyckluZGV4LCByZXN1bHRSZXBlYXRDb3VudFtpXSk7CiAgICAgICAgdmFyIF9vcHRpb24gPSByZXN1bHRSZXBlYXRPcHRpb25baV07CiAgICAgICAgdmFyIGJsb2NrQXRJbmRleCA9IHZvaWQgMDsKICAgICAgICBpZiAoX29wdGlvbiA9PT0gMiAvKiBJbmRlbnRHdWlkZVJlcGVhdE9wdGlvbi5CbG9ja0FsbCAqLykgewogICAgICAgICAgYmxvY2tBdEluZGV4ID0gMDsKICAgICAgICB9IGVsc2UgaWYgKF9vcHRpb24gPT09IDEgLyogSW5kZW50R3VpZGVSZXBlYXRPcHRpb24uQmxvY2tTdWJzZXF1ZW50ICovKSB7CiAgICAgICAgICBibG9ja0F0SW5kZXggPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBibG9ja0F0SW5kZXggPSBfY291bnQ7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgX2NvdW50OyBqKyspIHsKICAgICAgICAgIGlmIChqID09PSBibG9ja0F0SW5kZXgpIHsKICAgICAgICAgICAgdmFsdWUgPSAwOwogICAgICAgICAgfQogICAgICAgICAgdmlld0luZGVudHNbY3VyckluZGV4KytdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2aWV3SW5kZW50czsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZUNvbnRlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lQ29udGVudCh2aWV3TGluZU51bWJlcikgewogICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0Vmlld0xpbmVJbmZvKHZpZXdMaW5lTnVtYmVyKTsKICAgICAgcmV0dXJuIHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbaW5mby5tb2RlbExpbmVOdW1iZXIgLSAxXS5nZXRWaWV3TGluZUNvbnRlbnQodGhpcy5tb2RlbCwgaW5mby5tb2RlbExpbmVOdW1iZXIsIGluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZpZXdMaW5lTGVuZ3RoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3TGluZUxlbmd0aCh2aWV3TGluZU51bWJlcikgewogICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0Vmlld0xpbmVJbmZvKHZpZXdMaW5lTnVtYmVyKTsKICAgICAgcmV0dXJuIHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbaW5mby5tb2RlbExpbmVOdW1iZXIgLSAxXS5nZXRWaWV3TGluZUxlbmd0aCh0aGlzLm1vZGVsLCBpbmZvLm1vZGVsTGluZU51bWJlciwgaW5mby5tb2RlbExpbmVXcmFwcGVkTGluZUlkeCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld0xpbmVNaW5Db2x1bW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lTWluQ29sdW1uKHZpZXdMaW5lTnVtYmVyKSB7CiAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRWaWV3TGluZUluZm8odmlld0xpbmVOdW1iZXIpOwogICAgICByZXR1cm4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tpbmZvLm1vZGVsTGluZU51bWJlciAtIDFdLmdldFZpZXdMaW5lTWluQ29sdW1uKHRoaXMubW9kZWwsIGluZm8ubW9kZWxMaW5lTnVtYmVyLCBpbmZvLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZU1heENvbHVtbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVNYXhDb2x1bW4odmlld0xpbmVOdW1iZXIpIHsKICAgICAgdmFyIGluZm8gPSB0aGlzLmdldFZpZXdMaW5lSW5mbyh2aWV3TGluZU51bWJlcik7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2luZm8ubW9kZWxMaW5lTnVtYmVyIC0gMV0uZ2V0Vmlld0xpbmVNYXhDb2x1bW4odGhpcy5tb2RlbCwgaW5mby5tb2RlbExpbmVOdW1iZXIsIGluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZpZXdMaW5lRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVEYXRhKHZpZXdMaW5lTnVtYmVyKSB7CiAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRWaWV3TGluZUluZm8odmlld0xpbmVOdW1iZXIpOwogICAgICByZXR1cm4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tpbmZvLm1vZGVsTGluZU51bWJlciAtIDFdLmdldFZpZXdMaW5lRGF0YSh0aGlzLm1vZGVsLCBpbmZvLm1vZGVsTGluZU51bWJlciwgaW5mby5tb2RlbExpbmVXcmFwcGVkTGluZUlkeCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld0xpbmVzRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVzRGF0YSh2aWV3U3RhcnRMaW5lTnVtYmVyLCB2aWV3RW5kTGluZU51bWJlciwgbmVlZGVkKSB7CiAgICAgIHZpZXdTdGFydExpbmVOdW1iZXIgPSB0aGlzLl90b1ZhbGlkVmlld0xpbmVOdW1iZXIodmlld1N0YXJ0TGluZU51bWJlcik7CiAgICAgIHZpZXdFbmRMaW5lTnVtYmVyID0gdGhpcy5fdG9WYWxpZFZpZXdMaW5lTnVtYmVyKHZpZXdFbmRMaW5lTnVtYmVyKTsKICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5wcm9qZWN0ZWRNb2RlbExpbmVMaW5lQ291bnRzLmdldEluZGV4T2Yodmlld1N0YXJ0TGluZU51bWJlciAtIDEpOwogICAgICB2YXIgdmlld0xpbmVOdW1iZXIgPSB2aWV3U3RhcnRMaW5lTnVtYmVyOwogICAgICB2YXIgc3RhcnRNb2RlbExpbmVJbmRleCA9IHN0YXJ0LmluZGV4OwogICAgICB2YXIgc3RhcnRSZW1haW5kZXIgPSBzdGFydC5yZW1haW5kZXI7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgZm9yICh2YXIgbW9kZWxMaW5lSW5kZXggPSBzdGFydE1vZGVsTGluZUluZGV4LCBsZW4gPSB0aGlzLm1vZGVsLmdldExpbmVDb3VudCgpOyBtb2RlbExpbmVJbmRleCA8IGxlbjsgbW9kZWxMaW5lSW5kZXgrKykgewogICAgICAgIHZhciBsaW5lID0gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1ttb2RlbExpbmVJbmRleF07CiAgICAgICAgaWYgKCFsaW5lLmlzVmlzaWJsZSgpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdmFyIGZyb21WaWV3TGluZUluZGV4ID0gbW9kZWxMaW5lSW5kZXggPT09IHN0YXJ0TW9kZWxMaW5lSW5kZXggPyBzdGFydFJlbWFpbmRlciA6IDA7CiAgICAgICAgdmFyIHJlbWFpbmluZ1ZpZXdMaW5lQ291bnQgPSBsaW5lLmdldFZpZXdMaW5lQ291bnQoKSAtIGZyb21WaWV3TGluZUluZGV4OwogICAgICAgIHZhciBsYXN0TGluZSA9IGZhbHNlOwogICAgICAgIGlmICh2aWV3TGluZU51bWJlciArIHJlbWFpbmluZ1ZpZXdMaW5lQ291bnQgPiB2aWV3RW5kTGluZU51bWJlcikgewogICAgICAgICAgbGFzdExpbmUgPSB0cnVlOwogICAgICAgICAgcmVtYWluaW5nVmlld0xpbmVDb3VudCA9IHZpZXdFbmRMaW5lTnVtYmVyIC0gdmlld0xpbmVOdW1iZXIgKyAxOwogICAgICAgIH0KICAgICAgICBsaW5lLmdldFZpZXdMaW5lc0RhdGEodGhpcy5tb2RlbCwgbW9kZWxMaW5lSW5kZXggKyAxLCBmcm9tVmlld0xpbmVJbmRleCwgcmVtYWluaW5nVmlld0xpbmVDb3VudCwgdmlld0xpbmVOdW1iZXIgLSB2aWV3U3RhcnRMaW5lTnVtYmVyLCBuZWVkZWQsIHJlc3VsdCk7CiAgICAgICAgdmlld0xpbmVOdW1iZXIgKz0gcmVtYWluaW5nVmlld0xpbmVDb3VudDsKICAgICAgICBpZiAobGFzdExpbmUpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0sIHsKICAgIGtleTogInZhbGlkYXRlVmlld1Bvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZVZpZXdQb3NpdGlvbih2aWV3TGluZU51bWJlciwgdmlld0NvbHVtbiwgZXhwZWN0ZWRNb2RlbFBvc2l0aW9uKSB7CiAgICAgIHZpZXdMaW5lTnVtYmVyID0gdGhpcy5fdG9WYWxpZFZpZXdMaW5lTnVtYmVyKHZpZXdMaW5lTnVtYmVyKTsKICAgICAgdmFyIHIgPSB0aGlzLnByb2plY3RlZE1vZGVsTGluZUxpbmVDb3VudHMuZ2V0SW5kZXhPZih2aWV3TGluZU51bWJlciAtIDEpOwogICAgICB2YXIgbGluZUluZGV4ID0gci5pbmRleDsKICAgICAgdmFyIHJlbWFpbmRlciA9IHIucmVtYWluZGVyOwogICAgICB2YXIgbGluZSA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XTsKICAgICAgdmFyIG1pbkNvbHVtbiA9IGxpbmUuZ2V0Vmlld0xpbmVNaW5Db2x1bW4odGhpcy5tb2RlbCwgbGluZUluZGV4ICsgMSwgcmVtYWluZGVyKTsKICAgICAgdmFyIG1heENvbHVtbiA9IGxpbmUuZ2V0Vmlld0xpbmVNYXhDb2x1bW4odGhpcy5tb2RlbCwgbGluZUluZGV4ICsgMSwgcmVtYWluZGVyKTsKICAgICAgaWYgKHZpZXdDb2x1bW4gPCBtaW5Db2x1bW4pIHsKICAgICAgICB2aWV3Q29sdW1uID0gbWluQ29sdW1uOwogICAgICB9CiAgICAgIGlmICh2aWV3Q29sdW1uID4gbWF4Q29sdW1uKSB7CiAgICAgICAgdmlld0NvbHVtbiA9IG1heENvbHVtbjsKICAgICAgfQogICAgICB2YXIgY29tcHV0ZWRNb2RlbENvbHVtbiA9IGxpbmUuZ2V0TW9kZWxDb2x1bW5PZlZpZXdQb3NpdGlvbihyZW1haW5kZXIsIHZpZXdDb2x1bW4pOwogICAgICB2YXIgY29tcHV0ZWRNb2RlbFBvc2l0aW9uID0gdGhpcy5tb2RlbC52YWxpZGF0ZVBvc2l0aW9uKG5ldyBQb3NpdGlvbihsaW5lSW5kZXggKyAxLCBjb21wdXRlZE1vZGVsQ29sdW1uKSk7CiAgICAgIGlmIChjb21wdXRlZE1vZGVsUG9zaXRpb24uZXF1YWxzKGV4cGVjdGVkTW9kZWxQb3NpdGlvbikpIHsKICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKHZpZXdMaW5lTnVtYmVyLCB2aWV3Q29sdW1uKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5jb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uKGV4cGVjdGVkTW9kZWxQb3NpdGlvbi5saW5lTnVtYmVyLCBleHBlY3RlZE1vZGVsUG9zaXRpb24uY29sdW1uKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZVZpZXdSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsaWRhdGVWaWV3UmFuZ2Uodmlld1JhbmdlLCBleHBlY3RlZE1vZGVsUmFuZ2UpIHsKICAgICAgdmFyIHZhbGlkVmlld1N0YXJ0ID0gdGhpcy52YWxpZGF0ZVZpZXdQb3NpdGlvbih2aWV3UmFuZ2Uuc3RhcnRMaW5lTnVtYmVyLCB2aWV3UmFuZ2Uuc3RhcnRDb2x1bW4sIGV4cGVjdGVkTW9kZWxSYW5nZS5nZXRTdGFydFBvc2l0aW9uKCkpOwogICAgICB2YXIgdmFsaWRWaWV3RW5kID0gdGhpcy52YWxpZGF0ZVZpZXdQb3NpdGlvbih2aWV3UmFuZ2UuZW5kTGluZU51bWJlciwgdmlld1JhbmdlLmVuZENvbHVtbiwgZXhwZWN0ZWRNb2RlbFJhbmdlLmdldEVuZFBvc2l0aW9uKCkpOwogICAgICByZXR1cm4gbmV3IFJhbmdlKHZhbGlkVmlld1N0YXJ0LmxpbmVOdW1iZXIsIHZhbGlkVmlld1N0YXJ0LmNvbHVtbiwgdmFsaWRWaWV3RW5kLmxpbmVOdW1iZXIsIHZhbGlkVmlld0VuZC5jb2x1bW4pOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbnZlcnRWaWV3UG9zaXRpb25Ub01vZGVsUG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRWaWV3UG9zaXRpb25Ub01vZGVsUG9zaXRpb24odmlld0xpbmVOdW1iZXIsIHZpZXdDb2x1bW4pIHsKICAgICAgdmFyIGluZm8gPSB0aGlzLmdldFZpZXdMaW5lSW5mbyh2aWV3TGluZU51bWJlcik7CiAgICAgIHZhciBpbnB1dENvbHVtbiA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbaW5mby5tb2RlbExpbmVOdW1iZXIgLSAxXS5nZXRNb2RlbENvbHVtbk9mVmlld1Bvc2l0aW9uKGluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHgsIHZpZXdDb2x1bW4pOwogICAgICAvLyBjb25zb2xlLmxvZygnb3V0IC0+IGluICcgKyB2aWV3TGluZU51bWJlciArICcsJyArIHZpZXdDb2x1bW4gKyAnID09PT4gJyArIChsaW5lSW5kZXgrMSkgKyAnLCcgKyBpbnB1dENvbHVtbik7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsLnZhbGlkYXRlUG9zaXRpb24obmV3IFBvc2l0aW9uKGluZm8ubW9kZWxMaW5lTnVtYmVyLCBpbnB1dENvbHVtbikpOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbnZlcnRWaWV3UmFuZ2VUb01vZGVsUmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRWaWV3UmFuZ2VUb01vZGVsUmFuZ2Uodmlld1JhbmdlKSB7CiAgICAgIHZhciBzdGFydCA9IHRoaXMuY29udmVydFZpZXdQb3NpdGlvblRvTW9kZWxQb3NpdGlvbih2aWV3UmFuZ2Uuc3RhcnRMaW5lTnVtYmVyLCB2aWV3UmFuZ2Uuc3RhcnRDb2x1bW4pOwogICAgICB2YXIgZW5kID0gdGhpcy5jb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uKHZpZXdSYW5nZS5lbmRMaW5lTnVtYmVyLCB2aWV3UmFuZ2UuZW5kQ29sdW1uKTsKICAgICAgcmV0dXJuIG5ldyBSYW5nZShzdGFydC5saW5lTnVtYmVyLCBzdGFydC5jb2x1bW4sIGVuZC5saW5lTnVtYmVyLCBlbmQuY29sdW1uKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uKF9tb2RlbExpbmVOdW1iZXIsIF9tb2RlbENvbHVtbikgewogICAgICB2YXIgYWZmaW5pdHkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDI7CiAgICAgIHZhciB2YWxpZFBvc2l0aW9uID0gdGhpcy5tb2RlbC52YWxpZGF0ZVBvc2l0aW9uKG5ldyBQb3NpdGlvbihfbW9kZWxMaW5lTnVtYmVyLCBfbW9kZWxDb2x1bW4pKTsKICAgICAgdmFyIGlucHV0TGluZU51bWJlciA9IHZhbGlkUG9zaXRpb24ubGluZU51bWJlcjsKICAgICAgdmFyIGlucHV0Q29sdW1uID0gdmFsaWRQb3NpdGlvbi5jb2x1bW47CiAgICAgIHZhciBsaW5lSW5kZXggPSBpbnB1dExpbmVOdW1iZXIgLSAxLAogICAgICAgIGxpbmVJbmRleENoYW5nZWQgPSBmYWxzZTsKICAgICAgd2hpbGUgKGxpbmVJbmRleCA+IDAgJiYgIXRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XS5pc1Zpc2libGUoKSkgewogICAgICAgIGxpbmVJbmRleC0tOwogICAgICAgIGxpbmVJbmRleENoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICAgIGlmIChsaW5lSW5kZXggPT09IDAgJiYgIXRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XS5pc1Zpc2libGUoKSkgewogICAgICAgIC8vIENvdWxkIG5vdCByZWFjaCBhIHJlYWwgbGluZQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdpbiAtPiBvdXQgJyArIGlucHV0TGluZU51bWJlciArICcsJyArIGlucHV0Q29sdW1uICsgJyA9PT0+ICcgKyAxICsgJywnICsgMSk7CiAgICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbigxLCAxKTsKICAgICAgfQogICAgICB2YXIgZGVsdGFMaW5lTnVtYmVyID0gMSArIHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0obGluZUluZGV4KTsKICAgICAgdmFyIHI7CiAgICAgIGlmIChsaW5lSW5kZXhDaGFuZ2VkKSB7CiAgICAgICAgciA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XS5nZXRWaWV3UG9zaXRpb25PZk1vZGVsUG9zaXRpb24oZGVsdGFMaW5lTnVtYmVyLCB0aGlzLm1vZGVsLmdldExpbmVNYXhDb2x1bW4obGluZUluZGV4ICsgMSksIGFmZmluaXR5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByID0gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tpbnB1dExpbmVOdW1iZXIgLSAxXS5nZXRWaWV3UG9zaXRpb25PZk1vZGVsUG9zaXRpb24oZGVsdGFMaW5lTnVtYmVyLCBpbnB1dENvbHVtbiwgYWZmaW5pdHkpOwogICAgICB9CiAgICAgIC8vIGNvbnNvbGUubG9nKCdpbiAtPiBvdXQgJyArIGlucHV0TGluZU51bWJlciArICcsJyArIGlucHV0Q29sdW1uICsgJyA9PT0+ICcgKyByLmxpbmVOdW1iZXIgKyAnLCcgKyByKTsKICAgICAgcmV0dXJuIHI7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBhZmZpbml0eSBUaGUgYWZmaW5pdHkgaW4gY2FzZSBvZiBhbiBlbXB0eSByYW5nZS4gSGFzIG5vIGVmZmVjdCBmb3Igbm9uLWVtcHR5IHJhbmdlcy4KICAgICovCiAgfSwgewogICAga2V5OiAiY29udmVydE1vZGVsUmFuZ2VUb1ZpZXdSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydE1vZGVsUmFuZ2VUb1ZpZXdSYW5nZShtb2RlbFJhbmdlKSB7CiAgICAgIHZhciBhZmZpbml0eSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMDsKICAgICAgaWYgKG1vZGVsUmFuZ2UuaXNFbXB0eSgpKSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5jb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uKG1vZGVsUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyLCBtb2RlbFJhbmdlLnN0YXJ0Q29sdW1uLCBhZmZpbml0eSk7CiAgICAgICAgcmV0dXJuIFJhbmdlLmZyb21Qb3NpdGlvbnMoc3RhcnQpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBfc3RhcnQgPSB0aGlzLmNvbnZlcnRNb2RlbFBvc2l0aW9uVG9WaWV3UG9zaXRpb24obW9kZWxSYW5nZS5zdGFydExpbmVOdW1iZXIsIG1vZGVsUmFuZ2Uuc3RhcnRDb2x1bW4sIDEgLyogUG9zaXRpb25BZmZpbml0eS5SaWdodCAqLyk7CiAgICAgICAgdmFyIGVuZCA9IHRoaXMuY29udmVydE1vZGVsUG9zaXRpb25Ub1ZpZXdQb3NpdGlvbihtb2RlbFJhbmdlLmVuZExpbmVOdW1iZXIsIG1vZGVsUmFuZ2UuZW5kQ29sdW1uLCAwIC8qIFBvc2l0aW9uQWZmaW5pdHkuTGVmdCAqLyk7CiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShfc3RhcnQubGluZU51bWJlciwgX3N0YXJ0LmNvbHVtbiwgZW5kLmxpbmVOdW1iZXIsIGVuZC5jb2x1bW4pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld0xpbmVOdW1iZXJPZk1vZGVsUG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lTnVtYmVyT2ZNb2RlbFBvc2l0aW9uKG1vZGVsTGluZU51bWJlciwgbW9kZWxDb2x1bW4pIHsKICAgICAgdmFyIGxpbmVJbmRleCA9IG1vZGVsTGluZU51bWJlciAtIDE7CiAgICAgIGlmICh0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2xpbmVJbmRleF0uaXNWaXNpYmxlKCkpIHsKICAgICAgICAvLyB0aGlzIG1vZGVsIGxpbmUgaXMgdmlzaWJsZQogICAgICAgIHZhciBfZGVsdGFMaW5lTnVtYmVyID0gMSArIHRoaXMucHJvamVjdGVkTW9kZWxMaW5lTGluZUNvdW50cy5nZXRQcmVmaXhTdW0obGluZUluZGV4KTsKICAgICAgICByZXR1cm4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tsaW5lSW5kZXhdLmdldFZpZXdMaW5lTnVtYmVyT2ZNb2RlbFBvc2l0aW9uKF9kZWx0YUxpbmVOdW1iZXIsIG1vZGVsQ29sdW1uKTsKICAgICAgfQogICAgICAvLyB0aGlzIG1vZGVsIGxpbmUgaXMgbm90IHZpc2libGUKICAgICAgd2hpbGUgKGxpbmVJbmRleCA+IDAgJiYgIXRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XS5pc1Zpc2libGUoKSkgewogICAgICAgIGxpbmVJbmRleC0tOwogICAgICB9CiAgICAgIGlmIChsaW5lSW5kZXggPT09IDAgJiYgIXRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbGluZUluZGV4XS5pc1Zpc2libGUoKSkgewogICAgICAgIC8vIENvdWxkIG5vdCByZWFjaCBhIHJlYWwgbGluZQogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICAgIHZhciBkZWx0YUxpbmVOdW1iZXIgPSAxICsgdGhpcy5wcm9qZWN0ZWRNb2RlbExpbmVMaW5lQ291bnRzLmdldFByZWZpeFN1bShsaW5lSW5kZXgpOwogICAgICByZXR1cm4gdGhpcy5tb2RlbExpbmVQcm9qZWN0aW9uc1tsaW5lSW5kZXhdLmdldFZpZXdMaW5lTnVtYmVyT2ZNb2RlbFBvc2l0aW9uKGRlbHRhTGluZU51bWJlciwgdGhpcy5tb2RlbC5nZXRMaW5lTWF4Q29sdW1uKGxpbmVJbmRleCArIDEpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXREZWNvcmF0aW9uc0luUmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERlY29yYXRpb25zSW5SYW5nZShyYW5nZSwgb3duZXJJZCwgZmlsdGVyT3V0VmFsaWRhdGlvbikgewogICAgICB2YXIgbW9kZWxTdGFydCA9IHRoaXMuY29udmVydFZpZXdQb3NpdGlvblRvTW9kZWxQb3NpdGlvbihyYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLnN0YXJ0Q29sdW1uKTsKICAgICAgdmFyIG1vZGVsRW5kID0gdGhpcy5jb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uKHJhbmdlLmVuZExpbmVOdW1iZXIsIHJhbmdlLmVuZENvbHVtbik7CiAgICAgIGlmIChtb2RlbEVuZC5saW5lTnVtYmVyIC0gbW9kZWxTdGFydC5saW5lTnVtYmVyIDw9IHJhbmdlLmVuZExpbmVOdW1iZXIgLSByYW5nZS5zdGFydExpbmVOdW1iZXIpIHsKICAgICAgICAvLyBtb3N0IGxpa2VseSB0aGVyZSBhcmUgbm8gaGlkZGVuIGxpbmVzID0+IGZhc3QgcGF0aAogICAgICAgIC8vIGZldGNoIGRlY29yYXRpb25zIGZyb20gY29sdW1uIDEgdG8gY292ZXIgdGhlIGNhc2Ugb2Ygd3JhcHBlZCBsaW5lcyB0aGF0IGhhdmUgd2hvbGUgbGluZSBkZWNvcmF0aW9ucyBhdCBjb2x1bW4gMQogICAgICAgIHJldHVybiB0aGlzLm1vZGVsLmdldERlY29yYXRpb25zSW5SYW5nZShuZXcgUmFuZ2UobW9kZWxTdGFydC5saW5lTnVtYmVyLCAxLCBtb2RlbEVuZC5saW5lTnVtYmVyLCBtb2RlbEVuZC5jb2x1bW4pLCBvd25lcklkLCBmaWx0ZXJPdXRWYWxpZGF0aW9uKTsKICAgICAgfQogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgIHZhciBtb2RlbFN0YXJ0TGluZUluZGV4ID0gbW9kZWxTdGFydC5saW5lTnVtYmVyIC0gMTsKICAgICAgdmFyIG1vZGVsRW5kTGluZUluZGV4ID0gbW9kZWxFbmQubGluZU51bWJlciAtIDE7CiAgICAgIHZhciByZXFTdGFydCA9IG51bGw7CiAgICAgIGZvciAodmFyIG1vZGVsTGluZUluZGV4ID0gbW9kZWxTdGFydExpbmVJbmRleDsgbW9kZWxMaW5lSW5kZXggPD0gbW9kZWxFbmRMaW5lSW5kZXg7IG1vZGVsTGluZUluZGV4KyspIHsKICAgICAgICB2YXIgbGluZSA9IHRoaXMubW9kZWxMaW5lUHJvamVjdGlvbnNbbW9kZWxMaW5lSW5kZXhdOwogICAgICAgIGlmIChsaW5lLmlzVmlzaWJsZSgpKSB7CiAgICAgICAgICAvLyBtZXJnZSBpbnRvIHByZXZpb3VzIHJlcXVlc3QKICAgICAgICAgIGlmIChyZXFTdGFydCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXFTdGFydCA9IG5ldyBQb3NpdGlvbihtb2RlbExpbmVJbmRleCArIDEsIG1vZGVsTGluZUluZGV4ID09PSBtb2RlbFN0YXJ0TGluZUluZGV4ID8gbW9kZWxTdGFydC5jb2x1bW4gOiAxKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gaGl0IGludmlzaWJsZSBsaW5lID0+IGZsdXNoIHJlcXVlc3QKICAgICAgICAgIGlmIChyZXFTdGFydCAhPT0gbnVsbCkgewogICAgICAgICAgICB2YXIgbWF4TGluZUNvbHVtbiA9IHRoaXMubW9kZWwuZ2V0TGluZU1heENvbHVtbihtb2RlbExpbmVJbmRleCk7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQodGhpcy5tb2RlbC5nZXREZWNvcmF0aW9uc0luUmFuZ2UobmV3IFJhbmdlKHJlcVN0YXJ0LmxpbmVOdW1iZXIsIHJlcVN0YXJ0LmNvbHVtbiwgbW9kZWxMaW5lSW5kZXgsIG1heExpbmVDb2x1bW4pLCBvd25lcklkLCBmaWx0ZXJPdXRWYWxpZGF0aW9uKSk7CiAgICAgICAgICAgIHJlcVN0YXJ0ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHJlcVN0YXJ0ICE9PSBudWxsKSB7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdCh0aGlzLm1vZGVsLmdldERlY29yYXRpb25zSW5SYW5nZShuZXcgUmFuZ2UocmVxU3RhcnQubGluZU51bWJlciwgcmVxU3RhcnQuY29sdW1uLCBtb2RlbEVuZC5saW5lTnVtYmVyLCBtb2RlbEVuZC5jb2x1bW4pLCBvd25lcklkLCBmaWx0ZXJPdXRWYWxpZGF0aW9uKSk7CiAgICAgICAgcmVxU3RhcnQgPSBudWxsOwogICAgICB9CiAgICAgIHJlc3VsdC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIHJlcyA9IFJhbmdlLmNvbXBhcmVSYW5nZXNVc2luZ1N0YXJ0cyhhLnJhbmdlLCBiLnJhbmdlKTsKICAgICAgICBpZiAocmVzID09PSAwKSB7CiAgICAgICAgICBpZiAoYS5pZCA8IGIuaWQpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGEuaWQgPiBiLmlkKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0pOwogICAgICAvLyBFbGltaW5hdGUgZHVwbGljYXRlIGRlY29yYXRpb25zIHRoYXQgbWlnaHQgaGF2ZSBpbnRlcnNlY3RlZCBvdXIgdmlzaWJsZSByYW5nZXMgbXVsdGlwbGUgdGltZXMKICAgICAgdmFyIGZpbmFsUmVzdWx0ID0gW107CiAgICAgIHZhciBmaW5hbFJlc3VsdExlbiA9IDA7CiAgICAgIHZhciBwcmV2RGVjSWQgPSBudWxsOwogICAgICB2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHJlc3VsdCksCiAgICAgICAgX3N0ZXAzOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgZGVjID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgdmFyIGRlY0lkID0gZGVjLmlkOwogICAgICAgICAgaWYgKHByZXZEZWNJZCA9PT0gZGVjSWQpIHsKICAgICAgICAgICAgLy8gc2tpcAogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHByZXZEZWNJZCA9IGRlY0lkOwogICAgICAgICAgZmluYWxSZXN1bHRbZmluYWxSZXN1bHRMZW4rK10gPSBkZWM7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IzLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IzLmYoKTsKICAgICAgfQogICAgICByZXR1cm4gZmluYWxSZXN1bHQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SW5qZWN0ZWRUZXh0QXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluamVjdGVkVGV4dEF0KHBvc2l0aW9uKSB7CiAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRWaWV3TGluZUluZm8ocG9zaXRpb24ubGluZU51bWJlcik7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2luZm8ubW9kZWxMaW5lTnVtYmVyIC0gMV0uZ2V0SW5qZWN0ZWRUZXh0QXQoaW5mby5tb2RlbExpbmVXcmFwcGVkTGluZUlkeCwgcG9zaXRpb24uY29sdW1uKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJub3JtYWxpemVQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbm9ybWFsaXplUG9zaXRpb24ocG9zaXRpb24sIGFmZmluaXR5KSB7CiAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRWaWV3TGluZUluZm8ocG9zaXRpb24ubGluZU51bWJlcik7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsTGluZVByb2plY3Rpb25zW2luZm8ubW9kZWxMaW5lTnVtYmVyIC0gMV0ubm9ybWFsaXplUG9zaXRpb24oaW5mby5tb2RlbExpbmVXcmFwcGVkTGluZUlkeCwgcG9zaXRpb24sIGFmZmluaXR5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMaW5lSW5kZW50Q29sdW1uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lSW5kZW50Q29sdW1uKGxpbmVOdW1iZXIpIHsKICAgICAgdmFyIGluZm8gPSB0aGlzLmdldFZpZXdMaW5lSW5mbyhsaW5lTnVtYmVyKTsKICAgICAgaWYgKGluZm8ubW9kZWxMaW5lV3JhcHBlZExpbmVJZHggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5nZXRMaW5lSW5kZW50Q29sdW1uKGluZm8ubW9kZWxMaW5lTnVtYmVyKTsKICAgICAgfQogICAgICAvLyB3cmFwcGVkIGxpbmVzIGhhdmUgbm8gaW5kZW50YXRpb24uCiAgICAgIC8vIFdlIGRlbGliZXJhdGVseSBkb24ndCBoYW5kbGUgdGhlIGNhc2UgdGhhdCBpbmRlbnRhdGlvbiBpcyB3cmFwcGVkCiAgICAgIC8vIHRvIGF2b2lkIHR3byB2aWV3IGxpbmVzIHJlcG9ydGluZyBpbmRlbnRhdGlvbiBmb3IgdGhlIHZlcnkgc2FtZSBtb2RlbCBsaW5lLgogICAgICByZXR1cm4gMDsKICAgIH0KICB9XSk7CiAgcmV0dXJuIFZpZXdNb2RlbExpbmVzRnJvbVByb2plY3RlZE1vZGVsOwp9KCk7Ci8qKgogKiBPdmVybGFwcGluZyB1bnNvcnRlZCByYW5nZXM6CiAqIFsgICApICAgICAgWyApICAgICAgIFsgICkKICogICAgWyAgICApICAgICAgWyAgICAgICApCiAqIC0+CiAqIE5vbiBvdmVybGFwcGluZyBzb3J0ZWQgcmFuZ2VzOgogKiBbICAgICAgICkgIFsgKSBbICAgICAgICApCiAqCiAqIE5vdGU6IFRoaXMgZnVuY3Rpb24gb25seSBjb25zaWRlcnMgbGluZSBpbmZvcm1hdGlvbiEgQ29sdW1ucyBhcmUgaWdub3JlZC4KKi8KZnVuY3Rpb24gbm9ybWFsaXplTGluZVJhbmdlcyhyYW5nZXMpIHsKICBpZiAocmFuZ2VzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIFtdOwogIH0KICB2YXIgc29ydGVkUmFuZ2VzID0gcmFuZ2VzLnNsaWNlKCk7CiAgc29ydGVkUmFuZ2VzLnNvcnQoUmFuZ2UuY29tcGFyZVJhbmdlc1VzaW5nU3RhcnRzKTsKICB2YXIgcmVzdWx0ID0gW107CiAgdmFyIGN1cnJlbnRSYW5nZVN0YXJ0ID0gc29ydGVkUmFuZ2VzWzBdLnN0YXJ0TGluZU51bWJlcjsKICB2YXIgY3VycmVudFJhbmdlRW5kID0gc29ydGVkUmFuZ2VzWzBdLmVuZExpbmVOdW1iZXI7CiAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IHNvcnRlZFJhbmdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgdmFyIHJhbmdlID0gc29ydGVkUmFuZ2VzW2ldOwogICAgaWYgKHJhbmdlLnN0YXJ0TGluZU51bWJlciA+IGN1cnJlbnRSYW5nZUVuZCArIDEpIHsKICAgICAgcmVzdWx0LnB1c2gobmV3IFJhbmdlKGN1cnJlbnRSYW5nZVN0YXJ0LCAxLCBjdXJyZW50UmFuZ2VFbmQsIDEpKTsKICAgICAgY3VycmVudFJhbmdlU3RhcnQgPSByYW5nZS5zdGFydExpbmVOdW1iZXI7CiAgICAgIGN1cnJlbnRSYW5nZUVuZCA9IHJhbmdlLmVuZExpbmVOdW1iZXI7CiAgICB9IGVsc2UgaWYgKHJhbmdlLmVuZExpbmVOdW1iZXIgPiBjdXJyZW50UmFuZ2VFbmQpIHsKICAgICAgY3VycmVudFJhbmdlRW5kID0gcmFuZ2UuZW5kTGluZU51bWJlcjsKICAgIH0KICB9CiAgcmVzdWx0LnB1c2gobmV3IFJhbmdlKGN1cnJlbnRSYW5nZVN0YXJ0LCAxLCBjdXJyZW50UmFuZ2VFbmQsIDEpKTsKICByZXR1cm4gcmVzdWx0Owp9Ci8qKgogKiBSZXByZXNlbnRzIGEgdmlldyBsaW5lLiBDYW4gYmUgdXNlZCB0byBlZmZpY2llbnRseSBxdWVyeSBtb3JlIGluZm9ybWF0aW9uIGFib3V0IGl0LgogKi8KdmFyIFZpZXdMaW5lSW5mbyA9IC8qI19fUFVSRV9fKi9fY3JlYXRlQ2xhc3MoZnVuY3Rpb24gVmlld0xpbmVJbmZvKG1vZGVsTGluZU51bWJlciwgbW9kZWxMaW5lV3JhcHBlZExpbmVJZHgpIHsKICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmlld0xpbmVJbmZvKTsKICB0aGlzLm1vZGVsTGluZU51bWJlciA9IG1vZGVsTGluZU51bWJlcjsKICB0aGlzLm1vZGVsTGluZVdyYXBwZWRMaW5lSWR4ID0gbW9kZWxMaW5lV3JhcHBlZExpbmVJZHg7Cn0pOwovKioKICogQSBsaXN0IG9mIHZpZXcgbGluZXMgdGhhdCBoYXZlIGEgY29udGlndW91cyBzcGFuIGluIHRoZSBtb2RlbC4KKi8KdmFyIFZpZXdMaW5lSW5mb0dyb3VwZWRCeU1vZGVsUmFuZ2UgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZUNsYXNzKGZ1bmN0aW9uIFZpZXdMaW5lSW5mb0dyb3VwZWRCeU1vZGVsUmFuZ2UobW9kZWxSYW5nZSwgdmlld0xpbmVzKSB7CiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFZpZXdMaW5lSW5mb0dyb3VwZWRCeU1vZGVsUmFuZ2UpOwogIHRoaXMubW9kZWxSYW5nZSA9IG1vZGVsUmFuZ2U7CiAgdGhpcy52aWV3TGluZXMgPSB2aWV3TGluZXM7Cn0pOwp2YXIgQ29vcmRpbmF0ZXNDb252ZXJ0ZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIENvb3JkaW5hdGVzQ29udmVydGVyKGxpbmVzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29vcmRpbmF0ZXNDb252ZXJ0ZXIpOwogICAgdGhpcy5fbGluZXMgPSBsaW5lczsKICB9CiAgLy8gVmlldyAtPiBNb2RlbCBjb252ZXJzaW9uIGFuZCByZWxhdGVkIG1ldGhvZHMKICBfY3JlYXRlQ2xhc3MoQ29vcmRpbmF0ZXNDb252ZXJ0ZXIsIFt7CiAgICBrZXk6ICJjb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uKHZpZXdQb3NpdGlvbikgewogICAgICByZXR1cm4gdGhpcy5fbGluZXMuY29udmVydFZpZXdQb3NpdGlvblRvTW9kZWxQb3NpdGlvbih2aWV3UG9zaXRpb24ubGluZU51bWJlciwgdmlld1Bvc2l0aW9uLmNvbHVtbik7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29udmVydFZpZXdSYW5nZVRvTW9kZWxSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydFZpZXdSYW5nZVRvTW9kZWxSYW5nZSh2aWV3UmFuZ2UpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLmNvbnZlcnRWaWV3UmFuZ2VUb01vZGVsUmFuZ2Uodmlld1JhbmdlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ2YWxpZGF0ZVZpZXdQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdmFsaWRhdGVWaWV3UG9zaXRpb24odmlld1Bvc2l0aW9uLCBleHBlY3RlZE1vZGVsUG9zaXRpb24pIHsKICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLnZhbGlkYXRlVmlld1Bvc2l0aW9uKHZpZXdQb3NpdGlvbi5saW5lTnVtYmVyLCB2aWV3UG9zaXRpb24uY29sdW1uLCBleHBlY3RlZE1vZGVsUG9zaXRpb24pOwogICAgfQogIH0sIHsKICAgIGtleTogInZhbGlkYXRlVmlld1JhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZVZpZXdSYW5nZSh2aWV3UmFuZ2UsIGV4cGVjdGVkTW9kZWxSYW5nZSkgewogICAgICByZXR1cm4gdGhpcy5fbGluZXMudmFsaWRhdGVWaWV3UmFuZ2Uodmlld1JhbmdlLCBleHBlY3RlZE1vZGVsUmFuZ2UpOwogICAgfQogICAgLy8gTW9kZWwgLT4gVmlldyBjb252ZXJzaW9uIGFuZCByZWxhdGVkIG1ldGhvZHMKICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uKG1vZGVsUG9zaXRpb24sIGFmZmluaXR5KSB7CiAgICAgIHJldHVybiB0aGlzLl9saW5lcy5jb252ZXJ0TW9kZWxQb3NpdGlvblRvVmlld1Bvc2l0aW9uKG1vZGVsUG9zaXRpb24ubGluZU51bWJlciwgbW9kZWxQb3NpdGlvbi5jb2x1bW4sIGFmZmluaXR5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0TW9kZWxSYW5nZVRvVmlld1JhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0TW9kZWxSYW5nZVRvVmlld1JhbmdlKG1vZGVsUmFuZ2UsIGFmZmluaXR5KSB7CiAgICAgIHJldHVybiB0aGlzLl9saW5lcy5jb252ZXJ0TW9kZWxSYW5nZVRvVmlld1JhbmdlKG1vZGVsUmFuZ2UsIGFmZmluaXR5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtb2RlbFBvc2l0aW9uSXNWaXNpYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtb2RlbFBvc2l0aW9uSXNWaXNpYmxlKG1vZGVsUG9zaXRpb24pIHsKICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLm1vZGVsUG9zaXRpb25Jc1Zpc2libGUobW9kZWxQb3NpdGlvbi5saW5lTnVtYmVyLCBtb2RlbFBvc2l0aW9uLmNvbHVtbik7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TW9kZWxMaW5lVmlld0xpbmVDb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TW9kZWxMaW5lVmlld0xpbmVDb3VudChtb2RlbExpbmVOdW1iZXIpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLmdldE1vZGVsTGluZVZpZXdMaW5lQ291bnQobW9kZWxMaW5lTnVtYmVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZU51bWJlck9mTW9kZWxQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVOdW1iZXJPZk1vZGVsUG9zaXRpb24obW9kZWxMaW5lTnVtYmVyLCBtb2RlbENvbHVtbikgewogICAgICByZXR1cm4gdGhpcy5fbGluZXMuZ2V0Vmlld0xpbmVOdW1iZXJPZk1vZGVsUG9zaXRpb24obW9kZWxMaW5lTnVtYmVyLCBtb2RlbENvbHVtbik7CiAgICB9CiAgfV0pOwogIHJldHVybiBDb29yZGluYXRlc0NvbnZlcnRlcjsKfSgpOwpleHBvcnQgdmFyIFZpZXdNb2RlbExpbmVzRnJvbU1vZGVsQXNJcyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gVmlld01vZGVsTGluZXNGcm9tTW9kZWxBc0lzKG1vZGVsKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmlld01vZGVsTGluZXNGcm9tTW9kZWxBc0lzKTsKICAgIHRoaXMubW9kZWwgPSBtb2RlbDsKICB9CiAgX2NyZWF0ZUNsYXNzKFZpZXdNb2RlbExpbmVzRnJvbU1vZGVsQXNJcywgW3sKICAgIGtleTogImRpc3Bvc2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7fQogIH0sIHsKICAgIGtleTogImNyZWF0ZUNvb3JkaW5hdGVzQ29udmVydGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDb29yZGluYXRlc0NvbnZlcnRlcigpIHsKICAgICAgcmV0dXJuIG5ldyBJZGVudGl0eUNvb3JkaW5hdGVzQ29udmVydGVyKHRoaXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEhpZGRlbkFyZWFzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRIaWRkZW5BcmVhcygpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEhpZGRlbkFyZWFzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRIaWRkZW5BcmVhcyhfcmFuZ2VzKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRUYWJTaXplIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUYWJTaXplKF9uZXdUYWJTaXplKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRXcmFwcGluZ1NldHRpbmdzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRXcmFwcGluZ1NldHRpbmdzKF9mb250SW5mbywgX3dyYXBwaW5nU3RyYXRlZ3ksIF93cmFwcGluZ0NvbHVtbiwgX3dyYXBwaW5nSW5kZW50KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVMaW5lQnJlYWtzQ29tcHV0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUxpbmVCcmVha3NDb21wdXRlcigpIHsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICByZXR1cm4gewogICAgICAgIGFkZFJlcXVlc3Q6IGZ1bmN0aW9uIGFkZFJlcXVlc3QobGluZVRleHQsIGluamVjdGVkVGV4dCwgcHJldmlvdXNMaW5lQnJlYWtEYXRhKSB7CiAgICAgICAgICByZXN1bHQucHVzaChudWxsKTsKICAgICAgICB9LAogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbiBmaW5hbGl6ZSgpIHsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogIm9uTW9kZWxGbHVzaGVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vZGVsRmx1c2hlZCgpIHt9CiAgfSwgewogICAga2V5OiAib25Nb2RlbExpbmVzRGVsZXRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb2RlbExpbmVzRGVsZXRlZChfdmVyc2lvbklkLCBmcm9tTGluZU51bWJlciwgdG9MaW5lTnVtYmVyKSB7CiAgICAgIHJldHVybiBuZXcgdmlld0V2ZW50cy5WaWV3TGluZXNEZWxldGVkRXZlbnQoZnJvbUxpbmVOdW1iZXIsIHRvTGluZU51bWJlcik7CiAgICB9CiAgfSwgewogICAga2V5OiAib25Nb2RlbExpbmVzSW5zZXJ0ZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uTW9kZWxMaW5lc0luc2VydGVkKF92ZXJzaW9uSWQsIGZyb21MaW5lTnVtYmVyLCB0b0xpbmVOdW1iZXIsIGxpbmVCcmVha3MpIHsKICAgICAgcmV0dXJuIG5ldyB2aWV3RXZlbnRzLlZpZXdMaW5lc0luc2VydGVkRXZlbnQoZnJvbUxpbmVOdW1iZXIsIHRvTGluZU51bWJlcik7CiAgICB9CiAgfSwgewogICAga2V5OiAib25Nb2RlbExpbmVDaGFuZ2VkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vZGVsTGluZUNoYW5nZWQoX3ZlcnNpb25JZCwgbGluZU51bWJlciwgbGluZUJyZWFrRGF0YSkgewogICAgICByZXR1cm4gW2ZhbHNlLCBuZXcgdmlld0V2ZW50cy5WaWV3TGluZXNDaGFuZ2VkRXZlbnQobGluZU51bWJlciwgMSksIG51bGwsIG51bGxdOwogICAgfQogIH0sIHsKICAgIGtleTogImFjY2VwdFZlcnNpb25JZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWNjZXB0VmVyc2lvbklkKF92ZXJzaW9uSWQpIHt9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld0xpbmVDb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVDb3VudCgpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWwuZ2V0TGluZUNvdW50KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QWN0aXZlSW5kZW50R3VpZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFjdGl2ZUluZGVudEd1aWRlKHZpZXdMaW5lTnVtYmVyLCBfbWluTGluZU51bWJlciwgX21heExpbmVOdW1iZXIpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdGFydExpbmVOdW1iZXI6IHZpZXdMaW5lTnVtYmVyLAogICAgICAgIGVuZExpbmVOdW1iZXI6IHZpZXdMaW5lTnVtYmVyLAogICAgICAgIGluZGVudDogMAogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZpZXdMaW5lc0JyYWNrZXRHdWlkZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lc0JyYWNrZXRHdWlkZXMoc3RhcnRMaW5lTnVtYmVyLCBlbmRMaW5lTnVtYmVyLCBhY3RpdmVQb3NpdGlvbikgewogICAgICByZXR1cm4gbmV3IEFycmF5KGVuZExpbmVOdW1iZXIgLSBzdGFydExpbmVOdW1iZXIgKyAxKS5maWxsKFtdKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZXNJbmRlbnRHdWlkZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lc0luZGVudEd1aWRlcyh2aWV3U3RhcnRMaW5lTnVtYmVyLCB2aWV3RW5kTGluZU51bWJlcikgewogICAgICB2YXIgdmlld0xpbmVDb3VudCA9IHZpZXdFbmRMaW5lTnVtYmVyIC0gdmlld1N0YXJ0TGluZU51bWJlciArIDE7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgQXJyYXkodmlld0xpbmVDb3VudCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlld0xpbmVDb3VudDsgaSsrKSB7CiAgICAgICAgcmVzdWx0W2ldID0gMDsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZpZXdMaW5lQ29udGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVDb250ZW50KHZpZXdMaW5lTnVtYmVyKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsLmdldExpbmVDb250ZW50KHZpZXdMaW5lTnVtYmVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZUxlbmd0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVMZW5ndGgodmlld0xpbmVOdW1iZXIpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWwuZ2V0TGluZUxlbmd0aCh2aWV3TGluZU51bWJlcik7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld0xpbmVNaW5Db2x1bW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lTWluQ29sdW1uKHZpZXdMaW5lTnVtYmVyKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsLmdldExpbmVNaW5Db2x1bW4odmlld0xpbmVOdW1iZXIpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZpZXdMaW5lTWF4Q29sdW1uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaWV3TGluZU1heENvbHVtbih2aWV3TGluZU51bWJlcikgewogICAgICByZXR1cm4gdGhpcy5tb2RlbC5nZXRMaW5lTWF4Q29sdW1uKHZpZXdMaW5lTnVtYmVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lRGF0YSh2aWV3TGluZU51bWJlcikgewogICAgICB2YXIgbGluZVRva2VucyA9IHRoaXMubW9kZWwudG9rZW5pemF0aW9uLmdldExpbmVUb2tlbnModmlld0xpbmVOdW1iZXIpOwogICAgICB2YXIgbGluZUNvbnRlbnQgPSBsaW5lVG9rZW5zLmdldExpbmVDb250ZW50KCk7CiAgICAgIHJldHVybiBuZXcgVmlld0xpbmVEYXRhKGxpbmVDb250ZW50LCBmYWxzZSwgMSwgbGluZUNvbnRlbnQubGVuZ3RoICsgMSwgMCwgbGluZVRva2Vucy5pbmZsYXRlKCksIG51bGwpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFZpZXdMaW5lc0RhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdMaW5lc0RhdGEodmlld1N0YXJ0TGluZU51bWJlciwgdmlld0VuZExpbmVOdW1iZXIsIG5lZWRlZCkgewogICAgICB2YXIgbGluZUNvdW50ID0gdGhpcy5tb2RlbC5nZXRMaW5lQ291bnQoKTsKICAgICAgdmlld1N0YXJ0TGluZU51bWJlciA9IE1hdGgubWluKE1hdGgubWF4KDEsIHZpZXdTdGFydExpbmVOdW1iZXIpLCBsaW5lQ291bnQpOwogICAgICB2aWV3RW5kTGluZU51bWJlciA9IE1hdGgubWluKE1hdGgubWF4KDEsIHZpZXdFbmRMaW5lTnVtYmVyKSwgbGluZUNvdW50KTsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICBmb3IgKHZhciBsaW5lTnVtYmVyID0gdmlld1N0YXJ0TGluZU51bWJlcjsgbGluZU51bWJlciA8PSB2aWV3RW5kTGluZU51bWJlcjsgbGluZU51bWJlcisrKSB7CiAgICAgICAgdmFyIGlkeCA9IGxpbmVOdW1iZXIgLSB2aWV3U3RhcnRMaW5lTnVtYmVyOwogICAgICAgIHJlc3VsdFtpZHhdID0gbmVlZGVkW2lkeF0gPyB0aGlzLmdldFZpZXdMaW5lRGF0YShsaW5lTnVtYmVyKSA6IG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXREZWNvcmF0aW9uc0luUmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERlY29yYXRpb25zSW5SYW5nZShyYW5nZSwgb3duZXJJZCwgZmlsdGVyT3V0VmFsaWRhdGlvbikgewogICAgICByZXR1cm4gdGhpcy5tb2RlbC5nZXREZWNvcmF0aW9uc0luUmFuZ2UocmFuZ2UsIG93bmVySWQsIGZpbHRlck91dFZhbGlkYXRpb24pOwogICAgfQogIH0sIHsKICAgIGtleTogIm5vcm1hbGl6ZVBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBub3JtYWxpemVQb3NpdGlvbihwb3NpdGlvbiwgYWZmaW5pdHkpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWwubm9ybWFsaXplUG9zaXRpb24ocG9zaXRpb24sIGFmZmluaXR5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMaW5lSW5kZW50Q29sdW1uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lSW5kZW50Q29sdW1uKGxpbmVOdW1iZXIpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWwuZ2V0TGluZUluZGVudENvbHVtbihsaW5lTnVtYmVyKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJbmplY3RlZFRleHRBdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5qZWN0ZWRUZXh0QXQocG9zaXRpb24pIHsKICAgICAgLy8gSWRlbnRpdHkgbGluZXMgY29sbGVjdGlvbiBkb2VzIG5vdCBzdXBwb3J0IGluamVjdGVkIHRleHQuCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH1dKTsKICByZXR1cm4gVmlld01vZGVsTGluZXNGcm9tTW9kZWxBc0lzOwp9KCk7CnZhciBJZGVudGl0eUNvb3JkaW5hdGVzQ29udmVydGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBJZGVudGl0eUNvb3JkaW5hdGVzQ29udmVydGVyKGxpbmVzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSWRlbnRpdHlDb29yZGluYXRlc0NvbnZlcnRlcik7CiAgICB0aGlzLl9saW5lcyA9IGxpbmVzOwogIH0KICBfY3JlYXRlQ2xhc3MoSWRlbnRpdHlDb29yZGluYXRlc0NvbnZlcnRlciwgW3sKICAgIGtleTogIl92YWxpZFBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdmFsaWRQb3NpdGlvbihwb3MpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLm1vZGVsLnZhbGlkYXRlUG9zaXRpb24ocG9zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdmFsaWRSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ZhbGlkUmFuZ2UocmFuZ2UpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLm1vZGVsLnZhbGlkYXRlUmFuZ2UocmFuZ2UpOwogICAgfQogICAgLy8gVmlldyAtPiBNb2RlbCBjb252ZXJzaW9uIGFuZCByZWxhdGVkIG1ldGhvZHMKICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0Vmlld1Bvc2l0aW9uVG9Nb2RlbFBvc2l0aW9uKHZpZXdQb3NpdGlvbikgewogICAgICByZXR1cm4gdGhpcy5fdmFsaWRQb3NpdGlvbih2aWV3UG9zaXRpb24pOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbnZlcnRWaWV3UmFuZ2VUb01vZGVsUmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRWaWV3UmFuZ2VUb01vZGVsUmFuZ2Uodmlld1JhbmdlKSB7CiAgICAgIHJldHVybiB0aGlzLl92YWxpZFJhbmdlKHZpZXdSYW5nZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidmFsaWRhdGVWaWV3UG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlVmlld1Bvc2l0aW9uKF92aWV3UG9zaXRpb24sIGV4cGVjdGVkTW9kZWxQb3NpdGlvbikgewogICAgICByZXR1cm4gdGhpcy5fdmFsaWRQb3NpdGlvbihleHBlY3RlZE1vZGVsUG9zaXRpb24pOwogICAgfQogIH0sIHsKICAgIGtleTogInZhbGlkYXRlVmlld1JhbmdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZVZpZXdSYW5nZShfdmlld1JhbmdlLCBleHBlY3RlZE1vZGVsUmFuZ2UpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ZhbGlkUmFuZ2UoZXhwZWN0ZWRNb2RlbFJhbmdlKTsKICAgIH0KICAgIC8vIE1vZGVsIC0+IFZpZXcgY29udmVyc2lvbiBhbmQgcmVsYXRlZCBtZXRob2RzCiAgfSwgewogICAga2V5OiAiY29udmVydE1vZGVsUG9zaXRpb25Ub1ZpZXdQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydE1vZGVsUG9zaXRpb25Ub1ZpZXdQb3NpdGlvbihtb2RlbFBvc2l0aW9uKSB7CiAgICAgIHJldHVybiB0aGlzLl92YWxpZFBvc2l0aW9uKG1vZGVsUG9zaXRpb24pOwogICAgfQogIH0sIHsKICAgIGtleTogImNvbnZlcnRNb2RlbFJhbmdlVG9WaWV3UmFuZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRNb2RlbFJhbmdlVG9WaWV3UmFuZ2UobW9kZWxSYW5nZSkgewogICAgICByZXR1cm4gdGhpcy5fdmFsaWRSYW5nZShtb2RlbFJhbmdlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtb2RlbFBvc2l0aW9uSXNWaXNpYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtb2RlbFBvc2l0aW9uSXNWaXNpYmxlKG1vZGVsUG9zaXRpb24pIHsKICAgICAgdmFyIGxpbmVDb3VudCA9IHRoaXMuX2xpbmVzLm1vZGVsLmdldExpbmVDb3VudCgpOwogICAgICBpZiAobW9kZWxQb3NpdGlvbi5saW5lTnVtYmVyIDwgMSB8fCBtb2RlbFBvc2l0aW9uLmxpbmVOdW1iZXIgPiBsaW5lQ291bnQpIHsKICAgICAgICAvLyBpbnZhbGlkIGFyZ3VtZW50cwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNb2RlbExpbmVWaWV3TGluZUNvdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNb2RlbExpbmVWaWV3TGluZUNvdW50KG1vZGVsTGluZU51bWJlcikgewogICAgICByZXR1cm4gMTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRWaWV3TGluZU51bWJlck9mTW9kZWxQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld0xpbmVOdW1iZXJPZk1vZGVsUG9zaXRpb24obW9kZWxMaW5lTnVtYmVyLCBtb2RlbENvbHVtbikgewogICAgICByZXR1cm4gbW9kZWxMaW5lTnVtYmVyOwogICAgfQogIH1dKTsKICByZXR1cm4gSWRlbnRpdHlDb29yZGluYXRlc0NvbnZlcnRlcjsKfSgpOw=="},{"version":3,"names":["arrays","Position","Range","IndentGuide","IndentGuideHorizontalLine","ModelDecorationOptions","LineInjectedText","viewEvents","createModelLineProjection","ConstantTimePrefixSumComputer","ViewLineData","ViewModelLinesFromProjectedModel","editorId","model","domLineBreaksComputerFactory","monospaceLineBreaksComputerFactory","fontInfo","tabSize","wrappingStrategy","wrappingColumn","wrappingIndent","_editorId","_validModelVersionId","_domLineBreaksComputerFactory","_monospaceLineBreaksComputerFactory","_constructLines","hiddenAreasDecorationIds","deltaDecorations","CoordinatesConverter","resetHiddenAreas","previousLineBreaks","modelLineProjections","linesContent","getLinesContent","injectedTextDecorations","getInjectedTextDecorations","lineCount","length","lineBreaksComputer","createLineBreaksComputer","injectedTextQueue","ArrayQueue","fromDecorations","i","lineInjectedText","takeWhile","t","lineNumber","addRequest","linesBreaks","finalize","values","hiddenAreas","map","areaId","getDecorationRange","sort","compareRangesUsingStarts","hiddenAreaStart","hiddenAreaEnd","hiddenAreaIdx","nextLineNumberToUpdateHiddenArea","startLineNumber","endLineNumber","isInHiddenArea","line","getViewLineCount","getVersionId","projectedModelLineLineCounts","decId","_ranges","validatedRanges","r","validateRange","newRanges","normalizeLineRanges","oldRanges","hasDifference","equalsRange","newDecorations","range","options","EMPTY","hasVisibleLine","lineChanged","isVisible","setVisible","newOutputLineCount","setValue","setHiddenAreas","modelLineNumber","_modelColumn","newTabSize","equalFontInfo","equals","equalWrappingStrategy","equalWrappingColumn","equalWrappingIndent","onlyWrappingColumnChanged","len","getProjectionData","lineBreaksComputerFactory","versionId","fromLineNumber","toLineNumber","outputFromLineNumber","getPrefixSum","outputToLineNumber","splice","removeValues","ViewLinesDeletedEvent","_toLineNumber","lineBreaks","totalOutputLineCount","insertLines","insertPrefixSumValues","push","outputLineCount","slice","concat","insertValues","ViewLinesInsertedEvent","lineBreakData","lineIndex","oldOutputLineCount","lineMappingChanged","changeFrom","changeTo","insertFrom","insertTo","deleteFrom","deleteTo","viewLinesChangedEvent","ViewLinesChangedEvent","viewLinesInsertedEvent","viewLinesDeletedEvent","getTotalSum","viewLineNumber","viewLineCount","minLineNumber","maxLineNumber","_toValidViewLineNumber","modelPosition","convertViewPositionToModelPosition","getViewLineMinColumn","modelMinPosition","modelMaxPosition","result","guides","getActiveIndentGuide","viewStartPosition","convertModelPositionToViewPosition","viewEndPosition","getLineMaxColumn","indent","getIndexOf","index","remainder","ViewLineInfo","viewLineInfo","modelLineWrappedLineIdx","getViewLineMaxColumn","minViewColumn","column","getModelColumnOfViewPosition","maxViewColumn","viewStartLineNumber","viewEndLineNumber","startViewLine","getViewLineInfo","endViewLine","Array","lastVisibleModelPos","getModelStartPositionOfViewLine","viewLines","curModelLine","startOffset","endOffset","lastVisibleModelPos2","modelRange","fromPositions","ViewLineInfoGroupedByModelRange","getModelEndPositionOfViewLine","activeViewPosition","modelActivePosition","resultPerViewLine","getViewLineInfosGroupedByModelRanges","group","modelRangeStartLineNumber","bracketGuidesPerModelLine","getLinesBracketGuides","bracketGuides","g","forWrappedLinesAfterColumn","p","getViewPositionOfModelPosition","undefined","forWrappedLinesBeforeOrAtColumn","horizontalLine","getMinColumnOfViewLine","viewPosition","endColumn","visibleColumn","className","top","getMaxColumnOfViewLine","filter","modelStart","modelEnd","resultRepeatCount","resultRepeatOption","modelStartLineIndex","modelEndLineIndex","reqStart","modelLineIndex","viewLineStartIndex","getViewLineNumberOfModelPosition","viewLineEndIndex","count","option","getLinesIndentGuides","viewIndents","currIndex","value","Math","min","blockAtIndex","j","info","getViewLineContent","getViewLineLength","getViewLineData","needed","start","startModelLineIndex","startRemainder","getLineCount","fromViewLineIndex","remainingViewLineCount","lastLine","getViewLinesData","viewColumn","expectedModelPosition","minColumn","maxColumn","computedModelColumn","computedModelPosition","validatePosition","viewRange","expectedModelRange","validViewStart","validateViewPosition","startColumn","getStartPosition","validViewEnd","getEndPosition","inputColumn","end","_modelLineNumber","affinity","validPosition","inputLineNumber","lineIndexChanged","deltaLineNumber","isEmpty","modelColumn","ownerId","filterOutValidation","getDecorationsInRange","maxLineColumn","a","b","res","id","finalResult","finalResultLen","prevDecId","dec","position","getInjectedTextAt","normalizePosition","getLineIndentColumn","ranges","sortedRanges","currentRangeStart","currentRangeEnd","lines","_lines","convertViewRangeToModelRange","validateViewRange","convertModelRangeToViewRange","modelPositionIsVisible","getModelLineViewLineCount","ViewModelLinesFromModelAsIs","IdentityCoordinatesConverter","_newTabSize","_fontInfo","_wrappingStrategy","_wrappingColumn","_wrappingIndent","lineText","injectedText","previousLineBreakData","_versionId","_minLineNumber","_maxLineNumber","activePosition","fill","getLineContent","getLineLength","getLineMinColumn","lineTokens","tokenization","getLineTokens","lineContent","inflate","max","idx","pos","_validPosition","_validRange","_viewPosition","_viewRange"],"sources":["/Users/yanjiajia/Desktop/workspace/avue-data-new/node_modules/monaco-editor/esm/vs/editor/common/viewModel/viewModelLines.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as arrays from '../../../base/common/arrays.js';\nimport { Position } from '../core/position.js';\nimport { Range } from '../core/range.js';\nimport { IndentGuide, IndentGuideHorizontalLine } from '../textModelGuides.js';\nimport { ModelDecorationOptions } from '../model/textModel.js';\nimport { LineInjectedText } from '../textModelEvents.js';\nimport * as viewEvents from '../viewEvents.js';\nimport { createModelLineProjection } from './modelLineProjection.js';\nimport { ConstantTimePrefixSumComputer } from '../model/prefixSumComputer.js';\nimport { ViewLineData } from '../viewModel.js';\nexport class ViewModelLinesFromProjectedModel {\n    constructor(editorId, model, domLineBreaksComputerFactory, monospaceLineBreaksComputerFactory, fontInfo, tabSize, wrappingStrategy, wrappingColumn, wrappingIndent) {\n        this._editorId = editorId;\n        this.model = model;\n        this._validModelVersionId = -1;\n        this._domLineBreaksComputerFactory = domLineBreaksComputerFactory;\n        this._monospaceLineBreaksComputerFactory = monospaceLineBreaksComputerFactory;\n        this.fontInfo = fontInfo;\n        this.tabSize = tabSize;\n        this.wrappingStrategy = wrappingStrategy;\n        this.wrappingColumn = wrappingColumn;\n        this.wrappingIndent = wrappingIndent;\n        this._constructLines(/*resetHiddenAreas*/ true, null);\n    }\n    dispose() {\n        this.hiddenAreasDecorationIds = this.model.deltaDecorations(this.hiddenAreasDecorationIds, []);\n    }\n    createCoordinatesConverter() {\n        return new CoordinatesConverter(this);\n    }\n    _constructLines(resetHiddenAreas, previousLineBreaks) {\n        this.modelLineProjections = [];\n        if (resetHiddenAreas) {\n            this.hiddenAreasDecorationIds = this.model.deltaDecorations(this.hiddenAreasDecorationIds, []);\n        }\n        const linesContent = this.model.getLinesContent();\n        const injectedTextDecorations = this.model.getInjectedTextDecorations(this._editorId);\n        const lineCount = linesContent.length;\n        const lineBreaksComputer = this.createLineBreaksComputer();\n        const injectedTextQueue = new arrays.ArrayQueue(LineInjectedText.fromDecorations(injectedTextDecorations));\n        for (let i = 0; i < lineCount; i++) {\n            const lineInjectedText = injectedTextQueue.takeWhile(t => t.lineNumber === i + 1);\n            lineBreaksComputer.addRequest(linesContent[i], lineInjectedText, previousLineBreaks ? previousLineBreaks[i] : null);\n        }\n        const linesBreaks = lineBreaksComputer.finalize();\n        const values = [];\n        const hiddenAreas = this.hiddenAreasDecorationIds.map((areaId) => this.model.getDecorationRange(areaId)).sort(Range.compareRangesUsingStarts);\n        let hiddenAreaStart = 1, hiddenAreaEnd = 0;\n        let hiddenAreaIdx = -1;\n        let nextLineNumberToUpdateHiddenArea = (hiddenAreaIdx + 1 < hiddenAreas.length) ? hiddenAreaEnd + 1 : lineCount + 2;\n        for (let i = 0; i < lineCount; i++) {\n            const lineNumber = i + 1;\n            if (lineNumber === nextLineNumberToUpdateHiddenArea) {\n                hiddenAreaIdx++;\n                hiddenAreaStart = hiddenAreas[hiddenAreaIdx].startLineNumber;\n                hiddenAreaEnd = hiddenAreas[hiddenAreaIdx].endLineNumber;\n                nextLineNumberToUpdateHiddenArea = (hiddenAreaIdx + 1 < hiddenAreas.length) ? hiddenAreaEnd + 1 : lineCount + 2;\n            }\n            const isInHiddenArea = (lineNumber >= hiddenAreaStart && lineNumber <= hiddenAreaEnd);\n            const line = createModelLineProjection(linesBreaks[i], !isInHiddenArea);\n            values[i] = line.getViewLineCount();\n            this.modelLineProjections[i] = line;\n        }\n        this._validModelVersionId = this.model.getVersionId();\n        this.projectedModelLineLineCounts = new ConstantTimePrefixSumComputer(values);\n    }\n    getHiddenAreas() {\n        return this.hiddenAreasDecorationIds.map((decId) => this.model.getDecorationRange(decId));\n    }\n    setHiddenAreas(_ranges) {\n        const validatedRanges = _ranges.map(r => this.model.validateRange(r));\n        const newRanges = normalizeLineRanges(validatedRanges);\n        // TODO@Martin: Please stop calling this method on each model change!\n        // This checks if there really was a change\n        const oldRanges = this.hiddenAreasDecorationIds.map((areaId) => this.model.getDecorationRange(areaId)).sort(Range.compareRangesUsingStarts);\n        if (newRanges.length === oldRanges.length) {\n            let hasDifference = false;\n            for (let i = 0; i < newRanges.length; i++) {\n                if (!newRanges[i].equalsRange(oldRanges[i])) {\n                    hasDifference = true;\n                    break;\n                }\n            }\n            if (!hasDifference) {\n                return false;\n            }\n        }\n        const newDecorations = newRanges.map((r) => ({\n            range: r,\n            options: ModelDecorationOptions.EMPTY,\n        }));\n        this.hiddenAreasDecorationIds = this.model.deltaDecorations(this.hiddenAreasDecorationIds, newDecorations);\n        const hiddenAreas = newRanges;\n        let hiddenAreaStart = 1, hiddenAreaEnd = 0;\n        let hiddenAreaIdx = -1;\n        let nextLineNumberToUpdateHiddenArea = (hiddenAreaIdx + 1 < hiddenAreas.length) ? hiddenAreaEnd + 1 : this.modelLineProjections.length + 2;\n        let hasVisibleLine = false;\n        for (let i = 0; i < this.modelLineProjections.length; i++) {\n            const lineNumber = i + 1;\n            if (lineNumber === nextLineNumberToUpdateHiddenArea) {\n                hiddenAreaIdx++;\n                hiddenAreaStart = hiddenAreas[hiddenAreaIdx].startLineNumber;\n                hiddenAreaEnd = hiddenAreas[hiddenAreaIdx].endLineNumber;\n                nextLineNumberToUpdateHiddenArea = (hiddenAreaIdx + 1 < hiddenAreas.length) ? hiddenAreaEnd + 1 : this.modelLineProjections.length + 2;\n            }\n            let lineChanged = false;\n            if (lineNumber >= hiddenAreaStart && lineNumber <= hiddenAreaEnd) {\n                // Line should be hidden\n                if (this.modelLineProjections[i].isVisible()) {\n                    this.modelLineProjections[i] = this.modelLineProjections[i].setVisible(false);\n                    lineChanged = true;\n                }\n            }\n            else {\n                hasVisibleLine = true;\n                // Line should be visible\n                if (!this.modelLineProjections[i].isVisible()) {\n                    this.modelLineProjections[i] = this.modelLineProjections[i].setVisible(true);\n                    lineChanged = true;\n                }\n            }\n            if (lineChanged) {\n                const newOutputLineCount = this.modelLineProjections[i].getViewLineCount();\n                this.projectedModelLineLineCounts.setValue(i, newOutputLineCount);\n            }\n        }\n        if (!hasVisibleLine) {\n            // Cannot have everything be hidden => reveal everything!\n            this.setHiddenAreas([]);\n        }\n        return true;\n    }\n    modelPositionIsVisible(modelLineNumber, _modelColumn) {\n        if (modelLineNumber < 1 || modelLineNumber > this.modelLineProjections.length) {\n            // invalid arguments\n            return false;\n        }\n        return this.modelLineProjections[modelLineNumber - 1].isVisible();\n    }\n    getModelLineViewLineCount(modelLineNumber) {\n        if (modelLineNumber < 1 || modelLineNumber > this.modelLineProjections.length) {\n            // invalid arguments\n            return 1;\n        }\n        return this.modelLineProjections[modelLineNumber - 1].getViewLineCount();\n    }\n    setTabSize(newTabSize) {\n        if (this.tabSize === newTabSize) {\n            return false;\n        }\n        this.tabSize = newTabSize;\n        this._constructLines(/*resetHiddenAreas*/ false, null);\n        return true;\n    }\n    setWrappingSettings(fontInfo, wrappingStrategy, wrappingColumn, wrappingIndent) {\n        const equalFontInfo = this.fontInfo.equals(fontInfo);\n        const equalWrappingStrategy = (this.wrappingStrategy === wrappingStrategy);\n        const equalWrappingColumn = (this.wrappingColumn === wrappingColumn);\n        const equalWrappingIndent = (this.wrappingIndent === wrappingIndent);\n        if (equalFontInfo && equalWrappingStrategy && equalWrappingColumn && equalWrappingIndent) {\n            return false;\n        }\n        const onlyWrappingColumnChanged = (equalFontInfo && equalWrappingStrategy && !equalWrappingColumn && equalWrappingIndent);\n        this.fontInfo = fontInfo;\n        this.wrappingStrategy = wrappingStrategy;\n        this.wrappingColumn = wrappingColumn;\n        this.wrappingIndent = wrappingIndent;\n        let previousLineBreaks = null;\n        if (onlyWrappingColumnChanged) {\n            previousLineBreaks = [];\n            for (let i = 0, len = this.modelLineProjections.length; i < len; i++) {\n                previousLineBreaks[i] = this.modelLineProjections[i].getProjectionData();\n            }\n        }\n        this._constructLines(/*resetHiddenAreas*/ false, previousLineBreaks);\n        return true;\n    }\n    createLineBreaksComputer() {\n        const lineBreaksComputerFactory = (this.wrappingStrategy === 'advanced'\n            ? this._domLineBreaksComputerFactory\n            : this._monospaceLineBreaksComputerFactory);\n        return lineBreaksComputerFactory.createLineBreaksComputer(this.fontInfo, this.tabSize, this.wrappingColumn, this.wrappingIndent);\n    }\n    onModelFlushed() {\n        this._constructLines(/*resetHiddenAreas*/ true, null);\n    }\n    onModelLinesDeleted(versionId, fromLineNumber, toLineNumber) {\n        if (!versionId || versionId <= this._validModelVersionId) {\n            // Here we check for versionId in case the lines were reconstructed in the meantime.\n            // We don't want to apply stale change events on top of a newer read model state.\n            return null;\n        }\n        const outputFromLineNumber = (fromLineNumber === 1 ? 1 : this.projectedModelLineLineCounts.getPrefixSum(fromLineNumber - 1) + 1);\n        const outputToLineNumber = this.projectedModelLineLineCounts.getPrefixSum(toLineNumber);\n        this.modelLineProjections.splice(fromLineNumber - 1, toLineNumber - fromLineNumber + 1);\n        this.projectedModelLineLineCounts.removeValues(fromLineNumber - 1, toLineNumber - fromLineNumber + 1);\n        return new viewEvents.ViewLinesDeletedEvent(outputFromLineNumber, outputToLineNumber);\n    }\n    onModelLinesInserted(versionId, fromLineNumber, _toLineNumber, lineBreaks) {\n        if (!versionId || versionId <= this._validModelVersionId) {\n            // Here we check for versionId in case the lines were reconstructed in the meantime.\n            // We don't want to apply stale change events on top of a newer read model state.\n            return null;\n        }\n        // cannot use this.getHiddenAreas() because those decorations have already seen the effect of this model change\n        const isInHiddenArea = (fromLineNumber > 2 && !this.modelLineProjections[fromLineNumber - 2].isVisible());\n        const outputFromLineNumber = (fromLineNumber === 1 ? 1 : this.projectedModelLineLineCounts.getPrefixSum(fromLineNumber - 1) + 1);\n        let totalOutputLineCount = 0;\n        const insertLines = [];\n        const insertPrefixSumValues = [];\n        for (let i = 0, len = lineBreaks.length; i < len; i++) {\n            const line = createModelLineProjection(lineBreaks[i], !isInHiddenArea);\n            insertLines.push(line);\n            const outputLineCount = line.getViewLineCount();\n            totalOutputLineCount += outputLineCount;\n            insertPrefixSumValues[i] = outputLineCount;\n        }\n        // TODO@Alex: use arrays.arrayInsert\n        this.modelLineProjections =\n            this.modelLineProjections.slice(0, fromLineNumber - 1)\n                .concat(insertLines)\n                .concat(this.modelLineProjections.slice(fromLineNumber - 1));\n        this.projectedModelLineLineCounts.insertValues(fromLineNumber - 1, insertPrefixSumValues);\n        return new viewEvents.ViewLinesInsertedEvent(outputFromLineNumber, outputFromLineNumber + totalOutputLineCount - 1);\n    }\n    onModelLineChanged(versionId, lineNumber, lineBreakData) {\n        if (versionId !== null && versionId <= this._validModelVersionId) {\n            // Here we check for versionId in case the lines were reconstructed in the meantime.\n            // We don't want to apply stale change events on top of a newer read model state.\n            return [false, null, null, null];\n        }\n        const lineIndex = lineNumber - 1;\n        const oldOutputLineCount = this.modelLineProjections[lineIndex].getViewLineCount();\n        const isVisible = this.modelLineProjections[lineIndex].isVisible();\n        const line = createModelLineProjection(lineBreakData, isVisible);\n        this.modelLineProjections[lineIndex] = line;\n        const newOutputLineCount = this.modelLineProjections[lineIndex].getViewLineCount();\n        let lineMappingChanged = false;\n        let changeFrom = 0;\n        let changeTo = -1;\n        let insertFrom = 0;\n        let insertTo = -1;\n        let deleteFrom = 0;\n        let deleteTo = -1;\n        if (oldOutputLineCount > newOutputLineCount) {\n            changeFrom = this.projectedModelLineLineCounts.getPrefixSum(lineNumber - 1) + 1;\n            changeTo = changeFrom + newOutputLineCount - 1;\n            deleteFrom = changeTo + 1;\n            deleteTo = deleteFrom + (oldOutputLineCount - newOutputLineCount) - 1;\n            lineMappingChanged = true;\n        }\n        else if (oldOutputLineCount < newOutputLineCount) {\n            changeFrom = this.projectedModelLineLineCounts.getPrefixSum(lineNumber - 1) + 1;\n            changeTo = changeFrom + oldOutputLineCount - 1;\n            insertFrom = changeTo + 1;\n            insertTo = insertFrom + (newOutputLineCount - oldOutputLineCount) - 1;\n            lineMappingChanged = true;\n        }\n        else {\n            changeFrom = this.projectedModelLineLineCounts.getPrefixSum(lineNumber - 1) + 1;\n            changeTo = changeFrom + newOutputLineCount - 1;\n        }\n        this.projectedModelLineLineCounts.setValue(lineIndex, newOutputLineCount);\n        const viewLinesChangedEvent = (changeFrom <= changeTo ? new viewEvents.ViewLinesChangedEvent(changeFrom, changeTo - changeFrom + 1) : null);\n        const viewLinesInsertedEvent = (insertFrom <= insertTo ? new viewEvents.ViewLinesInsertedEvent(insertFrom, insertTo) : null);\n        const viewLinesDeletedEvent = (deleteFrom <= deleteTo ? new viewEvents.ViewLinesDeletedEvent(deleteFrom, deleteTo) : null);\n        return [lineMappingChanged, viewLinesChangedEvent, viewLinesInsertedEvent, viewLinesDeletedEvent];\n    }\n    acceptVersionId(versionId) {\n        this._validModelVersionId = versionId;\n        if (this.modelLineProjections.length === 1 && !this.modelLineProjections[0].isVisible()) {\n            // At least one line must be visible => reset hidden areas\n            this.setHiddenAreas([]);\n        }\n    }\n    getViewLineCount() {\n        return this.projectedModelLineLineCounts.getTotalSum();\n    }\n    _toValidViewLineNumber(viewLineNumber) {\n        if (viewLineNumber < 1) {\n            return 1;\n        }\n        const viewLineCount = this.getViewLineCount();\n        if (viewLineNumber > viewLineCount) {\n            return viewLineCount;\n        }\n        return viewLineNumber | 0;\n    }\n    getActiveIndentGuide(viewLineNumber, minLineNumber, maxLineNumber) {\n        viewLineNumber = this._toValidViewLineNumber(viewLineNumber);\n        minLineNumber = this._toValidViewLineNumber(minLineNumber);\n        maxLineNumber = this._toValidViewLineNumber(maxLineNumber);\n        const modelPosition = this.convertViewPositionToModelPosition(viewLineNumber, this.getViewLineMinColumn(viewLineNumber));\n        const modelMinPosition = this.convertViewPositionToModelPosition(minLineNumber, this.getViewLineMinColumn(minLineNumber));\n        const modelMaxPosition = this.convertViewPositionToModelPosition(maxLineNumber, this.getViewLineMinColumn(maxLineNumber));\n        const result = this.model.guides.getActiveIndentGuide(modelPosition.lineNumber, modelMinPosition.lineNumber, modelMaxPosition.lineNumber);\n        const viewStartPosition = this.convertModelPositionToViewPosition(result.startLineNumber, 1);\n        const viewEndPosition = this.convertModelPositionToViewPosition(result.endLineNumber, this.model.getLineMaxColumn(result.endLineNumber));\n        return {\n            startLineNumber: viewStartPosition.lineNumber,\n            endLineNumber: viewEndPosition.lineNumber,\n            indent: result.indent\n        };\n    }\n    // #region ViewLineInfo\n    getViewLineInfo(viewLineNumber) {\n        viewLineNumber = this._toValidViewLineNumber(viewLineNumber);\n        const r = this.projectedModelLineLineCounts.getIndexOf(viewLineNumber - 1);\n        const lineIndex = r.index;\n        const remainder = r.remainder;\n        return new ViewLineInfo(lineIndex + 1, remainder);\n    }\n    getMinColumnOfViewLine(viewLineInfo) {\n        return this.modelLineProjections[viewLineInfo.modelLineNumber - 1].getViewLineMinColumn(this.model, viewLineInfo.modelLineNumber, viewLineInfo.modelLineWrappedLineIdx);\n    }\n    getMaxColumnOfViewLine(viewLineInfo) {\n        return this.modelLineProjections[viewLineInfo.modelLineNumber - 1].getViewLineMaxColumn(this.model, viewLineInfo.modelLineNumber, viewLineInfo.modelLineWrappedLineIdx);\n    }\n    getModelStartPositionOfViewLine(viewLineInfo) {\n        const line = this.modelLineProjections[viewLineInfo.modelLineNumber - 1];\n        const minViewColumn = line.getViewLineMinColumn(this.model, viewLineInfo.modelLineNumber, viewLineInfo.modelLineWrappedLineIdx);\n        const column = line.getModelColumnOfViewPosition(viewLineInfo.modelLineWrappedLineIdx, minViewColumn);\n        return new Position(viewLineInfo.modelLineNumber, column);\n    }\n    getModelEndPositionOfViewLine(viewLineInfo) {\n        const line = this.modelLineProjections[viewLineInfo.modelLineNumber - 1];\n        const maxViewColumn = line.getViewLineMaxColumn(this.model, viewLineInfo.modelLineNumber, viewLineInfo.modelLineWrappedLineIdx);\n        const column = line.getModelColumnOfViewPosition(viewLineInfo.modelLineWrappedLineIdx, maxViewColumn);\n        return new Position(viewLineInfo.modelLineNumber, column);\n    }\n    getViewLineInfosGroupedByModelRanges(viewStartLineNumber, viewEndLineNumber) {\n        const startViewLine = this.getViewLineInfo(viewStartLineNumber);\n        const endViewLine = this.getViewLineInfo(viewEndLineNumber);\n        const result = new Array();\n        let lastVisibleModelPos = this.getModelStartPositionOfViewLine(startViewLine);\n        let viewLines = new Array();\n        for (let curModelLine = startViewLine.modelLineNumber; curModelLine <= endViewLine.modelLineNumber; curModelLine++) {\n            const line = this.modelLineProjections[curModelLine - 1];\n            if (line.isVisible()) {\n                const startOffset = curModelLine === startViewLine.modelLineNumber\n                    ? startViewLine.modelLineWrappedLineIdx\n                    : 0;\n                const endOffset = curModelLine === endViewLine.modelLineNumber\n                    ? endViewLine.modelLineWrappedLineIdx + 1\n                    : line.getViewLineCount();\n                for (let i = startOffset; i < endOffset; i++) {\n                    viewLines.push(new ViewLineInfo(curModelLine, i));\n                }\n            }\n            if (!line.isVisible() && lastVisibleModelPos) {\n                const lastVisibleModelPos2 = new Position(curModelLine - 1, this.model.getLineMaxColumn(curModelLine - 1) + 1);\n                const modelRange = Range.fromPositions(lastVisibleModelPos, lastVisibleModelPos2);\n                result.push(new ViewLineInfoGroupedByModelRange(modelRange, viewLines));\n                viewLines = [];\n                lastVisibleModelPos = null;\n            }\n            else if (line.isVisible() && !lastVisibleModelPos) {\n                lastVisibleModelPos = new Position(curModelLine, 1);\n            }\n        }\n        if (lastVisibleModelPos) {\n            const modelRange = Range.fromPositions(lastVisibleModelPos, this.getModelEndPositionOfViewLine(endViewLine));\n            result.push(new ViewLineInfoGroupedByModelRange(modelRange, viewLines));\n        }\n        return result;\n    }\n    // #endregion\n    getViewLinesBracketGuides(viewStartLineNumber, viewEndLineNumber, activeViewPosition, options) {\n        const modelActivePosition = activeViewPosition ? this.convertViewPositionToModelPosition(activeViewPosition.lineNumber, activeViewPosition.column) : null;\n        const resultPerViewLine = [];\n        for (const group of this.getViewLineInfosGroupedByModelRanges(viewStartLineNumber, viewEndLineNumber)) {\n            const modelRangeStartLineNumber = group.modelRange.startLineNumber;\n            const bracketGuidesPerModelLine = this.model.guides.getLinesBracketGuides(modelRangeStartLineNumber, group.modelRange.endLineNumber, modelActivePosition, options);\n            for (const viewLineInfo of group.viewLines) {\n                const bracketGuides = bracketGuidesPerModelLine[viewLineInfo.modelLineNumber - modelRangeStartLineNumber];\n                // visibleColumns stay as they are (this is a bug and needs to be fixed, but it is not a regression)\n                // model-columns must be converted to view-model columns.\n                const result = bracketGuides.map(g => {\n                    if (g.forWrappedLinesAfterColumn !== -1) {\n                        const p = this.modelLineProjections[viewLineInfo.modelLineNumber - 1].getViewPositionOfModelPosition(0, g.forWrappedLinesAfterColumn);\n                        if (p.lineNumber >= viewLineInfo.modelLineWrappedLineIdx) {\n                            return undefined;\n                        }\n                    }\n                    if (g.forWrappedLinesBeforeOrAtColumn !== -1) {\n                        const p = this.modelLineProjections[viewLineInfo.modelLineNumber - 1].getViewPositionOfModelPosition(0, g.forWrappedLinesBeforeOrAtColumn);\n                        if (p.lineNumber < viewLineInfo.modelLineWrappedLineIdx) {\n                            return undefined;\n                        }\n                    }\n                    if (!g.horizontalLine) {\n                        return g;\n                    }\n                    let column = -1;\n                    if (g.column !== -1) {\n                        const p = this.modelLineProjections[viewLineInfo.modelLineNumber - 1].getViewPositionOfModelPosition(0, g.column);\n                        if (p.lineNumber === viewLineInfo.modelLineWrappedLineIdx) {\n                            column = p.column;\n                        }\n                        else if (p.lineNumber < viewLineInfo.modelLineWrappedLineIdx) {\n                            column = this.getMinColumnOfViewLine(viewLineInfo);\n                        }\n                        else if (p.lineNumber > viewLineInfo.modelLineWrappedLineIdx) {\n                            return undefined;\n                        }\n                    }\n                    const viewPosition = this.convertModelPositionToViewPosition(viewLineInfo.modelLineNumber, g.horizontalLine.endColumn);\n                    const p = this.modelLineProjections[viewLineInfo.modelLineNumber - 1].getViewPositionOfModelPosition(0, g.horizontalLine.endColumn);\n                    if (p.lineNumber === viewLineInfo.modelLineWrappedLineIdx) {\n                        return new IndentGuide(g.visibleColumn, column, g.className, new IndentGuideHorizontalLine(g.horizontalLine.top, viewPosition.column), -1, -1);\n                    }\n                    else if (p.lineNumber < viewLineInfo.modelLineWrappedLineIdx) {\n                        return undefined;\n                    }\n                    else {\n                        if (g.visibleColumn !== -1) {\n                            // Don't repeat horizontal lines that use visibleColumn for unrelated lines.\n                            return undefined;\n                        }\n                        return new IndentGuide(g.visibleColumn, column, g.className, new IndentGuideHorizontalLine(g.horizontalLine.top, this.getMaxColumnOfViewLine(viewLineInfo)), -1, -1);\n                    }\n                });\n                resultPerViewLine.push(result.filter((r) => !!r));\n            }\n        }\n        return resultPerViewLine;\n    }\n    getViewLinesIndentGuides(viewStartLineNumber, viewEndLineNumber) {\n        // TODO: Use the same code as in `getViewLinesBracketGuides`.\n        // Future TODO: Merge with `getViewLinesBracketGuides`.\n        // However, this requires more refactoring of indent guides.\n        viewStartLineNumber = this._toValidViewLineNumber(viewStartLineNumber);\n        viewEndLineNumber = this._toValidViewLineNumber(viewEndLineNumber);\n        const modelStart = this.convertViewPositionToModelPosition(viewStartLineNumber, this.getViewLineMinColumn(viewStartLineNumber));\n        const modelEnd = this.convertViewPositionToModelPosition(viewEndLineNumber, this.getViewLineMaxColumn(viewEndLineNumber));\n        let result = [];\n        const resultRepeatCount = [];\n        const resultRepeatOption = [];\n        const modelStartLineIndex = modelStart.lineNumber - 1;\n        const modelEndLineIndex = modelEnd.lineNumber - 1;\n        let reqStart = null;\n        for (let modelLineIndex = modelStartLineIndex; modelLineIndex <= modelEndLineIndex; modelLineIndex++) {\n            const line = this.modelLineProjections[modelLineIndex];\n            if (line.isVisible()) {\n                const viewLineStartIndex = line.getViewLineNumberOfModelPosition(0, modelLineIndex === modelStartLineIndex ? modelStart.column : 1);\n                const viewLineEndIndex = line.getViewLineNumberOfModelPosition(0, this.model.getLineMaxColumn(modelLineIndex + 1));\n                const count = viewLineEndIndex - viewLineStartIndex + 1;\n                let option = 0 /* IndentGuideRepeatOption.BlockNone */;\n                if (count > 1 && line.getViewLineMinColumn(this.model, modelLineIndex + 1, viewLineEndIndex) === 1) {\n                    // wrapped lines should block indent guides\n                    option = (viewLineStartIndex === 0 ? 1 /* IndentGuideRepeatOption.BlockSubsequent */ : 2 /* IndentGuideRepeatOption.BlockAll */);\n                }\n                resultRepeatCount.push(count);\n                resultRepeatOption.push(option);\n                // merge into previous request\n                if (reqStart === null) {\n                    reqStart = new Position(modelLineIndex + 1, 0);\n                }\n            }\n            else {\n                // hit invisible line => flush request\n                if (reqStart !== null) {\n                    result = result.concat(this.model.guides.getLinesIndentGuides(reqStart.lineNumber, modelLineIndex));\n                    reqStart = null;\n                }\n            }\n        }\n        if (reqStart !== null) {\n            result = result.concat(this.model.guides.getLinesIndentGuides(reqStart.lineNumber, modelEnd.lineNumber));\n            reqStart = null;\n        }\n        const viewLineCount = viewEndLineNumber - viewStartLineNumber + 1;\n        const viewIndents = new Array(viewLineCount);\n        let currIndex = 0;\n        for (let i = 0, len = result.length; i < len; i++) {\n            let value = result[i];\n            const count = Math.min(viewLineCount - currIndex, resultRepeatCount[i]);\n            const option = resultRepeatOption[i];\n            let blockAtIndex;\n            if (option === 2 /* IndentGuideRepeatOption.BlockAll */) {\n                blockAtIndex = 0;\n            }\n            else if (option === 1 /* IndentGuideRepeatOption.BlockSubsequent */) {\n                blockAtIndex = 1;\n            }\n            else {\n                blockAtIndex = count;\n            }\n            for (let j = 0; j < count; j++) {\n                if (j === blockAtIndex) {\n                    value = 0;\n                }\n                viewIndents[currIndex++] = value;\n            }\n        }\n        return viewIndents;\n    }\n    getViewLineContent(viewLineNumber) {\n        const info = this.getViewLineInfo(viewLineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].getViewLineContent(this.model, info.modelLineNumber, info.modelLineWrappedLineIdx);\n    }\n    getViewLineLength(viewLineNumber) {\n        const info = this.getViewLineInfo(viewLineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].getViewLineLength(this.model, info.modelLineNumber, info.modelLineWrappedLineIdx);\n    }\n    getViewLineMinColumn(viewLineNumber) {\n        const info = this.getViewLineInfo(viewLineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].getViewLineMinColumn(this.model, info.modelLineNumber, info.modelLineWrappedLineIdx);\n    }\n    getViewLineMaxColumn(viewLineNumber) {\n        const info = this.getViewLineInfo(viewLineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].getViewLineMaxColumn(this.model, info.modelLineNumber, info.modelLineWrappedLineIdx);\n    }\n    getViewLineData(viewLineNumber) {\n        const info = this.getViewLineInfo(viewLineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].getViewLineData(this.model, info.modelLineNumber, info.modelLineWrappedLineIdx);\n    }\n    getViewLinesData(viewStartLineNumber, viewEndLineNumber, needed) {\n        viewStartLineNumber = this._toValidViewLineNumber(viewStartLineNumber);\n        viewEndLineNumber = this._toValidViewLineNumber(viewEndLineNumber);\n        const start = this.projectedModelLineLineCounts.getIndexOf(viewStartLineNumber - 1);\n        let viewLineNumber = viewStartLineNumber;\n        const startModelLineIndex = start.index;\n        const startRemainder = start.remainder;\n        const result = [];\n        for (let modelLineIndex = startModelLineIndex, len = this.model.getLineCount(); modelLineIndex < len; modelLineIndex++) {\n            const line = this.modelLineProjections[modelLineIndex];\n            if (!line.isVisible()) {\n                continue;\n            }\n            const fromViewLineIndex = (modelLineIndex === startModelLineIndex ? startRemainder : 0);\n            let remainingViewLineCount = line.getViewLineCount() - fromViewLineIndex;\n            let lastLine = false;\n            if (viewLineNumber + remainingViewLineCount > viewEndLineNumber) {\n                lastLine = true;\n                remainingViewLineCount = viewEndLineNumber - viewLineNumber + 1;\n            }\n            line.getViewLinesData(this.model, modelLineIndex + 1, fromViewLineIndex, remainingViewLineCount, viewLineNumber - viewStartLineNumber, needed, result);\n            viewLineNumber += remainingViewLineCount;\n            if (lastLine) {\n                break;\n            }\n        }\n        return result;\n    }\n    validateViewPosition(viewLineNumber, viewColumn, expectedModelPosition) {\n        viewLineNumber = this._toValidViewLineNumber(viewLineNumber);\n        const r = this.projectedModelLineLineCounts.getIndexOf(viewLineNumber - 1);\n        const lineIndex = r.index;\n        const remainder = r.remainder;\n        const line = this.modelLineProjections[lineIndex];\n        const minColumn = line.getViewLineMinColumn(this.model, lineIndex + 1, remainder);\n        const maxColumn = line.getViewLineMaxColumn(this.model, lineIndex + 1, remainder);\n        if (viewColumn < minColumn) {\n            viewColumn = minColumn;\n        }\n        if (viewColumn > maxColumn) {\n            viewColumn = maxColumn;\n        }\n        const computedModelColumn = line.getModelColumnOfViewPosition(remainder, viewColumn);\n        const computedModelPosition = this.model.validatePosition(new Position(lineIndex + 1, computedModelColumn));\n        if (computedModelPosition.equals(expectedModelPosition)) {\n            return new Position(viewLineNumber, viewColumn);\n        }\n        return this.convertModelPositionToViewPosition(expectedModelPosition.lineNumber, expectedModelPosition.column);\n    }\n    validateViewRange(viewRange, expectedModelRange) {\n        const validViewStart = this.validateViewPosition(viewRange.startLineNumber, viewRange.startColumn, expectedModelRange.getStartPosition());\n        const validViewEnd = this.validateViewPosition(viewRange.endLineNumber, viewRange.endColumn, expectedModelRange.getEndPosition());\n        return new Range(validViewStart.lineNumber, validViewStart.column, validViewEnd.lineNumber, validViewEnd.column);\n    }\n    convertViewPositionToModelPosition(viewLineNumber, viewColumn) {\n        const info = this.getViewLineInfo(viewLineNumber);\n        const inputColumn = this.modelLineProjections[info.modelLineNumber - 1].getModelColumnOfViewPosition(info.modelLineWrappedLineIdx, viewColumn);\n        // console.log('out -> in ' + viewLineNumber + ',' + viewColumn + ' ===> ' + (lineIndex+1) + ',' + inputColumn);\n        return this.model.validatePosition(new Position(info.modelLineNumber, inputColumn));\n    }\n    convertViewRangeToModelRange(viewRange) {\n        const start = this.convertViewPositionToModelPosition(viewRange.startLineNumber, viewRange.startColumn);\n        const end = this.convertViewPositionToModelPosition(viewRange.endLineNumber, viewRange.endColumn);\n        return new Range(start.lineNumber, start.column, end.lineNumber, end.column);\n    }\n    convertModelPositionToViewPosition(_modelLineNumber, _modelColumn, affinity = 2 /* PositionAffinity.None */) {\n        const validPosition = this.model.validatePosition(new Position(_modelLineNumber, _modelColumn));\n        const inputLineNumber = validPosition.lineNumber;\n        const inputColumn = validPosition.column;\n        let lineIndex = inputLineNumber - 1, lineIndexChanged = false;\n        while (lineIndex > 0 && !this.modelLineProjections[lineIndex].isVisible()) {\n            lineIndex--;\n            lineIndexChanged = true;\n        }\n        if (lineIndex === 0 && !this.modelLineProjections[lineIndex].isVisible()) {\n            // Could not reach a real line\n            // console.log('in -> out ' + inputLineNumber + ',' + inputColumn + ' ===> ' + 1 + ',' + 1);\n            return new Position(1, 1);\n        }\n        const deltaLineNumber = 1 + this.projectedModelLineLineCounts.getPrefixSum(lineIndex);\n        let r;\n        if (lineIndexChanged) {\n            r = this.modelLineProjections[lineIndex].getViewPositionOfModelPosition(deltaLineNumber, this.model.getLineMaxColumn(lineIndex + 1), affinity);\n        }\n        else {\n            r = this.modelLineProjections[inputLineNumber - 1].getViewPositionOfModelPosition(deltaLineNumber, inputColumn, affinity);\n        }\n        // console.log('in -> out ' + inputLineNumber + ',' + inputColumn + ' ===> ' + r.lineNumber + ',' + r);\n        return r;\n    }\n    /**\n     * @param affinity The affinity in case of an empty range. Has no effect for non-empty ranges.\n    */\n    convertModelRangeToViewRange(modelRange, affinity = 0 /* PositionAffinity.Left */) {\n        if (modelRange.isEmpty()) {\n            const start = this.convertModelPositionToViewPosition(modelRange.startLineNumber, modelRange.startColumn, affinity);\n            return Range.fromPositions(start);\n        }\n        else {\n            const start = this.convertModelPositionToViewPosition(modelRange.startLineNumber, modelRange.startColumn, 1 /* PositionAffinity.Right */);\n            const end = this.convertModelPositionToViewPosition(modelRange.endLineNumber, modelRange.endColumn, 0 /* PositionAffinity.Left */);\n            return new Range(start.lineNumber, start.column, end.lineNumber, end.column);\n        }\n    }\n    getViewLineNumberOfModelPosition(modelLineNumber, modelColumn) {\n        let lineIndex = modelLineNumber - 1;\n        if (this.modelLineProjections[lineIndex].isVisible()) {\n            // this model line is visible\n            const deltaLineNumber = 1 + this.projectedModelLineLineCounts.getPrefixSum(lineIndex);\n            return this.modelLineProjections[lineIndex].getViewLineNumberOfModelPosition(deltaLineNumber, modelColumn);\n        }\n        // this model line is not visible\n        while (lineIndex > 0 && !this.modelLineProjections[lineIndex].isVisible()) {\n            lineIndex--;\n        }\n        if (lineIndex === 0 && !this.modelLineProjections[lineIndex].isVisible()) {\n            // Could not reach a real line\n            return 1;\n        }\n        const deltaLineNumber = 1 + this.projectedModelLineLineCounts.getPrefixSum(lineIndex);\n        return this.modelLineProjections[lineIndex].getViewLineNumberOfModelPosition(deltaLineNumber, this.model.getLineMaxColumn(lineIndex + 1));\n    }\n    getDecorationsInRange(range, ownerId, filterOutValidation) {\n        const modelStart = this.convertViewPositionToModelPosition(range.startLineNumber, range.startColumn);\n        const modelEnd = this.convertViewPositionToModelPosition(range.endLineNumber, range.endColumn);\n        if (modelEnd.lineNumber - modelStart.lineNumber <= range.endLineNumber - range.startLineNumber) {\n            // most likely there are no hidden lines => fast path\n            // fetch decorations from column 1 to cover the case of wrapped lines that have whole line decorations at column 1\n            return this.model.getDecorationsInRange(new Range(modelStart.lineNumber, 1, modelEnd.lineNumber, modelEnd.column), ownerId, filterOutValidation);\n        }\n        let result = [];\n        const modelStartLineIndex = modelStart.lineNumber - 1;\n        const modelEndLineIndex = modelEnd.lineNumber - 1;\n        let reqStart = null;\n        for (let modelLineIndex = modelStartLineIndex; modelLineIndex <= modelEndLineIndex; modelLineIndex++) {\n            const line = this.modelLineProjections[modelLineIndex];\n            if (line.isVisible()) {\n                // merge into previous request\n                if (reqStart === null) {\n                    reqStart = new Position(modelLineIndex + 1, modelLineIndex === modelStartLineIndex ? modelStart.column : 1);\n                }\n            }\n            else {\n                // hit invisible line => flush request\n                if (reqStart !== null) {\n                    const maxLineColumn = this.model.getLineMaxColumn(modelLineIndex);\n                    result = result.concat(this.model.getDecorationsInRange(new Range(reqStart.lineNumber, reqStart.column, modelLineIndex, maxLineColumn), ownerId, filterOutValidation));\n                    reqStart = null;\n                }\n            }\n        }\n        if (reqStart !== null) {\n            result = result.concat(this.model.getDecorationsInRange(new Range(reqStart.lineNumber, reqStart.column, modelEnd.lineNumber, modelEnd.column), ownerId, filterOutValidation));\n            reqStart = null;\n        }\n        result.sort((a, b) => {\n            const res = Range.compareRangesUsingStarts(a.range, b.range);\n            if (res === 0) {\n                if (a.id < b.id) {\n                    return -1;\n                }\n                if (a.id > b.id) {\n                    return 1;\n                }\n                return 0;\n            }\n            return res;\n        });\n        // Eliminate duplicate decorations that might have intersected our visible ranges multiple times\n        const finalResult = [];\n        let finalResultLen = 0;\n        let prevDecId = null;\n        for (const dec of result) {\n            const decId = dec.id;\n            if (prevDecId === decId) {\n                // skip\n                continue;\n            }\n            prevDecId = decId;\n            finalResult[finalResultLen++] = dec;\n        }\n        return finalResult;\n    }\n    getInjectedTextAt(position) {\n        const info = this.getViewLineInfo(position.lineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].getInjectedTextAt(info.modelLineWrappedLineIdx, position.column);\n    }\n    normalizePosition(position, affinity) {\n        const info = this.getViewLineInfo(position.lineNumber);\n        return this.modelLineProjections[info.modelLineNumber - 1].normalizePosition(info.modelLineWrappedLineIdx, position, affinity);\n    }\n    getLineIndentColumn(lineNumber) {\n        const info = this.getViewLineInfo(lineNumber);\n        if (info.modelLineWrappedLineIdx === 0) {\n            return this.model.getLineIndentColumn(info.modelLineNumber);\n        }\n        // wrapped lines have no indentation.\n        // We deliberately don't handle the case that indentation is wrapped\n        // to avoid two view lines reporting indentation for the very same model line.\n        return 0;\n    }\n}\n/**\n * Overlapping unsorted ranges:\n * [   )      [ )       [  )\n *    [    )      [       )\n * ->\n * Non overlapping sorted ranges:\n * [       )  [ ) [        )\n *\n * Note: This function only considers line information! Columns are ignored.\n*/\nfunction normalizeLineRanges(ranges) {\n    if (ranges.length === 0) {\n        return [];\n    }\n    const sortedRanges = ranges.slice();\n    sortedRanges.sort(Range.compareRangesUsingStarts);\n    const result = [];\n    let currentRangeStart = sortedRanges[0].startLineNumber;\n    let currentRangeEnd = sortedRanges[0].endLineNumber;\n    for (let i = 1, len = sortedRanges.length; i < len; i++) {\n        const range = sortedRanges[i];\n        if (range.startLineNumber > currentRangeEnd + 1) {\n            result.push(new Range(currentRangeStart, 1, currentRangeEnd, 1));\n            currentRangeStart = range.startLineNumber;\n            currentRangeEnd = range.endLineNumber;\n        }\n        else if (range.endLineNumber > currentRangeEnd) {\n            currentRangeEnd = range.endLineNumber;\n        }\n    }\n    result.push(new Range(currentRangeStart, 1, currentRangeEnd, 1));\n    return result;\n}\n/**\n * Represents a view line. Can be used to efficiently query more information about it.\n */\nclass ViewLineInfo {\n    constructor(modelLineNumber, modelLineWrappedLineIdx) {\n        this.modelLineNumber = modelLineNumber;\n        this.modelLineWrappedLineIdx = modelLineWrappedLineIdx;\n    }\n}\n/**\n * A list of view lines that have a contiguous span in the model.\n*/\nclass ViewLineInfoGroupedByModelRange {\n    constructor(modelRange, viewLines) {\n        this.modelRange = modelRange;\n        this.viewLines = viewLines;\n    }\n}\nclass CoordinatesConverter {\n    constructor(lines) {\n        this._lines = lines;\n    }\n    // View -> Model conversion and related methods\n    convertViewPositionToModelPosition(viewPosition) {\n        return this._lines.convertViewPositionToModelPosition(viewPosition.lineNumber, viewPosition.column);\n    }\n    convertViewRangeToModelRange(viewRange) {\n        return this._lines.convertViewRangeToModelRange(viewRange);\n    }\n    validateViewPosition(viewPosition, expectedModelPosition) {\n        return this._lines.validateViewPosition(viewPosition.lineNumber, viewPosition.column, expectedModelPosition);\n    }\n    validateViewRange(viewRange, expectedModelRange) {\n        return this._lines.validateViewRange(viewRange, expectedModelRange);\n    }\n    // Model -> View conversion and related methods\n    convertModelPositionToViewPosition(modelPosition, affinity) {\n        return this._lines.convertModelPositionToViewPosition(modelPosition.lineNumber, modelPosition.column, affinity);\n    }\n    convertModelRangeToViewRange(modelRange, affinity) {\n        return this._lines.convertModelRangeToViewRange(modelRange, affinity);\n    }\n    modelPositionIsVisible(modelPosition) {\n        return this._lines.modelPositionIsVisible(modelPosition.lineNumber, modelPosition.column);\n    }\n    getModelLineViewLineCount(modelLineNumber) {\n        return this._lines.getModelLineViewLineCount(modelLineNumber);\n    }\n    getViewLineNumberOfModelPosition(modelLineNumber, modelColumn) {\n        return this._lines.getViewLineNumberOfModelPosition(modelLineNumber, modelColumn);\n    }\n}\nexport class ViewModelLinesFromModelAsIs {\n    constructor(model) {\n        this.model = model;\n    }\n    dispose() {\n    }\n    createCoordinatesConverter() {\n        return new IdentityCoordinatesConverter(this);\n    }\n    getHiddenAreas() {\n        return [];\n    }\n    setHiddenAreas(_ranges) {\n        return false;\n    }\n    setTabSize(_newTabSize) {\n        return false;\n    }\n    setWrappingSettings(_fontInfo, _wrappingStrategy, _wrappingColumn, _wrappingIndent) {\n        return false;\n    }\n    createLineBreaksComputer() {\n        const result = [];\n        return {\n            addRequest: (lineText, injectedText, previousLineBreakData) => {\n                result.push(null);\n            },\n            finalize: () => {\n                return result;\n            }\n        };\n    }\n    onModelFlushed() {\n    }\n    onModelLinesDeleted(_versionId, fromLineNumber, toLineNumber) {\n        return new viewEvents.ViewLinesDeletedEvent(fromLineNumber, toLineNumber);\n    }\n    onModelLinesInserted(_versionId, fromLineNumber, toLineNumber, lineBreaks) {\n        return new viewEvents.ViewLinesInsertedEvent(fromLineNumber, toLineNumber);\n    }\n    onModelLineChanged(_versionId, lineNumber, lineBreakData) {\n        return [false, new viewEvents.ViewLinesChangedEvent(lineNumber, 1), null, null];\n    }\n    acceptVersionId(_versionId) {\n    }\n    getViewLineCount() {\n        return this.model.getLineCount();\n    }\n    getActiveIndentGuide(viewLineNumber, _minLineNumber, _maxLineNumber) {\n        return {\n            startLineNumber: viewLineNumber,\n            endLineNumber: viewLineNumber,\n            indent: 0\n        };\n    }\n    getViewLinesBracketGuides(startLineNumber, endLineNumber, activePosition) {\n        return new Array(endLineNumber - startLineNumber + 1).fill([]);\n    }\n    getViewLinesIndentGuides(viewStartLineNumber, viewEndLineNumber) {\n        const viewLineCount = viewEndLineNumber - viewStartLineNumber + 1;\n        const result = new Array(viewLineCount);\n        for (let i = 0; i < viewLineCount; i++) {\n            result[i] = 0;\n        }\n        return result;\n    }\n    getViewLineContent(viewLineNumber) {\n        return this.model.getLineContent(viewLineNumber);\n    }\n    getViewLineLength(viewLineNumber) {\n        return this.model.getLineLength(viewLineNumber);\n    }\n    getViewLineMinColumn(viewLineNumber) {\n        return this.model.getLineMinColumn(viewLineNumber);\n    }\n    getViewLineMaxColumn(viewLineNumber) {\n        return this.model.getLineMaxColumn(viewLineNumber);\n    }\n    getViewLineData(viewLineNumber) {\n        const lineTokens = this.model.tokenization.getLineTokens(viewLineNumber);\n        const lineContent = lineTokens.getLineContent();\n        return new ViewLineData(lineContent, false, 1, lineContent.length + 1, 0, lineTokens.inflate(), null);\n    }\n    getViewLinesData(viewStartLineNumber, viewEndLineNumber, needed) {\n        const lineCount = this.model.getLineCount();\n        viewStartLineNumber = Math.min(Math.max(1, viewStartLineNumber), lineCount);\n        viewEndLineNumber = Math.min(Math.max(1, viewEndLineNumber), lineCount);\n        const result = [];\n        for (let lineNumber = viewStartLineNumber; lineNumber <= viewEndLineNumber; lineNumber++) {\n            const idx = lineNumber - viewStartLineNumber;\n            result[idx] = needed[idx] ? this.getViewLineData(lineNumber) : null;\n        }\n        return result;\n    }\n    getDecorationsInRange(range, ownerId, filterOutValidation) {\n        return this.model.getDecorationsInRange(range, ownerId, filterOutValidation);\n    }\n    normalizePosition(position, affinity) {\n        return this.model.normalizePosition(position, affinity);\n    }\n    getLineIndentColumn(lineNumber) {\n        return this.model.getLineIndentColumn(lineNumber);\n    }\n    getInjectedTextAt(position) {\n        // Identity lines collection does not support injected text.\n        return null;\n    }\n}\nclass IdentityCoordinatesConverter {\n    constructor(lines) {\n        this._lines = lines;\n    }\n    _validPosition(pos) {\n        return this._lines.model.validatePosition(pos);\n    }\n    _validRange(range) {\n        return this._lines.model.validateRange(range);\n    }\n    // View -> Model conversion and related methods\n    convertViewPositionToModelPosition(viewPosition) {\n        return this._validPosition(viewPosition);\n    }\n    convertViewRangeToModelRange(viewRange) {\n        return this._validRange(viewRange);\n    }\n    validateViewPosition(_viewPosition, expectedModelPosition) {\n        return this._validPosition(expectedModelPosition);\n    }\n    validateViewRange(_viewRange, expectedModelRange) {\n        return this._validRange(expectedModelRange);\n    }\n    // Model -> View conversion and related methods\n    convertModelPositionToViewPosition(modelPosition) {\n        return this._validPosition(modelPosition);\n    }\n    convertModelRangeToViewRange(modelRange) {\n        return this._validRange(modelRange);\n    }\n    modelPositionIsVisible(modelPosition) {\n        const lineCount = this._lines.model.getLineCount();\n        if (modelPosition.lineNumber < 1 || modelPosition.lineNumber > lineCount) {\n            // invalid arguments\n            return false;\n        }\n        return true;\n    }\n    getModelLineViewLineCount(modelLineNumber) {\n        return 1;\n    }\n    getViewLineNumberOfModelPosition(modelLineNumber, modelColumn) {\n        return modelLineNumber;\n    }\n}\n"],"mappings":"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"}]}